(function(){function t(b,c){function g(Qa){Qa=Qa.toString(16);return"#"+"0".repeat(6-Qa.length)+Qa}function h(Qa,Ua,ub,La){Qa.style.width="";Qa.style.height="";La&&(Qa.style.transform="");var Oa=Qa.getBoundingClientRect();La?Qa.style.transform=(1===Ua?"":" scaleX("+Ua+")")+(1===ub?"":" scaleY("+ub+")"):(0===Ua%1&&0===ub%1?(k.style.imageRendering="crisp-edges",k.style.imageRendering="pixelated",k.style["-ms-interpolation-mode"]="nearest-neighbor"):(k.style.imageRendering="",k.style["-ms-interpolation-mode"]=
""),La=window.devicePixelRatio||1,0!==La%1&&(Ua/=La,ub/=La));1!==Ua&&(Qa.style.width=Oa.width*Ua+"px");1!==ub&&(Qa.style.height=Oa.height*ub+"px")}console.assert(b,"1st argument must be a DOM container");var k=b.getElementsByTagName("canvas")[0],y=k.getContext("2d",{alpha:!1}),u=b.getElementsByTagName("div")[0],I=document.createElement("div"),ba,R,U=1,Y=1,fa=1,na,oa=!1,Ca,Ya,ib,zb=!1,Ib=this;b=new Uint16Array([8962,199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,
242,251,249,255,214,220,162,163,165,8359,402,225,237,243,250,241,209,170,186,191,8976,172,189,188,161,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]);for(var vb=
new Uint16Array([32,9786,9787,9829,9830,9827,9824,8226,9688,9675,9689,9794,9792,9834,9835,9788,9658,9668,8597,8252,182,167,9644,8616,8593,8595,8594,8592,8735,8596,9650,9660]),Pb=[],Fb,wb=0;256>wb;wb++)Fb=126<wb?b[wb-127]:32>wb?vb[wb]:wb,Pb[wb]=String.fromCharCode(Fb);y.imageSmoothingEnabled=!1;I.style.position="absolute";I.style.backgroundColor="#ccc";I.style.width="7px";I.style.display="inline-block";u.style.display="block";k.style.display="none";this.bus=c;c.register("screen-set-mode",function(Qa){this.set_mode(Qa)},
this);c.register("screen-fill-buffer-end",function(Qa){this.update_buffer(Qa)},this);c.register("screen-put-char",function(Qa){this.put_char(Qa[0],Qa[1],Qa[2],Qa[3],Qa[4])},this);c.register("screen-update-cursor",function(Qa){this.update_cursor(Qa[0],Qa[1])},this);c.register("screen-update-cursor-scanline",function(Qa){this.update_cursor_scanline(Qa[0],Qa[1])},this);c.register("screen-clear",function(){this.clear_screen()},this);c.register("screen-set-size-text",function(Qa){this.set_size_text(Qa[0],
Qa[1])},this);c.register("screen-set-size-graphical",function(Qa){this.set_size_graphical(Qa[0],Qa[1],Qa[2],Qa[3])},this);this.init=function(){this.set_size_text(80,25);this.timer()};this.make_screenshot=function(){const Qa=new Image;if(oa)Qa.src=k.toDataURL("image/png");else{const Ua=[9,16],ub=document.createElement("canvas");ub.width=Ya*Ua[0];ub.height=ib*Ua[1];const La=ub.getContext("2d");La.imageSmoothingEnabled=!1;La.font=window.getComputedStyle(u).font;La.textBaseline="top";for(let Oa=0;Oa<
Ya;Oa++)for(let $a=0;$a<ib;$a++){const nb=3*($a*Ya+Oa);La.fillStyle=g(Ca[nb+1]);La.fillRect(Oa*Ua[0],$a*Ua[1],Ua[0],Ua[1]);La.fillStyle=g(Ca[nb+2]);La.fillText(Pb[Ca[nb]],Oa*Ua[0],$a*Ua[1])}"none"!==I.style.display&&(La.fillStyle=I.style.backgroundColor,La.fillRect(R*Ua[0],ba*Ua[1]+parseInt(I.style.marginTop,10)-1,parseInt(I.style.width,10),parseInt(I.style.height,10)));Qa.src=ub.toDataURL("image/png")}return Qa};this.put_char=function(Qa,Ua,ub,La,Oa){Qa<ib&&Ua<Ya&&(Ua=3*(Qa*Ya+Ua),H(0<=ub&&256>ub),
Ca[Ua]=ub,Ca[Ua+1]=La,Ca[Ua+2]=Oa,na[Qa]=1)};this.timer=function(){zb||requestAnimationFrame(oa?Zb:$b)};var $b=function(){for(var Qa=0;Qa<ib;Qa++)na[Qa]&&(Ib.text_update_row(Qa),na[Qa]=0);this.timer()}.bind(this),Zb=function(){this.bus.send("screen-fill-buffer");this.timer()}.bind(this);this.destroy=function(){zb=!0};this.set_mode=function(Qa){(oa=Qa)?(u.style.display="none",k.style.display="block"):(u.style.display="block",k.style.display="none")};this.clear_screen=function(){y.fillStyle="#000";
y.fillRect(0,0,k.width,k.height)};this.set_size_text=function(Qa,Ua){if(Qa!==Ya||Ua!==ib){na=new Int8Array(Ua);Ca=new Int32Array(Qa*Ua*3);Ya=Qa;for(ib=Ua;u.childNodes.length>Ua;)u.removeChild(u.firstChild);for(;u.childNodes.length<Ua;)u.appendChild(document.createElement("div"));for(Qa=0;Qa<Ua;Qa++)this.text_update_row(Qa);h(u,U,Y,!0)}};this.set_size_graphical=function(Qa,Ua,ub,La){O&&(Qa=ub,Ua=La);k.style.display="block";k.width=Qa;k.height=Ua;fa=640>=Qa&&2*Qa<window.innerWidth&&2*Qa<window.innerHeight?
2:1;h(k,U*fa,Y*fa,!1)};this.set_scale=function(Qa,Ua){U=Qa;Y=Ua;h(u,U,Y,!0);h(k,U*fa,Y*fa,!1)};this.set_scale(U,Y);this.update_cursor_scanline=function(Qa,Ua){Qa&32?I.style.display="none":(I.style.display="inline",I.style.height=Math.min(15,Ua-Qa)+"px",I.style.marginTop=Math.min(15,Qa)+"px")};this.update_cursor=function(Qa,Ua){if(Qa!==ba||Ua!==R)na[Qa]=1,na[ba]=1,ba=Qa,R=Ua};this.text_update_row=function(Qa){for(var Ua=3*Qa*Ya,ub,La=u.childNodes[Qa],Oa=document.createElement("div"),$a=0;$a<Ya;){var nb=
document.createElement("span"),Jb=Ca[Ua+1],Tb=Ca[Ua+2];nb.style.backgroundColor=g(Jb);nb.style.color=g(Tb);for(ub="";$a<Ya&&Ca[Ua+1]===Jb&&Ca[Ua+2]===Tb;){var Lb=Ca[Ua];ub+=Pb[Lb];H(Pb[Lb]);$a++;Ua+=3;if(Qa===ba)if($a===R)break;else if($a===R+1){Oa.appendChild(I);break}}nb.textContent=ub;Oa.appendChild(nb)}La.parentNode.replaceChild(Oa,La)};this.update_buffer=function(Qa){O?(y.strokeStyle="#0F0",y.lineWidth=4,Qa.forEach(Ua=>{y.strokeRect(Ua.buffer_x,Ua.buffer_y,Ua.buffer_width,Ua.buffer_height)}),
y.lineWidth=1):Qa.forEach(Ua=>{y.putImageData(Ua.image_data,Ua.screen_x-Ua.buffer_x,Ua.screen_y-Ua.buffer_y,Ua.buffer_x,Ua.buffer_y,Ua.buffer_width,Ua.buffer_height)})};this.init()}function G(b){switch(b){case "FILE":return 0;case "DIRECTORY":return 128;case "SYMLINK":return 2;default:return 0}}function K(b,c){b=G(c.type);var g=void 0!=c.version?c.version:0;c=c.node;for(var h=5381,k=c.length;k;)h=33*h^c.charCodeAt(--k);return{type:b,version:g,path:h>>>0}}function e(b,c,g){this.fs=b.fs;this.sh=b.sh;
this.Path=b.Path;this.Buffer=b.Buffer;this.bus=g;this.configspace_tagname=[104,111,115,116,57,112];this.configspace_taglen=this.configspace_tagname.length;this.VERSION="9P2000.L";this.msize=this.BLOCKSIZE=8192;this.replybuffer=new Uint8Array(2*this.msize);this.replybuffersize=0;this.fids={};this.virtio=new P(c,{name:"virtio-9p",pci_id:48,device_id:4169,subsystem_device_id:9,common:{initial_port:43008,queues:[{size_supported:32,notify_offset:0}],features:[0,32,29,28],on_driver_ok:()=>{}},notification:{initial_port:43264,
single_handler:!1,handlers:[h=>{if(0!==h)H(!1,"Virtio-Filer-9P Notified for non-existent queue: "+h+" (expected queue_id of 0)");else{for(;this.virtqueue.has_request();)h=this.virtqueue.pop_request(),this.ReceiveRequest(h);this.virtqueue.notify_me_after(0)}}]},isr_status:{initial_port:42752},device_specific:{initial_port:42496,struct:[{bytes:2,name:"mount tag length",read:()=>this.configspace_taglen,write:h=>{}}].concat(aa.range(254).map(h=>({bytes:1,name:"mount tag name "+h,read:()=>this.configspace_tagname[h]||
0,write:k=>{}})))}});this.virtqueue=this.virtio.queues[0];this.pendingTags={}}function l(b){this.ports=[];this.cpu=b;for(var c=0;65536>c;c++)this.ports[c]=this.create_empty_entry();var g=b.memory_size[0];for(c=0;c<<17<g;c++)b.memory_map_read8[c]=b.memory_map_write8[c]=void 0,b.memory_map_read32[c]=b.memory_map_write32[c]=void 0;this.mmap_register(g,4294967296-g,function(h){r("Read from unmapped memory space, addr="+d(h>>>0,8),32);return 255},function(h,k){r("Write to unmapped memory space, addr="+
d(h>>>0,8)+" value="+d(k,2),32)},function(h){r("Read from unmapped memory space, addr="+d(h>>>0,8),32);return-1},function(h,k){r("Write to unmapped memory space, addr="+d(h>>>0,8)+" value="+d(k>>>0,8),32)})}function f(b,c){this.stopping=this.running=!1;this.tick_counter=0;this.worker=null;this.cpu=new sa(b,c,()=>{this.idle&&this.next_tick(0)});this.bus=b;b.register("cpu-init",this.init,this);b.register("cpu-run",this.run,this);b.register("cpu-stop",this.stop,this);b.register("cpu-restart",this.restart,
this);this.register_yield()}function d(b,c){b=b?b.toString(16):"";return"0x"+aa.pad0(b.toUpperCase(),c||1)}function m(b){var c=new Uint8Array(b),g,h;H(0===(b&b-1));this.length=0;this.push=function(k){this.length!==b&&this.length++;c[h]=k;h=h+1&b-1};this.shift=function(){if(this.length){var k=c[g];g=g+1&b-1;this.length--;return k}return-1};this.peek=function(){return this.length?c[g]:-1};this.clear=function(){this.length=h=g=0};this.clear()}function q(b){this.size=b;this.data=new Float32Array(b);this.length=
this.end=this.start=0;H(0===(b&b-1))}function n(b,c){b instanceof Array||(b=[b]);b=new Blob(b);var g=document.createElement("a");g.download=c;g.href=window.URL.createObjectURL(b);g.dataset.downloadurl=["application/octet-stream",g.download,g.href].join(":");document.createEvent?(b=document.createEvent("MouseEvent"),b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),g.dispatchEvent(b)):g.click();window.URL.revokeObjectURL(g.href)}function p(b,c,g){function h(){const ba=g||0;setTimeout(()=>
{p(b,c,ba+1)},1E3*([1,1,2,3,5,8,13,21][ba]||34))}var k=new XMLHttpRequest;k.open(c.method||"get",b,!0);k.responseType=c.as_json?"json":"arraybuffer";if(c.headers)for(var y=Object.keys(c.headers),u=0;u<y.length;u++){var I=y[u];k.setRequestHeader(I,c.headers[I])}c.range&&(y=c.range.start,k.setRequestHeader("Range","bytes="+y+"-"+(y+c.range.length-1)),k.onreadystatechange=function(){200===k.status&&k.abort()});k.onload=function(ba){4===k.readyState&&(200!==k.status&&206!==k.status?(console.error("Loading the image "+
b+" failed (status %d)",k.status),500<=k.status&&600>k.status&&h()):k.response&&c.done&&c.done(k.response,k))};k.onerror=function(ba){console.error("Loading the image "+b+" failed",ba);h()};c.progress&&(k.onprogress=function(ba){c.progress(ba)});k.send(null)}function w(b,c){let g=require("fs");c.range?(H(!c.as_json),g.open(b,"r",(h,k)=>{if(h)throw h;let y=c.range.length;var u=Buffer.allocUnsafe(y);g.read(k,u,0,y,c.range.start,(I,ba)=>{if(I)throw I;H(ba===y);c.done&&c.done(new Uint8Array(u));g.close(k,
R=>{if(R)throw R;})})})):g.readFile(b,{encoding:c.as_json?"utf-8":null},function(h,k){h?console.log("Could not read file:",b,h):(h=k,h=c.as_json?JSON.parse(h):(new Uint8Array(h)).buffer,c.done(h))})}function B(b,c,g,h,k,y){this.master=new v(this,b,c,h,k,0,y);this.slave=new v(this,b,g,!1,k,1,y);this.current_interface=this.master;this.cpu=b;0===k?(this.ata_port=496,this.irq=14,this.pci_id=240):1===k?(this.ata_port=368,this.irq=15,this.pci_id=248):H(!1,"IDE device with nr "+k+" ignored",32768);this.ata_port_high=
this.ata_port|516;this.master_port=46080;this.pci_space=[134,128,16,112,5,0,160,2,0,128,1,1,0,0,0,0,this.ata_port&255|1,this.ata_port>>8,0,0,this.ata_port_high&255|1,this.ata_port_high>>8,0,0,0,0,0,0,0,0,0,0,this.master_port&255|1,this.master_port>>8,0,0,0,0,0,0,0,0,0,0,67,16,212,130,0,0,0,0,0,0,0,0,0,0,0,0,this.irq,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0];this.pci_bars=[{size:8},{size:4},void 0,void 0,{size:16}];this.name="ide"+k;this.device_control=2;b.io.register_read(this.ata_port|7,this,function(){r("lower irq",32768);this.cpu.device_lower_irq(this.irq);return this.read_status()});b.io.register_read(this.ata_port_high|2,this,this.read_status);b.io.register_write(this.ata_port_high|2,this,this.write_control);b.io.register_read(this.ata_port|0,this,function(){return this.current_interface.read_data(1)},function(){return this.current_interface.read_data(2)},
function(){return this.current_interface.read_data(4)});b.io.register_read(this.ata_port|1,this,function(){r("Read error: "+d(this.current_interface.error&255)+" slave="+(this.current_interface===this.slave),32768);return this.current_interface.error&255});b.io.register_read(this.ata_port|2,this,function(){r("Read bytecount: "+d(this.current_interface.bytecount&255),32768);return this.current_interface.bytecount&255});b.io.register_read(this.ata_port|3,this,function(){r("Read sector: "+d(this.current_interface.sector&
255),32768);return this.current_interface.sector&255});b.io.register_read(this.ata_port|4,this,function(){r("Read 1F4: "+d(this.current_interface.cylinder_low&255),32768);return this.current_interface.cylinder_low&255});b.io.register_read(this.ata_port|5,this,function(){r("Read 1F5: "+d(this.current_interface.cylinder_high&255),32768);return this.current_interface.cylinder_high&255});b.io.register_read(this.ata_port|6,this,function(){r("Read 1F6",32768);return this.current_interface.drive_head&255});
b.io.register_write(this.ata_port|0,this,function(u){this.current_interface.write_data_port8(u)},function(u){this.current_interface.write_data_port16(u)},function(u){this.current_interface.write_data_port32(u)});b.io.register_write(this.ata_port|1,this,function(u){r("1F1/lba_count: "+d(u),32768);this.master.lba_count=(this.master.lba_count<<8|u)&65535;this.slave.lba_count=(this.slave.lba_count<<8|u)&65535});b.io.register_write(this.ata_port|2,this,function(u){r("1F2/bytecount: "+d(u),32768);this.master.bytecount=
(this.master.bytecount<<8|u)&65535;this.slave.bytecount=(this.slave.bytecount<<8|u)&65535});b.io.register_write(this.ata_port|3,this,function(u){r("1F3/sector: "+d(u),32768);this.master.sector=(this.master.sector<<8|u)&65535;this.slave.sector=(this.slave.sector<<8|u)&65535});b.io.register_write(this.ata_port|4,this,function(u){r("1F4/sector low: "+d(u),32768);this.master.cylinder_low=(this.master.cylinder_low<<8|u)&65535;this.slave.cylinder_low=(this.slave.cylinder_low<<8|u)&65535});b.io.register_write(this.ata_port|
5,this,function(u){r("1F5/sector high: "+d(u),32768);this.master.cylinder_high=(this.master.cylinder_high<<8|u)&65535;this.slave.cylinder_high=(this.slave.cylinder_high<<8|u)&65535});b.io.register_write(this.ata_port|6,this,function(u){var I=u&16;r("1F6/drive: "+d(u,2),32768);I?(r("Slave",32768),this.current_interface=this.slave):this.current_interface=this.master;this.master.drive_head=u;this.slave.drive_head=u;this.master.is_lba=this.slave.is_lba=u>>6&1;this.master.head=this.slave.head=u&15});this.dma_command=
this.dma_status=this.prdt_addr=0;b.io.register_write(this.ata_port|7,this,function(u){r("lower irq",32768);this.cpu.device_lower_irq(this.irq);this.current_interface.ata_command(u)});b.io.register_read(this.master_port|4,this,void 0,void 0,this.dma_read_addr);b.io.register_write(this.master_port|4,this,void 0,void 0,this.dma_set_addr);b.io.register_read(this.master_port,this,this.dma_read_command8,void 0,this.dma_read_command);b.io.register_write(this.master_port,this,this.dma_write_command8,void 0,
this.dma_write_command);b.io.register_read(this.master_port|2,this,this.dma_read_status);b.io.register_write(this.master_port|2,this,this.dma_write_status);b.io.register_read(this.master_port|8,this,function(){r("DMA read 0x8",32768);return 0});b.io.register_read(this.master_port|10,this,function(){r("DMA read 0xA",32768);return 0});b.devices.pci.register_device(this);N&&Object.seal(this)}function v(b,c,g,h,k,y,u){this.device=b;this.bus=u;this.nr=k;this.cpu=c;this.buffer=g;this.sector_size=h?2048:
512;this.is_atapi=h;this.cylinder_count=this.sectors_per_track=this.head_count=this.sector_count=0;this.buffer&&(this.sector_count=this.buffer.byteLength/this.sector_size,this.sector_count!==(this.sector_count|0)&&(r("Warning: Disk size not aligned with sector size",32768),this.sector_count=Math.ceil(this.sector_count)),h?(this.head_count=1,this.sectors_per_track=0):(this.head_count=16,this.sectors_per_track=63),this.cylinder_count=this.sector_count/this.head_count/this.sectors_per_track,this.cylinder_count!==
(this.cylinder_count|0)&&(r("Warning: Rounding up cylinder count. Choose different head number",32768),this.cylinder_count=Math.floor(this.cylinder_count)),b=c.devices.rtc,b.cmos_write(Ma,b.cmos_read(Ma)|1<<4*this.nr),b.cmos_write(Ha,b.cmos_read(Ha)&15|240),c=ab,b.cmos_write(c+0,this.cylinder_count&255),b.cmos_write(c+1,this.cylinder_count>>8&255),b.cmos_write(c+2,this.head_count&255),b.cmos_write(c+3,255),b.cmos_write(c+4,255),b.cmos_write(c+5,200),b.cmos_write(c+6,this.cylinder_count&255),b.cmos_write(c+
7,this.cylinder_count>>8&255),b.cmos_write(c+8,this.sectors_per_track&255));this.stats={sectors_read:0,sectors_written:0,bytes_read:0,bytes_written:0,loading:!1};this.buffer=g;this.drive_head=this.head=this.cylinder_high=this.cylinder_low=this.lba_count=this.sector=this.bytecount=this.is_lba=0;this.status=80;this.sectors_per_drq=128;this.data_pointer=this.error=0;this.data=new Uint8Array(65536);this.data16=new Uint16Array(this.data.buffer);this.data32=new Int32Array(this.data.buffer);this.data_end=
this.data_length=0;this.current_atapi_command=this.current_command=-1;this.last_io_id=this.write_dest=0;this.in_progress_io_ids=new Set;this.cancelled_io_ids=new Set;Object.seal(this)}function z(b){this.pci_addr=new Uint8Array(4);this.pci_value=new Uint8Array(4);this.pci_response=new Uint8Array(4);this.pci_status=new Uint8Array(4);this.pci_addr32=new Int32Array(this.pci_addr.buffer);this.pci_value32=new Int32Array(this.pci_value.buffer);this.pci_response32=new Int32Array(this.pci_response.buffer);
this.pci_status32=new Int32Array(this.pci_status.buffer);this.device_spaces=[];this.devices=[];this.cpu=b;for(var c=0;256>c;c++)this.device_spaces[c]=void 0,this.devices[c]=void 0;this.io=b.io;b.io.register_write(3324,this,function(g){this.pci_write8(this.pci_addr32[0],g)},function(g){this.pci_write16(this.pci_addr32[0],g)},function(g){this.pci_write32(this.pci_addr32[0],g)});b.io.register_write(3325,this,function(g){this.pci_write8(this.pci_addr32[0]+1|0,g)});b.io.register_write(3326,this,function(g){this.pci_write8(this.pci_addr32[0]+
2|0,g)},function(g){this.pci_write16(this.pci_addr32[0]+2|0,g)});b.io.register_write(3327,this,function(g){this.pci_write8(this.pci_addr32[0]+3|0,g)});b.io.register_read_consecutive(3324,this,function(){return this.pci_response[0]},function(){return this.pci_response[1]},function(){return this.pci_response[2]},function(){return this.pci_response[3]});b.io.register_read_consecutive(3320,this,function(){return this.pci_status[0]},function(){return this.pci_status[1]},function(){return this.pci_status[2]},
function(){return this.pci_status[3]});b.io.register_write_consecutive(3320,this,function(g){this.pci_addr[0]=g&252},function(g){2===(this.pci_addr[1]&6)&&6===(g&6)?(r("CPU reboot via PCI"),b.reboot_internal()):this.pci_addr[1]=g},function(g){this.pci_addr[2]=g},function(g){this.pci_addr[3]=g;this.pci_query()});this.register_device({pci_id:0,pci_space:[134,128,55,18,0,0,0,0,2,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0],pci_bars:[],name:"82441FX PMC"});this.isa_bridge={pci_id:8,pci_space:[134,128,0,112,7,0,0,2,0,0,1,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],pci_bars:[],name:"82371SB PIIX3 ISA"};this.isa_bridge_space=this.register_device(this.isa_bridge);this.isa_bridge_space8=new Uint8Array(this.isa_bridge_space.buffer)}function C(b,c,g){this.io=b.io;this.cpu=b;this.dma=b.devices.dma;this.bytes_expecting=
0;this.receiving_command=new Uint8Array(10);this.receiving_index=0;this.next_command=null;this.response_data=new Uint8Array(10);this.response_length=this.response_index=0;this.fda_image=c;this.fdb_image=g;this.last_head=this.last_cylinder=this.drive=this.status_reg2=this.status_reg1=this.status_reg0=0;this.last_sector=1;this.dor=0;if(c){var h={[163840]:{type:1,tracks:40,sectors:8,heads:1},[184320]:{type:1,tracks:40,sectors:9,heads:1},[204800]:{type:1,tracks:40,sectors:10,heads:1},[327680]:{type:1,
tracks:40,sectors:8,heads:2},[368640]:{type:1,tracks:40,sectors:9,heads:2},[409600]:{type:1,tracks:40,sectors:10,heads:2},[737280]:{type:3,tracks:80,sectors:9,heads:2},[1228800]:{type:2,tracks:80,sectors:15,heads:2},[1474560]:{type:4,tracks:80,sectors:18,heads:2},[1763328]:{type:5,tracks:82,sectors:21,heads:2},[2949120]:{type:5,tracks:80,sectors:36,heads:2},512:{type:1,tracks:1,sectors:1,heads:1}};let k=c.byteLength;(g=h[k])||(k=1474560<c.byteLength?2949120:1474560,g=h[k],r("Warning: Unkown floppy size: "+
c.byteLength+", assuming "+k));b.devices.rtc.cmos_write(za,g.type<<4);b=g.sectors;c=g.heads;g=g.tracks;this.sectors_per_track=b;this.number_of_heads=c;this.number_of_cylinders=g}else b.devices.rtc.cmos_write(za,64),this.number_of_cylinders=this.number_of_heads=this.sectors_per_track=0;this.io.register_read(1008,this,this.port3F0_read);this.io.register_read(1010,this,this.port3F2_read);this.io.register_read(1012,this,this.port3F4_read);this.io.register_read(1013,this,this.port3F5_read);this.io.register_read(1015,
this,this.port3F7_read);this.io.register_write(1010,this,this.port3F2_write);this.io.register_write(1013,this,this.port3F5_write)}function A(b){this.cpu=b;this.channel_page=new Uint8Array(8);this.channel_pagehi=new Uint8Array(8);this.channel_addr=new Uint16Array(8);this.channel_addr_init=new Uint16Array(8);this.channel_count=new Uint16Array(8);this.channel_count_init=new Uint16Array(8);this.channel_mask=new Uint8Array(8);this.channel_mode=new Uint8Array(8);this.unmask_listeners=[];this.lsb_msb_flipflop=
0;b=b.io;b.register_write(0,this,this.port_addr_write.bind(this,0));b.register_write(2,this,this.port_addr_write.bind(this,1));b.register_write(4,this,this.port_addr_write.bind(this,2));b.register_write(6,this,this.port_addr_write.bind(this,3));b.register_write(1,this,this.port_count_write.bind(this,0));b.register_write(3,this,this.port_count_write.bind(this,1));b.register_write(5,this,this.port_count_write.bind(this,2));b.register_write(7,this,this.port_count_write.bind(this,3));b.register_read(0,
this,this.port_addr_read.bind(this,0));b.register_read(2,this,this.port_addr_read.bind(this,1));b.register_read(4,this,this.port_addr_read.bind(this,2));b.register_read(6,this,this.port_addr_read.bind(this,3));b.register_read(1,this,this.port_count_read.bind(this,0));b.register_read(3,this,this.port_count_read.bind(this,1));b.register_read(5,this,this.port_count_read.bind(this,2));b.register_read(7,this,this.port_count_read.bind(this,3));b.register_write(192,this,this.port_addr_write.bind(this,4));
b.register_write(196,this,this.port_addr_write.bind(this,5));b.register_write(200,this,this.port_addr_write.bind(this,6));b.register_write(204,this,this.port_addr_write.bind(this,7));b.register_write(194,this,this.port_count_write.bind(this,4));b.register_write(198,this,this.port_count_write.bind(this,5));b.register_write(202,this,this.port_count_write.bind(this,6));b.register_write(206,this,this.port_count_write.bind(this,7));b.register_read(192,this,this.port_addr_read.bind(this,4));b.register_read(196,
this,this.port_addr_read.bind(this,5));b.register_read(200,this,this.port_addr_read.bind(this,6));b.register_read(204,this,this.port_addr_read.bind(this,7));b.register_read(194,this,this.port_count_read.bind(this,4));b.register_read(198,this,this.port_count_read.bind(this,5));b.register_read(202,this,this.port_count_read.bind(this,6));b.register_read(206,this,this.port_count_read.bind(this,7));b.register_write(135,this,this.port_page_write.bind(this,0));b.register_write(131,this,this.port_page_write.bind(this,
1));b.register_write(129,this,this.port_page_write.bind(this,2));b.register_write(130,this,this.port_page_write.bind(this,3));b.register_write(143,this,this.port_page_write.bind(this,4));b.register_write(139,this,this.port_page_write.bind(this,5));b.register_write(137,this,this.port_page_write.bind(this,6));b.register_write(138,this,this.port_page_write.bind(this,7));b.register_read(135,this,this.port_page_read.bind(this,0));b.register_read(131,this,this.port_page_read.bind(this,1));b.register_read(129,
this,this.port_page_read.bind(this,2));b.register_read(130,this,this.port_page_read.bind(this,3));b.register_read(143,this,this.port_page_read.bind(this,4));b.register_read(139,this,this.port_page_read.bind(this,5));b.register_read(137,this,this.port_page_read.bind(this,6));b.register_read(138,this,this.port_page_read.bind(this,7));b.register_write(1159,this,this.port_pagehi_write.bind(this,0));b.register_write(1155,this,this.port_pagehi_write.bind(this,1));b.register_write(1153,this,this.port_pagehi_write.bind(this,
2));b.register_write(1154,this,this.port_pagehi_write.bind(this,3));b.register_write(1163,this,this.port_pagehi_write.bind(this,5));b.register_write(1161,this,this.port_pagehi_write.bind(this,6));b.register_write(1162,this,this.port_pagehi_write.bind(this,7));b.register_read(1159,this,this.port_pagehi_read.bind(this,0));b.register_read(1155,this,this.port_pagehi_read.bind(this,1));b.register_read(1153,this,this.port_pagehi_read.bind(this,2));b.register_read(1154,this,this.port_pagehi_read.bind(this,
3));b.register_read(1163,this,this.port_pagehi_read.bind(this,5));b.register_read(1161,this,this.port_pagehi_read.bind(this,6));b.register_read(1162,this,this.port_pagehi_read.bind(this,7));b.register_write(10,this,this.port_singlemask_write.bind(this,0));b.register_write(212,this,this.port_singlemask_write.bind(this,4));b.register_write(15,this,this.port_multimask_write.bind(this,0));b.register_write(222,this,this.port_multimask_write.bind(this,4));b.register_read(15,this,this.port_multimask_read.bind(this,
0));b.register_read(222,this,this.port_multimask_read.bind(this,4));b.register_write(11,this,this.port_mode_write.bind(this,0));b.register_write(214,this,this.port_mode_write.bind(this,4));b.register_write(12,this,this.portC_write);b.register_write(216,this,this.portC_write)}function F(b,c){this.cpu=b;this.bus=c;this.counter_start_time=new Float64Array(3);this.counter_start_value=new Uint16Array(3);this.counter_next_low=new Uint8Array(4);this.counter_enabled=new Uint8Array(4);this.counter_mode=new Uint8Array(4);
this.counter_read_mode=new Uint8Array(4);this.counter_latch=new Uint8Array(4);this.counter_latch_value=new Uint16Array(3);this.counter_reload=new Uint16Array(3);b.io.register_read(97,this,function(){var g=f.microtick(),h=66.66666666666667*g&1;g=this.did_rollover(2,g);return h<<4|g<<5});b.io.register_write(97,this,function(g){g&1?this.bus.send("pcspeaker-enable"):this.bus.send("pcspeaker-disable")});b.io.register_read(64,this,function(){return this.counter_read(0)});b.io.register_read(65,this,function(){return this.counter_read(1)});
b.io.register_read(66,this,function(){return this.counter_read(2)});b.io.register_write(64,this,function(g){this.counter_write(0,g)});b.io.register_write(65,this,function(g){this.counter_write(1,g)});b.io.register_write(66,this,function(g){this.counter_write(2,g);this.bus.send("pcspeaker-update",[this.counter_mode[2],this.counter_reload[2]])});b.io.register_write(67,this,this.port43_write)}function E(b,c,g){this.cpu=b;this.bus=c;this.vga_memory_size=g;this.cursor_address=0;this.cursor_scanline_start=
14;this.cursor_scanline_end=15;this.max_cols=80;this.max_rows=25;this.virtual_height=this.virtual_width=this.screen_height=this.screen_width=0;this.layers=[];this.start_address_latched=this.start_address=0;this.crtc=new Uint8Array(25);this.line_compare=this.offset_register=this.preset_row_scan=this.underline_location_register=this.vertical_blank_start=this.vertical_display_enable_end=this.horizontal_blank_start=this.horizontal_display_enable_end=this.crtc_mode=0;this.graphical_mode_is_linear=!0;this.graphical_mode=
!1;setTimeout(()=>{c.send("screen-set-mode",this.graphical_mode)},0);this.vga256_palette=new Int32Array(256);this.latch_dword=0;this.svga_version=45253;this.svga_height=this.svga_width=0;this.svga_enabled=!1;this.svga_bpp=32;this.svga_offset=this.svga_bank_offset=0;this.pci_space=[52,18,17,17,3,1,0,0,0,0,0,3,0,0,0,0,8,14680064,57344,224,0,0,0,0,0,0,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,190,254,0,0,0,0,0,0,0,0,0,0,0,0];this.pci_id=144;this.pci_bars=[{size:g}];this.pci_rom_size=65536;
this.pci_rom_address=4272947200;this.name="vga";this.stats={is_graphical:!1,res_x:0,res_y:0,bpp:0};this.dac_state=this.dac_color_index_read=this.dac_color_index_write=this.index_crtc=0;this.dac_mask=255;this.dac_map=new Uint8Array(16);this.attribute_controller_index=-1;this.palette_source=32;this.color_select=this.horizontal_panning=this.color_plane_enable=this.attribute_mode=0;this.sequencer_index=-1;this.plane_write_bm=15;this.clocking_mode=this.sequencer_memory_mode=0;this.graphics_index=-1;this.planar_rotate_reg=
this.planar_mode=this.plane_read=0;this.planar_bitmap=255;this.max_scan_line=this.color_dont_care=this.color_compare=this.miscellaneous_graphics_register=this.planar_setreset_enable=this.planar_setreset=0;this.port_3DA_value=this.miscellaneous_output_register=255;g=b.io;g.register_write(960,this,this.port3C0_write);g.register_read(960,this,this.port3C0_read,this.port3C0_read16);g.register_read(961,this,this.port3C1_read);g.register_write(962,this,this.port3C2_write);g.register_write_consecutive(964,
this,this.port3C4_write,this.port3C5_write);g.register_read(964,this,this.port3C4_read);g.register_read(965,this,this.port3C5_read);g.register_write_consecutive(974,this,this.port3CE_write,this.port3CF_write);g.register_read(974,this,this.port3CE_read);g.register_read(975,this,this.port3CF_read);g.register_read(966,this,this.port3C6_read);g.register_write(966,this,this.port3C6_write);g.register_write(967,this,this.port3C7_write);g.register_read(967,this,this.port3C7_read);g.register_write(968,this,
this.port3C8_write);g.register_read(968,this,this.port3C8_read);g.register_write(969,this,this.port3C9_write);g.register_read(969,this,this.port3C9_read);g.register_read(972,this,this.port3CC_read);g.register_write_consecutive(980,this,this.port3D4_write,this.port3D5_write);g.register_read(980,this,this.port3D4_read);g.register_read(981,this,this.port3D5_read,()=>{r("Warning: 16-bit read from 3D5",256);return this.port3D5_read()});g.register_read(970,this,function(){r("3CA read",256);return 0});g.register_read(986,
this,this.port3DA_read);g.register_read(954,this,this.port3DA_read);this.dispi_index=-1;this.dispi_enable_value=0;g.register_write(462,this,void 0,this.port1CE_write);g.register_write(463,this,void 0,this.port1CF_write);g.register_read(463,this,void 0,this.port1CF_read);void 0===this.vga_memory_size||262144>this.vga_memory_size?(this.vga_memory_size=262144,r("vga memory size rounded up to "+this.vga_memory_size,256)):this.vga_memory_size&65535&&(this.vga_memory_size|=65535,this.vga_memory_size++);
const h=b.svga_allocate_memory(this.vga_memory_size);this.svga_memory=aa.view(Uint8Array,b.wasm_memory,h,this.vga_memory_size);this.diff_addr_min=this.vga_memory_size;this.diff_addr_max=0;this.diff_plot_min=this.vga_memory_size;this.diff_plot_max=0;this.image_data=null;c.register("screen-fill-buffer",function(){this.screen_fill_buffer()},this);this.vga_memory=new Uint8Array(262144);this.plane0=new Uint8Array(this.vga_memory.buffer,0,65536);this.plane1=new Uint8Array(this.vga_memory.buffer,65536,65536);
this.plane2=new Uint8Array(this.vga_memory.buffer,131072,65536);this.plane3=new Uint8Array(this.vga_memory.buffer,196608,65536);this.pixel_buffer=new Uint8Array(524288);var k=this;g.mmap_register(655360,131072,function(y){return k.vga_memory_read(y)},function(y,u){k.vga_memory_write(y,u)});b.devices.pci.register_device(this)}function M(b,c){this.cpu=b;this.bus=c;this.use_mouse=this.enable_mouse_stream=!1;this.have_mouse=!0;this.mouse_clicks=this.mouse_delta_y=this.mouse_delta_x=0;this.have_keyboard=
!0;this.next_read_resolution=this.next_read_rate=this.next_handle_scan_code_set=this.next_read_led=this.next_read_sample=this.next_is_mouse_command=this.enable_keyboard_stream=!1;this.kbd_buffer=new m(1024);this.last_port60_byte=0;this.sample_rate=100;this.mouse_id=this.mouse_detect_state=0;this.mouse_reset_workaround=!1;this.wheel_movement=0;this.resolution=4;this.scaling2=!1;this.last_mouse_packet=-1;this.mouse_buffer=new m(1024);this.next_byte_is_aux=this.next_byte_is_ready=!1;this.bus.register("keyboard-code",
function(g){this.kbd_send_code(g)},this);this.bus.register("mouse-click",function(g){this.mouse_send_click(g[0],g[1],g[2])},this);this.bus.register("mouse-delta",function(g){this.mouse_send_delta(g[0],g[1])},this);this.bus.register("mouse-wheel",function(g){this.wheel_movement-=g[0];this.wheel_movement-=2*g[1];this.wheel_movement=Math.min(7,Math.max(-8,this.wheel_movement));this.send_mouse_packet(0,0)},this);this.command_register=5;this.controller_output_port=0;this.read_controller_output_port=this.read_command_register=
this.read_output_register=!1;b.io.register_read(96,this,this.port60_read);b.io.register_read(100,this,this.port64_read);b.io.register_write(96,this,this.port60_write);b.io.register_write(100,this,this.port64_write)}function J(b,c){this.irq_value=this.irr=this.isr=this.irq_map=this.irq_mask=0;this.requested_irq=-1;this.master=c;this.is_master=void 0===this.master;this.slave=void 0;this.name=this.is_master?"master":"slave ";this.expect_icw4=!1;this.read_isr=this.state=0;this.auto_eoi=1;this.elcr=this.special_mask_mode=
0;this.cpu=b;this.is_master?(this.slave=new J(this.cpu,this),this.check_irqs=function(){if(0<=this.requested_irq)this.cpu.handle_irqs();else{var g=this.irr&this.irq_mask;if(g){g&=-g;var h=this.special_mask_mode?this.irq_mask:-1;this.isr&&(this.isr&-this.isr&h)<=g?r("master> higher prio: isr="+d(this.isr,2)+" mask="+d(this.irq_mask&255,2)+" irq="+d(g,2),128):(H(0!==g),h=aa.int_log2_byte(g),H(g===1<<h),this.requested_irq=h,this.cpu.handle_irqs())}}},this.acknowledge_irq=function(){if(-1!==this.requested_irq)if(0===
this.irr)this.requested_irq=-1;else{H(this.irr);H(0<=this.requested_irq);var g=1<<this.requested_irq;0===(this.elcr&g)&&(this.irr&=~g);this.auto_eoi||(this.isr|=g);2===this.requested_irq?this.slave.acknowledge_irq():this.cpu.pic_call_irq(this.irq_map|this.requested_irq);this.requested_irq=-1;this.check_irqs()}}):(this.check_irqs=function(){if(0<=this.requested_irq)this.cpu.handle_irqs();else{var g=this.irr&this.irq_mask;if(g){g&=-g;var h=this.special_mask_mode?this.irq_mask:-1;this.isr&&(this.isr&
-this.isr&h)<=g||(H(0!==g),h=aa.int_log2_byte(g),H(g===1<<h),this.requested_irq=h,this.master.set_irq(2))}}},this.acknowledge_irq=function(){if(-1!==this.requested_irq)if(0===this.irr)this.requested_irq=-1,this.master.irq_value&=-5,this.cpu.pic_call_irq(this.irq_map|7);else{H(this.irr);H(0<=this.requested_irq);var g=1<<this.requested_irq;0===(this.elcr&g)&&(this.irr&=~g);this.auto_eoi||(this.isr|=g);this.master.irq_value&=-5;this.cpu.pic_call_irq(this.irq_map|this.requested_irq);this.requested_irq=
-1;this.check_irqs()}});this.dump=function(){r("mask: "+d(this.irq_mask&255),128);r("base: "+d(this.irq_map),128);r("requested: "+d(this.irr),128);r("serviced: "+d(this.isr),128);this.is_master&&this.slave.dump()};this.is_master?(b=32,c=1232):(b=160,c=1233);this.cpu.io.register_write(b,this,this.port20_write);this.cpu.io.register_read(b,this,this.port20_read);this.cpu.io.register_write(b|1,this,this.port21_write);this.cpu.io.register_read(b|1,this,this.port21_read);this.cpu.io.register_write(c,this,
this.port4D0_write);this.cpu.io.register_read(c,this,this.port4D0_read);this.is_master?(this.set_irq=function(g){H(0<=g&&16>g);8<=g?this.slave.set_irq(g-8):(g=1<<g,0===(this.irq_value&g)&&(this.irr|=g,this.irq_value|=g,this.check_irqs()))},this.clear_irq=function(g){H(0<=g&&16>g);8<=g?this.slave.clear_irq(g-8):(g=1<<g,this.irq_value&g&&(this.irq_value&=~g,this.irr&=~g,this.check_irqs()))}):(this.set_irq=function(g){H(0<=g&&8>g);g=1<<g;0===(this.irq_value&g)&&(this.irr|=g,this.irq_value|=g,this.check_irqs())},
this.clear_irq=function(g){H(0<=g&&8>g);g=1<<g;this.irq_value&g&&(this.irq_value&=~g,this.irr&=~g,this.check_irqs())});this.get_isr=function(){return this.isr}}function X(b){this.cpu=b;this.cmos_index=0;this.cmos_data=new Uint8Array(128);this.last_update=this.rtc_time=Date.now();this.next_interrupt_alarm=this.next_interrupt=0;this.periodic_interrupt=!1;this.periodic_interrupt_time=.9765625;this.cmos_a=38;this.cmos_b=2;this.nmi_disabled=this.cmos_c=0;b.io.register_write(112,this,function(c){this.cmos_index=
c&127;this.nmi_disabled=c>>7});b.io.register_write(113,this,this.cmos_port_write);b.io.register_read(113,this,this.cmos_port_read)}function ja(b,c,g){this.bus=g;this.cpu=b;this.ints=4;this.line_control=this.baud_rate=0;this.lsr=96;this.ier=this.fifo_control=0;this.iir=1;this.irq=this.scratch_register=this.modem_status=this.modem_control=0;this.input=new m(4096);this.current_line="";switch(c){case 1016:this.com=0;this.irq=4;break;case 760:this.com=1;this.irq=3;break;case 1E3:this.com=2;this.irq=4;
break;case 744:this.irq=this.com=3;break;default:r("Invalid serial port: "+d(c),16384),this.com=0,this.irq=4}this.bus.register("serial"+this.com+"-input",function(h){this.data_received(h)},this);b=b.io;b.register_write(c,this,function(h){this.write_data(h)},function(h){this.write_data(h&255);this.write_data(h>>8)});b.register_write(c|1,this,function(h){this.line_control&128?(this.baud_rate=this.baud_rate&255|h<<8,r("baud rate: "+d(this.baud_rate),16384)):(0===(this.ier&2)&&h&2&&this.ThrowInterrupt(2),
this.ier=h&15,r("interrupt enable: "+d(h),16384),this.CheckInterrupt())});b.register_read(c,this,function(){if(this.line_control&128)return this.baud_rate&255;var h=this.input.shift();-1===h?r("Read input empty",16384):r("Read input: "+d(h),16384);0===this.input.length&&(this.lsr&=-2,this.ClearInterrupt(12),this.ClearInterrupt(4));return h});b.register_read(c|1,this,function(){return this.line_control&128?this.baud_rate>>8:this.ier&15});b.register_read(c|2,this,function(){var h=this.iir&15;r("read interrupt identification: "+
d(this.iir),16384);2==this.iir&&this.ClearInterrupt(2);this.fifo_control&1&&(h|=192);return h});b.register_write(c|2,this,function(h){r("fifo control: "+d(h),16384);this.fifo_control=h});b.register_read(c|3,this,function(){r("read line control: "+d(this.line_control),16384);return this.line_control});b.register_write(c|3,this,function(h){r("line control: "+d(h),16384);this.line_control=h});b.register_read(c|4,this,function(){return this.modem_control});b.register_write(c|4,this,function(h){r("modem control: "+
d(h),16384);this.modem_control=h});b.register_read(c|5,this,function(){r("read line status: "+d(this.lsr),16384);return this.lsr});b.register_write(c|5,this,function(h){r("Factory test write",16384)});b.register_read(c|6,this,function(){r("read modem status: "+d(this.modem_status),16384);return this.modem_status});b.register_write(c|6,this,function(h){r("Unkown register write (base+6)",16384)});b.register_read(c|7,this,function(){return this.scratch_register});b.register_write(c|7,this,function(h){this.scratch_register=
h})}function S(b){function c(){return h?1E4*(Date.now()-k)+y|0:y}var g=this,h=!1,k=Date.now(),y=0,u=!1,I=0,ba=new Int32Array(8),R=new Int32Array(8),U=new Int32Array(8),Y=0;this.legacy_mode=!1;this.timer=function(fa){if(!h)return 100;fa=c()>>>0;for(var na,oa,Ca=0;4>Ca;Ca++)if(na=ba[Ca<<1],oa=R[Ca<<1]>>>0,Y<=fa?oa>Y&&oa<=fa:oa>Y||oa<=fa)oa=na&4,na&2?(oa=oa&&!(I&1<<Ca),I|=1<<Ca):I&=~(1<<Ca),na&8&&(R[Ca<<1]+=U[Ca<<1]),oa&&b.device_raise_irq(0);Y=fa;return 100};b.io.mmap_register(4275044352,16384,function(fa){r("Read "+
d(fa,4)+" (ctr="+d(c()>>>0)+")",131072);switch(fa){case 0:return 99073;case 4:return 1E8;case 16:return g.legacy_mode<<1|h;case 240:return c();case 244:return 0}var na=fa>>2&7,oa=fa-256>>5;if(256>fa||4<=oa||5<na)return r("Read reserved address: "+d(fa),131072),0;r("Read counter: addr="+d(fa)+" counter="+d(oa,2)+" reg="+d(na),131072);switch(na){case 0:return ba[oa<<1]&-32817|16;case 1:return ba[oa<<1|1];case 2:return R[oa<<1];case 3:return R[oa<<1|1];case 4:case 5:return 0}},function(fa,na){r("Write "+
d(fa,4)+": "+d(na,2),131072);switch(fa){case 16:r("conf: enabled="+(na&1)+" legacy="+(na>>1&1),131072);(h^na)&1&&(na&1?k=Date.now():y=c());h=1===(na&1);g.legacy_mode=2===(na&2);return;case 32:I&=~na;return;case 240:y=na;return;case 244:return}var oa=fa>>2&7,Ca=fa-256>>5;if(256>fa||4<=Ca||2<oa)r("Write reserved address: "+d(fa)+" data="+d(na),131072);else switch(r("Write counter: addr="+d(fa)+" counter="+d(Ca,2)+" reg="+d(oa)+" data="+d(na,2),131072),oa){case 0:ba[Ca<<1]=na;break;case 2:u?(U[Ca<<1]=
na,u=!1,r("Accumulator acc="+d(na>>>0,8)+" ctr="+d(Ca,2),131072)):(R[Ca<<1]=na,ba[Ca<<1]&64&&(u=!0,ba[Ca<<1]&=-65));break;case 3:R[Ca<<1|1]=na}})}function W(b){this.cpu=b;var c=b.io;b.devices.pci.register_device({pci_id:56,pci_space:[134,128,19,113,7,0,128,2,8,0,128,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,1,0,0],pci_bars:[],name:"acpi"});this.timer_imprecision_offset=this.timer_last_value=0;this.status=1;this.pm1_enable=this.pm1_status=
0;this.last_timer=this.get_timer(f.microtick());this.gpe=new Uint8Array(4);c.register_read(45056,this,void 0,function(){r("ACPI pm1_status read",262144);return this.pm1_status});c.register_write(45056,this,void 0,function(g){r("ACPI pm1_status write: "+d(g,4),262144);this.pm1_status&=~g});c.register_read(45058,this,void 0,function(){r("ACPI pm1_enable read",262144);return this.pm1_enable});c.register_write(45058,this,void 0,function(g){r("ACPI pm1_enable write: "+d(g),262144);this.pm1_enable=g});
c.register_read(45060,this,void 0,function(){r("ACPI status read",262144);return this.status});c.register_write(45060,this,void 0,function(g){r("ACPI status write: "+d(g),262144);this.status=g});c.register_read(45064,this,void 0,void 0,function(){return this.get_timer(f.microtick())&16777215});c.register_read(45024,this,function(){r("Read gpe#0",262144);return this.gpe[0]});c.register_read(45025,this,function(){r("Read gpe#1",262144);return this.gpe[1]});c.register_read(45026,this,function(){r("Read gpe#2",
262144);return this.gpe[2]});c.register_read(45027,this,function(){r("Read gpe#3",262144);return this.gpe[3]});c.register_write(45024,this,function(g){r("Write gpe#0: "+d(g),262144);this.gpe[0]=g});c.register_write(45025,this,function(g){r("Write gpe#1: "+d(g),262144);this.gpe[1]=g});c.register_write(45026,this,function(g){r("Write gpe#2: "+d(g),262144);this.gpe[2]=g});c.register_write(45027,this,function(g){r("Write gpe#3: "+d(g),262144);this.gpe[3]=g})}function la(b){this.cpu=b;this.timer_divider=
this.apic_id=0;this.timer_divider_shift=1;this.timer_current_count=this.timer_initial_count=0;this.next_tick=f.microtick();this.lvt_error=this.lvt_int1=this.lvt_int0=this.lvt_perf_counter=this.lvt_timer=Wa;this.icr1=this.icr0=this.tpr=0;this.irr=new Int32Array(8);this.isr=new Int32Array(8);this.tmr=new Int32Array(8);this.spurious_vector=254;this.destination_format=-1;this.read_error=this.error=this.local_destination=0;b.io.mmap_register(4276092928,1048576,c=>{r("Unsupported read8 from apic: "+d(c>>>
0),524288);var g=c&3;return this.read32(c&-4)>>8*g&255},(c,g)=>{r("Unsupported write8 from apic: "+d(c)+" <- "+d(g),524288);N&&r(Error().stack,void 0);H(!1)},c=>this.read32(c),(c,g)=>this.write32(c,g))}function qa(b){this.cpu=b;this.ioredtbl_config=new Int32Array(24);this.ioredtbl_destination=new Int32Array(24);for(var c=0;c<this.ioredtbl_config.length;c++)this.ioredtbl_config[c]=Wa;this.irq_value=this.irr=this.ioapic_id=this.ioregsel=0;H(!0);b.io.mmap_register(4273995776,131072,g=>{g=g-4273995776|
0;if(16<=g&&20>g)return g-=16,r("ioapic read8 byte "+g+" "+d(this.ioregsel),524288),this.read(this.ioregsel)>>8*g&255;r("Unexpected IOAPIC register read: "+d(g>>>0),524288);H(!1);return 0},(g,h)=>{H(!1,"unsupported write8 from ioapic: "+d(g>>>0))},g=>{g=g-4273995776|0;if(0===g)return this.ioregsel;if(16===g)return this.read(this.ioregsel);r("Unexpected IOAPIC register read: "+d(g>>>0),524288);H(!1);return 0},(g,h)=>{g=g-4273995776|0;0===g?this.ioregsel=h:16===g?this.write(this.ioregsel,h):(r("Unexpected IOAPIC register write: "+
d(g>>>0)+" <- "+d(h>>>0,8),524288),H(!1))})}function Pa(b){this.message=b}function Ba(b,c){if("object"!==typeof b||null===b)return H("function"!==typeof b),b;if(b instanceof Array)return b.map(y=>Ba(y,c));b.constructor===Object&&(console.log(b),H(b.constructor!==Object,"Expected non-object"));if(b.BYTES_PER_ELEMENT){var g=new Uint8Array(b.buffer,b.byteOffset,b.length*b.BYTES_PER_ELEMENT);b=b.constructor.name.replace("bound ","");H(Mb[b]);return{__state_type__:b,buffer_id:c.push(g)-1}}N&&!b.get_state&&
console.log("Object without get_state: ",b);g=b.get_state();b=[];for(var h=0;h<g.length;h++){var k=g[h];H("function"!==typeof k);b[h]=Ba(k,c)}return b}function wa(b,c){if("object"!==typeof b||null===b)return H("function"!==typeof b),b;if(b instanceof Array){for(var g=0;g<b.length;g++)b[g]=wa(b[g],c);return b}g=b.__state_type__;H(void 0!==g);const h=Mb[g];H(h,"Unkown type: "+g);return new h(c[b.buffer_id])}function Na(b,c,g){b[0]===c[0]&&b[1]===c[1]&&b[2]===c[2]&&b[3]===c[3]&&b[4]===c[4]&&b[5]===c[5]&&
(r("Replace mac in eth destination field",1048576),b[0]=g[0],b[1]=g[1],b[2]=g[2],b[3]=g[3],b[4]=g[4],b[5]=g[5]);b[6]===c[0]&&b[7]===c[1]&&b[8]===c[2]&&b[9]===c[3]&&b[10]===c[4]&&b[11]===c[5]&&(r("Replace mac in eth source field",1048576),b[6]=g[0],b[7]=g[1],b[8]=g[2],b[9]=g[3],b[10]=g[4],b[11]=g[5]);var h=b[12]<<8|b[13];if(2048===h)if(b=b.subarray(14),h=b[0]>>4,4!==h)r("Expected ipv4.version==4 but got: "+h,1048576);else{if(H(5===(b[0]&15),"TODO: ihl!=5"),17===b[9]){b=b.subarray(20);h=b[0]<<8|b[1];
var k=b[2]<<8|b[3];r("udp srcport="+h+" dstport="+k+" checksum="+d(b[6]<<8|b[7],4),1048576);if(67===h||67===k)if(h=b.subarray(8),k=h[236]<<24|h[237]<<16|h[238]<<8|h[239],1669485411!==k)r("dhcp packet didn't match magic: "+d(k,8));else for(h[28]===c[0]&&h[29]===c[1]&&h[30]===c[2]&&h[31]===c[3]&&h[32]===c[4]&&h[33]===c[5]&&(r("Replace mac in dhcp.chaddr",1048576),h[28]=g[0],h[29]=g[1],h[30]=g[2],h[31]=g[3],h[32]=g[4],h[33]=g[5],b[6]=b[7]=0),k=240;k<h.length;){const y=h[k++];if(255===y)break;const u=
h[k++];61===y&&1===h[k+0]&&h[k+1]===c[0]&&h[k+2]===c[1]&&h[k+3]===c[2]&&h[k+4]===c[3]&&h[k+5]===c[4]&&h[k+6]===c[5]&&(r("Replace mac in dhcp.clientidentifier",1048576),h[k+1]=g[0],h[k+2]=g[1],h[k+3]=g[2],h[k+4]=g[3],h[k+5]=g[4],h[k+6]=g[5],b[6]=b[7]=0);k+=u}}}else 2054===h&&(b=b.subarray(14),r("arp oper="+b[7]+" "+Sa(b.subarray(8,14))+" "+Sa(b.subarray(18,24)),1048576),b[8]===c[0]&&b[9]===c[1]&&b[10]===c[2]&&b[11]===c[3]&&b[12]===c[4]&&b[13]===c[5]&&(r("Replace mac in arp.sha",1048576),b[8]=g[0],
b[9]=g[1],b[10]=g[2],b[11]=g[3],b[12]=g[4],b[13]=g[5]))}function Sa(b){return[b[0].toString(16).padStart(2,"0"),b[1].toString(16).padStart(2,"0"),b[2].toString(16).padStart(2,"0"),b[3].toString(16).padStart(2,"0"),b[4].toString(16).padStart(2,"0"),b[5].toString(16).padStart(2,"0")].join(":")}function Aa(b,c,g,h){this.cpu=b;this.pci=b.devices.pci;this.preserve_mac_from_state_image=g;this.mac_address_translation=h;this.bus=c;this.bus.register("net0-receive",function(k){this.receive(k)},this);this.port=
768;this.name="ne2k";this.pci_space=[236,16,41,128,3,1,0,0,0,0,0,2,0,0,0,0,this.port&255|1,this.port>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,184,254,0,0,0,0,0,0,0,0,0,1,0,0];this.pci_id=40;this.pci_bars=[{size:32}];this.imr=this.isr=0;this.cr=1;this.tpsr=this.tcnt=this.rcnt=this.dcfg=0;this.memory=new Uint8Array(32768);this.txcr=this.rxcr=0;this.tsr=1;this.mac=new Uint8Array([0,34,21,255*Math.random()|0,255*Math.random()|0,255*Math.random()|0]);this.mac_address_in_state=
null;for(c=0;6>c;c++)this.memory[c<<1]=this.memory[c<<1|1]=this.mac[c];this.memory[28]=this.memory[29]=87;this.memory[30]=this.memory[31]=87;r("Mac: "+Sa(this.mac),1048576);this.rsar=0;this.pstart=64;this.pstop=128;this.boundary=this.curpg=76;c=b.io;c.register_read(this.port|0,this,function(){r("Read cmd",1048576);return this.cr});c.register_write(this.port|0,this,function(k){this.cr=k;r("Write command: "+d(k,2)+" newpg="+(this.cr>>6)+" txcr="+d(this.txcr,2),1048576);this.cr&1||(k&24&&0===this.rcnt&&
this.do_interrupt(64),k&4&&(k=this.tpsr<<8,k=this.memory.subarray(k,k+this.tcnt),this.mac_address_in_state&&(k=new Uint8Array(k),Na(k,this.mac_address_in_state,this.mac)),this.bus.send("net0-send",k),this.bus.send("eth-transmit-end",[k.length]),this.cr&=-5,this.do_interrupt(2),r("Command: Transfer. length="+d(k.byteLength),1048576)))});c.register_read(this.port|13,this,function(){r("Read counter0",1048576);return 0});c.register_read(this.port|14,this,function(){r("Read8 counter1",1048576);return 0},
function(){r("Read16 counter1",1048576);return 0});c.register_read(this.port|15,this,function(){r("Read counter2",1048576);return 0});c.register_read(this.port|31,this,function(){this.get_page();r("Read reset",1048576);this.do_interrupt(128);return 0});c.register_write(this.port|31,this,function(k){this.get_page();r("Write reset: "+d(k,2),1048576)});c.register_read(this.port|1,this,function(){var k=this.get_page();if(0===k)return this.pstart;if(1===k)return r("Read pg1/01 (mac[0])",1048576),this.mac[0];
if(2===k)return this.pstart;r("Read pg"+k+"/01");H(!1);return 0});c.register_write(this.port|1,this,function(k){var y=this.get_page();0===y?(r("start page: "+d(k,2),1048576),this.pstart=k):1===y?(r("mac[0] = "+d(k),1048576),this.mac[0]=k):3===y?r("Unimplemented: Write pg3/01 (9346CR): "+d(k),1048576):(r("Write pg"+y+"/01: "+d(k),1048576),H(!1))});c.register_read(this.port|2,this,function(){var k=this.get_page();if(0===k)return this.pstop;if(1===k)return r("Read pg1/02 (mac[1])",1048576),this.mac[1];
if(2===k)return this.pstop;r("Read pg"+k+"/02",1048576);H(!1);return 0});c.register_write(this.port|2,this,function(k){var y=this.get_page();0===y?(r("stop page: "+d(k,2),1048576),k>this.memory.length>>8&&(k=this.memory.length>>8,r("XXX: Adjusting stop page to "+d(k),1048576)),this.pstop=k):1===y?(r("mac[1] = "+d(k),1048576),this.mac[1]=k):(r("Write pg"+y+"/02: "+d(k),1048576),H(!1))});c.register_read(this.port|7,this,function(){var k=this.get_page();if(0===k)return r("Read isr: "+d(this.isr,2),1048576),
this.isr;if(1===k)return r("Read curpg: "+d(this.curpg,2),1048576),this.curpg;H(!1)});c.register_write(this.port|7,this,function(k){var y=this.get_page();0===y?(r("Write isr: "+d(k,2),1048576),this.isr&=~k,this.update_irq()):1===y?(r("Write curpg: "+d(k,2),1048576),this.curpg=k):H(!1)});c.register_write(this.port|13,this,function(k){var y=this.get_page();0===y?(this.txcr=k,r("Write tx config: "+d(k,2),1048576)):r("Unimplemented: Write pg"+y+"/0d "+d(k,2),1048576)});c.register_write(this.port|14,this,
function(k){var y=this.get_page();0===y?(r("Write data configuration: "+d(k,2),1048576),this.dcfg=k):r("Unimplemented: Write pg"+y+"/0e "+d(k,2),1048576)});c.register_read(this.port|10,this,function(){if(0===this.get_page())return r("Read pg0/0a",1048576),80;H(!1,"TODO");return 0});c.register_write(this.port|10,this,function(k){var y=this.get_page();0===y?(r("Write remote byte count low: "+d(k,2),1048576),this.rcnt=this.rcnt&65280|k&255):r("Unimplemented: Write pg"+y+"/0a "+d(k,2),1048576)});c.register_read(this.port|
11,this,function(){if(0===this.get_page())return r("Read pg0/0b",1048576),67;H(!1,"TODO");return 0});c.register_write(this.port|11,this,function(k){var y=this.get_page();0===y?(r("Write remote byte count high: "+d(k,2),1048576),this.rcnt=this.rcnt&255|k<<8&65280):r("Unimplemented: Write pg"+y+"/0b "+d(k,2),1048576)});c.register_read(this.port|8,this,function(){var k=this.get_page();if(0===k)return r("Read remote start address low",1048576),this.rsar&255;r("Unimplemented: Read pg"+k+"/08",1048576);
H(!1)});c.register_write(this.port|8,this,function(k){var y=this.get_page();0===y?(r("Write remote start address low: "+d(k,2),1048576),this.rsar=this.rsar&65280|k&255):r("Unimplemented: Write pg"+y+"/08 "+d(k,2),1048576)});c.register_read(this.port|9,this,function(){var k=this.get_page();if(0===k)return r("Read remote start address high",1048576),this.rsar>>8&255;r("Unimplemented: Read pg"+k+"/09",1048576);H(!1)});c.register_write(this.port|9,this,function(k){var y=this.get_page();0===y?(r("Write remote start address low: "+
d(k,2),1048576),this.rsar=this.rsar&255|k<<8&65280):r("Unimplemented: Write pg"+y+"/09 "+d(k,2),1048576)});c.register_write(this.port|15,this,function(k){var y=this.get_page();0===y?(r("Write interrupt mask register: "+d(k,2)+" isr="+d(this.isr,2),1048576),this.imr=k,this.update_irq()):r("Unimplemented: Write pg"+y+"/0f "+d(k,2),1048576)});c.register_read(this.port|3,this,function(){var k=this.get_page();if(0===k)return r("Read boundary: "+d(this.boundary,2),1048576),this.boundary;if(1===k)return r("Read pg1/03 (mac[2])",
1048576),this.mac[2];3===k?r("Unimplemented: Read pg3/03 (CONFIG0)",1048576):(r("Read pg"+k+"/03",1048576),H(!1));return 0});c.register_write(this.port|3,this,function(k){var y=this.get_page();0===y?(r("Write boundary: "+d(k,2),1048576),this.boundary=k):1===y?(r("mac[2] = "+d(k),1048576),this.mac[2]=k):(r("Write pg"+y+"/03: "+d(k),1048576),H(!1))});c.register_read(this.port|4,this,function(){var k=this.get_page();if(0===k)return this.tsr;if(1===k)return r("Read pg1/04 (mac[3])",1048576),this.mac[3];
r("Read pg"+k+"/04",1048576);H(!1);return 0});c.register_write(this.port|4,this,function(k){var y=this.get_page();0===y?(r("Write tpsr: "+d(k,2),1048576),this.tpsr=k):1===y?(r("mac[3] = "+d(k),1048576),this.mac[3]=k):(r("Write pg"+y+"/04: "+d(k),1048576),H(!1))});c.register_read(this.port|5,this,function(){var k=this.get_page();if(0===k)return r("Unimplemented: Read pg0/05 (NCR: Number of Collisions Register)",1048576),0;if(1===k)return r("Read pg1/05 (mac[4])",1048576),this.mac[4];3===k?r("Unimplemented: Read pg3/05 (CONFIG2)",
1048576):(r("Read pg"+k+"/05",1048576),H(!1));return 0});c.register_write(this.port|5,this,function(k){var y=this.get_page();0===y?(r("Write tcnt low: "+d(k,2),1048576),this.tcnt=this.tcnt&-256|k):1===y?(r("mac[4] = "+d(k),1048576),this.mac[4]=k):3===y?r("Unimplemented: Write pg3/05 (CONFIG2): "+d(k),1048576):(r("Write pg"+y+"/05: "+d(k),1048576),H(!1))});c.register_read(this.port|6,this,function(){var k=this.get_page();if(0===k)return H(!1,"TODO"),0;if(1===k)return r("Read pg1/06 (mac[5])",1048576),
this.mac[5];3===k?r("Unimplemented: Read pg3/06 (CONFIG3)",1048576):(r("Read pg"+k+"/06",1048576),H(!1));return 0});c.register_write(this.port|6,this,function(k){var y=this.get_page();0===y?(r("Write tcnt high: "+d(k,2),1048576),this.tcnt=this.tcnt&255|k<<8):1===y?(r("mac[5] = "+d(k),1048576),this.mac[5]=k):3===y?r("Unimplemented: Write pg3/06 (CONFIG3): "+d(k),1048576):(r("Write pg"+y+"/06: "+d(k),1048576),H(!1))});c.register_read(this.port|12,this,function(){var k=this.get_page();if(0===k)return 9;
r("Unimplemented: Read pg"+k+"/0c",1048576);H(!1);return 0});c.register_write(this.port|12,this,function(k){var y=this.get_page();0===y?(r("RX configuration reg write: "+d(k,2),1048576),this.rxcr=k):r("Unimplemented: Write pg"+y+"/0c: "+d(k),1048576)});c.register_read(this.port|16,this,this.data_port_read8,this.data_port_read16,this.data_port_read32);c.register_write(this.port|16,this,this.data_port_write16,this.data_port_write16,this.data_port_write32);b.devices.pci.register_device(this)}function ya(b,
c){this.cpu=b;this.bus=c;this.write_buffer=new m(64);this.read_buffer=new m(64);this.mixer_current_address=this.command_size=this.command=this.read_buffer_lastvalue=0;this.mixer_registers=new Uint8Array(256);this.mixer_reset();this.dummy_speaker_enabled=!1;this.test_register=0;this.dsp_signed=this.dsp_16bit=this.dsp_stereo=this.dsp_highspeed=!1;this.dac_buffers=[new q(65536),new q(65536)];this.dma=b.devices.dma;this.dma_channel=this.dma_irq=this.dma_bytes_block=this.dma_bytes_left=this.dma_bytes_count=
this.dma_sample_count=0;this.dma_channel_8bit=1;this.dma_channel_16bit=5;this.dma_autoinit=!1;this.dma_buffer=new ArrayBuffer(65536);this.dma_buffer_int8=new Int8Array(this.dma_buffer);this.dma_buffer_uint8=new Uint8Array(this.dma_buffer);this.dma_buffer_int16=new Int16Array(this.dma_buffer);this.dma_buffer_uint16=new Uint16Array(this.dma_buffer);this.dma_syncbuffer=new aa.SyncBuffer(this.dma_buffer);this.dma_paused=this.dma_waiting_transfer=!1;this.sampling_rate=22050;c.send("dac-tell-sampling-rate",
this.sampling_rate);this.bytes_per_sample=1;this.e2_value=170;this.e2_count=0;this.asp_registers=new Uint8Array(256);this.mpu_read_buffer=new m(64);this.fm_current_address1=this.fm_current_address0=this.mpu_read_buffer_lastvalue=0;this.fm_waveform_select_enable=!1;this.irq=5;this.irq_triggered=new Uint8Array(16);b.io.register_read_consecutive(544,this,this.port2x0_read,this.port2x1_read,this.port2x2_read,this.port2x3_read);b.io.register_read_consecutive(904,this,this.port2x0_read,this.port2x1_read);
b.io.register_read_consecutive(548,this,this.port2x4_read,this.port2x5_read);b.io.register_read(550,this,this.port2x6_read);b.io.register_read(551,this,this.port2x7_read);b.io.register_read(552,this,this.port2x8_read);b.io.register_read(553,this,this.port2x9_read);b.io.register_read(554,this,this.port2xA_read);b.io.register_read(555,this,this.port2xB_read);b.io.register_read(556,this,this.port2xC_read);b.io.register_read(557,this,this.port2xD_read);b.io.register_read_consecutive(558,this,this.port2xE_read,
this.port2xF_read);b.io.register_write_consecutive(544,this,this.port2x0_write,this.port2x1_write,this.port2x2_write,this.port2x3_write);b.io.register_write_consecutive(904,this,this.port2x0_write,this.port2x1_write);b.io.register_write_consecutive(548,this,this.port2x4_write,this.port2x5_write);b.io.register_write(550,this,this.port2x6_write);b.io.register_write(551,this,this.port2x7_write);b.io.register_write_consecutive(552,this,this.port2x8_write,this.port2x9_write);b.io.register_write(554,this,
this.port2xA_write);b.io.register_write(555,this,this.port2xB_write);b.io.register_write(556,this,this.port2xC_write);b.io.register_write(557,this,this.port2xD_write);b.io.register_write(558,this,this.port2xE_write);b.io.register_write(559,this,this.port2xF_write);b.io.register_read_consecutive(816,this,this.port3x0_read,this.port3x1_read);b.io.register_write_consecutive(816,this,this.port3x0_write,this.port3x1_write);this.dma.on_unmask(this.dma_on_unmask,this);c.register("dac-request-data",function(){this.dac_handle_request()},
this);c.register("speaker-has-initialized",function(){this.mixer_reset()},this);c.send("speaker-confirm-initialized");this.dsp_reset()}function x(b,c,g){g||=ya.prototype.dsp_default_handler;for(var h=0;h<b.length;h++)pb[b[h]]=c,fb[b[h]]=g}function D(b){for(var c=[],g=0;16>g;g++)c.push(b+g);return c}function L(b,c){c||=ya.prototype.mixer_default_read;gb[b]=c}function Z(b,c){c||=ya.prototype.mixer_default_write;Cb[b]=c}function pa(b,c,g){ac[b]=1;gb[b]=function(){return this.mixer_registers[c]&240|this.mixer_registers[g]>>>
4};Cb[b]=function(h){this.mixer_registers[b]=h;var k=h<<4&240|this.mixer_registers[g]&15;this.mixer_write(c,h&240|this.mixer_registers[c]&15);this.mixer_write(g,k)}}function Ja(b,c,g){gb[b]=ya.prototype.mixer_default_read;Cb[b]=function(h){this.mixer_registers[b]=h;this.bus.send("mixer-volume",[c,g,(h>>>2)-62])}}function ea(b,c){c||=ya.prototype.fm_default_write;for(var g=0;g<b.length;g++)dc[b[g]]=c}function ra(b,c){for(var g=[];b<=c;b++)g.push(b);return g}function Fa(b,c,g){return(b<c)*c+(b>g)*g+
(c<=b&&b<=g)*b}function P(b,c){this.cpu=b;this.pci=b.devices.pci;this.device_id=c.device_id;this.pci_space=[244,26,c.device_id&255,c.device_id>>8,7,5,16,0,1,0,2,0,0,0,0,0,1,168,0,0,0,16,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,c.subsystem_device_id&255,c.subsystem_device_id>>8,0,0,0,0,64,0,0,0,0,0,0,0,0,1,0,0];this.pci_space=this.pci_space.concat(aa.zeros(256-this.pci_space.length));this.pci_id=c.pci_id;this.pci_bars=[];this.name=c.name;this.driver_feature_select=this.device_feature_select=
0;this.device_feature=new Uint32Array(4);this.driver_feature=new Uint32Array(4);for(var g of c.common.features)H(0<=g,"VirtIO device<"+this.name+"> feature bit numbers must be non-negative"),H(128>g,"VirtIO device<"+this.name+"> feature bit numbers assumed less than 128 in implementation"),this.device_feature[g>>>5]|=1<<(g&31),this.driver_feature[g>>>5]|=1<<(g&31);H(c.common.features.includes(32),"VirtIO device<"+this.name+"> only non-transitional devices are supported");this.features_ok=!0;this.device_status=
0;this.config_has_changed=!1;this.config_generation=0;this.queues=[];for(var h of c.common.queues)this.queues.push(new Ia(b,this,h));this.queue_select=0;this.queue_selected=this.queues[0];this.isr_status=0;if(N){g=new Set;for(var k of this.queues.map(y=>y.notify_offset))h=c.notification.single_handler?0:k,g.add(h),H(c.notification.handlers[h],"VirtIO device<"+this.name+"> every queue's notifier must exist");for(const [y,u]of c.notification.handlers.entries())H(!u||g.has(y),"VirtIO device<"+this.name+
"> no defined notify handler should be unused")}k=[];k.push(this.create_common_capability(c.common));k.push(this.create_notification_capability(c.notification));k.push(this.create_isr_capability(c.isr_status));c.device_specific&&k.push(this.create_device_specific_capability(c.device_specific));this.init_capabilities(k);b.devices.pci.register_device(this);this.reset()}function Ia(b,c,g){this.cpu=b;this.virtio=c;this.size_supported=this.size=g.size_supported;this.mask=this.size-1;this.enabled=!1;this.notify_offset=
g.notify_offset;this.num_staged_replies=this.used_addr=this.avail_last_idx=this.avail_addr=this.desc_addr=0;this.reset()}function ha(b,c){this.cpu=b.cpu;this.virtio=b.virtio;this.head_idx=c;this.read_buffers=[];this.length_readable=this.read_buffer_offset=this.read_buffer_idx=0;this.write_buffers=[];this.length_writable=this.length_written=this.write_buffer_offset=this.write_buffer_idx=0;let g=b.desc_addr,h=0,k=b.size,y=!1;const u=this.virtio.is_feature_negotiated(28);r("<<< Descriptor chain start",
2097152);do{const I=b.get_descriptor(g,c);r("descriptor: idx="+c+" addr="+d(I.addr_high,8)+":"+d(I.addr_low,8)+" len="+d(I.len,8)+" flags="+d(I.flags,4)+" next="+d(I.next,4),2097152);if(u&&I.flags&4)N&&I.flags&1&&r("Driver bug: has set VIRTQ_DESC_F_NEXT flag in an indirect table descriptor",2097152),g=I.addr_low,h=c=0,k=I.len/16,r("start indirect",2097152);else{if(I.flags&2)y=!0,this.write_buffers.push(I),this.length_writable+=I.len;else{if(y){r("Driver bug: readonly buffer after writeonly buffer within chain",
2097152);break}this.read_buffers.push(I);this.length_readable+=I.len}h++;if(h>k){r("Driver bug: descriptor chain cycle detected",2097152);break}if(I.flags&1)c=I.next;else break}}while(1);r("Descriptor chain end >>>",2097152)}function va(){this.listeners={};this.pair=void 0}function H(b,c,g){if(N&&!b){debugger;console.trace();if(c)throw"Assert failed: "+c;throw"Assert failed";}}function sa(b,c,g){this.next_tick_immediately=g;this.wm=c;this.wasm_patch();this.create_jit_imports();this.wasm_memory=c=
this.wm.exports.memory;this.memory_size=aa.view(Uint32Array,c,812,1);this.mem8=new Uint8Array(0);this.mem32s=new Int32Array(this.mem8.buffer);this.segment_is_null=aa.view(Uint8Array,c,724,8);this.segment_offsets=aa.view(Int32Array,c,736,8);this.segment_limits=aa.view(Uint32Array,c,768,8);this.protected_mode=aa.view(Int32Array,c,800,1);this.idtr_size=aa.view(Int32Array,c,564,1);this.idtr_offset=aa.view(Int32Array,c,568,1);this.gdtr_size=aa.view(Int32Array,c,572,1);this.gdtr_offset=aa.view(Int32Array,
c,576,1);this.tss_size_32=aa.view(Int32Array,c,1128,1);this.page_fault=aa.view(Uint32Array,c,540,8);this.cr=aa.view(Int32Array,c,580,8);this.cpl=aa.view(Uint8Array,c,612,1);this.is_32=aa.view(Int32Array,c,804,1);this.stack_size_32=aa.view(Int32Array,c,808,1);this.in_hlt=aa.view(Uint8Array,c,616,1);this.last_virt_eip=aa.view(Int32Array,c,620,1);this.eip_phys=aa.view(Int32Array,c,624,1);this.sysenter_cs=aa.view(Int32Array,c,636,1);this.sysenter_esp=aa.view(Int32Array,c,640,1);this.sysenter_eip=aa.view(Int32Array,
c,644,1);this.prefixes=aa.view(Int32Array,c,648,1);this.flags=aa.view(Int32Array,c,120,1);this.flags_changed=aa.view(Int32Array,c,100,1);this.last_op_size=aa.view(Int32Array,c,96,1);this.last_op1=aa.view(Int32Array,c,104,1);this.last_result=aa.view(Int32Array,c,112,1);this.current_tsc=aa.view(Uint32Array,c,960,2);this.devices={};this.instruction_pointer=aa.view(Int32Array,c,556,1);this.previous_ip=aa.view(Int32Array,c,560,1);this.apic_enabled=aa.view(Uint8Array,c,548,1);this.acpi_enabled=aa.view(Uint8Array,
c,552,1);this.memory_map_read8=[];this.memory_map_write8=[];this.memory_map_read32=[];this.memory_map_write32=[];this.bios={main:null,vga:null};this.instruction_counter=aa.view(Uint32Array,c,664,1);this.reg32=aa.view(Int32Array,c,64,8);this.fpu_st=aa.view(Int32Array,c,1152,32);this.fpu_stack_empty=aa.view(Uint8Array,c,816,1);this.fpu_stack_empty[0]=255;this.fpu_stack_ptr=aa.view(Uint8Array,c,1032,1);this.fpu_stack_ptr[0]=0;this.fpu_control_word=aa.view(Uint16Array,c,1036,1);this.fpu_control_word[0]=
895;this.fpu_status_word=aa.view(Uint16Array,c,1040,1);this.fpu_status_word[0]=0;this.fpu_ip=aa.view(Int32Array,c,1048,1);this.fpu_ip[0]=0;this.fpu_ip_selector=aa.view(Int32Array,c,1052,1);this.fpu_ip_selector[0]=0;this.fpu_opcode=aa.view(Int32Array,c,1044,1);this.fpu_opcode[0]=0;this.fpu_dp=aa.view(Int32Array,c,1056,1);this.fpu_dp[0]=0;this.fpu_dp_selector=aa.view(Int32Array,c,1060,1);this.fpu_dp_selector[0]=0;this.reg_xmm32s=aa.view(Int32Array,c,832,32);this.mxcsr=aa.view(Int32Array,c,824,1);this.sreg=
aa.view(Uint16Array,c,668,8);this.dreg=aa.view(Int32Array,c,684,8);this.reg_pdpte=aa.view(Int32Array,c,968,8);this.svga_dirty_bitmap_min_offset=aa.view(Uint32Array,c,716,1);this.svga_dirty_bitmap_max_offset=aa.view(Uint32Array,c,720,1);this.fw_value=[];this.fw_pointer=0;this.option_roms=[];this.io=void 0;this.bus=b;this.set_tsc(0,0);this.debug_init();N&&(this.do_many_cycles_total=this.do_many_cycles_count=0,this.seen_code={},this.seen_code_uncompiled={})}function Ra(b){return b.map(function(c){var g=
Object.keys(c);console.assert(1===g.length);g=g[0];c=c[g];console.assert(0<c.size);return{name:g,type:c,size:c.size,get:c.get,set:c.set}})}function Xa(b){b=new DataView(b);let [c,g]=rb(b,ec);console.assert(52===g);if(N)for(var h of Object.keys(c))r(h+": 0x"+(c[h].toString(16)>>>0));console.assert(1179403647===c.magic,"Bad magic");console.assert(1===c.class,"Unimplemented: 64 bit elf");console.assert(1===c.data,"Unimplemented: big endian");console.assert(1===c.version0,"Bad version0");console.assert(2===
c.type,"Unimplemented type");console.assert(1===c.version1,"Bad version1");console.assert(52===c.ehsize,"Bad header size");console.assert(32===c.phentsize,"Bad program header size");console.assert(40===c.shentsize,"Bad section header size");[h]=Bb(new DataView(b.buffer,b.byteOffset+c.phoff,c.phentsize*c.phnum),fc,c.phnum);[b]=Bb(new DataView(b.buffer,b.byteOffset+c.shoff,c.shentsize*c.shnum),gc,c.shnum);if(N&&Q){console.log("%d program headers:",h.length);for(let k of h)console.log("type=%s offset=%s vaddr=%s paddr=%s filesz=%s memsz=%s flags=%s align=%s",
k.type.toString(16),k.offset.toString(16),k.vaddr.toString(16),k.paddr.toString(16),k.filesz.toString(16),k.memsz.toString(16),k.flags.toString(16),k.align.toString(16));console.log("%d program headers:",b.length);for(let k of b)console.log("name=%s type=%s flags=%s addr=%s offset=%s size=%s link=%s info=%s addralign=%s entsize=%s",k.name.toString(16),k.type.toString(16),k.flags.toString(16),k.addr.toString(16),k.offset.toString(16),k.size.toString(16),k.link.toString(16),k.info.toString(16),k.addralign.toString(16),
k.entsize.toString(16))}return{header:c,program_headers:h,sections_headers:b}}function rb(b,c){let g={},h=0;for(let k of c)c=k.get.call(b,h,!0),console.assert(void 0===g[k.name]),g[k.name]=c,h+=k.size;return[g,h]}function Bb(b,c,g){let h=[],k=0;for(var y=0;y<g;y++){let [u,I]=rb(new DataView(b.buffer,b.byteOffset+k,void 0),c);h.push(u);k+=I}return[h,k]}function ob(b,c,g,h){r("Trying to load kernel of size "+c.byteLength);var k=new Uint8Array(c);const y=new Uint16Array(c),u=new Uint32Array(c);var I=
k[497]||4,ba=y[255];if(43605!==ba)r("Bad checksum1: "+d(ba));else if(ba=y[257]|y[258]<<16,1400005704!==ba)r("Bad checksum2: "+d(ba));else{ba=y[259];H(514<=ba);var R=k[529];H(R&1);var U=y[283],Y=u[139],fa=u[140],na=k[564],oa=k[565],Ca=u[142],Ya=u[146],ib=u[147],zb=u[150],Ib=u[151],vb=u[152];r("kernel boot protocol version: "+d(ba));r("flags="+d(R)+" xflags="+d(U));r("code32_start="+d(u[133]));r("initrd_addr_max="+d(Y));r("kernel_alignment="+d(fa));r("relocatable="+na);r("min_alignment="+d(oa));r("cmdline max="+
d(Ca));r("payload offset="+d(Ya)+" size="+d(ib));r("pref_address="+d(Ib)+":"+d(zb));r("init_size="+d(vb));k[528]=255;k[529]=R&-97|128;y[274]=56832;y[253]=65535;r("heap_end_ptr="+d(56832));h+="\x00";H(h.length<Ca);r("cmd_line_ptr="+d(581632));u[138]=581632;for(k=0;k<h.length;k++)b[581632+k]=h.charCodeAt(k);I=512*(I+1);r("prot_mode_kernel_start="+d(I));h=new Uint8Array(c,0,I);c=new Uint8Array(c,I);k=I=0;g&&(I=67108864,k=g.byteLength,H(1048576+c.length<I),b.set(new Uint8Array(g),I));u[134]=I;u[135]=
k;H(655360>524288+h.length);b.set(h,524288);b.set(c,1048576);b=32768;c=57344;h=new Uint8Array(256);(new Uint16Array(h.buffer))[0]=43605;h[2]=1;g=3;h[g++]=250;h[g++]=184;h[g++]=b>>0;h[g++]=b>>8;h[g++]=142;h[g++]=192;h[g++]=142;h[g++]=216;h[g++]=142;h[g++]=224;h[g++]=142;h[g++]=232;h[g++]=142;h[g++]=208;h[g++]=188;h[g++]=c>>0;h[g++]=c>>8;h[g++]=234;h[g++]=0;h[g++]=0;h[g++]=b+32>>0;h[g++]=b+32>>8;H(512>g);b=g;for(g=c=h[b]=0;g<h.length;g++)c+=h[g];h[b]=-c;return{option_rom:{name:"genroms/kernel.bin",
data:h}}}}function Ob(b){function c(na){!na.altKey&&I[56]&&y(56,!1);return k(na,!1)}function g(na){!na.altKey&&I[56]&&y(56,!1);return k(na,!0)}function h(na){na=Object.keys(I);for(var oa,Ca=0;Ca<na.length;Ca++)oa=+na[Ca],I[oa]&&y(oa,!1);I={}}function k(na,oa){var Ca;if(Ca=ba.bus)Ca=na.shiftKey&&na.ctrlKey&&(73===na.keyCode||74===na.keyCode||75===na.keyCode)||!ba.emu_enabled?!1:na.target?na.target.classList.contains("phone_keyboard")||"INPUT"!==na.target.nodeName&&"TEXTAREA"!==na.target.nodeName:!0;
if(Ca){if(void 0===na.code||(Ca=fa[na.code],void 0===Ca))Ca=R[na.keyCode];if(Ca)return y(Ca,oa,na.repeat),na.preventDefault&&na.preventDefault(),!1;console.log("Missing char in map: keyCode="+(na.keyCode||-1).toString(16)+" code="+na.code)}}function y(na,oa,Ca){if(oa)I[na]&&!Ca&&y(na,!1);else if(!I[na])return;(I[na]=oa)||(na|=128);255<na?(u(na>>8),u(na&255)):u(na)}function u(na){ba.bus.send("keyboard-code",na)}var I={},ba=this;this.emu_enabled=!0;var R=new Uint16Array([0,0,0,0,0,0,0,0,14,15,0,0,0,
28,0,0,42,29,56,0,58,0,0,0,0,0,0,1,0,0,0,0,57,57417,57425,57423,57415,57419,57416,57421,80,0,0,0,0,82,83,0,11,2,3,4,5,6,7,8,9,10,0,39,0,13,0,0,0,30,48,46,32,18,33,34,35,23,36,37,38,50,49,24,25,16,19,31,20,22,47,17,45,21,44,57435,57436,57437,0,0,82,79,80,81,75,76,77,71,72,73,0,0,0,0,0,0,59,60,61,62,63,64,65,66,67,68,87,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,69,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,39,13,51,12,52,53,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,26,43,27,40,0,57435,57400,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),U={8:8,10:13,32:32,39:222,44:188,45:189,46:190,47:191,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,59:186,61:187,91:219,92:220,93:221,96:192,97:65,98:66,99:67,100:68,101:69,102:70,103:71,104:72,105:73,106:74,107:75,108:76,109:77,110:78,111:79,112:80,113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,122:90},Y={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,42:56,43:187,58:186,60:188,62:190,63:191,
64:50,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,94:54,95:189,123:219,124:220,125:221,126:192},fa={Escape:1,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Digit0:11,Minus:12,Equal:13,Backspace:14,Tab:15,KeyQ:16,KeyW:17,KeyE:18,KeyR:19,KeyT:20,KeyY:21,KeyU:22,KeyI:23,KeyO:24,KeyP:25,BracketLeft:26,BracketRight:27,Enter:28,ControlLeft:29,KeyA:30,KeyS:31,
KeyD:32,KeyF:33,KeyG:34,KeyH:35,KeyJ:36,KeyK:37,KeyL:38,Semicolon:39,Quote:40,Backquote:41,ShiftLeft:42,Backslash:43,KeyZ:44,KeyX:45,KeyC:46,KeyV:47,KeyB:48,KeyN:49,KeyM:50,Comma:51,Period:52,Slash:53,IntlRo:53,ShiftRight:54,NumpadMultiply:55,AltLeft:56,Space:57,CapsLock:58,F1:59,F2:60,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,F10:68,NumLock:69,ScrollLock:70,Numpad7:71,Numpad8:72,Numpad9:73,NumpadSubtract:74,Numpad4:75,Numpad5:76,Numpad6:77,NumpadAdd:78,Numpad1:79,Numpad2:80,Numpad3:81,Numpad0:82,
NumpadDecimal:83,IntlBackslash:86,F11:87,F12:88,NumpadEnter:57372,ControlRight:57373,NumpadDivide:57397,AltRight:57400,Home:57415,ArrowUp:57416,PageUp:57417,ArrowLeft:57419,ArrowRight:57421,End:57423,ArrowDown:57424,PageDown:57425,Insert:57426,Delete:57427,OSLeft:57435,OSRight:57436,ContextMenu:57437};this.bus=b;this.destroy=function(){"undefined"!==typeof window&&(window.removeEventListener("keyup",c,!1),window.removeEventListener("keydown",g,!1),window.removeEventListener("blur",h,!1))};this.init=
function(){"undefined"!==typeof window&&(this.destroy(),window.addEventListener("keyup",c,!1),window.addEventListener("keydown",g,!1),window.addEventListener("blur",h,!1))};this.init();this.simulate_press=function(na){na={keyCode:na};k(na,!0);k(na,!1)};this.simulate_char=function(na){var oa=na.charCodeAt(0);oa in U?this.simulate_press(U[oa]):oa in Y?(u(42),this.simulate_press(Y[oa]),u(170)):console.log("ascii -> keyCode not found: ",oa,na)}}function db(b,c){function g(fa){}function h(fa){if(ba||U||
R)Y.bus.send("mouse-click",[!1,!1,!1]),ba=U=R=!1}function k(fa){}function y(fa){}function u(fa){}function I(fa){}var ba=!1,R=!1,U=!1,Y=this;this.enabled=!1;this.emu_enabled=!0;this.bus=b;this.bus.register("mouse-enable",function(fa){this.enabled=fa},this);this.is_running=!1;this.bus.register("emulator-stopped",function(){this.is_running=!1},this);this.bus.register("emulator-started",function(){this.is_running=!0},this);this.destroy=function(){"undefined"!==typeof window&&(window.removeEventListener("touchstart",
g,!1),window.removeEventListener("touchend",h,!1),window.removeEventListener("touchmove",k,!1),window.removeEventListener("mousemove",k,!1),window.removeEventListener("mousedown",y,!1),window.removeEventListener("mouseup",u,!1),window.removeEventListener("wheel",I,{passive:!1}))};this.init=function(){"undefined"!==typeof window&&(this.destroy(),window.addEventListener("touchstart",g,!1),window.addEventListener("touchend",h,!1),window.addEventListener("touchmove",k,!1),window.addEventListener("mousemove",
k,!1),window.addEventListener("mousedown",y,!1),window.addEventListener("mouseup",u,!1),window.addEventListener("wheel",I,{passive:!1}))};this.init()}function Db(b){if("undefined"!==typeof window)if(window.AudioContext||window.webkitAudioContext){var c=window.AudioWorklet?ta:Da;this.bus=b;this.audio_context=window.AudioContext?new AudioContext:new webkitAudioContext;this.mixer=new T(b,this.audio_context);this.pcspeaker=new ia(b,this.audio_context,this.mixer);this.dac=new c(b,this.audio_context,this.mixer);
this.pcspeaker.start();b.register("emulator-stopped",function(){this.audio_context.suspend()},this);b.register("emulator-started",function(){this.audio_context.resume()},this);b.register("speaker-confirm-initialized",function(){b.send("speaker-has-initialized")},this);b.send("speaker-has-initialized")}else console.warn("Web browser doesn't support Web Audio API")}function T(b,c){function g(h){return function(k){h.gain.setValueAtTime(k,this.audio_context.currentTime)}}this.audio_context=c;this.sources=
new Map;this.gain_right=this.gain_left=this.volume_right=this.volume_left=this.volume_both=1;this.node_treble_left=this.audio_context.createBiquadFilter();this.node_treble_right=this.audio_context.createBiquadFilter();this.node_treble_left.type="highshelf";this.node_treble_right.type="highshelf";this.node_treble_left.frequency.setValueAtTime(2E3,this.audio_context.currentTime);this.node_treble_right.frequency.setValueAtTime(2E3,this.audio_context.currentTime);this.node_bass_left=this.audio_context.createBiquadFilter();
this.node_bass_right=this.audio_context.createBiquadFilter();this.node_bass_left.type="lowshelf";this.node_bass_right.type="lowshelf";this.node_bass_left.frequency.setValueAtTime(200,this.audio_context.currentTime);this.node_bass_right.frequency.setValueAtTime(200,this.audio_context.currentTime);this.node_gain_left=this.audio_context.createGain();this.node_gain_right=this.audio_context.createGain();this.node_merger=this.audio_context.createChannelMerger(2);this.input_left=this.node_treble_left;this.input_right=
this.node_treble_right;this.node_treble_left.connect(this.node_bass_left);this.node_bass_left.connect(this.node_gain_left);this.node_gain_left.connect(this.node_merger,0,0);this.node_treble_right.connect(this.node_bass_right);this.node_bass_right.connect(this.node_gain_right);this.node_gain_right.connect(this.node_merger,0,1);this.node_merger.connect(this.audio_context.destination);b.register("mixer-connect",function(h){this.connect_source(h[0],h[1])},this);b.register("mixer-disconnect",function(h){this.disconnect_source(h[0],
h[1])},this);b.register("mixer-volume",function(h){var k=h[0],y=h[1];h=Math.pow(10,h[2]/20);var u=0===k?this:this.sources.get(k);void 0===u?H(!1,"Mixer set volume - cannot set volume for undefined source: "+k):u.set_volume(h,y)},this);b.register("mixer-gain-left",function(h){this.gain_left=Math.pow(10,h/20);this.update()},this);b.register("mixer-gain-right",function(h){this.gain_right=Math.pow(10,h/20);this.update()},this);b.register("mixer-treble-left",g(this.node_treble_left),this);b.register("mixer-treble-right",
g(this.node_treble_right),this);b.register("mixer-bass-left",g(this.node_bass_left),this);b.register("mixer-bass-right",g(this.node_bass_right),this)}function ca(b,c,g,h){this.audio_context=b;this.connected_right=this.connected_left=!0;this.volume_right=this.volume_left=this.volume_both=this.gain_hidden=1;this.node_splitter=b.createChannelSplitter(2);this.node_gain_left=b.createGain();this.node_gain_right=b.createGain();c.connect(this.node_splitter);this.node_splitter.connect(this.node_gain_left,
0);this.node_gain_left.connect(g);this.node_splitter.connect(this.node_gain_right,1);this.node_gain_right.connect(h)}function ia(b,c,g){this.node_oscillator=c.createOscillator();this.node_oscillator.type="square";this.node_oscillator.frequency.setValueAtTime(440,c.currentTime);this.mixer_connection=g.add_source(this.node_oscillator,1);this.mixer_connection.disconnect();b.register("pcspeaker-enable",function(){g.connect_source(1)},this);b.register("pcspeaker-disable",function(){g.disconnect_source(1)},
this);b.register("pcspeaker-update",function(h){var k=h[1],y=0;3===h[0]&&(y=1193181.6665999999/k,y=Math.min(y,this.node_oscillator.frequency.maxValue),y=Math.max(y,0));this.node_oscillator.frequency.setValueAtTime(y,c.currentTime)},this)}function ta(b,c,g){this.bus=b;this.audio_context=c;this.enabled=!1;this.sampling_rate=48E3;c=function(){function u(R){if(0===R)return 1;R*=Math.PI;return Math.sin(R)/R}function I(){var R=Reflect.construct(AudioWorkletProcessor,[],I);R.kernel_size=3;R.queue_data=Array(1024);
R.queue_start=0;R.queue_end=0;R.queue_length=0;R.queue_size=R.queue_data.length;R.queued_samples=0;R.source_buffer_previous=ba;R.source_buffer_current=ba;R.source_samples_per_destination=1;R.source_block_start=0;R.source_time=0;R.source_offset=0;R.port.onmessage=U=>{switch(U.data.type){case "queue":R.queue_push(U.data.value);break;case "sampling-rate":R.source_samples_per_destination=U.data.value/sampleRate}};return R}var ba=[new Float32Array(256),new Float32Array(256)];Reflect.setPrototypeOf(I.prototype,
AudioWorkletProcessor.prototype);Reflect.setPrototypeOf(I,AudioWorkletProcessor);I.prototype.process=I.prototype.process=function(R,U,Y){for(R=0;R<U[0][0].length;R++){for(var fa=Y=0,na=this.source_offset+this.kernel_size,oa=this.source_offset-this.kernel_size+1;oa<=na;oa++){var Ca=this.source_block_start+oa;Y+=this.get_sample(Ca,0)*this.kernel(this.source_time-oa);fa+=this.get_sample(Ca,1)*this.kernel(this.source_time-oa)}if(isNaN(Y)||isNaN(fa))Y=fa=0,this.dbg_log("ERROR: NaN values! Ignoring for now.");
U[0][0][R]=Y;U[0][1][R]=fa;this.source_time+=this.source_samples_per_destination;this.source_offset=Math.floor(this.source_time)}U=this.source_offset;U+=this.kernel_size+2;this.source_time-=this.source_offset;this.source_block_start+=this.source_offset;this.source_offset=0;this.ensure_enough_data(U);return!0};I.prototype.kernel=function(R){return u(R)*u(R/this.kernel_size)};I.prototype.get_sample=function(R,U){return 0>R?(R+=this.source_buffer_previous[0].length,this.source_buffer_previous[U][R]):
this.source_buffer_current[U][R]};I.prototype.ensure_enough_data=function(R){var U=this.source_buffer_current[0].length;U-this.source_block_start<R&&(this.prepare_next_buffer(),this.source_block_start-=U)};I.prototype.prepare_next_buffer=function(){256>this.queued_samples&&this.queue_length&&this.dbg_log("Not enough samples - should not happen during midway of playback");this.source_buffer_previous=this.source_buffer_current;this.source_buffer_current=this.queue_shift();var R=this.source_buffer_current[0].length;
if(256>R){for(var U=this.queue_start,Y=0;256>R&&Y<this.queue_length;)R+=this.queue_data[U][0].length,U=U+1&this.queue_size-1,Y++;R=Math.max(R,256);R=[new Float32Array(R),new Float32Array(R)];R[0].set(this.source_buffer_current[0]);R[1].set(this.source_buffer_current[1]);U=this.source_buffer_current[0].length;for(var fa=0;fa<Y;fa++){var na=this.queue_shift();R[0].set(na[0],U);R[1].set(na[1],U);U+=na[0].length}this.source_buffer_current=R}this.pump()};I.prototype.pump=function(){1024>this.queued_samples/
this.source_samples_per_destination&&this.port.postMessage({type:"pump"})};I.prototype.queue_push=function(R){this.queue_length<this.queue_size&&(this.queue_data[this.queue_end]=R,this.queue_end=this.queue_end+1&this.queue_size-1,this.queue_length++,this.queued_samples+=R[0].length,this.pump())};I.prototype.queue_shift=function(){if(!this.queue_length)return ba;var R=this.queue_data[this.queue_start];this.queue_data[this.queue_start]=null;this.queue_start=this.queue_start+1&this.queue_size-1;this.queue_length--;
this.queued_samples-=R[0].length;return R};I.prototype.dbg_log=function(R){N&&this.port.postMessage({type:"debug-log",value:R})};registerProcessor("dac-processor",I)}.toString();var h=c.indexOf("{")+1,k=c.lastIndexOf("}");c=c.substring(h,k);N&&(c="var DEBUG = true;\n"+c);c=new Blob([c],{type:"application/javascript"});var y=URL.createObjectURL(c);this.node_processor=null;this.node_output=this.audio_context.createGain();this.audio_context.audioWorklet.addModule(y).then(()=>{URL.revokeObjectURL(y);
this.node_processor=new AudioWorkletNode(this.audio_context,"dac-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2],parameterData:{},processorOptions:{}});this.node_processor.port.postMessage({type:"sampling-rate",value:this.sampling_rate});this.node_processor.port.onmessage=u=>{switch(u.data.type){case "pump":this.pump();break;case "debug-log":r("SpeakerWorkletDAC - Worklet: "+u.data.value)}};this.node_processor.connect(this.node_output)});this.mixer_connection=g.add_source(this.node_output,
2);this.mixer_connection.set_gain_hidden(3);b.register("dac-send-data",function(u){this.queue(u)},this);b.register("dac-enable",function(u){this.enabled=!0},this);b.register("dac-disable",function(){this.enabled=!1},this);b.register("dac-tell-sampling-rate",function(u){H(0<u,"Sampling rate should be nonzero");this.sampling_rate=u;this.node_processor&&this.node_processor.port.postMessage({type:"sampling-rate",value:u})},this);N&&(this.debugger=new Va(this.audio_context,this.node_output))}function Da(b,
c,g){this.bus=b;this.audio_context=c;this.enabled=!1;this.sampling_rate=22050;this.buffered_time=0;this.rate_ratio=1;this.node_lowpass=this.audio_context.createBiquadFilter();this.node_lowpass.type="lowpass";this.node_output=this.node_lowpass;this.mixer_connection=g.add_source(this.node_output,2);this.mixer_connection.set_gain_hidden(3);b.register("dac-send-data",function(h){this.queue(h)},this);b.register("dac-enable",function(h){this.enabled=!0;this.pump()},this);b.register("dac-disable",function(){this.enabled=
!1},this);b.register("dac-tell-sampling-rate",function(h){H(0<h,"Sampling rate should be nonzero");this.sampling_rate=h;this.rate_ratio=Math.ceil(8E3/h);this.node_lowpass.frequency.setValueAtTime(h/2,this.audio_context.currentTime)},this);N&&(this.debugger=new Va(this.audio_context,this.node_output))}function Va(b,c){this.audio_context=b;this.node_source=c;this.node_processor=null;this.node_gain=this.audio_context.createGain();this.node_gain.gain.setValueAtTime(0,this.audio_context.currentTime);this.node_gain.connect(this.audio_context.destination);
this.is_active=!1;this.queued_history=[];this.output_history=[];this.queued=[[],[]];this.output=[[],[]]}function Za(b,c){function g(I){u.bus&&u.enabled&&(u.send_char(I.which),I.preventDefault())}function h(I){var ba=I.which;8===ba?(u.send_char(127),I.preventDefault()):9===ba&&(u.send_char(9),I.preventDefault())}function k(I){if(u.enabled){for(var ba=I.clipboardData.getData("text/plain"),R=0;R<ba.length;R++)u.send_char(ba.charCodeAt(R));I.preventDefault()}}function y(I){I.target!==b&&b.blur()}var u=
this;this.enabled=!0;this.bus=c;this.text="";this.text_new_line=!1;this.last_update=0;this.bus.register("serial0-output-char",function(I){this.show_char(I)},this);this.destroy=function(){b.removeEventListener("keypress",g,!1);b.removeEventListener("keydown",h,!1);b.removeEventListener("paste",k,!1);window.removeEventListener("mousedown",y,!1)};this.init=function(){this.destroy();b.style.display="block";b.addEventListener("keypress",g,!1);b.addEventListener("keydown",h,!1);b.addEventListener("paste",
k,!1);window.addEventListener("mousedown",y,!1)};this.init();this.show_char=function(I){"\b"===I?(this.text=this.text.slice(0,-1),this.update()):"\r"!==I&&(this.text+=I,"\n"===I&&(this.text_new_line=!0),this.update())};this.update=function(){var I=Date.now(),ba=I-this.last_update;16>ba?void 0===this.update_timer&&(this.update_timer=setTimeout(()=>{this.update_timer=void 0;var R=Date.now();H(15<=R-this.last_update);this.last_update=R;this.render()},16-ba)):(void 0!==this.update_timer&&(clearTimeout(this.update_timer),
this.update_timer=void 0),this.last_update=I,this.render())};this.render=function(){b.value=this.text;this.text_new_line&&(this.text_new_line=!1,b.scrollTop=1E9)};this.send_char=function(I){u.bus&&u.bus.send("serial0-input",I)}}function eb(b,c){this.element=b;if(window.Terminal){var g=this.term=new window.Terminal;g.setOption("logLevel","off");g.write("This is the serial console. Whatever you type or paste here will be sent to COM1");var h=g.onData(function(k){for(let y=0;y<k.length;y++)c.send("serial0-input",
k.charCodeAt(y))});c.register("serial0-output-char",function(k){g.write(k)},this);this.destroy=function(){h.dispose();g.dispose()}}}function Ka(b,c){this.bus=c;this.socket=void 0;this.send_queue=[];this.url=b;this.reconnect_interval=1E4;this.last_connect_attempt=Date.now()-this.reconnect_interval;this.send_queue_limit=64;this.bus.register("net0-send",function(g){this.send(g)},this)}function ua(b){this.cpu_is_running=!1;var c=hc.create();this.bus=c[0];this.emulator_bus=c[1];var g,h;const k=new WebAssembly.Table({element:"anyfunc",
initial:1924});c={cpu_exception_hook:u=>this.cpu_exception_hook&&this.cpu_exception_hook(u),hlt_op:function(){return g.hlt_op()},abort:function(){H(!1)},microtick:f.microtick,get_rand_int:function(){return aa.get_rand_int()},pic_acknowledge:function(){g.pic_acknowledge()},io_port_read8:function(u){return g.io.port_read8(u)},io_port_read16:function(u){return g.io.port_read16(u)},io_port_read32:function(u){return g.io.port_read32(u)},io_port_write8:function(u,I){g.io.port_write8(u,I)},io_port_write16:function(u,
I){g.io.port_write16(u,I)},io_port_write32:function(u,I){g.io.port_write32(u,I)},mmap_read8:function(u){return g.mmap_read8(u)},mmap_read16:function(u){return g.mmap_read16(u)},mmap_read32:function(u){return g.mmap_read32(u)},mmap_write8:function(u,I){g.mmap_write8(u,I)},mmap_write16:function(u,I){g.mmap_write16(u,I)},mmap_write32:function(u,I){g.mmap_write32(u,I)},mmap_write64:function(u,I,ba){g.mmap_write64(u,I,ba)},mmap_write128:function(u,I,ba,R,U){g.mmap_write128(u,I,ba,R,U)},log_from_wasm:function(u,
I){u=aa.read_sized_string_from_mem(h,u,I);r(u,2)},console_log_from_wasm:function(u,I){u=aa.read_sized_string_from_mem(h,u,I);console.error(u)},dbg_trace_from_wasm:function(){N&&r(Error().stack,2)},codegen_finalize:(u,I,ba,R,U)=>{g.codegen_finalize(u,I,ba,R,U)},jit_clear_func:u=>g.jit_clear_func(u),jit_clear_all_funcs:()=>g.jit_clear_all_funcs(),__indirect_function_table:k};let y=b.wasm_fn;y||=u=>new Promise(I=>{let ba=N?"v86-debug.wasm":"v86.wasm",R="v86-fallback.wasm";if(b.wasm_path){ba=b.wasm_path;
const U=ba.lastIndexOf("/");R=(-1===U?"":ba.substr(0,U))+"/"+R}else"undefined"===typeof window&&"string"===typeof __dirname?(ba=__dirname+"/"+ba,R=__dirname+"/"+R):(ba="build/"+ba,R="build/"+R);aa.load_file(ba,{done:async U=>{try{const {instance:Y}=await WebAssembly.instantiate(U,u);I(Y.exports)}catch(Y){aa.load_file(R,{done:async fa=>{({instance:fa}=await WebAssembly.instantiate(fa,u));I(fa.exports)}})}},progress:U=>{this.emulator_bus.send("download-progress",{file_index:0,file_count:1,file_name:ba,
lengthComputable:U.lengthComputable,total:U.total,loaded:U.loaded})}})});y({env:c}).then(u=>{h=u.memory;u.rust_init();u=this.v86=new f(this.emulator_bus,{exports:u,wasm_table:k});g=u.cpu;this.continue_init(u,b)})}function kb(b){this.message=b||"File already exists"}function lb(b){this.message=b||"File not found"}function Ab(b){var c,g,h,k,y;this.bus=b;b.register("screen-set-mode",function(u){this.set_mode(u)},this);b.register("screen-fill-buffer-end",function(u){this.update_buffer(u[0],u[1])},this);
b.register("screen-put-char",function(u){this.put_char(u[0],u[1],u[2],u[3],u[4])},this);b.register("screen-text-scroll",function(u){console.log("scroll",u)},this);b.register("screen-update-cursor",function(u){this.update_cursor(u[0],u[1])},this);b.register("screen-update-cursor-scanline",function(u){this.update_cursor_scanline(u[0],u[1])},this);b.register("screen-set-size-text",function(u){this.set_size_text(u[0],u[1])},this);b.register("screen-set-size-graphical",function(u){this.set_size_graphical(u[0],
u[1])},this);this.put_char=function(u,I,ba,R,U){u<y&&I<k&&(u=3*(u*k+I),h[u]=ba,h[u+1]=R,h[u+2]=U)};this.destroy=function(){};this.set_mode=function(u){};this.clear_screen=function(){};this.set_size_text=function(u,I){if(u!==k||I!==y)h=new Int32Array(u*I*3),k=u,y=I};this.set_size_graphical=function(u,I){};this.set_scale=function(u,I){};this.update_cursor_scanline=function(u,I){};this.update_cursor=function(u,I){if(u!==c||I!==g)c=u,g=I};this.update_buffer=function(u,I){};this.get_text_screen=function(){for(var u=
[],I=0;I<y;I++)u.push(this.get_text_row(I));return u};this.get_text_row=function(u){var I="";u=3*u*k;for(var ba=0;ba<k;ba++)I+=String.fromCharCode(h[u+3*ba]);return I}}function sb(){this.filedata=new Map}function qb(b,c){H(c,"ServerMemoryFileStorage: baseurl should not be empty");this.storage=b;this.baseurl=c}function ka(b,c){this.inodes=[];this.events=[];this.storage=b;this.qidcounter=c||{last_qidnumber:0};this.inodedata={};this.total_size=274877906944;this.used_size=0;this.mounts=[];this.CreateDirectory("",
-1)}function xb(b){this.direntries=new Map;this.minor=this.major=this.mtime=this.atime=this.ctime=this.fid=this.gid=this.uid=this.size=this.status=0;this.symlink="";this.mode=493;this.qid={type:0,version:0,path:b};this.caps=void 0;this.nlinks=0;this.sha256sum="";this.locks=[];this.foreign_id=this.mount_id=-1}function jb(b){this.fs=b;this.backtrack=new Map}function tb(){this.type=2;this.start=0;this.length=Infinity;this.proc_id=-1;this.client_id=""}function Hb(){this.stream=new Uint8Array(5);this.ofs=
0;this.Put=function(b){this.stream[this.ofs]=b;this.ofs++;switch(this.ofs){case 1:if(128>this.stream[0])return this.ofs=0,this.stream[0];break;case 2:if(192==(this.stream[0]&224)&&128==(this.stream[1]&192))return this.ofs=0,(this.stream[0]&31)<<6|this.stream[1]&63}return-1}}function Eb(b){if(128>b)return[b];if(2048>b)return[192|b>>6&31,128|b&63]}var bb=bb||{};bb.scope={};bb.ASSUME_ES5=!1;bb.ASSUME_NO_NATIVE_MAP=!1;bb.ASSUME_NO_NATIVE_SET=!1;bb.SIMPLE_FROUND_POLYFILL=!1;bb.ISOLATE_POLYFILLS=!1;bb.FORCE_POLYFILL_PROMISE=
!1;bb.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;bb.defineProperty=bb.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,g){if(b==Array.prototype||b==Object.prototype)return b;b[c]=g.value;return b};bb.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<b.length;++c){var g=b[c];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");
};bb.global=bb.getGlobal(this);bb.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");bb.TRUST_ES6_POLYFILLS=!bb.ISOLATE_POLYFILLS||bb.IS_SYMBOL_NATIVE;bb.polyfills={};bb.propertyToPolyfillSymbol={};bb.POLYFILL_PREFIX="$jscp$";bb.polyfill=function(b,c,g,h){c&&(bb.ISOLATE_POLYFILLS?bb.polyfillIsolated(b,c,g,h):bb.polyfillUnisolated(b,c,g,h))};bb.polyfillUnisolated=function(b,c,g,h){g=bb.global;b=b.split(".");for(h=0;h<b.length-1;h++){var k=b[h];if(!(k in g))return;g=g[k]}b=b[b.length-
1];h=g[b];c=c(h);c!=h&&null!=c&&bb.defineProperty(g,b,{configurable:!0,writable:!0,value:c})};bb.polyfillIsolated=function(b,c,g,h){var k=b.split(".");b=1===k.length;h=k[0];h=!b&&h in bb.polyfills?bb.polyfills:bb.global;for(var y=0;y<k.length-1;y++){var u=k[y];if(!(u in h))return;h=h[u]}k=k[k.length-1];g=bb.IS_SYMBOL_NATIVE&&"es6"===g?h[k]:null;c=c(g);null!=c&&(b?bb.defineProperty(bb.polyfills,k,{configurable:!0,writable:!0,value:c}):c!==g&&(void 0===bb.propertyToPolyfillSymbol[k]&&(g=1E9*Math.random()>>>
0,bb.propertyToPolyfillSymbol[k]=bb.IS_SYMBOL_NATIVE?bb.global.Symbol(k):bb.POLYFILL_PREFIX+g+"$"+k),bb.defineProperty(h,bb.propertyToPolyfillSymbol[k],{configurable:!0,writable:!0,value:c})))};bb.polyfill("globalThis",function(b){return b||bb.global},"es_2020","es3");bb.polyfill("String.prototype.trimRight",function(b){function c(){return this.replace(/[\s\xa0]+$/,"")}return b||c},"es_2019","es3");var Qb=[[1,""],[2,"CPU"],[32768,"DISK"],[4,"FPU"],[8,"MEM"],[16,"DMA"],[32,"IO"],[64,"PS2"],[128,"PIC"],
[256,"VGA"],[512,"PIT"],[1024,"MOUS"],[2048,"PCI"],[4096,"BIOS"],[8192,"FLOP"],[16384,"SERI"],[65536,"RTC"],[131072,"HPET"],[262144,"ACPI"],[524288,"APIC"],[1048576,"NET"],[2097152,"VIO"],[4194304,"9P"],[8388608,"SB16"]];const Vb={EPERM:1,ENOENT:2,EBADF:9,EBUSY:11,EINVAL:22,ENOTDIR:20,EISDIR:21,EEXIST:17,ELOOP:40,ENOTEMPTY:39,EIO:5,EOPNOTSUPP:95};Object.freeze(["shared","exclusive","unlock"]);e.prototype.shouldAbortRequest=function(b){var c=!this.pendingTags[b];c&&mb.Debug("Request can be aborted tag="+
b);return c};e.prototype.get_state=function(){var b=[];b[0]=this.configspace_tagname;b[1]=this.configspace_taglen;b[2]=this.virtio;b[3]=this.VERSION;b[4]=this.BLOCKSIZE;b[5]=this.msize;b[6]=this.replybuffer;b[7]=this.replybuffersize;b[8]=this.fids.map(function(c){return[c.inodeid,c.type,c.uid,c.dbg_name]});b[9]=this.fs;b[10]=this.sh;b[11]=this.Path;b[12]=this.Buffer;return b};e.prototype.set_state=function(b){};e.prototype.Createfid=function(b,c,g){return{path:b,type:c,uid:g}};e.prototype.Reset=function(){this.fids=
{}};e.prototype.addTag=function(b){this.pendingTags[b]={}};e.prototype.flushTag=function(b){delete this.pendingTags[b]};e.prototype.BuildReply=function(b,c,g){H(0<=g,"9P: Negative payload size");cb.Marshall(["w","b","h"],[g+7,b+1,c],this.replybuffer,0);g+7>=this.replybuffer.length&&mb.Debug("Error in 9p: payloadsize exceeds maximum length");this.replybuffersize=g+7};e.prototype.SendError=function(b,c){c=cb.Marshall(["w"],[Vb[c.code]],this.replybuffer,7);this.BuildReply(6,b,c)};e.prototype.SendReply=
function(b){H(0<=this.replybuffersize,"9P: Negative replybuffersize");b.set_next_blob(this.replybuffer.subarray(0,this.replybuffersize));this.virtqueue.push_reply(b);this.virtqueue.flush_replies()};e.prototype.ReceiveRequest=async function(b){var c=this,g=this.Path,h=this.fs,k=this.sh;const y=new Uint8Array(b.length_readable);b.get_next_blob(y);const u={offset:0};var I=cb.Unmarshall(["w","b","h"],y,u),ba=I[0],R=I[1],U=I[2];this.addTag(U);switch(R){case 8:ba=1024;var Y=[16914839];Y[1]=this.BLOCKSIZE;
Y[2]=Math.floor(1073741824/Y[1]);Y[3]=Y[2]-Math.floor(ba/Y[1]);Y[4]=Y[2]-Math.floor(ba/Y[1]);Y[5]=1073741824;Y[6]=1048576;Y[7]=0;Y[8]=256;ba=cb.Marshall("wwddddddw".split(""),Y,this.replybuffer,7);this.BuildReply(R,U,ba);this.SendReply(b);break;case 112:case 12:Y=cb.Unmarshall(["w","w"],y,u);var fa=Y[0],na=Y[1],oa=this.fids[fa].path;mb.Debug("[open] fid="+fa+", mode="+na);mb.Debug("file open "+this.fids[fa].dbg_name);h.stat(oa,function(La,Oa){c.shouldAbortRequest(U)||(La?c.SendError(U,La):(Y[0]=K(oa,
Oa),Y[1]=c.msize-24,cb.Marshall(["Q","w"],Y,c.replybuffer,7),c.BuildReply(R,U,17)),c.SendReply(b))});break;case 70:Y=cb.Unmarshall(["w","w","s"],y,u);I=Y[0];var Ca=c.fids[I].path;fa=Y[1];na=c.fids[fa].path;k=Y[2];var Ya=g.join(Ca,k);mb.Debug("[link] dfid="+I+", name="+k);h.link(na,Ya,function(La){c.shouldAbortRequest(U)||(La&&(c.SendError(U,La),c.SendReply(b)),c.BuildReply(R,U,0),c.SendReply(b))});break;case 16:Y=cb.Unmarshall(["w","s","s","w"],y,u);fa=Y[0];oa=c.fids[fa].path;k=Y[1];Ya=g.join(oa,
k);Ca=Y[2];I=Y[3];mb.Debug("[symlink] fid="+fa+", name="+k+", symtgt="+Ca+", gid="+I);h.symlink(Ca,Ya,function(La){c.shouldAbortRequest(U)||(La?(c.SendError(U,La),c.SendReply(b)):h.stat(Ya,function(Oa,$a){c.shouldAbortRequest(U)||(Oa&&(c.SendError(U,Oa),c.SendReply(b)),Oa=K(Ya,$a),cb.Marshall(["Q"],[Oa],c.replybuffer,7),c.BuildReply(R,U,13),c.SendReply(b))}))});break;case 18:Y=cb.Unmarshall("wswwww".split(""),y,u);fa=Y[0];var ib=c.fids[fa].path;k=Y[1];na=Y[2];Ca=Y[3];na=Y[4];I=Y[5];mb.Debug("[mknod] fid="+
fa+", name="+k+", major="+Ca+", minor="+na);h.mknod(ib,"FILE",function(La){c.shouldAbortRequest(U)||(La?(c.SendError(U,La),c.SendReply(b)):h.stat(ib,function(Oa,$a){c.shouldAbortRequest(U)||(Oa?c.SendError(U,Oa):(Oa=K(ib,$a),cb.Marshall(["Q"],[Oa],c.replybuffer,7),c.BuildReply(R,U,13)),c.SendReply(b))}))});break;case 22:Y=cb.Unmarshall(["w"],y,u);fa=Y[0];oa=c.fids[fa].path;mb.Debug("[readlink] fid="+fa+" name="+this.fids[fa].dbg_name+" target=idk");h.readlink(oa,function(La,Oa){c.shouldAbortRequest(U)||
(La?(c.SendError(U,La),c.sendReply(b)):(ba=cb.Marshall(["s"],[Oa],c.replybuffer,7),c.BuildReply(R,U,ba),c.SendReply(b)))});break;case 72:Y=cb.Unmarshall(["w","s","w","w"],y,u);fa=Y[0];k=Y[1];na=Y[2];I=Y[3];var zb=g.join(c.fids[fa].path,k);mb.Debug("[mkdir] fid="+fa+", name="+k+", mode="+na+", gid="+I);h.mkdir(zb,na,function(La){c.shouldAbortRequest(U)||(La&&(c.SendError(U,La),c.SendReply(b)),h.stat(zb,function(Oa,$a){c.shouldAbortRequest(U)||(Oa&&(c.SendError(U,Oa),c.SendReply(b)),Oa=K(zb,$a),cb.Marshall(["Q"],
[Oa],c.replybuffer,7),c.BuildReply(R,U,13),c.SendReply(b))}))});break;case 14:Y=cb.Unmarshall(["w","s","w","w","w"],y,u);fa=Y[0];k=Y[1];Ca=Y[2];na=Y[3];I=Y[4];var Ib=g.join(c.fids[fa].path,k);this.bus.send("9p-create",[k,this.fids[fa].inodeid]);mb.Debug("[create] fid="+fa+", name="+k+", flags="+Ca+", mode="+na+", gid="+I);h.open(Ib,"w+",na,function(La,Oa){c.shouldAbortRequest(U)?Oa&&h.close(Oa):(La&&(c.SendError(U,La),c.SendReply(b)),h.fstat(Oa,function($a,nb){c.shouldAbortRequest(U)?Oa&&h.close(Oa):
($a&&(c.SendError(U,$a),c.SendReply(b)),c.fids[fa]=c.Createfid(Ib,1,$b),h.close(Oa),$a=K(Ib,nb),cb.Marshall(["Q","w"],[$a,c.msize-24],c.replybuffer,7),c.BuildReply(R,U,17),c.SendReply(b))}))});break;case 52:cb.Marshall(["b"],[0],this.replybuffer,7);this.BuildReply(R,U,1);this.SendReply(b);break;case 54:break;case 24:Y=cb.Unmarshall(["w","d"],y,u);fa=Y[0];oa=this.fids[fa].path;mb.Debug("[getattr]: fid="+fa+" name="+this.fids[fa].dbg_name+" request mask="+Y[1]);h.lstat(oa,function(La,Oa){if(!c.shouldAbortRequest(U)){La&&
(c.SendError(U,La),c.SendReply(b));La=K(oa,Oa);var $a=Oa.size;cb.Marshall("dQwwwddddddddddddddd".split(""),[2047,La,Oa.mode,Oa.uid,Oa.gid,Oa.nlinks,0,$a,c.BLOCKSIZE,Math.floor($a/512+1),Math.round(Oa.atimeMs/1E3),1E6*Oa.atimeMs,Math.round(Oa.mtimeMs/1E3),1E6*Oa.mtimeMs,Math.round(Oa.ctimeMs/1E3),1E6*Oa.ctimeMs,0,0,0,0],c.replybuffer,7);c.BuildReply(R,U,153);c.SendReply(b)}});break;case 26:Y=cb.Unmarshall("wwwwwddddd".split(""),y,u);fa=Y[0];oa=this.fids[fa].path;mb.Debug("[setattr]: fid="+fa+" request mask="+
Y[1]);k=[];Y[1]&1&&k.push(new Promise(function(La,Oa){var $a=Y[2];mb.Debug("[setattr]: mode="+$a);c.shouldAbortRequest(U)||h.chmod(oa,$a,function(nb){nb?Oa(nb):La()})}));Y[1]&2&&Y[1]&4&&k.push(new Promise(function(La,Oa){var $a=Y[3],nb=Y[4];mb.Debug("[setattr]: uid="+$a+" gid="+nb);c.shouldAbortRequest(U)||h.chown(oa,$a,nb,function(Jb){Jb?Oa(Jb):La()})}));var vb,Pb;I=Date.now();Y[1]&16&&(vb=I);Y[1]&32&&(Pb=I);Y[1]&64&&mb.Debug("[TODO] requested to SETATTR for CTIME, ignoring");Y[1]&128&&(vb=1E3*Y[6]);
Y[1]&256&&(Pb=1E3*Y[8]);(vb||Pb)&&k.push(new Promise(function(La,Oa){c.shouldAbortRequest(U)||(mb.Debug("[setattr]: atime="+vb+" mtime="+Pb),h.utimes(oa,vb,Pb,function($a){$a?Oa($a):La()}))}));Y[1]&8&&k.push(new Promise(function(La,Oa){var $a=Y[5];mb.Debug("[setattr]: size="+$a);h.truncate(oa,$a,function(nb){nb?Oa(nb):La()})}));Promise.all(k).then(function(){c.BuildReply(R,U,0);c.SendReply(b)}).catch(function(La){c.SendError(U,La);c.SendReply(b)});break;case 50:Y=cb.Unmarshall(["w","d"],y,u);fa=Y[0];
this.BuildReply(R,U,0);this.SendReply(b);break;case 40:Y=cb.Unmarshall(["w","d","w"],y,u);fa=Y[0];var Fb=Y[1],wb=Y[2];oa=this.fids[fa].path;k.ls(oa,{recursive:!1},function(La,Oa){if(!c.shouldAbortRequest(U))if(La)c.SendError(U,La),c.SendReply(b);else{var $a=Oa.reduce(function(Jb,Tb){return Jb+13+8+1+2+bc.UTF8Length(Tb.name)},0);$a+=25;$a+=26;var nb=new Uint8Array($a);h.stat(oa,function(Jb,Tb){if(!c.shouldAbortRequest(U))if(Jb)c.SendError(U,Jb),c.SendReply(b);else{var Lb=0;Lb+=cb.Marshall(["Q","d",
"b","s"],[K(oa,Tb),Lb+13+8+1+2+1,Tb.mode>>12,"."],nb,Lb);var ic=g.resolve("..",oa);h.stat(ic,function(Ub,jc){if(!c.shouldAbortRequest(U)){if(Ub)c.SendError(U,Ub);else{Lb+=cb.Marshall(["Q","d","b","s"],[K(ic,jc),Lb+13+8+1+2+2,jc.mode>>12,".."],nb,Lb);Oa.forEach(function(Xb){var kc=g.join(oa,Xb.name);Lb+=cb.Marshall(["Q","d","b","s"],[K(kc,Xb),Lb+13+8+1+2+bc.UTF8Length(Xb.name),Xb.mode>>12,Xb.name],nb,Lb)});$a<Fb+wb&&(console.warn("size<offset+count !","size="+$a,"offset="+Fb,"count="+wb),wb=$a>Fb?
$a-Fb:0);if(nb)for(Ub=0;Ub<wb;Ub++)c.replybuffer[11+Ub]=nb[Fb+Ub];cb.Marshall(["w"],[wb],c.replybuffer,7);c.BuildReply(R,U,4+wb)}c.SendReply(b)}})}})}});break;case 116:Y=cb.Unmarshall(["w","d","w"],y,u);fa=Y[0];Fb=Y[1];wb=Math.min(Y[2],16373);oa=this.fids[fa].path;function Ua(La){var Oa=La.length;Fb+wb>Oa&&(wb=Oa-Fb);for(Oa=0;Oa<wb;Oa++)c.replybuffer[11+Oa]=La[Fb+Oa];cb.Marshall(["w"],[wb],c.replybuffer,7);c.BuildReply(R,U,4+wb);c.SendReply(b)}if(k=c.pendingTags[U].data){Ua(k);break}h.readFile(oa,
function(La,Oa){c.shouldAbortRequest(U)||(La?(c.SendError(U,La),c.SendReply(b)):(c.pendingTags[U].data=Oa,Ua(Oa)))});break;case 118:Y=cb.Unmarshall(["w","d","w"],y,u);fa=Y[0];Fb=Y[1];wb=Y[2];oa=c.fids[fa].path;mb.Debug("[write]: fid="+fa+" offset="+Fb+" count="+wb+" fidtype="+this.fids[fa].type);h.open(oa,"w",function(La,Oa){c.shouldAbortRequest(U)?Oa&&h.close(Oa):(La&&(c.SendError(U,La),c.SendReply(b)),La=c.Buffer.from(y.subarray(u.offset)),h.write(Oa,La,0,wb,Fb,function($a,nb){c.shouldAbortRequest(U)?
Oa&&h.close(Oa):($a&&(c.SendError(U,$a),c.SendReply(b)),h.close(Oa),cb.Marshall(["w"],[nb],c.replybuffer,7),c.BuildReply(R,U,4),c.SendReply(b))}))});break;case 74:Y=cb.Unmarshall(["w","s","w","s"],y,u);k=Y[1];I=g.join(c.fids[Y[0]].path,k);Ca=Y[3];Ya=g.join(c.fids[Y[2]].path,Ca);mb.Debug("[renameat]: oldname="+k+" newname="+Ca);h.rename(I,Ya,function(La){c.shouldAbortRequest(U)||(La&&(c.SendError(U,La),c.SendReply(b)),c.BuildReply(R,U,0),c.SendReply(b))});break;case 76:Y=cb.Unmarshall(["w","s","w"],
y,u);I=Y[0];k=Y[1];Ca=Y[2];oa=g.join(c.fids[I].path,k);mb.Debug("[unlink]: dirfd="+I+" name="+k+" flags="+Ca);h.stat(oa,function(La,Oa){if(!c.shouldAbortRequest(U))if(La)c.SendError(U,La),c.SendReply(b);else h["DIRECTORY"===Oa.type?"rmdir":"unlink"](oa,function($a){c.shouldAbortRequest(U)||($a?c.SendError(U,$a):c.BuildReply(R,U,0),c.SendReply(b))})});break;case 100:k=cb.Unmarshall(["w","s"],y,u);mb.Debug("[version]: msize="+k[0]+" version="+k[1]);this.msize=k[0];ba=cb.Marshall(["w","s"],[this.msize,
this.VERSION],this.replybuffer,7);this.BuildReply(R,U,ba);this.SendReply(b);break;case 104:Y=cb.Unmarshall(["w","w","s","s","w"],y,u);fa=Y[0];var $b=Y[4];mb.Debug("[attach]: fid="+fa+" afid="+d(Y[1])+" uname="+Y[2]+" aname="+Y[3]);this.fids[fa]=this.Createfid("/",1,$b);h.stat("/",function(La,Oa){c.shouldAbortRequest(U)||(La?(c.SendError(U,La),c.SendReply(b)):(La=K("/",Oa),cb.Marshall(["Q"],[La],c.replybuffer,7),c.BuildReply(R,U,13),c.SendReply(b),c.bus.send("9p-attach")))});break;case 108:Y=cb.Unmarshall(["h"],
y,u);this.flushTag(Y[0]);mb.Debug("[flush] "+U);this.BuildReply(R,U,0);this.SendReply(b);break;case 110:Y=cb.Unmarshall(["w","w","h"],y,u);fa=Y[0];var Zb=Y[1];k=Y[2];mb.Debug("[walk]: fid="+Y[0]+" nwfid="+Y[1]+" nwname="+k);if(0==k){this.fids[Zb]=this.Createfid(this.fids[fa].path,1,this.fids[fa].uid);cb.Marshall(["h"],[0],this.replybuffer,7);this.BuildReply(R,U,2);this.SendReply(b);break}I=[];for(Ca=0;Ca<k;Ca++)I.push("s");k=cb.Unmarshall(I,y,u);oa=this.fids[fa].path;Fb=9;var Qa=0;mb.Debug("walk in dir "+
this.fids[fa].dbg_name+" to: "+k.toString());function ub(La,Oa){var $a=Oa.shift();$a?(La=g.join(La,$a),h.stat(La,function(nb,Jb){c.shouldAbortRequest(U)||(nb?(c.SendError(U,nb),c.SendReply(b)):(nb=K(La,Jb),c.fids[Zb]=c.Createfid(La,1,Jb.uid),Fb+=cb.Marshall(["Q"],[nb],c.replybuffer,Fb),Qa++,ub(La,Oa)))})):(cb.Marshall(["h"],[Qa],c.replybuffer,7),c.BuildReply(R,U,Fb-7),c.SendReply(b))}ub(oa,k);break;case 120:Y=cb.Unmarshall(["w"],y,u);mb.Debug("[clunk]: fid="+Y[0]);delete c.fids[fa];this.BuildReply(R,
U,0);this.SendReply(b);break;case 32:Y=cb.Unmarshall(["w","s","d","w"],y,u);fa=Y[0];k=Y[1];I=Y[2];Ca=Y[3];mb.Debug("[txattrcreate]: fid="+fa+" name="+k+" attr_size="+I+" flags="+Ca);this.fids[fa].type=2;this.BuildReply(R,U,0);this.SendReply(b);break;case 30:Y=cb.Unmarshall(["w","w","s"],y,u);fa=Y[0];k=Y[2];mb.Debug("[xattrwalk]: fid="+Y[0]+" newfid="+Y[1]+" name="+Y[2]);this.SendError(U,{code:"EOPNOTSUPP"});this.SendReply(b);break;default:mb.Debug("Error in Virtio9p: Unknown id "+R+" received"),mb.Abort()}};
var N=!1,Q=-15786961,O=N&&!1,V=N&&!1;l.prototype.create_empty_entry=function(){return{read8:this.empty_port_read8,read16:this.empty_port_read16,read32:this.empty_port_read32,write8:this.empty_port_write,write16:this.empty_port_write,write32:this.empty_port_write,device:void 0}};l.prototype.empty_port_read8=function(){return 255};l.prototype.empty_port_read16=function(){return 65535};l.prototype.empty_port_read32=function(){return-1};l.prototype.empty_port_write=function(b){};l.prototype.register_read=
function(b,c,g,h,k){H("number"===typeof b);H("object"===typeof c);H(!g||"function"===typeof g);H(!h||"function"===typeof h);H(!k||"function"===typeof k);H(g||h||k);if(N){var y=function(u){H(!1,"Overlapped read"+u+" "+d(b,4)+" ("+c.name+")");return-1>>>32-u|0};g||=y.bind(this,8);h||=y.bind(this,16);k||=y.bind(this,32)}g&&(this.ports[b].read8=g);h&&(this.ports[b].read16=h);k&&(this.ports[b].read32=k);this.ports[b].device=c};l.prototype.register_write=function(b,c,g,h,k){H("number"===typeof b);H("object"===
typeof c);H(!g||"function"===typeof g);H(!h||"function"===typeof h);H(!k||"function"===typeof k);H(g||h||k);if(N){var y=function(u){H(!1,"Overlapped write"+u+" "+d(b)+" ("+c.name+")")};g||=y.bind(this,8);h||=y.bind(this,16);k||=y.bind(this,32)}g&&(this.ports[b].write8=g);h&&(this.ports[b].write16=h);k&&(this.ports[b].write32=k);this.ports[b].device=c};l.prototype.register_read_consecutive=function(b,c,g,h,k,y){function u(){return g.call(this)|h.call(this)<<8}function I(){return k.call(this)|y.call(this)<<
8}function ba(){return g.call(this)|h.call(this)<<8|k.call(this)<<16|y.call(this)<<24}H(4===arguments.length||6===arguments.length);k&&y?(this.register_read(b,c,g,u,ba),this.register_read(b+1,c,h),this.register_read(b+2,c,k,I),this.register_read(b+3,c,y)):(this.register_read(b,c,g,u),this.register_read(b+1,c,h))};l.prototype.register_write_consecutive=function(b,c,g,h,k,y){function u(R){g.call(this,R&255);h.call(this,R>>8&255)}function I(R){k.call(this,R&255);y.call(this,R>>8&255)}function ba(R){g.call(this,
R&255);h.call(this,R>>8&255);k.call(this,R>>16&255);y.call(this,R>>>24)}H(4===arguments.length||6===arguments.length);k&&y?(this.register_write(b,c,g,u,ba),this.register_write(b+1,c,h),this.register_write(b+2,c,k,I),this.register_write(b+3,c,y)):(this.register_write(b,c,g,u),this.register_write(b+1,c,h))};l.prototype.mmap_read32_shim=function(b){var c=this.cpu.memory_map_read8[b>>>17];return c(b)|c(b+1)<<8|c(b+2)<<16|c(b+3)<<24};l.prototype.mmap_write32_shim=function(b,c){var g=this.cpu.memory_map_write8[b>>>
17];g(b,c&255);g(b+1,c>>8&255);g(b+2,c>>16&255);g(b+3,c>>>24)};l.prototype.mmap_register=function(b,c,g,h,k,y){r("mmap_register addr="+d(b>>>0,8)+" size="+d(c,8),32);H(0===(b&131071));H(c&&0===(c&131071));k||=this.mmap_read32_shim.bind(this);y||=this.mmap_write32_shim.bind(this);for(b>>>=17;0<c;b++)this.cpu.memory_map_read8[b]=g,this.cpu.memory_map_write8[b]=h,this.cpu.memory_map_read32[b]=k,this.cpu.memory_map_write32[b]=y,c-=131072};l.prototype.port_write8=function(b,c){var g=this.ports[b];g.write8===
this.empty_port_write&&r("write8 port #"+d(b,4)+" <- "+d(c,2)+this.get_port_description(b),32);return g.write8.call(g.device,c)};l.prototype.port_write16=function(b,c){var g=this.ports[b];g.write16===this.empty_port_write&&r("write16 port #"+d(b,4)+" <- "+d(c,4)+this.get_port_description(b),32);return g.write16.call(g.device,c)};l.prototype.port_write32=function(b,c){var g=this.ports[b];g.write32===this.empty_port_write&&r("write32 port #"+d(b,4)+" <- "+d(c>>>0,8)+this.get_port_description(b),32);
return g.write32.call(g.device,c)};l.prototype.port_read8=function(b){var c=this.ports[b];c.read8===this.empty_port_read8&&r("read8 port  #"+d(b,4)+this.get_port_description(b),32);c=c.read8.call(c.device);H(256>c,"8 bit port returned large value: "+d(b));return c};l.prototype.port_read16=function(b){var c=this.ports[b];c.read16===this.empty_port_read16&&r("read16 port  #"+d(b,4)+this.get_port_description(b),32);c=c.read16.call(c.device);H(65536>c&&0<=c,"16 bit port returned large value: "+d(b));
return c};l.prototype.port_read32=function(b){var c=this.ports[b];c.read32===this.empty_port_read32&&r("read32 port  #"+d(b,4)+this.get_port_description(b),32);b=c.read32.call(c.device);H((b|0)===b);return b};var da={4:"PORT_DMA_ADDR_2",5:"PORT_DMA_CNT_2",10:"PORT_DMA1_MASK_REG",11:"PORT_DMA1_MODE_REG",12:"PORT_DMA1_CLEAR_FF_REG",13:"PORT_DMA1_MASTER_CLEAR",32:"PORT_PIC1_CMD",33:"PORT_PIC1_DATA",64:"PORT_PIT_COUNTER0",65:"PORT_PIT_COUNTER1",66:"PORT_PIT_COUNTER2",67:"PORT_PIT_MODE",96:"PORT_PS2_DATA",
97:"PORT_PS2_CTRLB",100:"PORT_PS2_STATUS",112:"PORT_CMOS_INDEX",113:"PORT_CMOS_DATA",128:"PORT_DIAG",129:"PORT_DMA_PAGE_2",146:"PORT_A20",160:"PORT_PIC2_CMD",161:"PORT_PIC2_DATA",178:"PORT_SMI_CMD",179:"PORT_SMI_STATUS",212:"PORT_DMA2_MASK_REG",214:"PORT_DMA2_MODE_REG",218:"PORT_DMA2_MASTER_CLEAR",240:"PORT_MATH_CLEAR",368:"PORT_ATA2_CMD_BASE",496:"PORT_ATA1_CMD_BASE",632:"PORT_LPT2",744:"PORT_SERIAL4",760:"PORT_SERIAL2",884:"PORT_ATA2_CTRL_BASE",888:"PORT_LPT1",1E3:"PORT_SERIAL3",1008:"PORT_FD_BASE",
1010:"PORT_FD_DOR",1012:"PORT_FD_STATUS",1013:"PORT_FD_DATA",1014:"PORT_HD_DATA",1015:"PORT_FD_DIR",1016:"PORT_SERIAL1",3320:"PORT_PCI_CMD",3321:"PORT_PCI_REBOOT",3324:"PORT_PCI_DATA",1026:"PORT_BIOS_DEBUG",1296:"PORT_QEMU_CFG_CTL",1297:"PORT_QEMU_CFG_DATA",45056:"PORT_ACPI_PM_BASE",45312:"PORT_SMB_BASE",35072:"PORT_BIOS_APM"};l.prototype.get_port_description=function(b){return da[b]?"  ("+da[b]+")":""};f.prototype.run=function(){this.stopping=!1;this.running||(this.running=!0,this.bus.send("emulator-started"));
this.next_tick(0)};f.prototype.do_tick=function(){if(this.stopping||!this.running)this.stopping=this.running=!1,this.bus.send("emulator-stopped");else{this.idle=!1;var b=this.cpu.main_run();this.next_tick(b)}};f.prototype.next_tick=function(b){const c=++this.tick_counter;this.idle=!0;this.yield(b,c)};f.prototype.yield_callback=function(b){b===this.tick_counter&&this.do_tick()};f.prototype.stop=function(){this.running&&(this.stopping=!0)};f.prototype.destroy=function(){this.unregister_yield()};f.prototype.restart=
function(){this.cpu.reset_cpu();this.cpu.load_bios()};f.prototype.init=function(b){this.cpu.init(b,this.bus);this.bus.send("emulator-ready")};if("undefined"!==typeof process)f.prototype.yield=function(b,c){1>b?global.setImmediate(g=>this.yield_callback(g),c):setTimeout(g=>this.yield_callback(g),b,c)},f.prototype.register_yield=function(){},f.prototype.unregister_yield=function(){};else if("undefined"!==typeof Worker){function b(){globalThis.onmessage=function(c){const g=c.data.t;1>g?postMessage(c.data.tick):
setTimeout(()=>postMessage(c.data.tick),g)}}f.prototype.register_yield=function(){const c=URL.createObjectURL(new Blob(["("+b.toString()+")()"],{type:"text/javascript"}));this.worker=new Worker(c);this.worker.onmessage=g=>this.yield_callback(g.data);URL.revokeObjectURL(c)};f.prototype.yield=function(c,g){this.worker.postMessage({t:c,tick:g})};f.prototype.unregister_yield=function(){this.worker.terminate();this.worker=null}}else f.prototype.yield=function(b){setTimeout(()=>{this.do_tick()},b)},f.prototype.register_yield=
function(){},f.prototype.unregister_yield=function(){};f.prototype.save_state=function(){return this.cpu.save_state()};f.prototype.restore_state=function(b){return this.cpu.restore_state(b)};if("object"===typeof performance&&performance.now)f.microtick=performance.now.bind(performance);else if("function"===typeof require){const {performance:b}=require("perf_hooks");f.microtick=b.now.bind(b)}else f.microtick="object"===typeof process&&process.hrtime?function(){var b=process.hrtime();return 1E3*b[0]+
b[1]/1E6}:Date.now;var ma=ma||{};ma.exportSymbol=function(){};ma.exportProperty=function(){};var aa=aa||{};aa.pads=function(b,c){return(b||0===b?b+"":"").padEnd(c," ")};aa.pad0=function(b,c){return(b||0===b?b+"":"").padStart(c,"0")};aa.zeros=function(b){return Array(b).fill(0)};aa.range=function(b){return Array.from(Array(b).keys())};aa.view=function(b,c,g,h){return new Proxy({},{get:function(k,y,u){k=new b(c.buffer,g,h);u=k[y];if("function"===typeof u)return u.bind(k);H(/^\d+$/.test(y)||"buffer"===
y||"length"===y||"BYTES_PER_ELEMENT"===y||"byteOffset"===y);return u},set:function(k,y,u,I){H(/^\d+$/.test(y));(new b(c.buffer,g,h))[y]=u;return!0}})};if("undefined"!==typeof crypto&&crypto.getRandomValues){let b=new Int32Array(1);aa.get_rand_int=function(){crypto.getRandomValues(b);return b[0]}}else if("undefined"!==typeof require){const b=require("crypto");aa.get_rand_int=function(){return b.randomBytes(4).readInt32LE(0)}}else H(!1,"Unsupported platform: No cryptographic random values");(function(){if("function"===
typeof Math.clz32)aa.int_log2_byte=function(h){H(0<h);H(256>h);return 31-Math.clz32(h)},aa.int_log2=function(h){H(0<h);return 31-Math.clz32(h)};else{for(var b=new Int8Array(256),c=0,g=-2;256>c;c++)c&c-1||g++,b[c]=g;aa.int_log2_byte=function(h){H(0<h);H(256>h);return b[h]};aa.int_log2=function(h){h>>>=0;H(0<h);var k=h>>>16;if(k){var y=k>>>8;return y?24+b[y]:16+b[k]}return(y=h>>>8)?8+b[y]:b[h]}}})();q.prototype.push=function(b){this.length===this.size?this.start=this.start+1&this.size-1:this.length++;
this.data[this.end]=b;this.end=this.end+1&this.size-1};q.prototype.shift=function(){if(this.length){var b=this.data[this.start];this.start=this.start+1&this.size-1;this.length--;return b}};q.prototype.shift_block=function(b){var c=new Float32Array(b);b>this.length&&(b=this.length);var g=this.start+b,h=this.data.subarray(this.start,g);c.set(h);g>=this.size&&(g-=this.size,c.set(this.data.subarray(0,g),h.length));this.start=g;this.length-=b;return c};q.prototype.peek=function(){if(this.length)return this.data[this.start]};
q.prototype.clear=function(){this.length=this.end=this.start=0};aa.Bitmap=function(b){"number"===typeof b?this.view=new Uint8Array(b+7>>3):b instanceof ArrayBuffer?this.view=new Uint8Array(b):H(!1,"v86util.Bitmap: Invalid argument")};aa.Bitmap.prototype.set=function(b,c){const g=b>>3;b=1<<(b&7);this.view[g]=c?this.view[g]|b:this.view[g]&~b};aa.Bitmap.prototype.get=function(b){return this.view[b>>3]>>(b&7)&1};aa.Bitmap.prototype.get_buffer=function(){return this.view.buffer};aa.load_file="undefined"===
typeof XMLHttpRequest?w:p;aa.read_sized_string_from_mem=function(b,c,g){return String.fromCharCode(...(new Uint8Array(b.buffer,c>>>0,g>>>0)))};(function(){function b(u){H(u instanceof ArrayBuffer);this.buffer=u;this.byteLength=u.byteLength;this.onprogress=this.onload=void 0}function c(u,I,ba){this.filename=u;this.byteLength=I;this.block_cache=new Map;this.block_cache_is_write=new Set;this.fixed_chunk_size=ba;this.cache_reads=!!ba;this.onprogress=this.onload=void 0}function g(u,I,ba,R){const U=u.match(/(.*)(\..*)/);
U?(this.basename=U[1],this.extension=U[2]):(this.basename=u,this.extension="");this.basename.endsWith("/")||(this.basename+="-");this.block_cache=new Map;this.block_cache_is_write=new Set;this.byteLength=I;this.fixed_chunk_size=ba;this.partfile_alt_format=!!R;this.cache_reads=!!ba;this.onprogress=this.onload=void 0}function h(u){this.file=u;this.byteLength=u.size;1073741824<u.size&&console.warn("SyncFileBuffer: Allocating buffer of "+(u.size>>20)+" MB ...");this.buffer=new ArrayBuffer(u.size);this.onprogress=
this.onload=void 0}function k(u){this.file=u;this.byteLength=u.size;this.block_cache=new Map;this.block_cache_is_write=new Set;this.onprogress=this.onload=void 0}aa.SyncBuffer=b;aa.AsyncXHRBuffer=c;aa.AsyncXHRPartfileBuffer=g;aa.AsyncFileBuffer=k;aa.SyncFileBuffer=h;b.prototype.load=function(){this.onload&&this.onload({buffer:this.buffer})};b.prototype.get=function(u,I,ba){H(u+I<=this.byteLength);ba(new Uint8Array(this.buffer,u,I))};b.prototype.set=function(u,I,ba){H(u+I.byteLength<=this.byteLength);
(new Uint8Array(this.buffer,u,I.byteLength)).set(I);ba()};b.prototype.get_buffer=function(u){u(this.buffer)};b.prototype.get_state=function(){const u=[];u[0]=this.byteLength;u[1]=new Uint8Array(this.buffer);return u};b.prototype.set_state=function(u){this.byteLength=u[0];this.buffer=u[1].slice().buffer};c.prototype.load=function(){void 0!==this.byteLength?this.onload&&this.onload(Object.create(null)):y(this.filename,(u,I)=>{if(u)throw Error("Cannot use: "+this.filename+". "+u);H(0<=I);this.byteLength=
I;this.onload&&this.onload(Object.create(null))})};c.prototype.get_from_cache=function(u,I){var ba=I/256;u/=256;for(var R=0;R<ba;R++)if(!this.block_cache.get(u+R))return;if(1===ba)return this.block_cache.get(u);I=new Uint8Array(I);for(R=0;R<ba;R++)I.set(this.block_cache.get(u+R),256*R);return I};c.prototype.get=function(u,I,ba){H(u+I<=this.byteLength);H(0===u%256);H(0===I%256);H(I);var R=this.get_from_cache(u,I);if(R)ba(R);else{var U=u,Y=I;this.fixed_chunk_size&&(U=u-u%this.fixed_chunk_size,Y=Math.ceil((u-
U+I)/this.fixed_chunk_size)*this.fixed_chunk_size);aa.load_file(this.filename,{done:function(fa){fa=new Uint8Array(fa);this.handle_read(U,Y,fa);U===u&&Y===I?ba(fa):ba(fa.subarray(u-U,u-U+I))}.bind(this),range:{start:U,length:Y}})}};c.prototype.set=function(u,I,ba){var R=I.length;H(u+I.byteLength<=this.byteLength);H(0===u%256);H(0===R%256);H(R);u/=256;R/=256;for(var U=0;U<R;U++){var Y=this.block_cache.get(u+U);if(void 0===Y)Y=I.slice(256*U,256*(U+1)),this.block_cache.set(u+U,Y);else{const fa=I.subarray(256*
U,256*(U+1));H(Y.byteLength===fa.length);Y.set(fa)}this.block_cache_is_write.add(u+U)}ba()};c.prototype.handle_read=function(u,I,ba){u/=256;I/=256;for(var R=0;R<I;R++){const U=this.block_cache.get(u+R);U?ba.set(U,256*R):this.cache_reads&&this.block_cache.set(u+R,ba.slice(256*R,256*(R+1)))}};c.prototype.get_buffer=function(u){u()};c.prototype.get_state=function(){const u=[],I=[];for(let [ba,R]of this.block_cache)H(isFinite(ba)),this.block_cache_is_write.has(ba)&&I.push([ba,R]);u[0]=I;return u};c.prototype.set_state=
function(u){u=u[0];this.block_cache.clear();this.block_cache_is_write.clear();for(let [I,ba]of u)H(isFinite(I)),this.block_cache.set(I,ba),this.block_cache_is_write.add(I)};g.prototype.load=function(){void 0===this.byteLength&&H(!1);this.onload&&this.onload(Object.create(null))};g.prototype.get=function(u,I,ba){H(u+I<=this.byteLength);H(0===u%256);H(0===I%256);H(I);var R=this.get_from_cache(u,I);if(R)ba(R);else if(this.fixed_chunk_size){const Y=Math.floor(u/this.fixed_chunk_size),fa=u-Y*this.fixed_chunk_size;
H(0<=fa);const na=Math.ceil((fa+I)/this.fixed_chunk_size),oa=new Uint8Array(na*this.fixed_chunk_size);let Ca=0;for(let Ya=0;Ya<na;Ya++){var U=(Y+Ya)*this.fixed_chunk_size;R=this.partfile_alt_format?this.basename+(Y+Ya+"").padStart(8,"0")+this.extension:this.basename+U+"-"+(U+this.fixed_chunk_size)+this.extension;(U=this.get_from_cache(U,this.fixed_chunk_size))?(oa.set(U,Ya*this.fixed_chunk_size),Ca++,Ca===na&&(R=oa.subarray(fa,fa+I),ba(R))):aa.load_file(R,{done:function(ib){var zb=Ya*this.fixed_chunk_size;
ib=new Uint8Array(ib);this.handle_read((Y+Ya)*this.fixed_chunk_size,this.fixed_chunk_size|0,ib);oa.set(ib,zb);Ca++;Ca===na&&(zb=oa.subarray(fa,fa+I),ba(zb))}.bind(this)})}}else aa.load_file(this.basename+u+"-"+(u+I)+this.extension,{done:function(Y){H(Y.byteLength===I);Y=new Uint8Array(Y);this.handle_read(u,I,Y);ba(Y)}.bind(this)})};g.prototype.get_from_cache=c.prototype.get_from_cache;g.prototype.set=c.prototype.set;g.prototype.handle_read=c.prototype.handle_read;g.prototype.get_state=c.prototype.get_state;
g.prototype.set_state=c.prototype.set_state;h.prototype.load=function(){this.load_next(0)};h.prototype.load_next=function(u){var I=new FileReader;I.onload=function(R){R=new Uint8Array(R.target.result);(new Uint8Array(this.buffer,u)).set(R);this.load_next(u+4194304)}.bind(this);if(this.onprogress)this.onprogress({loaded:u,total:this.byteLength,lengthComputable:!0});if(u<this.byteLength){var ba=this.file.slice(u,Math.min(u+4194304,this.byteLength));(async()=>{I.readAsArrayBuffer(await ba)})()}else this.file=
void 0,this.onload&&this.onload({buffer:this.buffer})};h.prototype.get=b.prototype.get;h.prototype.set=b.prototype.set;h.prototype.get_buffer=b.prototype.get_buffer;h.prototype.get_state=b.prototype.get_state;h.prototype.set_state=b.prototype.set_state;k.prototype.load=function(){this.onload&&this.onload(Object.create(null))};k.prototype.get=function(u,I,ba){H(0===u%256);H(0===I%256);H(I);var R=this.get_from_cache(u,I);if(R)ba(R);else{var U=new FileReader;U.onload=function(Y){Y=new Uint8Array(Y.target.result);
this.handle_read(u,I,Y);ba(Y)}.bind(this);(async()=>{U.readAsArrayBuffer(await this.file.slice(u,u+I))})()}};k.prototype.get_from_cache=c.prototype.get_from_cache;k.prototype.set=c.prototype.set;k.prototype.handle_read=c.prototype.handle_read;k.prototype.get_state=c.prototype.get_state;k.prototype.set_state=c.prototype.set_state;k.prototype.get_buffer=function(u){u()};k.prototype.get_as_file=function(u){for(var I=[],ba=Array.from(this.block_cache.keys()).sort(function(na,oa){return na-oa}),R=0,U=
0;U<ba.length;U++){var Y=ba[U],fa=this.block_cache.get(Y);Y*=256;H(Y>=R);Y!==R&&(I.push(this.file.slice(R,Y)),R=Y);I.push(fa);R+=fa.length}R!==this.file.size&&I.push(this.file.slice(R));u=new File(I,u);H(u.size===this.file.size);return u};var y="undefined"===typeof XMLHttpRequest?function(u,I){require("fs").stat(u,(ba,R)=>{ba?I(ba):I(null,R.size)})}:function(u,I){aa.load_file(u,{done:(ba,R)=>{ba=R.getResponseHeader("Content-Range")||"";(R=ba.match(/\/(\d+)\s*$/))?I(null,+R[1]):I("`Range: bytes=...` header not supported (Got `"+
ba+"`)")},headers:{Range:"bytes=0-0"}})}})();B.prototype.read_status=function(){if(this.current_interface.buffer){var b=this.current_interface.status;r("ATA read status: "+d(b,2),32768);return b}return 0};B.prototype.write_control=function(b){r("set device control: "+d(b,2)+" interrupts "+(b&2?"disabled":"enabled"),32768);b&4&&(r("Reset via control port",32768),this.cpu.device_lower_irq(this.irq),this.master.device_reset(),this.slave.device_reset());this.device_control=b};B.prototype.dma_read_addr=
function(){r("dma get address: "+d(this.prdt_addr,8),32768);return this.prdt_addr};B.prototype.dma_set_addr=function(b){r("dma set address: "+d(b,8),32768);this.prdt_addr=b};B.prototype.dma_read_status=function(){r("DMA read status: "+d(this.dma_status),32768);return this.dma_status};B.prototype.dma_write_status=function(b){r("DMA set status: "+d(b),32768);this.dma_status&=~(b&6)};B.prototype.dma_read_command=function(){return this.dma_read_command8()|this.dma_read_status()<<16};B.prototype.dma_read_command8=
function(){r("DMA read command: "+d(this.dma_command),32768);return this.dma_command};B.prototype.dma_write_command=function(b){r("DMA write command: "+d(b),32768);this.dma_write_command8(b&255);this.dma_write_status(b>>16&255)};B.prototype.dma_write_command8=function(b){r("DMA write command8: "+d(b),32768);let c=this.dma_command;this.dma_command=b&9;if((c&1)!==(b&1))if(0===(b&1))this.dma_status&=-2;else switch(this.dma_status|=1,this.current_interface.current_command){case 37:case 200:this.current_interface.do_ata_read_sectors_dma();
break;case 202:case 53:this.current_interface.do_ata_write_sectors_dma();break;case 160:this.current_interface.do_atapi_dma();break;default:r("Spurious dma command write, current command: "+d(this.current_interface.current_command),32768),H(!1)}};B.prototype.push_irq=function(){0===(this.device_control&2)&&(r("push irq",32768),this.dma_status|=4,this.cpu.device_raise_irq(this.irq))};B.prototype.get_state=function(){var b=[];b[0]=this.master;b[1]=this.slave;b[2]=this.ata_port;b[3]=this.irq;b[4]=this.pci_id;
b[5]=this.ata_port_high;b[6]=this.master_port;b[7]=this.name;b[8]=this.device_control;b[9]=this.prdt_addr;b[10]=this.dma_status;b[11]=this.current_interface===this.master;b[12]=this.dma_command;return b};B.prototype.set_state=function(b){this.master.set_state(b[0]);this.slave.set_state(b[1]);this.ata_port=b[2];this.irq=b[3];this.pci_id=b[4];this.ata_port_high=b[5];this.master_port=b[6];this.name=b[7];this.device_control=b[8];this.prdt_addr=b[9];this.dma_status=b[10];this.current_interface=b[11]?this.master:
this.slave;this.dma_command=b[12]};v.prototype.device_reset=function(){this.is_atapi?(this.status=0,this.sector=this.error=this.bytecount=1,this.cylinder_low=20,this.cylinder_high=235):(this.status=81,this.sector=this.error=this.bytecount=1,this.cylinder_high=this.cylinder_low=0);this.cancel_io_operations()};v.prototype.push_irq=function(){this.device.push_irq()};v.prototype.ata_command=function(b){r("ATA Command: "+d(b)+" slave="+(this.drive_head>>4&1),32768);if(this.buffer)switch(this.current_command=
b,this.error=0,b){case 8:r("ATA device reset",32768);this.data_length=this.data_end=this.data_pointer=0;this.device_reset();this.push_irq();break;case 16:this.status=80;this.cylinder_low=0;this.push_irq();break;case 248:this.status=80;b=this.sector_count-1;this.sector=b&255;this.cylinder_low=b>>8&255;this.cylinder_high=b>>16&255;this.drive_head=this.drive_head&240|b>>24&15;this.push_irq();break;case 39:this.status=80;b=this.sector_count-1;this.sector=b&255;this.cylinder_low=b>>8&255;this.cylinder_high=
b>>16&255;this.sector|=b>>24<<8&65280;this.push_irq();break;case 32:case 36:case 41:case 196:this.ata_read_sectors(b);break;case 48:case 52:case 57:case 197:this.ata_write_sectors(b);break;case 144:this.push_irq();this.error=257;this.status=80;break;case 145:this.status=80;this.push_irq();break;case 160:this.is_atapi&&(this.status=88,this.data_allocate(12),this.data_end=12,this.bytecount=1,this.push_irq());break;case 161:r("ATA identify packet device",32768);this.is_atapi?(this.create_identify_packet(),
this.status=88,this.cylinder_low=20,this.cylinder_high=235):this.status=65;this.push_irq();break;case 198:r("Logical sectors per DRQ Block: "+d(this.bytecount&255),32768);this.sectors_per_drq=this.bytecount&255;this.status=80;this.push_irq();break;case 37:case 200:this.ata_read_sectors_dma(b);break;case 53:case 202:this.ata_write_sectors_dma(b);break;case 64:r("read verify sectors",32768);this.status=80;this.push_irq();break;case 218:r("Unimplemented: get media status",32768);this.status=65;this.error=
4;this.push_irq();break;case 224:r("ATA standby immediate",32768);this.status=80;this.push_irq();break;case 225:r("ATA idle immediate",32768);this.status=80;this.push_irq();break;case 231:r("ATA flush cache",32768);this.status=80;this.push_irq();break;case 236:r("ATA identify device",32768);if(this.is_atapi){this.status=65;this.error=4;this.push_irq();break}this.create_identify_packet();this.status=88;this.push_irq();break;case 234:r("flush cache ext",32768);this.status=80;this.push_irq();break;case 239:r("set features: "+
d(this.bytecount&255),32768);this.status=80;this.push_irq();break;case 222:this.status=80;this.push_irq();break;case 245:r("security freeze lock",32768);this.status=80;this.push_irq();break;case 249:r("Unimplemented: set max address",32768);this.status=65;this.error=4;break;default:H(!1,"New ATA cmd on 1F7: "+d(b),32768),this.status=65,this.error=4}else r("abort: No buffer",32768),this.error=4,this.status=65,this.push_irq()};v.prototype.atapi_handle=function(){r("ATAPI Command: "+d(this.data[0])+
" slave="+(this.drive_head>>4&1),32768);this.data_pointer=0;this.current_atapi_command=this.data[0];switch(this.current_atapi_command){case 0:r("test unit ready",32768);this.data_allocate(0);this.data_end=this.data_length;this.status=80;break;case 3:this.data_allocate(this.data[4]);this.data_end=this.data_length;this.status=88;this.data[0]=240;this.data[2]=5;this.data[7]=8;break;case 18:var b=this.data[4];this.status=88;r("inquiry: "+d(this.data[1],2)+" length="+b,32768);this.data.set([5,128,1,49,
31,0,0,0,83,79,78,89,32,32,32,32,67,68,45,82,79,77,32,67,68,85,45,49,48,48,48,32,49,46,49,97]);this.data_end=this.data_length=Math.min(36,b);break;case 26:this.data_allocate(this.data[4]);this.data_end=this.data_length;this.status=88;break;case 30:this.data_allocate(0);this.data_end=this.data_length;this.status=80;break;case 37:b=this.sector_count-1;this.data_set(new Uint8Array([b>>24&255,b>>16&255,b>>8&255,b&255,0,0,this.sector_size>>8&255,this.sector_size&255]));this.data_end=this.data_length;this.status=
88;break;case 40:this.lba_count&1?this.atapi_read_dma(this.data):this.atapi_read(this.data);break;case 66:b=this.data[8];this.data_allocate(Math.min(8,b));this.data_end=this.data_length;r("read q subcode: length="+b,32768);this.status=88;break;case 67:b=this.data[8]|this.data[7]<<8;var c=this.data[9]>>6;this.data_allocate(b);this.data_end=this.data_length;r("read toc: "+d(c,2)+" length="+b+" "+(this.data[1]&2)+" "+d(this.data[6]),32768);0===c?(b=this.sector_count,this.data.set(new Uint8Array([0,18,
1,1,0,20,1,0,0,0,0,0,0,22,170,0,b>>24,b>>16&255,b>>8&255,b&255]))):1===c?this.data.set(new Uint8Array([0,10,1,1,0,0,0,0,0,0,0,0])):H(!1,"Unimplemented format: "+c);this.status=88;break;case 70:b=this.data[8]|this.data[7]<<8;b=Math.min(b,32);this.data_allocate(b);this.data_end=this.data_length;this.data[0]=b-4>>24&255;this.data[1]=b-4>>16&255;this.data[2]=b-4>>8&255;this.data[3]=b-4&255;this.data[6]=8;this.data[10]=3;this.status=88;break;case 81:this.data_allocate(0);this.data_end=this.data_length;
this.status=80;break;case 82:r("Unimplemented ATAPI command: "+d(this.data[0]),32768);this.status=81;this.data_length=0;this.error=80;break;case 90:b=this.data[8]|this.data[7]<<8;c=this.data[2];r("mode sense: "+d(c)+" length="+b,32768);42===c&&this.data_allocate(Math.min(30,b));this.data_end=this.data_length;this.status=88;break;case 189:this.data_allocate(this.data[9]|this.data[8]<<8);this.data_end=this.data_length;this.data[5]=1;this.status=88;break;case 74:this.status=81;this.data_length=0;this.error=
80;r("Unimplemented ATAPI command: "+d(this.data[0]),32768);break;case 190:r("Unimplemented ATAPI command: "+d(this.data[0]),32768);this.data_allocate(0);this.data_end=this.data_length;this.status=80;break;default:this.status=81,this.data_length=0,this.error=80,r("Unimplemented ATAPI command: "+d(this.data[0]),32768),H(!1)}this.bytecount=this.bytecount&-8|2;0===(this.status&128)&&this.push_irq();0===(this.status&128)&&0===this.data_length&&(this.bytecount|=1,this.status&=-9)};v.prototype.do_write=
function(){this.status=80;H(this.data_length<=this.data.length);var b=this.data.subarray(0,this.data_length);H(0===this.data_length%512);this.ata_advance(this.current_command,this.data_length/512);this.push_irq();this.buffer.set(this.write_dest,b,function(){});this.report_write(this.data_length)};v.prototype.atapi_read=function(b){var c=b[2]<<24|b[3]<<16|b[4]<<8|b[5],g=b[7]<<8|b[8];b=b[1];var h=g*this.sector_size,k=c*this.sector_size;r("CD read lba="+d(c)+" lbacount="+d(g)+" bytecount="+d(h)+" flags="+
d(b),32768);this.data_length=0;var y=this.cylinder_high<<8&65280|this.cylinder_low&255;r(d(this.cylinder_high,2)+" "+d(this.cylinder_low,2),32768);this.cylinder_low=this.cylinder_high=0;65535===y&&y--;y>h&&(y=h);k>=this.buffer.byteLength?(H(!1,"CD read: Outside of disk  end="+d(k+h)+" size="+d(this.buffer.byteLength),32768),this.status=255,this.push_irq()):0===h?(this.status=80,this.data_pointer=0):(h=Math.min(h,this.buffer.byteLength-k),this.status=208,this.report_read_start(),this.read_buffer(k,
h,u=>{r("cd read: data arrived",32768);this.data_set(u);this.status=88;this.bytecount=this.bytecount&-8|2;this.push_irq();this.data_end=y&=-4;this.data_end>this.data_length&&(this.data_end=this.data_length);this.cylinder_low=this.data_end&255;this.cylinder_high=this.data_end>>8&255;this.report_read_end(h)}))};v.prototype.atapi_read_dma=function(b){var c=b[2]<<24|b[3]<<16|b[4]<<8|b[5],g=b[7]<<8|b[8];b=b[1];var h=g*this.sector_size,k=c*this.sector_size;r("CD read DMA lba="+d(c)+" lbacount="+d(g)+" bytecount="+
d(h)+" flags="+d(b),32768);k>=this.buffer.byteLength?(H(!1,"CD read: Outside of disk  end="+d(k+h)+" size="+d(this.buffer.byteLength),32768),this.status=255,this.push_irq()):(this.status=208,this.report_read_start(),this.read_buffer(k,h,y=>{r("atapi_read_dma: Data arrived");this.report_read_end(h);this.status=88;this.bytecount=this.bytecount&-8|2;this.data_set(y);this.do_atapi_dma()}))};v.prototype.do_atapi_dma=function(){if(0===(this.device.dma_status&1))r("do_atapi_dma: Status not set",32768);else if(0===
(this.status&8))r("do_atapi_dma: DRQ not set",32768);else{r("atapi dma transfer len="+this.data_length,32768);var b=this.device.prdt_addr,c=0,g=this.data;do{var h=this.cpu.read32s(b),k=this.cpu.read16(b+4),y=this.cpu.read8(b+7)&128;k||=65536;r("dma read dest="+d(h)+" count="+d(k)+" datalen="+d(this.data_length),32768);this.cpu.write_blob(g.subarray(c,Math.min(c+k,this.data_length)),h);c+=k;b+=8;if(c>=this.data_length&&!y){r("leave early end="+ +y+" offset="+d(c)+" data_length="+d(this.data_length)+
" cmd="+d(this.current_command),32768);break}}while(!y);r("end offset="+c,32768);this.status=80;this.device.dma_status&=-2;this.bytecount=this.bytecount&-8|3;this.push_irq()}};v.prototype.read_data=function(b){if(this.data_pointer<this.data_end){H(this.data_pointer+b-1<this.data_end);H(0===this.data_pointer%b,d(this.data_pointer)+" "+b);var c=1===b?this.data[this.data_pointer]:2===b?this.data16[this.data_pointer>>>1]:this.data32[this.data_pointer>>>2];this.data_pointer+=b;0===(this.data_pointer&(0===
(this.data_end&4095)?4095:255))&&r("Read 1F0: "+d(this.data[this.data_pointer],2)+" cur="+d(this.data_pointer)+" cnt="+d(this.data_length),32768);this.data_pointer>=this.data_end&&this.read_end();return c}r("Read 1F0: empty",32768);this.data_pointer+=b;return 0};v.prototype.read_end=function(){r("read_end cmd="+d(this.current_command)+" data_pointer="+d(this.data_pointer)+" end="+d(this.data_end)+" length="+d(this.data_length),32768);if(160===this.current_command)if(this.data_end===this.data_length)this.status=
80,this.bytecount=this.bytecount&-8|3,this.push_irq();else{this.status=88;this.bytecount=this.bytecount&-8|2;this.push_irq();var b=this.cylinder_high<<8&65280|this.cylinder_low&255;this.data_end+b>this.data_length?(this.cylinder_low=this.data_length-this.data_end&255,this.cylinder_high=this.data_length-this.data_end>>8&255,this.data_end=this.data_length):this.data_end+=b;r("data_end="+d(this.data_end),32768)}else this.error=0,this.data_pointer>=this.data_length?this.status=80:(196===this.current_command||
41===this.current_command?(b=Math.min(this.sectors_per_drq,(this.data_length-this.data_end)/512),H(0===b%1)):(H(32===this.current_command||36===this.current_command),b=1),this.ata_advance(this.current_command,b),this.data_end+=512*b,this.status=88),this.push_irq()};v.prototype.write_data_port=function(b,c){H(0===this.data_pointer%c);this.data_pointer>=this.data_end?r("Redundant write to data port: "+d(b)+" count="+d(this.data_end)+" cur="+d(this.data_pointer),32768):((0===(this.data_pointer+c&(0===
(this.data_end&4095)?4095:255))||20>this.data_end)&&r("Data port: "+d(b>>>0)+" count="+d(this.data_end)+" cur="+d(this.data_pointer),32768),1===c?this.data[this.data_pointer++]=b:2===c?(this.data16[this.data_pointer>>>1]=b,this.data_pointer+=2):(this.data32[this.data_pointer>>>2]=b,this.data_pointer+=4),H(this.data_pointer<=this.data_end),this.data_pointer===this.data_end&&this.write_end())};v.prototype.write_data_port8=function(b){this.write_data_port(b,1)};v.prototype.write_data_port16=function(b){this.write_data_port(b,
2)};v.prototype.write_data_port32=function(b){this.write_data_port(b,4)};v.prototype.write_end=function(){160===this.current_command?this.atapi_handle():(r("write_end data_pointer="+d(this.data_pointer)+" data_length="+d(this.data_length),32768),this.data_pointer>=this.data_length?this.do_write():(H(48===this.current_command||52===this.current_command||197===this.current_command,"Unexpected command: "+d(this.current_command)),this.status=88,this.data_end+=512,this.push_irq()))};v.prototype.ata_advance=
function(b,c){r("Advance sectors="+c+" old_bytecount="+this.bytecount,32768);this.bytecount-=c;36===b||41===b||52===b||57===b||37===b||53===b?(b=c+this.get_lba48(),this.sector=b&255|b>>16&65280,this.cylinder_low=b>>8&255,this.cylinder_high=b>>16&255):this.is_lba?(b=c+this.get_lba28(),this.sector=b&255,this.cylinder_low=b>>8&255,this.cylinder_high=b>>16&255,this.head=this.head&-16|b&15):(b=c+this.get_chs(),c=b/(this.head_count*this.sectors_per_track)|0,this.cylinder_low=c&255,this.cylinder_high=c>>
8&255,this.head=(b/this.sectors_per_track|0)%this.head_count&15,this.sector=b%this.sectors_per_track+1&255,H(b===this.get_chs()))};v.prototype.ata_read_sectors=function(b){var c=36===b||41===b,g=this.get_count(c);c=this.get_lba(c);var h=32===b||36===b,k=g*this.sector_size,y=c*this.sector_size;r("ATA read cmd="+d(b)+" mode="+(this.is_lba?"lba":"chs")+" lba="+d(c)+" lbacount="+d(g)+" bytecount="+d(k),32768);y+k>this.buffer.byteLength?(H(!1,"ATA read: Outside of disk",32768),this.status=255,this.push_irq()):
(this.status=192,this.report_read_start(),this.read_buffer(y,k,u=>{r("ata_read: Data arrived",32768);this.data_set(u);this.status=88;this.data_end=h?512:Math.min(k,512*this.sectors_per_drq);this.ata_advance(b,h?1:Math.min(g,this.sectors_per_track));this.push_irq();this.report_read_end(k)}))};v.prototype.ata_read_sectors_dma=function(b){var c=37===b;b=this.get_count(c);c=this.get_lba(c);var g=b*this.sector_size,h=c*this.sector_size;r("ATA DMA read lba="+d(c)+" lbacount="+d(b)+" bytecount="+d(g),32768);
h+g>this.buffer.byteLength?(H(!1,"ATA read: Outside of disk",32768),this.status=255,this.push_irq()):(this.status=88,this.device.dma_status|=1)};v.prototype.do_ata_read_sectors_dma=function(){var b=37===this.current_command,c=this.get_count(b);b=this.get_lba(b);var g=c*this.sector_size,h=b*this.sector_size;H(b<this.buffer.byteLength);this.report_read_start();var k=this.device.prdt_addr;this.read_buffer(h,g,y=>{r("do_ata_read_sectors_dma: Data arrived",32768);var u=this.device.prdt_addr,I=0;H(k===
u);do{var ba=this.cpu.read32s(u),R=this.cpu.read16(u+4),U=this.cpu.read8(u+7)&128;R||(R=65536,r("dma: prd count was 0",32768));r("dma read transfer dest="+d(ba)+" prd_count="+d(R),32768);this.cpu.write_blob(y.subarray(I,I+R),ba);I+=R;u+=8}while(!U);H(I===g);this.ata_advance(this.current_command,c);this.status=80;this.device.dma_status&=-2;this.current_command=-1;this.push_irq();this.report_read_end(g)})};v.prototype.ata_write_sectors=function(b){var c=52===b||57===b,g=this.get_count(c);c=this.get_lba(c);
b=48===b||52===b;var h=g*this.sector_size,k=c*this.sector_size;r("ATA write lba="+d(c)+" mode="+(this.is_lba?"lba":"chs")+" lbacount="+d(g)+" bytecount="+d(h),32768);k+h>this.buffer.byteLength?(H(!1,"ATA write: Outside of disk",32768),this.status=255,this.push_irq()):(this.status=88,this.data_allocate_noclear(h),this.data_end=b?512:Math.min(h,512*this.sectors_per_drq),this.write_dest=k)};v.prototype.ata_write_sectors_dma=function(b){var c=53===b;b=this.get_count(c);c=this.get_lba(c);var g=b*this.sector_size,
h=c*this.sector_size;r("ATA DMA write lba="+d(c)+" lbacount="+d(b)+" bytecount="+d(g),32768);h+g>this.buffer.byteLength?(H(!1,"ATA DMA write: Outside of disk",32768),this.status=255,this.push_irq()):(this.status=88,this.device.dma_status|=1)};v.prototype.do_ata_write_sectors_dma=function(){var b=53===this.current_command,c=this.get_count(b),g=this.get_lba(b);b=c*this.sector_size;g*=this.sector_size;var h=this.device.prdt_addr,k=0;r("prdt addr: "+d(h,8),32768);const y=new Uint8Array(b);do{var u=this.cpu.read32s(h),
I=this.cpu.read16(h+4),ba=this.cpu.read8(h+7)&128;I||(I=65536,r("dma: prd count was 0",32768));r("dma write transfer dest="+d(u)+" prd_count="+d(I),32768);u=this.cpu.mem8.subarray(u,u+I);H(u.length===I);y.set(u,k);k+=I;h+=8}while(!ba);H(k===y.length);this.buffer.set(g,y,()=>{r("dma write completed",32768);this.ata_advance(this.current_command,c);this.status=80;this.push_irq();this.device.dma_status&=-2;this.current_command=-1});this.report_write(b)};v.prototype.get_chs=function(){var b=this.cylinder_low&
255|this.cylinder_high<<8&65280,c=this.head,g=this.sector&255;r("get_chs: c="+b+" h="+c+" s="+g,32768);return(b*this.head_count+c)*this.sectors_per_track+g-1};v.prototype.get_lba28=function(){return this.sector&255|this.cylinder_low<<8&65280|this.cylinder_high<<16&16711680|(this.head&15)<<24};v.prototype.get_lba48=function(){return(this.sector&255|this.cylinder_low<<8&65280|this.cylinder_high<<16&16711680|this.sector>>8<<24&4278190080)>>>0};v.prototype.get_lba=function(b){return b?this.get_lba48():
this.is_lba?this.get_lba28():this.get_chs()};v.prototype.get_count=function(b){b?(b=this.bytecount,0===b&&(b=65536)):(b=this.bytecount&255,0===b&&(b=256));return b};v.prototype.create_identify_packet=function(){if(this.drive_head&16)this.data_allocate(0);else{for(var b=0;512>b;b++)this.data[b]=0;b=Math.min(16383,this.cylinder_count);this.data_set([64,this.is_atapi?133:0,b,b>>8,0,0,this.head_count,this.head_count>>8,this.sectors_per_track/512,this.sectors_per_track/512>>8,0,2,this.sectors_per_track,
this.sectors_per_track>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,2,4,0,0,0,0,0,0,0,0,0,56,118,32,54,68,72,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,128,0,1,0,0,2,0,0,0,2,0,2,7,0,b,b>>8,this.head_count,this.head_count>>8,this.sectors_per_track,0,this.sector_count&255,this.sector_count>>8&255,this.sector_count>>16&255,this.sector_count>>24&255,0,0,this.sector_count&255,this.sector_count>>8&255,this.sector_count>>16&255,this.sector_count>>
24&255,0,0,160===this.current_command?0:7,160===this.current_command?0:4,0,0,30,0,30,0,30,0,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,0,0,0,0,0,0,116,0,64,0,64,0,116,0,64,0,0,0,0,0,0,0,0,0,0,1,96,0,0,0,0,0,0,0,0,0,0,0,0,this.sector_count&255,this.sector_count>>8&255,this.sector_count>>16&255,this.sector_count>>24&255]);this.data_end=this.data_length=512}};v.prototype.data_allocate=function(b){this.data_allocate_noclear(b);for(var c=0;c<b+3>>2;c++)this.data32[c]=0};v.prototype.data_allocate_noclear=
function(b){this.data.length<b&&(this.data=new Uint8Array(b+3&-4),this.data16=new Uint16Array(this.data.buffer),this.data32=new Int32Array(this.data.buffer));this.data_length=b;this.data_pointer=0};v.prototype.data_set=function(b){this.data_allocate_noclear(b.length);this.data.set(b)};v.prototype.report_read_start=function(){this.stats.loading=!0;this.bus.send("ide-read-start")};v.prototype.report_read_end=function(b){this.stats.loading=!1;var c=b/this.sector_size|0;this.stats.sectors_read+=c;this.stats.bytes_read+=
b;this.bus.send("ide-read-end",[this.nr,b,c])};v.prototype.report_write=function(b){var c=b/this.sector_size|0;this.stats.sectors_written+=c;this.stats.bytes_written+=b;this.bus.send("ide-write-end",[this.nr,b,c])};v.prototype.read_buffer=function(b,c,g){const h=this.last_io_id++;this.in_progress_io_ids.add(h);this.buffer.get(b,c,k=>{if(this.cancelled_io_ids.delete(h))H(!this.in_progress_io_ids.has(h));else{var y=this.in_progress_io_ids.delete(h);H(y);g(k)}})};v.prototype.cancel_io_operations=function(){for(const b of this.in_progress_io_ids)this.cancelled_io_ids.add(b);
this.in_progress_io_ids.clear()};v.prototype.get_state=function(){var b=[];b[0]=this.bytecount;b[1]=this.cylinder_count;b[2]=this.cylinder_high;b[3]=this.cylinder_low;b[4]=this.data_pointer;b[5]=0;b[6]=0;b[7]=0;b[8]=0;b[9]=this.drive_head;b[10]=this.error;b[11]=this.head;b[12]=this.head_count;b[13]=this.is_atapi;b[14]=this.is_lba;b[15]=this.lba_count;b[16]=this.data;b[17]=this.data_length;b[18]=this.sector;b[19]=this.sector_count;b[20]=this.sector_size;b[21]=this.sectors_per_drq;b[22]=this.sectors_per_track;
b[23]=this.status;b[24]=this.write_dest;b[25]=this.current_command;b[26]=this.data_end;b[27]=this.current_atapi_command;b[28]=this.buffer;return b};v.prototype.set_state=function(b){this.bytecount=b[0];this.cylinder_count=b[1];this.cylinder_high=b[2];this.cylinder_low=b[3];this.data_pointer=b[4];this.drive_head=b[9];this.error=b[10];this.head=b[11];this.head_count=b[12];this.is_atapi=b[13];this.is_lba=b[14];this.lba_count=b[15];this.data=b[16];this.data_length=b[17];this.sector=b[18];this.sector_count=
b[19];this.sector_size=b[20];this.sectors_per_drq=b[21];this.sectors_per_track=b[22];this.status=b[23];this.write_dest=b[24];this.current_command=b[25];this.data_end=b[26];this.current_atapi_command=b[27];this.data16=new Uint16Array(this.data.buffer);this.data32=new Int32Array(this.data.buffer);this.buffer&&this.buffer.set_state(b[28])};z.prototype.get_state=function(){for(var b=[],c=0;256>c;c++)b[c]=this.device_spaces[c];b[256]=this.pci_addr;b[257]=this.pci_value;b[258]=this.pci_response;b[259]=
this.pci_status;return b};z.prototype.set_state=function(b){for(var c=0;256>c;c++){var g=this.devices[c],h=b[c];if(g&&h){for(var k=0;k<g.pci_bars.length;k++){var y=h[4+k];if(y&1){var u=g.pci_bars[k];this.set_io_bars(u,u.original_bar&65534,y&65534)}}this.device_spaces[c].set(h)}else g&&r("Warning: While restoring PCI device: Device exists in current configuration but not in snapshot ("+g.name+")"),h&&r("Warning: While restoring PCI device: Device doesn't exist in current configuration but does in snapshot (device "+
d(c,2)+")")}this.pci_addr.set(b[256]);this.pci_value.set(b[257]);this.pci_response.set(b[258]);this.pci_status.set(b[259])};z.prototype.pci_query=function(){var b=this.pci_addr[2]<<8|this.pci_addr[1],c=this.pci_addr[0]&252,g=b>>3&31,h="query enabled="+(this.pci_addr[3]>>7)+(" bdf="+d(b,4));h+=" dev="+d(g,2);h+=" addr="+d(c,2);g=this.device_spaces[b];void 0!==g?(this.pci_status32[0]=-2147483648,this.pci_response32[0]=c<g.byteLength?g[c>>2]:0,h+=" "+d(this.pci_addr32[0]>>>0,8)+" -> "+d(this.pci_response32[0]>>>
0,8),c>=g.byteLength&&(h+=" (undef)"),h+=" ("+this.devices[b].name+")",r(h,2048)):(this.pci_response32[0]=-1,this.pci_status32[0]=0)};z.prototype.pci_write8=function(b,c){var g=b>>8&65535;b&=255;var h=new Uint8Array(this.device_spaces[g].buffer),k=this.devices[g];h&&(H(!(16<=b&&44>b||48<=b&&52>b),"PCI: Expected 32-bit write, got 8-bit (addr: "+d(b)+")"),r("PCI write8 dev="+d(g>>3,2)+" ("+k.name+") addr="+d(b,4)+" value="+d(c,2),2048),h[b]=c)};z.prototype.pci_write16=function(b,c){H(0===(b&1));var g=
b>>8&65535;b&=255;var h=new Uint16Array(this.device_spaces[g].buffer),k=this.devices[g];h&&(16<=b&&44>b?r("Warning: PCI: Expected 32-bit write, got 16-bit (addr: "+d(b)+")"):(H(!(48<=b&&52>b),"PCI: Expected 32-bit write, got 16-bit (addr: "+d(b)+")"),r("PCI writ16 dev="+d(g>>3,2)+" ("+k.name+") addr="+d(b,4)+" value="+d(c,4),2048),h[b>>>1]=c))};z.prototype.pci_write32=function(b,c){H(0===(b&3));var g=b>>8&65535;b&=255;var h=this.device_spaces[g],k=this.devices[g];if(h)if(16<=b&&40>b){var y=b-16>>
2,u=k.pci_bars[y];r("BAR"+y+" exists="+(u?"y":"n")+" changed to "+d(c>>>0)+" dev="+d(g>>3,2)+" ("+k.name+") ",2048);u?(H(!(u.size&u.size-1),"bar size should be power of 2"),g=b>>2,k=h[g]&1,-1===(c|3|u.size-1)?(c=~(u.size-1)|k,0===k&&(h[g]=c)):0===k&&(y=u.original_bar,(c&-16)!==(y&-16)&&r("Warning: Changing memory bar not supported, ignored",2048),h[g]=y),1===k&&(H(1===k),k=h[g]&65534,y=c&65534,r("io bar changed from "+d(k>>>0,8)+" to "+d(y>>>0,8)+" size="+u.size,2048),this.set_io_bars(u,k,y),h[g]=
c|1)):h[b>>2]=0;r("BAR effective value: "+d(h[b>>2]>>>0),2048)}else 48===b?(r("PCI write rom address dev="+d(g>>3,2)+" ("+k.name+") value="+d(c>>>0,8),2048),h[b>>2]=k.pci_rom_size?-1===(c|2047)?-k.pci_rom_size|0:k.pci_rom_address|0:0):4===b?r("PCI write dev="+d(g>>3,2)+" ("+k.name+") addr="+d(b,4)+" value="+d(c>>>0,8),2048):(r("PCI write dev="+d(g>>3,2)+" ("+k.name+") addr="+d(b,4)+" value="+d(c>>>0,8),2048),h[b>>>2]=c)};z.prototype.register_device=function(b){H(void 0!==b.pci_id);H(void 0!==b.pci_space);
H(void 0!==b.pci_bars);var c=b.pci_id;r("PCI register bdf="+d(c)+" ("+b.name+")",2048);H(!this.devices[c]);H(64<=b.pci_space.length);H(c<this.devices.length);var g=new Int32Array(64);g.set(new Int32Array((new Uint8Array(b.pci_space)).buffer));this.device_spaces[c]=g;this.devices[c]=b;c=g.slice(4,10);for(var h=0;h<b.pci_bars.length;h++){var k=b.pci_bars[h];if(k){var y=c[h],u=y&1;k.original_bar=y;k.entries=[];if(0!==u)for(H(1===u),y&=-2,u=0;u<k.size;u++)k.entries[u]=this.io.ports[y+u]}}return g};z.prototype.set_io_bars=
function(b,c,g){var h=b.size;r("Move io bars: from="+d(c)+" to="+d(g)+" count="+h,2048);for(var k=this.io.ports,y=0;y<h;y++){var u=k[c+y];4096<=c+y&&(k[c+y]=this.io.create_empty_entry());u.read8===this.io.empty_port_read8&&u.read16===this.io.empty_port_read16&&u.read32===this.io.empty_port_read32&&u.write8===this.io.empty_port_write&&u.write16===this.io.empty_port_write&&u.write32===this.io.empty_port_write&&r("Warning: Bad IO bar: Source not mapped, port="+d(c+y,4),2048);u=b.entries[y];var I=k[g+
y];H(u&&I);4096<=g+y&&(k[g+y]=u);I.read8!==this.io.empty_port_read8&&I.read16!==this.io.empty_port_read16&&I.read32!==this.io.empty_port_read32&&I.write8!==this.io.empty_port_write&&I.write16!==this.io.empty_port_write&&I.write32!==this.io.empty_port_write||r("Warning: Bad IO bar: Target already mapped, port="+d(g+y,4),2048)}};z.prototype.raise_irq=function(b){var c=this.device_spaces[b];H(c);this.cpu.device_raise_irq(this.isa_bridge_space8[96+((c[15]>>8&255)-1+((b>>3)-1&255)&3)])};z.prototype.lower_irq=
function(b){var c=this.device_spaces[b];H(c);this.cpu.device_lower_irq(this.isa_bridge_space8[96+((c[15]>>8&255)+(b>>3&255)-2&3)])};C.prototype.get_state=function(){var b=[];b[0]=this.bytes_expecting;b[1]=this.receiving_command;b[2]=this.receiving_index;b[4]=this.response_data;b[5]=this.response_index;b[6]=this.response_length;b[8]=this.status_reg0;b[9]=this.status_reg1;b[10]=this.status_reg2;b[11]=this.drive;b[12]=this.last_cylinder;b[13]=this.last_head;b[14]=this.last_sector;b[15]=this.dor;b[16]=
this.sectors_per_track;b[17]=this.number_of_heads;b[18]=this.number_of_cylinders;return b};C.prototype.set_state=function(b){this.bytes_expecting=b[0];this.receiving_command=b[1];this.receiving_index=b[2];this.next_command=b[3];this.response_data=b[4];this.response_index=b[5];this.response_length=b[6];this.status_reg0=b[8];this.status_reg1=b[9];this.status_reg2=b[10];this.drive=b[11];this.last_cylinder=b[12];this.last_head=b[13];this.last_sector=b[14];this.dor=b[15];this.sectors_per_track=b[16];this.number_of_heads=
b[17];this.number_of_cylinders=b[18]};C.prototype.port3F0_read=function(){r("3F0 read",8192);return 0};C.prototype.port3F4_read=function(){r("3F4 read",8192);var b=128;this.response_index<this.response_length&&(b|=80);0===(this.dor&8)&&(b|=32);return b};C.prototype.port3F7_read=function(){r("3F7 read",8192);return 0};C.prototype.port3F5_read=function(){if(this.response_index<this.response_length)return r("3F5 read: "+this.response_data[this.response_index],8192),this.cpu.device_lower_irq(6),this.response_data[this.response_index++];
r("3F5 read, empty",8192);return 255};C.prototype.port3F5_write=function(b){if(this.fda_image)if(r("3F5 write "+d(b),8192),0<this.bytes_expecting){if(this.receiving_command[this.receiving_index++]=b,this.bytes_expecting--,0===this.bytes_expecting){if(N){b="3F5 command received: ";for(var c=0;c<this.receiving_index;c++)b+=d(this.receiving_command[c])+" ";r(b,8192)}this.next_command.call(this,this.receiving_command)}}else{switch(b){case 3:this.next_command=this.fix_drive_data;this.bytes_expecting=2;
break;case 4:this.next_command=this.check_drive_status;this.bytes_expecting=1;break;case 5:case 69:case 197:this.next_command=function(g){this.do_sector(!0,g)};this.bytes_expecting=8;break;case 230:this.next_command=function(g){this.do_sector(!1,g)};this.bytes_expecting=8;break;case 7:this.next_command=this.calibrate;this.bytes_expecting=1;break;case 8:this.check_interrupt_status();break;case 74:this.next_command=this.read_sector_id;this.bytes_expecting=1;break;case 15:this.bytes_expecting=2;this.next_command=
this.seek;break;case 14:r("dump registers",8192);this.response_data[0]=128;this.response_index=0;this.response_length=1;this.bytes_expecting=0;break;default:H(!1,"Unimplemented floppy command call "+d(b))}this.receiving_index=0}};C.prototype.port3F2_read=function(){r("read 3F2: DOR",8192);return this.dor};C.prototype.port3F2_write=function(b){4===(b&4)&&0===(this.dor&4)&&this.cpu.device_raise_irq(6);r("start motors: "+d(b>>4),8192);r("enable dma: "+!!(b&8),8192);r("reset fdc: "+!!(b&4),8192);r("drive select: "+
(b&3),8192);r("DOR = "+d(b),8192);this.dor=b};C.prototype.check_drive_status=function(b){r("check drive status",8192);this.response_index=0;this.response_length=1;this.response_data[0]=32};C.prototype.seek=function(b){r("seek",8192);H(0===(b[0]&3),"Unhandled seek drive");this.last_cylinder=b[1];this.last_head=b[0]>>2&1;this.raise_irq()};C.prototype.calibrate=function(b){r("floppy calibrate",8192);this.raise_irq()};C.prototype.check_interrupt_status=function(){r("floppy check interrupt status",8192);
this.response_index=0;this.response_length=2;this.response_data[0]=32;this.response_data[1]=this.last_cylinder};C.prototype.do_sector=function(b,c){var g=c[2],h=c[1],k=c[3],y=128<<c[4],u=c[5]-c[3]+1,I=((g+this.number_of_heads*h)*this.sectors_per_track+k-1)*y;r("Floppy "+(b?"Write":"Read"),8192);r("from "+d(I)+" length "+d(u*y),8192);r(h+" / "+g+" / "+k,8192);c[4]||r("FDC: sector count is zero, use data length instead",8192);this.fda_image&&(b?this.dma.do_write(this.fda_image,I,u*y,2,this.done.bind(this,
c,h,g,k)):this.dma.do_read(this.fda_image,I,u*y,2,this.done.bind(this,c,h,g,k)))};C.prototype.done=function(b,c,g,h,k){k||(h++,h>this.sectors_per_track&&(h=1,g++,g>=this.number_of_heads&&(g=0,c++)),this.last_cylinder=c,this.last_head=g,this.last_sector=h,this.response_index=0,this.response_length=7,this.response_data[0]=g<<2|32,this.response_data[1]=0,this.response_data[2]=0,this.response_data[3]=c,this.response_data[4]=g,this.response_data[5]=h,this.response_data[6]=b[4],this.raise_irq())};C.prototype.fix_drive_data=
function(b){r("floppy fix drive data "+b,8192)};C.prototype.read_sector_id=function(b){r("floppy read sector id "+b,8192);this.response_index=0;this.response_length=7;this.response_data[0]=0;this.response_data[1]=0;this.response_data[2]=0;this.response_data[3]=0;this.response_data[4]=0;this.response_data[5]=0;this.response_data[6]=0;this.raise_irq()};C.prototype.raise_irq=function(){this.dor&8&&this.cpu.device_raise_irq(6)};sa.prototype.mmap_read8=function(b){b=this.memory_map_read8[b>>>17](b);H(0<=
b&&255>=b);return b};sa.prototype.mmap_write8=function(b,c){H(0<=c&&255>=c);this.memory_map_write8[b>>>17](b,c)};sa.prototype.mmap_read16=function(b){var c=this.memory_map_read8[b>>>17];b=c(b)|c(b+1|0)<<8;H(0<=b&&65535>=b);return b};sa.prototype.mmap_write16=function(b,c){var g=this.memory_map_write8[b>>>17];H(0<=c&&65535>=c);g(b,c&255);g(b+1|0,c>>8)};sa.prototype.mmap_read32=function(b){return this.memory_map_read32[b>>>17](b)};sa.prototype.mmap_write32=function(b,c){this.memory_map_write32[b>>>
17](b,c)};sa.prototype.mmap_write64=function(b,c,g){var h=b>>>17;H(h===b+7>>>17);h=this.memory_map_write32[h];h(b,c);h(b+4,g)};sa.prototype.mmap_write128=function(b,c,g,h,k){var y=b>>>17;H(y===b+12>>>17);y=this.memory_map_write32[y];y(b,c);y(b+4,g);y(b+8,h);y(b+12,k)};sa.prototype.write_blob=function(b,c){H(b&&0<=b.length);b.length&&(H(!this.in_mapped_range(c)),H(!this.in_mapped_range(c+b.length-1)),this.jit_dirty_cache(c,c+b.length),this.mem8.set(b,c))};sa.prototype.read_blob=function(b,c){c&&(H(!this.in_mapped_range(b)),
H(!this.in_mapped_range(b+c-1)));return this.mem8.subarray(b,b+c)};A.prototype.get_state=function(){return[this.channel_page,this.channel_pagehi,this.channel_addr,this.channel_addr_init,this.channel_count,this.channel_count_init,this.channel_mask,this.channel_mode,this.lsb_msb_flipflop]};A.prototype.set_state=function(b){this.channel_page=b[0];this.channel_pagehi=b[1];this.channel_addr=b[2];this.channel_addr_init=b[3];this.channel_count=b[4];this.channel_count_init=b[5];this.channel_mask=b[6];this.channel_mode=
b[7];this.lsb_msb_flipflop=b[8]};A.prototype.port_count_write=function(b,c){r("count write ["+b+"] = "+d(c),16);this.channel_count[b]=this.flipflop_get(this.channel_count[b],c,!1);this.channel_count_init[b]=this.flipflop_get(this.channel_count_init[b],c,!0)};A.prototype.port_count_read=function(b){r("count read ["+b+"] -> "+d(this.channel_count[b]),16);return this.flipflop_read(this.channel_count[b])};A.prototype.port_addr_write=function(b,c){r("addr write ["+b+"] = "+d(c),16);this.channel_addr[b]=
this.flipflop_get(this.channel_addr[b],c,!1);this.channel_addr_init[b]=this.flipflop_get(this.channel_addr_init[b],c,!0)};A.prototype.port_addr_read=function(b){r("addr read ["+b+"] -> "+d(this.channel_addr[b]),16);return this.flipflop_read(this.channel_addr[b])};A.prototype.port_pagehi_write=function(b,c){r("pagehi write ["+b+"] = "+d(c),16);this.channel_pagehi[b]=c};A.prototype.port_pagehi_read=function(b){r("pagehi read ["+b+"]",16);return this.channel_pagehi[b]};A.prototype.port_page_write=function(b,
c){r("page write ["+b+"] = "+d(c),16);this.channel_page[b]=c};A.prototype.port_page_read=function(b){r("page read ["+b+"]",16);return this.channel_page[b]};A.prototype.port_singlemask_write=function(b,c){b=(c&3)+b;c=c&4?1:0;r("singlechannel mask write ["+b+"] = "+c,16);this.update_mask(b,c)};A.prototype.port_multimask_write=function(b,c){r("multichannel mask write: "+d(c),16);for(var g=0;4>g;g++)this.update_mask(b+g,c&1<<g)};A.prototype.port_multimask_read=function(b){var c=0|this.channel_mask[b+
0];c|=this.channel_mask[b+1]<<1;c|=this.channel_mask[b+2]<<2;c|=this.channel_mask[b+3]<<3;r("multichannel mask read: "+d(c),16);return c};A.prototype.port_mode_write=function(b,c){b=(c&3)+b;r("mode write ["+b+"] = "+d(c),16);this.channel_mode[b]=c};A.prototype.portC_write=function(b){r("flipflop reset",16);this.lsb_msb_flipflop=0};A.prototype.on_unmask=function(b,c){this.unmask_listeners.push({fn:b,this_value:c})};A.prototype.update_mask=function(b,c){if(this.channel_mask[b]!==c&&(this.channel_mask[b]=
c,!c))for(r("firing on_unmask("+b+")",16),c=0;c<this.unmask_listeners.length;c++)this.unmask_listeners[c].fn.call(this.unmask_listeners[c].this_value,b)};A.prototype.do_read=function(b,c,g,h,k){var y=this.count_get_8bit(h),u=this.address_get_8bit(h);r("DMA write channel "+h,16);r("to "+d(u)+" len "+d(y),16);g<y&&r("DMA should read more than provided: "+d(g)+" "+d(y),16);if(c+y>b.byteLength)r("DMA read outside of buffer",16),k(!0);else{var I=this.cpu;this.channel_addr[h]+=y;b.get(c,y,function(ba){I.write_blob(ba,
u);k(!1)})}};A.prototype.do_write=function(b,c,g,h,k){var y=this.channel_count[h]+1&65535,u=5<=h?2:1,I=y*u,ba=this.address_get_8bit(h),R=!1,U=!1,Y=this.channel_mode[h]&16;r("DMA write channel "+h,16);r("to "+d(ba)+" len "+d(I),16);g<I?(r("DMA should read more than provided",16),y=Math.floor(g/u),I=y*u,R=!0):g>I&&(r("DMA attempted to read more than provided",16),U=!0);c+I>b.byteLength?(r("DMA write outside of buffer",16),k(!0)):(this.channel_addr[h]+=y,this.channel_count[h]-=y,!R&&Y&&(r("DMA autoinit",
16),this.channel_addr[h]=this.channel_addr_init[h],this.channel_count[h]=this.channel_count_init[h]),b.set(c,this.cpu.mem8.subarray(ba,ba+I),()=>{U&&Y?(r("DMA continuing from start",16),this.do_write(b,c+I,g-I,h,k)):k(!1)}))};A.prototype.address_get_8bit=function(b){var c=this.channel_addr[b];5<=b&&(c<<=1);c=c&65535|this.channel_page[b]<<16;return c|this.channel_pagehi[b]<<24};A.prototype.count_get_8bit=function(b){var c=this.channel_count[b]+1;5<=b&&(c*=2);return c};A.prototype.flipflop_get=function(b,
c,g){g||(this.lsb_msb_flipflop^=1);return this.lsb_msb_flipflop?b&-256|c:b&-65281|c<<8};A.prototype.flipflop_read=function(b){return(this.lsb_msb_flipflop^=1)?b&255:b>>8&255};F.prototype.get_state=function(){var b=[];b[0]=this.counter_next_low;b[1]=this.counter_enabled;b[2]=this.counter_mode;b[3]=this.counter_read_mode;b[4]=this.counter_latch;b[5]=this.counter_latch_value;b[6]=this.counter_reload;b[7]=this.counter_start_time;b[8]=this.counter_start_value;return b};F.prototype.set_state=function(b){this.counter_next_low=
b[0];this.counter_enabled=b[1];this.counter_mode=b[2];this.counter_read_mode=b[3];this.counter_latch=b[4];this.counter_latch_value=b[5];this.counter_reload=b[6];this.counter_start_time=b[7];this.counter_start_value=b[8]};F.prototype.timer=function(b,c){var g=100;c||(this.counter_enabled[0]&&this.did_rollover(0,b)?(this.counter_start_value[0]=this.get_counter_value(0,b),this.counter_start_time[0]=b,r("pit interrupt. new value: "+this.counter_start_value[0],512),this.cpu.device_lower_irq(0),this.cpu.device_raise_irq(0),
0===this.counter_mode[0]&&(this.counter_enabled[0]=0)):this.cpu.device_lower_irq(0),this.counter_enabled[0]&&(g=(this.counter_start_value[0]-Math.floor(1193.1816666*(b-this.counter_start_time[0])))/1193.1816666));return g};F.prototype.get_counter_value=function(b,c){if(!this.counter_enabled[b])return 0;var g=c-this.counter_start_time[b],h=Math.floor(1193.1816666*g);c=this.counter_start_value[b]-h;r("diff="+g+" dticks="+h+" value="+c+" reload="+this.counter_reload[b],512);g=this.counter_reload[b];
c>=g?(r("Warning: Counter"+b+" value "+c+" is larger than reload "+g,512),c%=g):0>c&&(c=c%g+g);return c};F.prototype.did_rollover=function(b,c){c-=this.counter_start_time[b];return 0>c?(r("Warning: PIT timer difference is negative, resetting (timer "+b+")"),!0):this.counter_start_value[b]<Math.floor(1193.1816666*c)};F.prototype.counter_read=function(b){var c=this.counter_latch[b];if(c)return this.counter_latch[b]--,2===c?this.counter_latch_value[b]&255:this.counter_latch_value[b]>>8;c=this.counter_next_low[b];
3===this.counter_mode[b]&&(this.counter_next_low[b]^=1);b=this.get_counter_value(b,f.microtick());return c?b&255:b>>8};F.prototype.counter_write=function(b,c){this.counter_reload[b]=this.counter_next_low[b]?this.counter_reload[b]&-256|c:this.counter_reload[b]&255|c<<8;3===this.counter_read_mode[b]&&this.counter_next_low[b]||(this.counter_reload[b]||(this.counter_reload[b]=65535),this.counter_start_value[b]=this.counter_reload[b],this.counter_enabled[b]=!0,this.counter_start_time[b]=f.microtick(),
r("counter"+b+" reload="+d(this.counter_reload[b])+" tick="+(this.counter_reload[b]||65536)/1193.1816666+"ms",512));3===this.counter_read_mode[b]&&(this.counter_next_low[b]^=1)};F.prototype.port43_write=function(b){var c=b>>1&7,g=b&1,h=b>>6&3;b=b>>4&3;1===h&&r("Unimplemented timer1",512);3===h?r("Unimplemented read back",512):0===b?(this.counter_latch[h]=2,c=this.get_counter_value(h,f.microtick()),r("latch: "+c,512),this.counter_latch_value[h]=c?c-1:0):(6<=c&&(c&=-5),r("Control: mode="+c+" ctr="+
h+" read_mode="+b+" bcd="+g,512),this.counter_next_low[h]=1===b?0:1,0===h&&this.cpu.device_lower_irq(0),0!==c&&3!==c&&2!==c&&r("Unimplemented counter mode: "+d(c),512),this.counter_mode[h]=c,this.counter_read_mode[h]=b,2===h&&this.bus.send("pcspeaker-update",[this.counter_mode[2],this.counter_reload[2]]))};F.prototype.dump=function(){const b=this.counter_reload[0];r("counter0 ticks every "+(b||65536)/1193.1816666+"ms (reload="+b+")")};var xa=Uint32Array.from([655360,655360,720896,753664]),Ea=Uint32Array.from([131072,
65536,32768,32768]);E.prototype.get_state=function(){var b=[];b[0]=this.vga_memory_size;b[1]=this.cursor_address;b[2]=this.cursor_scanline_start;b[3]=this.cursor_scanline_end;b[4]=this.max_cols;b[5]=this.max_rows;b[6]=this.vga_memory;b[7]=this.dac_state;b[8]=this.start_address;b[9]=this.graphical_mode;b[10]=this.vga256_palette;b[11]=this.latch_dword;b[12]=this.color_compare;b[13]=this.color_dont_care;b[14]=this.miscellaneous_graphics_register;b[15]=this.svga_width;b[16]=this.svga_height;b[17]=this.crtc_mode;
b[18]=this.svga_enabled;b[19]=this.svga_bpp;b[20]=this.svga_bank_offset;b[21]=this.svga_offset;b[22]=this.index_crtc;b[23]=this.dac_color_index_write;b[24]=this.dac_color_index_read;b[25]=this.dac_map;b[26]=this.sequencer_index;b[27]=this.plane_write_bm;b[28]=this.sequencer_memory_mode;b[29]=this.graphics_index;b[30]=this.plane_read;b[31]=this.planar_mode;b[32]=this.planar_rotate_reg;b[33]=this.planar_bitmap;b[34]=this.max_scan_line;b[35]=this.miscellaneous_output_register;b[36]=this.port_3DA_value;
b[37]=this.dispi_index;b[38]=this.dispi_enable_value;b[39]=this.svga_memory;b[40]=this.graphical_mode_is_linear;b[41]=this.attribute_controller_index;b[42]=this.offset_register;b[43]=this.planar_setreset;b[44]=this.planar_setreset_enable;b[45]=this.start_address_latched;b[46]=this.crtc;b[47]=this.horizontal_display_enable_end;b[48]=this.horizontal_blank_start;b[49]=this.vertical_display_enable_end;b[50]=this.vertical_blank_start;b[51]=this.underline_location_register;b[52]=this.preset_row_scan;b[53]=
this.offset_register;b[54]=this.palette_source;b[55]=this.attribute_mode;b[56]=this.color_plane_enable;b[57]=this.horizontal_panning;b[58]=this.color_select;b[59]=this.clocking_mode;b[60]=this.line_compare;b[61]=this.pixel_buffer;b[62]=this.dac_mask;return b};E.prototype.set_state=function(b){this.vga_memory_size=b[0];this.cursor_address=b[1];this.cursor_scanline_start=b[2];this.cursor_scanline_end=b[3];this.max_cols=b[4];this.max_rows=b[5];b[6]&&this.vga_memory.set(b[6]);this.dac_state=b[7];this.start_address=
b[8];this.graphical_mode=b[9];this.vga256_palette=b[10];this.latch_dword=b[11];this.color_compare=b[12];this.color_dont_care=b[13];this.miscellaneous_graphics_register=b[14];this.svga_width=b[15];this.svga_height=b[16];this.crtc_mode=b[17];this.svga_enabled=b[18];this.svga_bpp=b[19];this.svga_bank_offset=b[20];this.svga_offset=b[21];this.index_crtc=b[22];this.dac_color_index_write=b[23];this.dac_color_index_read=b[24];this.dac_map=b[25];this.sequencer_index=b[26];this.plane_write_bm=b[27];this.sequencer_memory_mode=
b[28];this.graphics_index=b[29];this.plane_read=b[30];this.planar_mode=b[31];this.planar_rotate_reg=b[32];this.planar_bitmap=b[33];this.max_scan_line=b[34];this.miscellaneous_output_register=b[35];this.port_3DA_value=b[36];this.dispi_index=b[37];this.dispi_enable_value=b[38];this.svga_memory.set(b[39]);this.graphical_mode_is_linear=b[40];this.attribute_controller_index=b[41];this.offset_register=b[42];this.planar_setreset=b[43];this.planar_setreset_enable=b[44];this.start_address_latched=b[45];this.crtc.set(b[46]);
this.horizontal_display_enable_end=b[47];this.horizontal_blank_start=b[48];this.vertical_display_enable_end=b[49];this.vertical_blank_start=b[50];this.underline_location_register=b[51];this.preset_row_scan=b[52];this.offset_register=b[53];this.palette_source=b[54];this.attribute_mode=b[55];this.color_plane_enable=b[56];this.horizontal_panning=b[57];this.color_select=b[58];this.clocking_mode=b[59];this.line_compare=b[60];b[61]&&this.pixel_buffer.set(b[61]);this.dac_mask=void 0===b[62]?255:b[62];this.bus.send("screen-set-mode",
this.graphical_mode);this.graphical_mode?(this.screen_height=this.screen_width=0,this.svga_enabled?(this.set_size_graphical(this.svga_width,this.svga_height,this.svga_bpp,this.svga_width,this.svga_height),this.update_layers()):(this.update_vga_size(),this.update_layers(),this.complete_replot())):(this.set_size_text(this.max_cols,this.max_rows),this.update_cursor_scanline(),this.update_cursor());this.complete_redraw()};E.prototype.vga_memory_read=function(b){if(this.svga_enabled&&this.graphical_mode_is_linear)return this.cpu.read8((b-
655360|this.svga_bank_offset)+3758096384|0);var c=this.miscellaneous_graphics_register>>2&3;b-=xa[c];if(0>b||b>=Ea[c])return r("vga read outside memory space: addr:"+d(b),256),0;this.latch_dword=this.plane0[b];this.latch_dword|=this.plane1[b]<<8;this.latch_dword|=this.plane2[b]<<16;this.latch_dword|=this.plane3[b]<<24;if(this.planar_mode&8)return c=255,this.color_dont_care&1&&(c&=this.plane0[b]^~(this.color_compare&1?255:0)),this.color_dont_care&2&&(c&=this.plane1[b]^~(this.color_compare&2?255:0)),
this.color_dont_care&4&&(c&=this.plane2[b]^~(this.color_compare&4?255:0)),this.color_dont_care&8&&(c&=this.plane3[b]^~(this.color_compare&8?255:0)),c;c=this.plane_read;this.graphical_mode?this.sequencer_memory_mode&8?(c=b&3,b&=-4):this.planar_mode&16&&(c=b&1,b&=-2):c=0;return this.vga_memory[c<<16|b]};E.prototype.vga_memory_write=function(b,c){if(this.svga_enabled&&this.graphical_mode&&this.graphical_mode_is_linear)this.cpu.write8((b-655360|this.svga_bank_offset)+3758096384|0,c);else{var g=this.miscellaneous_graphics_register>>
2&3;b-=xa[g];0>b||b>=Ea[g]?r("vga write outside memory space: addr:"+d(b)+", value:"+d(c),256):this.graphical_mode?this.vga_memory_write_graphical(b,c):this.plane_write_bm&3&&this.vga_memory_write_text_mode(b,c)}};E.prototype.vga_memory_write_graphical=function(b,c){var g=this.planar_mode&3,h=this.apply_feed(this.planar_bitmap),k=this.apply_expand(this.planar_setreset),y=this.apply_expand(this.planar_setreset_enable);switch(g){case 0:c=this.apply_rotate(c);var u=this.apply_feed(c);u=this.apply_setreset(u,
y);u=this.apply_logical(u,this.latch_dword);u=this.apply_bitmask(u,h);break;case 1:u=this.latch_dword;break;case 2:u=this.apply_expand(c);u=this.apply_logical(u,this.latch_dword);u=this.apply_bitmask(u,h);break;case 3:c=this.apply_rotate(c),h&=this.apply_feed(c),u=this.apply_bitmask(k,h)}c=15;switch(this.sequencer_memory_mode&12){case 0:c=5<<(b&1);b&=-2;break;case 8:case 12:c=1<<(b&3),b&=-4}c&=this.plane_write_bm;c&1&&(this.plane0[b]=u>>0&255);c&2&&(this.plane1[b]=u>>8&255);c&4&&(this.plane2[b]=u>>
16&255);c&8&&(this.plane3[b]=u>>24&255);b=this.vga_addr_to_pixel(b);this.partial_replot(b,b+7)};E.prototype.apply_feed=function(b){return b|b<<8|b<<16|b<<24};E.prototype.apply_expand=function(b){return(b&1?255:0)|(b&2?255:0)<<8|(b&4?255:0)<<16|(b&8?255:0)<<24};E.prototype.apply_rotate=function(b){return(b|b<<8)>>>(this.planar_rotate_reg&7)&255};E.prototype.apply_setreset=function(b,c){var g=this.apply_expand(this.planar_setreset);return(b|c&g)&(~c|g)};E.prototype.apply_logical=function(b,c){switch(this.planar_rotate_reg&
24){case 8:return b&c;case 16:return b|c;case 24:return b^c}return b};E.prototype.apply_bitmask=function(b,c){return c&b|~c&this.latch_dword};E.prototype.text_mode_redraw=function(){for(var b=this.start_address<<1,c,g,h=0;h<this.max_rows;h++)for(var k=0;k<this.max_cols;k++)c=this.vga_memory[b],g=this.vga_memory[b|1],this.bus.send("screen-put-char",[h,k,c,this.vga256_palette[this.dac_mask&this.dac_map[g>>4&15]],this.vga256_palette[this.dac_mask&this.dac_map[g&15]]]),b+=2};E.prototype.vga_memory_write_text_mode=
function(b,c){var g=(b>>1)-this.start_address,h=g/this.max_cols|0;g%=this.max_cols;if(b&1)var k=c,y=this.vga_memory[b&-2];else y=c,k=this.vga_memory[b|1];this.bus.send("screen-put-char",[h,g,y,this.vga256_palette[this.dac_mask&this.dac_map[k>>4&15]],this.vga256_palette[this.dac_mask&this.dac_map[k&15]]]);this.vga_memory[b]=c};E.prototype.update_cursor=function(){var b=(this.cursor_address-this.start_address)/this.max_cols|0,c=(this.cursor_address-this.start_address)%this.max_cols;b=Math.min(this.max_rows-
1,b);this.bus.send("screen-update-cursor",[b,c])};E.prototype.complete_redraw=function(){r("complete redraw",256);this.graphical_mode?this.svga_enabled?this.cpu.svga_mark_dirty():(this.diff_addr_min=0,this.diff_addr_max=524288):this.text_mode_redraw()};E.prototype.complete_replot=function(){r("complete replot",256);this.graphical_mode&&!this.svga_enabled&&(this.diff_plot_min=0,this.diff_plot_max=524288,this.complete_redraw())};E.prototype.partial_redraw=function(b,c){b<this.diff_addr_min&&(this.diff_addr_min=
b);c>this.diff_addr_max&&(this.diff_addr_max=c)};E.prototype.partial_replot=function(b,c){b<this.diff_plot_min&&(this.diff_plot_min=b);c>this.diff_plot_max&&(this.diff_plot_max=c);this.partial_redraw(b,c)};E.prototype.reset_diffs=function(){this.diff_addr_min=this.vga_memory_size;this.diff_addr_max=0;this.diff_plot_min=this.vga_memory_size;this.diff_plot_max=0};E.prototype.destroy=function(){};E.prototype.vga_bytes_per_line=function(){var b=this.offset_register<<2;this.underline_location_register&
64?b<<=1:this.crtc_mode&64&&(b>>>=1);return b};E.prototype.vga_addr_shift_count=function(){var b=128+(~this.underline_location_register&this.crtc_mode&64);b-=this.underline_location_register&64;b-=this.attribute_mode&64;return b>>>6};E.prototype.vga_addr_to_pixel=function(b){var c=this.vga_addr_shift_count();if(~this.crtc_mode&3){var g=b-this.start_address;g&=this.crtc_mode<<13|-24577;g<<=c;var h=g/this.virtual_width|0;g%=this.virtual_width;switch(this.crtc_mode&3){case 2:h=h<<1|b>>13&1;break;case 1:h=
h<<1|b>>14&1;break;case 0:h=h<<2|b>>13&3}return h*this.virtual_width+g+(this.start_address<<c)}return b<<c};E.prototype.scan_line_to_screen_row=function(b){this.max_scan_line&128&&(b>>>=1);b=Math.ceil(b/(1+(this.max_scan_line&31)));this.crtc_mode&1||(b<<=1);this.crtc_mode&2||(b<<=1);return b};E.prototype.set_size_text=function(b,c){this.max_cols=b;this.max_rows=c;this.bus.send("screen-set-size-text",[b,c])};E.prototype.set_size_graphical=function(b,c,g,h,k){if(!this.stats.is_graphical||this.stats.bpp!==
g||this.screen_width!==b||this.screen_height!==c||this.virtual_width!==h||this.virtual_height!==k){this.screen_width=b;this.screen_height=c;this.virtual_width=h;this.virtual_height=k;this.stats.bpp=g;this.stats.is_graphical=!0;this.stats.res_x=b;this.stats.res_y=c;if("undefined"!==typeof ImageData){const y=h*k,u=this.cpu.svga_allocate_dest_buffer(y)>>>0;this.dest_buffet_offset=u;this.image_data=new ImageData(new Uint8ClampedArray(this.cpu.wasm_memory.buffer,u,4*y),h,k);this.cpu.svga_mark_dirty()}this.bus.send("screen-set-size-graphical",
[b,c,h,k,g])}};E.prototype.update_vga_size=function(){if(!this.svga_enabled){var b=Math.min(1+this.horizontal_display_enable_end,this.horizontal_blank_start),c=Math.min(1+this.vertical_display_enable_end,this.vertical_blank_start);if(b&&c)if(this.graphical_mode){b<<=3;var g=this.offset_register<<4;this.attribute_mode&64&&(b>>>=1,g>>>=1);c=this.scan_line_to_screen_row(c);var h=Math.ceil(Ea[0]/this.vga_bytes_per_line());this.set_size_graphical(b,c,8,g,h);this.update_vertical_retrace();this.update_layers()}else this.max_scan_line&
128&&(c>>>=1),g=c/(1+(this.max_scan_line&31))|0,b&&g&&this.set_size_text(b,g)}};E.prototype.update_layers=function(){this.graphical_mode||this.text_mode_redraw();if(this.svga_enabled)this.layers=[];else if(this.virtual_width&&this.screen_width)if(!this.palette_source||this.clocking_mode&32)this.layers=[],this.bus.send("screen-clear");else{var b=this.start_address_latched,c=this.horizontal_panning;this.attribute_mode&64&&(c>>>=1);var g=this.preset_row_scan>>5&3,h=this.vga_addr_to_pixel(b+g);b=h/this.virtual_width|
0;var k=h%this.virtual_width+c;h=this.scan_line_to_screen_row(1+this.line_compare);h=Math.min(h,this.screen_height);var y=this.screen_height-h;this.layers=[];k=-k;for(var u=0;k<this.screen_width;k+=this.virtual_width,u++)this.layers.push({image_data:this.image_data,screen_x:k,screen_y:0,buffer_x:0,buffer_y:b+u,buffer_width:this.virtual_width,buffer_height:h});b=0;this.attribute_mode&32||(b=this.vga_addr_to_pixel(g)+c);k=-b;for(u=0;k<this.screen_width;k+=this.virtual_width,u++)this.layers.push({image_data:this.image_data,
screen_x:k,screen_y:h,buffer_x:0,buffer_y:u,buffer_width:this.virtual_width,buffer_height:y})}};E.prototype.update_vertical_retrace=function(){this.port_3DA_value|=8;this.start_address_latched!==this.start_address&&(this.start_address_latched=this.start_address,this.update_layers())};E.prototype.update_cursor_scanline=function(){this.bus.send("screen-update-cursor-scanline",[this.cursor_scanline_start,this.cursor_scanline_end])};E.prototype.port3C0_write=function(b){if(-1===this.attribute_controller_index)r("attribute controller index register: "+
d(b),256),this.attribute_controller_index=b&31,r("attribute actual index: "+d(this.attribute_controller_index),256),this.palette_source!==(b&32)&&(this.palette_source=b&32,this.update_layers());else{if(16>this.attribute_controller_index)r("internal palette: "+d(this.attribute_controller_index)+" -> "+d(b),256),this.dac_map[this.attribute_controller_index]=b,this.attribute_mode&64||this.complete_redraw();else switch(this.attribute_controller_index){case 16:r("3C0 / attribute mode control: "+d(b),256);
if(this.attribute_mode!==b){var c=this.attribute_mode;this.attribute_mode=b;var g=0<(b&1);this.svga_enabled||this.graphical_mode===g||(this.graphical_mode=g,this.bus.send("screen-set-mode",this.graphical_mode));(c^b)&64&&this.complete_replot();this.update_vga_size();this.complete_redraw()}break;case 18:r("3C0 / color plane enable: "+d(b),256);this.color_plane_enable!==b&&(this.color_plane_enable=b,this.complete_redraw());break;case 19:r("3C0 / horizontal panning: "+d(b),256);this.horizontal_panning!==
b&&(this.horizontal_panning=b&15,this.update_layers());break;case 20:r("3C0 / color select: "+d(b),256);this.color_select!==b&&(this.color_select=b,this.complete_redraw());break;default:r("3C0 / attribute controller write "+d(this.attribute_controller_index)+": "+d(b),256)}this.attribute_controller_index=-1}};E.prototype.port3C0_read=function(){r("3C0 read",256);return this.attribute_controller_index|this.palette_source};E.prototype.port3C0_read16=function(){r("3C0 read16",256);return this.port3C0_read()&
255|this.port3C1_read()<<8&65280};E.prototype.port3C1_read=function(){if(16>this.attribute_controller_index)return r("3C1 / internal palette read: "+d(this.attribute_controller_index)+" -> "+d(this.dac_map[this.attribute_controller_index]),256),this.dac_map[this.attribute_controller_index]&255;switch(this.attribute_controller_index){case 16:return r("3C1 / attribute mode read: "+d(this.attribute_mode),256),this.attribute_mode;case 18:return r("3C1 / color plane enable read: "+d(this.color_plane_enable),
256),this.color_plane_enable;case 19:return r("3C1 / horizontal panning read: "+d(this.horizontal_panning),256),this.horizontal_panning;case 20:return r("3C1 / color select read: "+d(this.color_select),256),this.color_select;default:r("3C1 / attribute controller read "+d(this.attribute_controller_index),256)}return 255};E.prototype.port3C2_write=function(b){r("3C2 / miscellaneous output register = "+d(b),256);this.miscellaneous_output_register=b};E.prototype.port3C4_write=function(b){this.sequencer_index=
b};E.prototype.port3C4_read=function(){return this.sequencer_index};E.prototype.port3C5_write=function(b){switch(this.sequencer_index){case 1:r("clocking mode: "+d(b),256);var c=this.clocking_mode;this.clocking_mode=b;(c^b)&32&&this.update_layers();break;case 2:r("plane write mask: "+d(b),256);this.plane_write_bm=b;break;case 4:r("sequencer memory mode: "+d(b),256);this.sequencer_memory_mode=b;break;default:r("3C5 / sequencer write "+d(this.sequencer_index)+": "+d(b),256)}};E.prototype.port3C5_read=
function(){r("3C5 / sequencer read "+d(this.sequencer_index),256);switch(this.sequencer_index){case 1:return this.clocking_mode;case 2:return this.plane_write_bm;case 4:return this.sequencer_memory_mode;case 6:return 18}return 0};E.prototype.port3C6_write=function(b){this.dac_mask=b};E.prototype.port3C6_read=function(){return this.dac_mask};E.prototype.port3C7_write=function(b){r("3C7 write: "+d(b),256);this.dac_color_index_read=3*b;this.dac_state&=0};E.prototype.port3C7_read=function(){return this.dac_state};
E.prototype.port3C8_write=function(b){this.dac_color_index_write=3*b;this.dac_state|=3};E.prototype.port3C8_read=function(){return this.dac_color_index_write/3&255};E.prototype.port3C9_write=function(b){var c=this.dac_color_index_write/3|0,g=this.dac_color_index_write%3,h=this.vga256_palette[c];if(0===(this.dispi_enable_value&32)){b&=63;const k=b&1;b=b<<2|k<<1|k}0===g?h=h&-16711681|b<<16:1===g?h=h&-65281|b<<8:(h=h&-256|b,r("dac set color, index="+d(c)+" value="+d(h),256));this.vga256_palette[c]!==
h&&(this.vga256_palette[c]=h,this.complete_redraw());this.dac_color_index_write++};E.prototype.port3C9_read=function(){r("3C9 read",256);var b=this.vga256_palette[this.dac_color_index_read/3|0]>>8*(2-this.dac_color_index_read%3)&255;this.dac_color_index_read++;return this.dispi_enable_value&32?b:b>>2};E.prototype.port3CC_read=function(){r("3CC read",256);return this.miscellaneous_output_register};E.prototype.port3CE_write=function(b){this.graphics_index=b};E.prototype.port3CE_read=function(){return this.graphics_index};
E.prototype.port3CF_write=function(b){switch(this.graphics_index){case 0:this.planar_setreset=b;r("plane set/reset: "+d(b),256);break;case 1:this.planar_setreset_enable=b;r("plane set/reset enable: "+d(b),256);break;case 2:this.color_compare=b;r("color compare: "+d(b),256);break;case 3:this.planar_rotate_reg=b;r("plane rotate: "+d(b),256);break;case 4:this.plane_read=b;r("plane read: "+d(b),256);break;case 5:var c=this.planar_mode;this.planar_mode=b;r("planar mode: "+d(b),256);(c^b)&96&&this.complete_replot();
break;case 6:r("miscellaneous graphics register: "+d(b),256);this.miscellaneous_graphics_register!==b&&(this.miscellaneous_graphics_register=b,this.update_vga_size());break;case 7:this.color_dont_care=b;r("color don't care: "+d(b),256);break;case 8:this.planar_bitmap=b;r("planar bitmap: "+d(b),256);break;default:r("3CF / graphics write "+d(this.graphics_index)+": "+d(b),256)}};E.prototype.port3CF_read=function(){r("3CF / graphics read "+d(this.graphics_index),256);switch(this.graphics_index){case 0:return this.planar_setreset;
case 1:return this.planar_setreset_enable;case 2:return this.color_compare;case 3:return this.planar_rotate_reg;case 4:return this.plane_read;case 5:return this.planar_mode;case 6:return this.miscellaneous_graphics_register;case 7:return this.color_dont_care;case 8:return this.planar_bitmap}return 0};E.prototype.port3D4_write=function(b){r("3D4 / crtc index: "+b,256);this.index_crtc=b};E.prototype.port3D4_read=function(){r("3D4 read / crtc index: "+this.index_crtc,256);return this.index_crtc};E.prototype.port3D5_write=
function(b){switch(this.index_crtc){case 1:r("3D5 / hdisp enable end write: "+d(b),256);this.horizontal_display_enable_end!==b&&(this.horizontal_display_enable_end=b,this.update_vga_size());break;case 2:this.horizontal_blank_start!==b&&(this.horizontal_blank_start=b,this.update_vga_size());break;case 7:r("3D5 / overflow register write: "+d(b),256);var c=this.vertical_display_enable_end;this.vertical_display_enable_end&=255;this.vertical_display_enable_end=this.vertical_display_enable_end|b<<3&512|
b<<7&256;c!=this.vertical_display_enable_end&&this.update_vga_size();this.line_compare=this.line_compare&767|b<<4&256;c=this.vertical_blank_start;this.vertical_blank_start=this.vertical_blank_start&767|b<<5&256;c!==this.vertical_blank_start&&this.update_vga_size();this.update_layers();break;case 8:r("3D5 / preset row scan write: "+d(b),256);this.preset_row_scan=b;this.update_layers();break;case 9:r("3D5 / max scan line write: "+d(b),256);this.max_scan_line=b;this.line_compare=this.line_compare&511|
b<<3&512;c=this.vertical_blank_start;this.vertical_blank_start=this.vertical_blank_start&511|b<<4&512;c!==this.vertical_blank_start&&this.update_vga_size();this.update_layers();break;case 10:r("3D5 / cursor scanline start write: "+d(b),256);this.cursor_scanline_start=b;this.update_cursor_scanline();break;case 11:r("3D5 / cursor scanline end write: "+d(b),256);this.cursor_scanline_end=b;this.update_cursor_scanline();break;case 12:(this.start_address>>8&255)!==b&&(this.start_address=this.start_address&
255|b<<8,this.update_layers(),~this.crtc_mode&3&&this.complete_replot());r("3D5 / start addr hi write: "+d(b)+" -> "+d(this.start_address,4),256);break;case 13:(this.start_address&255)!==b&&(this.start_address=this.start_address&65280|b,this.update_layers(),~this.crtc_mode&3&&this.complete_replot());r("3D5 / start addr lo write: "+d(b)+" -> "+d(this.start_address,4),256);break;case 14:r("3D5 / cursor address hi write: "+d(b),256);this.cursor_address=this.cursor_address&255|b<<8;this.update_cursor();
break;case 15:r("3D5 / cursor address lo write: "+d(b),256);this.cursor_address=this.cursor_address&65280|b;this.update_cursor();break;case 18:r("3D5 / vdisp enable end write: "+d(b),256);(this.vertical_display_enable_end&255)!==b&&(this.vertical_display_enable_end=this.vertical_display_enable_end&768|b,this.update_vga_size());break;case 19:r("3D5 / offset register write: "+d(b),256);this.offset_register!==b&&(this.offset_register=b,this.update_vga_size(),~this.crtc_mode&3&&this.complete_replot());
break;case 20:r("3D5 / underline location write: "+d(b),256);this.underline_location_register!==b&&(c=this.underline_location_register,this.underline_location_register=b,this.update_vga_size(),(c^b)&64&&this.complete_replot());break;case 21:r("3D5 / vertical blank start write: "+d(b),256);(this.vertical_blank_start&255)!==b&&(this.vertical_blank_start=this.vertical_blank_start&768|b,this.update_vga_size());break;case 23:r("3D5 / crtc mode write: "+d(b),256);this.crtc_mode!==b&&(c=this.crtc_mode,this.crtc_mode=
b,this.update_vga_size(),(c^b)&67&&this.complete_replot());break;case 24:r("3D5 / line compare write: "+d(b),256);this.line_compare=this.line_compare&768|b;this.update_layers();break;default:this.index_crtc<this.crtc.length&&(this.crtc[this.index_crtc]=b),r("3D5 / CRTC write "+d(this.index_crtc)+": "+d(b),256)}};E.prototype.port3D5_read=function(){r("3D5 read "+d(this.index_crtc),256);switch(this.index_crtc){case 1:return this.horizontal_display_enable_end;case 2:return this.horizontal_blank_start;
case 7:return this.vertical_display_enable_end>>7&2|this.vertical_blank_start>>5&8|this.line_compare>>4&16|this.vertical_display_enable_end>>3&64;case 8:return this.preset_row_scan;case 9:return this.max_scan_line;case 10:return this.cursor_scanline_start;case 11:return this.cursor_scanline_end;case 12:return this.start_address&255;case 13:return this.start_address>>8;case 14:return this.cursor_address>>8;case 15:return this.cursor_address&255;case 18:return this.vertical_display_enable_end&255;case 19:return this.offset_register;
case 20:return this.underline_location_register;case 21:return this.vertical_blank_start&255;case 23:return this.crtc_mode;case 24:return this.line_compare&255}return this.index_crtc<this.crtc.length?this.crtc[this.index_crtc]:0};E.prototype.port3DA_read=function(){r("3DA read - status 1 and clear attr index",256);var b=this.port_3DA_value;this.graphical_mode?(this.port_3DA_value^=1,this.port_3DA_value&=1):(this.port_3DA_value&1&&(this.port_3DA_value^=8),this.port_3DA_value^=1);this.attribute_controller_index=
-1;return b};E.prototype.port1CE_write=function(b){this.dispi_index=b};E.prototype.port1CF_write=function(b){r("1CF / dispi write "+d(this.dispi_index)+": "+d(b),256);switch(this.dispi_index){case 0:45248<=b&&45253>=b?this.svga_version=b:r("Invalid version value: "+d(b),256);break;case 1:this.svga_width=b;2560<this.svga_width&&(r("svga_width reduced from "+this.svga_width+" to 2560",256),this.svga_width=2560);break;case 2:this.svga_height=b;1600<this.svga_height&&(r("svga_height reduced from "+this.svga_height+
" to 1600",256),this.svga_height=1600);break;case 3:this.svga_bpp=b;break;case 4:this.svga_enabled=1===(b&1);this.dispi_enable_value=b;break;case 5:r("SVGA bank offset: "+d(b<<16),256);this.svga_bank_offset=b<<16;break;case 9:const c=b*this.svga_width;r("SVGA offset: "+d(c)+" y="+d(b),256);this.svga_offset!==c&&(this.svga_offset=c,this.complete_redraw())}!this.svga_enabled||this.svga_width&&this.svga_height||(r("SVGA: disabled because of invalid width/height: "+this.svga_width+"x"+this.svga_height,
256),this.svga_enabled=!1);H(4!==this.svga_bpp,"unimplemented svga bpp: 4");H(4===this.svga_bpp||8===this.svga_bpp||15===this.svga_bpp||16===this.svga_bpp||24===this.svga_bpp||32===this.svga_bpp,"unexpected svga bpp: "+this.svga_bpp);r("SVGA: enabled="+this.svga_enabled+", "+this.svga_width+"x"+this.svga_height+"x"+this.svga_bpp,256);this.svga_enabled&&4===this.dispi_index&&(this.set_size_graphical(this.svga_width,this.svga_height,this.svga_bpp,this.svga_width,this.svga_height),this.bus.send("screen-set-mode",
!0),this.graphical_mode_is_linear=this.graphical_mode=!0);this.svga_enabled||(this.svga_bank_offset=0);this.update_layers()};E.prototype.port1CF_read=function(){r("1CF / dispi read "+d(this.dispi_index),256);return this.svga_register_read(this.dispi_index)};E.prototype.svga_register_read=function(b){switch(b){case 0:return this.svga_version;case 1:return this.dispi_enable_value&2?2560:this.svga_width;case 2:return this.dispi_enable_value&2?1600:this.svga_height;case 3:return this.dispi_enable_value&
2?32:this.svga_bpp;case 4:return this.dispi_enable_value;case 5:return this.svga_bank_offset>>>16;case 6:return this.screen_width?this.screen_width:1;case 8:return 0;case 10:return this.vga_memory_size/65536|0}return 255};E.prototype.vga_replot=function(){for(var b=this.diff_plot_min&-16,c=Math.min(this.diff_plot_max|15,524287),g=this.vga_addr_shift_count(),h=~this.crtc_mode&3,k=this.planar_mode&96,y=this.attribute_mode&64;b<=c;){var u=b>>>g;if(h){var I=b/this.virtual_width|0,ba=b-this.virtual_width*
I;switch(h){case 1:u=(I&1)<<13;I>>>=1;break;case 2:u=(I&1)<<14;I>>>=1;break;case 3:u=(I&3)<<13,I>>>=2}u|=(I*this.virtual_width+ba>>>g)+this.start_address}I=this.plane0[u];ba=this.plane1[u];var R=this.plane2[u],U=this.plane3[u];u=new Uint8Array(8);switch(k){case 0:I<<=0;ba<<=1;R<<=2;U<<=3;for(var Y=7;0<=Y;Y--)u[7-Y]=I>>Y&1|ba>>Y&2|R>>Y&4|U>>Y&8;break;case 32:u[0]=I>>6&3|R>>4&12;u[1]=I>>4&3|R>>2&12;u[2]=I>>2&3|R>>0&12;u[3]=I>>0&3|R<<2&12;u[4]=ba>>6&3|U>>4&12;u[5]=ba>>4&3|U>>2&12;u[6]=ba>>2&3|U>>0&12;
u[7]=ba>>0&3|U<<2&12;break;case 64:case 96:u[0]=I>>4&15,u[1]=I>>0&15,u[2]=ba>>4&15,u[3]=ba>>0&15,u[4]=R>>4&15,u[5]=R>>0&15,u[6]=U>>4&15,u[7]=U>>0&15}if(y)for(I=Y=0;4>Y;Y++,b++,I+=2)this.pixel_buffer[b]=u[I]<<4|u[I+1];else for(Y=0;8>Y;Y++,b++)this.pixel_buffer[b]=u[Y]}};E.prototype.vga_redraw=function(){var b=this.diff_addr_min,c=Math.min(this.diff_addr_max,524287);const g=new Int32Array(this.cpu.wasm_memory.buffer,this.dest_buffet_offset,this.virtual_width*this.virtual_height);var h=255,k=0;this.attribute_mode&
128&&(h&=207,k|=this.color_select<<4&48);if(this.attribute_mode&64)for(;b<=c;b++){var y=this.pixel_buffer[b]&h|k;y=this.vga256_palette[y];g[b]=y&65280|y<<16|y>>16|4278190080}else for(h&=63,k|=this.color_select<<4&192;b<=c;b++)y=this.dac_map[this.pixel_buffer[b]&this.color_plane_enable]&h|k,y=this.vga256_palette[y],g[b]=y&65280|y<<16|y>>16|4278190080};E.prototype.screen_fill_buffer=function(){if(this.graphical_mode){if(0===this.image_data.data.byteLength){var b=new Uint8ClampedArray(this.cpu.wasm_memory.buffer,
this.dest_buffet_offset,4*this.virtual_width*this.virtual_height);this.image_data=new ImageData(b,this.virtual_width,this.virtual_height);this.update_layers()}if(this.svga_enabled){b=0;let h=this.svga_height;if(8===this.svga_bpp){const k=new Int32Array(this.cpu.wasm_memory.buffer,this.dest_buffet_offset,this.screen_width*this.screen_height),y=new Uint8Array(this.cpu.wasm_memory.buffer,this.svga_memory.byteOffset,this.vga_memory_size);for(var c=0;c<k.length;c++){var g=this.vga256_palette[y[c]];k[c]=
g&65280|g<<16|g>>16|4278190080}}else this.cpu.svga_fill_pixel_buffer(this.svga_bpp,this.svga_offset),c=15===this.svga_bpp?2:this.svga_bpp/8,b=((this.cpu.svga_dirty_bitmap_min_offset[0]/c|0)-this.svga_offset)/this.svga_width|0,h=(((this.cpu.svga_dirty_bitmap_max_offset[0]/c|0)-this.svga_offset)/this.svga_width|0)+1;b<h&&(b=Math.max(b,0),h=Math.min(h,this.svga_height),this.bus.send("screen-fill-buffer-end",[{image_data:this.image_data,screen_x:0,screen_y:b,buffer_x:0,buffer_y:b,buffer_width:this.svga_width,
buffer_height:h-b}]))}else this.vga_replot(),this.vga_redraw(),this.bus.send("screen-fill-buffer-end",this.layers);this.reset_diffs()}this.update_vertical_retrace()};M.prototype.get_state=function(){var b=[];b[0]=this.enable_mouse_stream;b[1]=this.use_mouse;b[2]=this.have_mouse;b[3]=this.mouse_delta_x;b[4]=this.mouse_delta_y;b[5]=this.mouse_clicks;b[6]=this.have_keyboard;b[7]=this.enable_keyboard_stream;b[8]=this.next_is_mouse_command;b[9]=this.next_read_sample;b[10]=this.next_read_led;b[11]=this.next_handle_scan_code_set;
b[12]=this.next_read_rate;b[13]=this.next_read_resolution;b[15]=this.last_port60_byte;b[16]=this.sample_rate;b[17]=this.resolution;b[18]=this.scaling2;b[20]=this.command_register;b[21]=this.read_output_register;b[22]=this.read_command_register;b[23]=this.controller_output_port;b[24]=this.read_controller_output_port;b[25]=this.mouse_id;b[26]=this.mouse_detect_state;b[27]=this.mouse_reset_workaround;return b};M.prototype.set_state=function(b){this.enable_mouse_stream=b[0];this.use_mouse=b[1];this.have_mouse=
b[2];this.mouse_delta_x=b[3];this.mouse_delta_y=b[4];this.mouse_clicks=b[5];this.have_keyboard=b[6];this.enable_keyboard_stream=b[7];this.next_is_mouse_command=b[8];this.next_read_sample=b[9];this.next_read_led=b[10];this.next_handle_scan_code_set=b[11];this.next_read_rate=b[12];this.next_read_resolution=b[13];this.last_port60_byte=b[15];this.sample_rate=b[16];this.resolution=b[17];this.scaling2=b[18];this.command_register=b[20];this.read_output_register=b[21];this.read_command_register=b[22];this.controller_output_port=
b[23];this.read_controller_output_port=b[24];this.mouse_id=b[25]||0;this.mouse_detect_state=b[26]||0;this.mouse_reset_workaround=b[27]||!1;this.next_byte_is_aux=this.next_byte_is_ready=!1;this.kbd_buffer.clear();this.mouse_buffer.clear();this.bus.send("mouse-enable",this.use_mouse)};M.prototype.raise_irq=function(){this.next_byte_is_ready||(this.kbd_buffer.length?this.kbd_irq():this.mouse_buffer.length&&this.mouse_irq())};M.prototype.mouse_irq=function(){this.next_byte_is_aux=this.next_byte_is_ready=
!0;this.command_register&2&&(r("Mouse irq",64),this.cpu.device_lower_irq(12),this.cpu.device_raise_irq(12))};M.prototype.kbd_irq=function(){this.next_byte_is_ready=!0;this.next_byte_is_aux=!1;this.command_register&1&&(r("Keyboard irq",64),this.cpu.device_lower_irq(1),this.cpu.device_raise_irq(1))};M.prototype.kbd_send_code=function(b){this.enable_keyboard_stream&&(r("adding kbd code: "+d(b),64),this.kbd_buffer.push(b),this.raise_irq())};M.prototype.mouse_send_delta=function(b,c){if(this.have_mouse&&
this.use_mouse){var g=this.resolution*this.sample_rate/80;this.mouse_delta_x+=b*g;this.mouse_delta_y+=c*g;this.enable_mouse_stream&&(b=this.mouse_delta_x|0,c=this.mouse_delta_y|0,b||c)&&(Date.now(),this.mouse_delta_x-=b,this.mouse_delta_y-=c,this.send_mouse_packet(b,c))}};M.prototype.mouse_send_click=function(b,c,g){this.have_mouse&&this.use_mouse&&(this.mouse_clicks=b|g<<1|c<<2,this.enable_mouse_stream&&this.send_mouse_packet(0,0))};M.prototype.send_mouse_packet=function(b,c){var g=(0>c)<<5|(0>b)<<
4|8|this.mouse_clicks;this.last_mouse_packet=Date.now();this.mouse_buffer.push(g);this.mouse_buffer.push(b);this.mouse_buffer.push(c);4===this.mouse_id?(this.mouse_buffer.push(0|this.wheel_movement&15),this.wheel_movement=0):3===this.mouse_id&&(this.mouse_buffer.push(this.wheel_movement&255),this.wheel_movement=0);this.raise_irq()};M.prototype.apply_scaling2=function(b){var c=b>>31;switch(Math.abs(b)){case 0:case 1:case 3:return b;case 2:return c;case 4:return 6*c;case 5:return 9*c;default:return b<<
1}};M.prototype.port60_read=function(){this.next_byte_is_ready=!1;if(!this.kbd_buffer.length&&!this.mouse_buffer.length)return r("Port 60 read: Empty",64),this.last_port60_byte;this.next_byte_is_aux?(this.cpu.device_lower_irq(12),this.last_port60_byte=this.mouse_buffer.shift(),r("Port 60 read (mouse): "+d(this.last_port60_byte),64)):(this.cpu.device_lower_irq(1),this.last_port60_byte=this.kbd_buffer.shift(),r("Port 60 read (kbd)  : "+d(this.last_port60_byte),64));(this.kbd_buffer.length||this.mouse_buffer.length)&&
this.raise_irq();return this.last_port60_byte};M.prototype.port64_read=function(){var b=16;this.next_byte_is_ready&&(b|=1);this.next_byte_is_aux&&(b|=32);r("port 64 read: "+d(b),64);return b};M.prototype.port60_write=function(b){r("port 60 write: "+d(b),64);if(this.read_command_register)this.command_register=b,this.read_command_register=!1,r("Keyboard command register = "+d(this.command_register),64);else if(this.read_output_register)this.read_output_register=!1,this.mouse_buffer.clear(),this.mouse_buffer.push(b),
this.mouse_irq();else if(this.next_read_sample){this.next_read_sample=!1;this.mouse_buffer.clear();this.mouse_buffer.push(250);this.sample_rate=b;switch(this.mouse_detect_state){case -1:60===b?(this.mouse_reset_workaround=!0,this.mouse_detect_state=0):(this.mouse_reset_workaround=!1,this.mouse_detect_state=200===b?1:0);break;case 0:200===b&&(this.mouse_detect_state=1);break;case 1:this.mouse_detect_state=100===b?2:200===b?3:0;break;case 2:80===b&&(this.mouse_id=3);this.mouse_detect_state=-1;break;
case 3:80===b&&(this.mouse_id=4),this.mouse_detect_state=-1}r("mouse sample rate: "+d(b)+", mouse id: "+d(this.mouse_id),64);this.sample_rate||(r("invalid sample rate, reset to 100",64),this.sample_rate=100);this.mouse_irq()}else if(this.next_read_resolution)this.next_read_resolution=!1,this.mouse_buffer.clear(),this.mouse_buffer.push(250),3<b?(this.resolution=4,r("invalid resolution, resetting to 4",64)):(this.resolution=1<<b,r("resolution: "+this.resolution,64)),this.mouse_irq();else if(this.next_read_led)this.next_read_led=
!1,this.kbd_buffer.push(250),this.kbd_irq();else if(this.next_handle_scan_code_set)this.next_handle_scan_code_set=!1,this.kbd_buffer.push(250),this.kbd_irq(),b||this.kbd_buffer.push(2);else if(this.next_read_rate)this.next_read_rate=!1,this.kbd_buffer.push(250),this.kbd_irq();else if(this.next_is_mouse_command){if(this.next_is_mouse_command=!1,r("Port 60 data register write: "+d(b),64),this.have_mouse){this.kbd_buffer.clear();this.mouse_buffer.clear();this.mouse_buffer.push(250);switch(b){case 230:r("Scaling 1:1",
64);this.scaling2=!1;break;case 231:r("Scaling 2:1",64);this.scaling2=!0;break;case 232:this.next_read_resolution=!0;break;case 233:this.send_mouse_packet(0,0);break;case 235:r("unimplemented request single packet",64);this.send_mouse_packet(0,0);break;case 242:r("required id: "+d(this.mouse_id),64);this.mouse_buffer.push(this.mouse_id);this.mouse_clicks=this.mouse_delta_x=this.mouse_delta_y=0;this.raise_irq();break;case 243:this.next_read_sample=!0;break;case 244:this.use_mouse=this.enable_mouse_stream=
!0;this.bus.send("mouse-enable",!0);this.mouse_clicks=this.mouse_delta_x=this.mouse_delta_y=0;break;case 245:this.enable_mouse_stream=!1;break;case 246:this.enable_mouse_stream=!1;this.sample_rate=100;this.scaling2=!1;this.resolution=4;break;case 255:r("Mouse reset",64);this.mouse_buffer.push(170);this.mouse_buffer.push(0);this.use_mouse=!0;this.bus.send("mouse-enable",!0);this.enable_mouse_stream=!1;this.sample_rate=100;this.scaling2=!1;this.resolution=4;this.mouse_reset_workaround||(this.mouse_id=
0);this.mouse_clicks=this.mouse_delta_x=this.mouse_delta_y=0;break;default:r("Unimplemented mouse command: "+d(b),64)}this.mouse_irq()}}else if(this.read_controller_output_port)this.read_controller_output_port=!1,this.controller_output_port=b;else{r("Port 60 data register write: "+d(b),64);this.mouse_buffer.clear();this.kbd_buffer.clear();this.kbd_buffer.push(250);switch(b){case 237:this.next_read_led=!0;break;case 240:this.next_handle_scan_code_set=!0;break;case 242:this.kbd_buffer.push(171);this.kbd_buffer.push(83);
break;case 243:this.next_read_rate=!0;break;case 244:r("kbd enable scanning",64);this.enable_keyboard_stream=!0;break;case 245:r("kbd disable scanning",64);this.enable_keyboard_stream=!1;break;case 246:break;case 255:this.kbd_buffer.clear();this.kbd_buffer.push(250);this.kbd_buffer.push(170);this.kbd_buffer.push(0);break;default:r("Unimplemented keyboard command: "+d(b),64)}this.kbd_irq()}};M.prototype.port64_write=function(b){r("port 64 write: "+d(b),64);switch(b){case 32:this.kbd_buffer.clear();
this.mouse_buffer.clear();this.kbd_buffer.push(this.command_register);this.kbd_irq();break;case 96:this.read_command_register=!0;break;case 209:this.read_controller_output_port=!0;break;case 211:this.read_output_register=!0;break;case 212:this.next_is_mouse_command=!0;break;case 167:r("Disable second port",64);this.command_register|=32;break;case 168:r("Enable second port",64);this.command_register&=-33;break;case 169:this.kbd_buffer.clear();this.mouse_buffer.clear();this.kbd_buffer.push(0);this.kbd_irq();
break;case 170:this.kbd_buffer.clear();this.mouse_buffer.clear();this.kbd_buffer.push(85);this.kbd_irq();break;case 171:this.kbd_buffer.clear();this.mouse_buffer.clear();this.kbd_buffer.push(0);this.kbd_irq();break;case 173:r("Disable Keyboard",64);this.command_register|=16;break;case 174:r("Enable Keyboard",64);this.command_register&=-17;break;case 254:r("CPU reboot via PS2");this.cpu.reboot_internal();break;default:r("port 64: Unimplemented command byte: "+d(b),64)}};J.prototype.get_state=function(){var b=
[];b[0]=this.irq_mask;b[1]=this.irq_map;b[2]=this.isr;b[3]=this.irr;b[4]=this.is_master;b[5]=this.slave;b[6]=this.expect_icw4;b[7]=this.state;b[8]=this.read_isr;b[9]=this.auto_eoi;b[10]=this.elcr;return b};J.prototype.set_state=function(b){this.irq_mask=b[0];this.irq_map=b[1];this.isr=b[2];this.irr=b[3];this.is_master=b[4];this.slave&&this.slave.set_state(b[5]);this.expect_icw4=b[6];this.state=b[7];this.read_isr=b[8];this.auto_eoi=b[9];this.elcr=b[10]};J.prototype.port20_write=function(b){if(b&16)r("icw1 = "+
d(b),128),this.irq_value=this.irq_mask=this.irr=this.isr=0,this.auto_eoi=1,this.requested_irq=-1,this.expect_icw4=b&1,this.state=1;else if(b&8)r("ocw3: "+d(b),128),b&2&&(this.read_isr=b&1),b&4&&H(!1,"unimplemented: polling",128),b&64&&(this.special_mask_mode=32===(b&32),r("special mask mode: "+this.special_mask_mode,128));else{r("eoi: "+d(b)+" ("+this.name+")",128);var c=b>>5;1===c?(this.isr&=this.isr-1,r("new isr: "+d(this.isr,2),128)):3===c?this.isr&=~(1<<(b&7)):192===(b&200)?r("lowest priority: "+
d(b&7),128):(r("Unknown eoi: "+d(b),128),H(!1),this.isr&=this.isr-1);this.check_irqs()}};J.prototype.port20_read=function(){if(this.read_isr)return r("read port 20h (isr): "+d(this.isr),128),this.isr;r("read port 20h (irr): "+d(this.irr),128);return this.irr};J.prototype.port21_write=function(b){0===this.state?this.expect_icw4?(this.expect_icw4=!1,this.auto_eoi=b&2,r("icw4: "+d(b)+" autoeoi="+this.auto_eoi,128),0===(b&1)&&H(!1,"unimplemented: not 8086 mode",128)):(this.irq_mask=~b,this.check_irqs()):
1===this.state?(this.irq_map=b,r("interrupts are mapped to "+d(this.irq_map)+" ("+this.name+")",128),this.state++):2===this.state&&(this.state=0,r("icw3: "+d(b),128))};J.prototype.port21_read=function(){r("21h read "+d(~this.irq_mask&255),128);return~this.irq_mask&255};J.prototype.port4D0_read=function(){r("elcr read: "+d(this.elcr,2),128);return this.elcr};J.prototype.port4D0_write=function(b){r("elcr write: "+d(b,2),128);this.elcr=b};var za=16,Ha=18,ab=27,Ma=57;X.prototype.get_state=function(){var b=
[];b[0]=this.cmos_index;b[1]=this.cmos_data;b[2]=this.rtc_time;b[3]=this.last_update;b[4]=this.next_interrupt;b[5]=this.next_interrupt_alarm;b[6]=this.periodic_interrupt;b[7]=this.periodic_interrupt_time;b[8]=this.cmos_a;b[9]=this.cmos_b;b[10]=this.cmos_c;b[11]=this.nmi_disabled;return b};X.prototype.set_state=function(b){this.cmos_index=b[0];this.cmos_data=b[1];this.rtc_time=b[2];this.last_update=b[3];this.next_interrupt=b[4];this.next_interrupt_alarm=b[5];this.periodic_interrupt=b[6];this.periodic_interrupt_time=
b[7];this.cmos_a=b[8];this.cmos_b=b[9];this.cmos_c=b[10];this.nmi_disabled=b[11]};X.prototype.timer=function(b,c){b=Date.now();this.rtc_time+=b-this.last_update;this.last_update=b;this.periodic_interrupt&&this.next_interrupt<b?(this.cpu.device_raise_irq(8),this.cmos_c|=192,this.next_interrupt+=this.periodic_interrupt_time*Math.ceil((b-this.next_interrupt)/this.periodic_interrupt_time)):this.next_interrupt_alarm&&this.next_interrupt_alarm<b&&(this.cpu.device_raise_irq(8),this.cmos_c|=160,this.next_interrupt_alarm=
0);c=100;this.periodic_interrupt&&this.next_interrupt&&(c=Math.min(c,Math.max(0,this.next_interrupt-b)));this.next_interrupt_alarm&&(c=Math.min(c,Math.max(0,this.next_interrupt_alarm-b)));return c};X.prototype.bcd_pack=function(b){for(var c=0,g=0,h;b;)h=b%10,g|=h<<4*c,c++,b=(b-h)/10;return g};X.prototype.bcd_unpack=function(b){const c=b&15,g=b>>4&15;H(256>b);H(10>c);H(10>g);return c+10*g};X.prototype.encode_time=function(b){return this.cmos_b&4?b:this.bcd_pack(b)};X.prototype.decode_time=function(b){return this.cmos_b&
4?b:this.bcd_unpack(b)};X.prototype.cmos_port_read=function(){var b=this.cmos_index;switch(b){case 0:return this.encode_time((new Date(this.rtc_time)).getUTCSeconds());case 2:return this.encode_time((new Date(this.rtc_time)).getUTCMinutes());case 4:return this.encode_time((new Date(this.rtc_time)).getUTCHours());case 7:return this.encode_time((new Date(this.rtc_time)).getUTCDate());case 8:return this.encode_time((new Date(this.rtc_time)).getUTCMonth()+1);case 9:return this.encode_time((new Date(this.rtc_time)).getUTCFullYear()%
100);case 10:return 999<=f.microtick()%1E3?this.cmos_a|128:this.cmos_a;case 11:return this.cmos_b;case 12:return this.cpu.device_lower_irq(8),r("cmos reg C read",65536),b=this.cmos_c,this.cmos_c&=-241,b;case 13:return 0;case 50:return this.encode_time((new Date(this.rtc_time)).getUTCFullYear()/100|0);default:return r("cmos read from index "+d(b),65536),this.cmos_data[this.cmos_index]}};X.prototype.cmos_port_write=function(b){switch(this.cmos_index){case 10:this.cmos_a=b&127;this.periodic_interrupt_time=
1E3/(32768>>(this.cmos_a&15)-1);r("Periodic interrupt, a="+d(this.cmos_a,2)+" t="+this.periodic_interrupt_time,65536);break;case 11:this.cmos_b=b;this.cmos_b&64&&(this.next_interrupt=Date.now());if(this.cmos_b&32){b=new Date;const c=this.decode_time(this.cmos_data[1]),g=this.decode_time(this.cmos_data[3]),h=this.decode_time(this.cmos_data[5]),k=new Date(Date.UTC(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),h,g,c));r("RTC alarm scheduled for "+k+" hh:mm:ss="+h+":"+g+":"+c+" ms_from_now="+(k-b),
65536);this.next_interrupt_alarm=+k}this.cmos_b&16&&r("Unimplemented: updated interrupt",65536);r("cmos b="+d(this.cmos_b,2),65536);break;case 1:case 3:case 5:this.cmos_write(this.cmos_index,b);break;default:r("cmos write index "+d(this.cmos_index)+": "+d(b),65536)}this.periodic_interrupt=64===(this.cmos_b&64)&&0<(this.cmos_a&15)};X.prototype.cmos_read=function(b){H(128>b);return this.cmos_data[b]};X.prototype.cmos_write=function(b,c){r("cmos "+d(b)+" <- "+d(c),65536);H(128>b);this.cmos_data[b]=c};
ja.prototype.get_state=function(){var b=[];b[0]=this.ints;b[1]=this.baud_rate;b[2]=this.line_control;b[3]=this.lsr;b[4]=this.fifo_control;b[5]=this.ier;b[6]=this.iir;b[7]=this.modem_control;b[8]=this.modem_status;b[9]=this.scratch_register;b[10]=this.irq;return b};ja.prototype.set_state=function(b){this.ints=b[0];this.baud_rate=b[1];this.line_control=b[2];this.lsr=b[3];this.fifo_control=b[4];this.ier=b[5];this.iir=b[6];this.modem_control=b[7];this.modem_status=b[8];this.scratch_register=b[9];this.irq=
b[10]};ja.prototype.CheckInterrupt=function(){this.ints&4096&&this.ier&1?(this.iir=12,this.cpu.device_raise_irq(this.irq)):this.ints&16&&this.ier&1?(this.iir=4,this.cpu.device_raise_irq(this.irq)):this.ints&4&&this.ier&2?(this.iir=2,this.cpu.device_raise_irq(this.irq)):this.ints&1&&this.ier&8?(this.iir=0,this.cpu.device_raise_irq(this.irq)):(this.iir=1,this.cpu.device_lower_irq(this.irq))};ja.prototype.ThrowInterrupt=function(b){this.ints|=1<<b;this.CheckInterrupt()};ja.prototype.ClearInterrupt=function(b){this.ints&=
~(1<<b);this.CheckInterrupt()};ja.prototype.data_received=function(b){r("input: "+d(b),16384);this.input.push(b);this.lsr|=1;this.fifo_control&1?this.ThrowInterrupt(12):this.ThrowInterrupt(4)};ja.prototype.write_data=function(b){this.line_control&128?this.baud_rate=this.baud_rate&-256|b:(r("data: "+d(b),16384),this.ThrowInterrupt(2),255!==b&&(b=String.fromCharCode(b),this.bus.send("serial"+this.com+"-output-char",b),N&&(this.current_line+=b,"\n"===b&&(b=this.current_line.trimRight().replace(/[\x00-\x08\x0b-\x1f\x7f\x80-\xff]/g,
""),r("SERIAL: "+b),this.current_line=""))))};W.prototype.timer=function(b){b=this.get_timer(b);var c=0!==((b^this.last_timer)&8388608);this.pm1_enable&1&&c?(r("ACPI raise irq",262144),this.pm1_status|=1,this.cpu.device_raise_irq(9)):this.cpu.device_lower_irq(9);this.last_timer=b;return 100};W.prototype.get_timer=function(b){b=Math.round(3579.545*b);b===this.timer_last_value?3579.545>this.timer_imprecision_offset&&this.timer_imprecision_offset++:(H(b>this.timer_last_value),this.timer_last_value+this.timer_imprecision_offset<=
b?(this.timer_imprecision_offset=0,this.timer_last_value=b):r("Warning: Overshot pmtimer, waiting; current="+b+" last="+this.timer_last_value+" offset="+this.timer_imprecision_offset,262144));return this.timer_last_value+this.timer_imprecision_offset};W.prototype.get_state=function(){var b=[];b[0]=this.status;b[1]=this.pm1_status;b[2]=this.pm1_enable;b[3]=this.gpe;return b};W.prototype.set_state=function(b){this.status=b[0];this.pm1_status=b[1];this.pm1_enable=b[2];this.gpe=b[3]};var Ga="Fixed (0);Lowest Prio (1);SMI (2);Reserved (3);NMI (4);INIT (5);Reserved (6);ExtINT (7)".split(";"),
Ta=["physical","logical"];la.prototype.read32=function(b){b=b-4276092928|0;switch(b){case 32:return r("APIC read id",524288),this.apic_id;case 48:return r("APIC read version",524288),327700;case 128:return this.tpr;case 208:return r("Read local destination",524288),this.local_destination;case 224:return r("Read destination format",524288),this.destination_format;case 240:return this.spurious_vector;case 256:case 272:case 288:case 304:case 320:case 336:case 352:case 368:return b=b-256>>4,r("Read isr "+
b+": "+d(this.isr[b]>>>0,8),524288),this.isr[b];case 384:case 400:case 416:case 432:case 448:case 464:case 480:case 496:return b=b-384>>4,r("Read tmr "+b+": "+d(this.tmr[b]>>>0,8),524288),this.tmr[b];case 512:case 528:case 544:case 560:case 576:case 592:case 608:case 624:return b=b-512>>4,r("Read irr "+b+": "+d(this.irr[b]>>>0,8),524288),this.irr[b];case 640:return r("Read error: "+d(this.read_error>>>0,8),524288),this.read_error;case 768:return this.icr0;case 784:return r("APIC read icr1",524288),
this.icr1;case 800:return r("read timer lvt",524288),this.lvt_timer;case 832:return r("read lvt perf counter",524288),this.lvt_perf_counter;case 848:return r("read lvt int0",524288),this.lvt_int0;case 864:return r("read lvt int1",524288),this.lvt_int1;case 880:return r("read lvt error",524288),this.lvt_error;case 992:return r("read timer divider",524288),this.timer_divider;case 896:return r("read timer initial count",524288),this.timer_initial_count;case 912:return r("read timer current count: "+
d(this.timer_current_count>>>0,8),524288),this.timer_current_count;default:return r("APIC read "+d(b),524288),H(!1),0}};la.prototype.write32=function(b,c){b=b-4276092928|0;switch(b){case 48:r("APIC write version: "+d(c>>>0,8)+", ignored",524288);break;case 128:this.tpr=c&255;this.check_vector();break;case 176:b=this.highest_isr();-1!==b?(this.register_clear_bit(this.isr,b),this.register_get_bit(this.tmr,b)&&this.cpu.devices.ioapic.remote_eoi(b),this.check_vector()):r("Bad eoi: No isr set",524288);
break;case 208:r("Set local destination: "+d(c>>>0,8),524288);this.local_destination=c&4278190080;break;case 224:r("Set destination format: "+d(c>>>0,8),524288);this.destination_format=c|16777215;break;case 240:r("Set spurious vector: "+d(c>>>0,8),524288);this.spurious_vector=c;break;case 640:r("Write error: "+d(c>>>0,8),524288);this.read_error=this.error;this.error=0;break;case 768:b=c&255;var g=c>>8&7,h=c>>11&1,k=c>>15&1,y=c>>18&3,u=this.icr1>>>24;r("APIC write icr0: "+d(c,8)+" vector="+d(b,2)+
" destination_mode="+Ta[h]+" delivery_mode="+Ga[g]+" destination_shorthand="+["no","self","all with self","all without self"][y],524288);this.icr0=c&-4097;0===y?this.route(b,g,k,u,h):1===y?this.deliver(b,hb,k):2===y?this.deliver(b,g,k):3!==y&&H(!1);break;case 784:r("APIC write icr1: "+d(c>>>0,8),524288);this.icr1=c;break;case 800:r("timer lvt: "+d(c>>>0,8),524288);this.lvt_timer=c;break;case 832:r("lvt perf counter: "+d(c>>>0,8),524288);this.lvt_perf_counter=c;break;case 848:r("lvt int0: "+d(c>>>
0,8),524288);this.lvt_int0=c;break;case 864:r("lvt int1: "+d(c>>>0,8),524288);this.lvt_int1=c;break;case 880:r("lvt error: "+d(c>>>0,8),524288);this.lvt_error=c;break;case 992:r("timer divider: "+d(c>>>0,8),524288);this.timer_divider=c;c=c&3|(c&8)>>1;this.timer_divider_shift=7===c?0:c+1;break;case 896:r("timer initial: "+d(c>>>0,8),524288);this.timer_initial_count=c>>>0;this.timer_current_count=c>>>0;this.next_tick=f.microtick();this.timer_active=!0;break;case 912:r("timer current: "+d(c>>>0,8),524288);
H(!1,"read-only register");break;default:r("APIC write32 "+d(b)+" <- "+d(c>>>0,8),524288),H(!1)}};la.prototype.timer=function(b){if(0===this.timer_current_count)return 100;const c=1E6/(1<<this.timer_divider_shift);b=(b-this.next_tick)*c>>>0;this.next_tick+=b/c;this.timer_current_count-=b;0>=this.timer_current_count&&(b=this.lvt_timer&393216,131072===b?(this.timer_current_count%=this.timer_initial_count,0>=this.timer_current_count&&(this.timer_current_count+=this.timer_initial_count),H(0!==this.timer_current_count),
0===(this.lvt_timer&Wa)&&this.deliver(this.lvt_timer&255,hb,!1)):0===b&&(this.timer_current_count=0,r("APIC timer one shot end",524288),0===(this.lvt_timer&Wa)&&this.deliver(this.lvt_timer&255,hb,!1)));return Math.max(0,this.timer_current_count/c)};la.prototype.route=function(b,c,g,h,k){this.deliver(b,c,g)};la.prototype.deliver=function(b,c,g){c!==Nb&&c!==Kb&&((16>b||255===b)&&H(!1,"TODO: Invalid vector"),this.register_get_bit(this.irr,b)?r("Not delivered: irr already set, vector="+d(b,2),524288):
(this.register_set_bit(this.irr,b),g?this.register_set_bit(this.tmr,b):this.register_clear_bit(this.tmr,b),this.check_vector()))};la.prototype.highest_irr=function(){var b=this.register_get_highest_bit(this.irr);H(255!==b);H(16<=b||-1===b);return b};la.prototype.highest_isr=function(){var b=this.register_get_highest_bit(this.isr);H(255!==b);H(16<=b||-1===b);return b};la.prototype.check_vector=function(){var b=this.highest_irr();-1!==b&&(this.highest_isr()>=b||(b&240)<=(this.tpr&240)||this.cpu.handle_irqs())};
la.prototype.acknowledge_irq=function(){var b=this.highest_irr();-1!==b&&(this.highest_isr()>=b||(b&240)<=(this.tpr&240)||(this.register_clear_bit(this.irr,b),this.register_set_bit(this.isr,b),this.cpu.pic_call_irq(b),this.check_vector()))};la.prototype.get_state=function(){var b=[];b[0]=this.apic_id;b[1]=this.timer_divider;b[2]=this.timer_divider_shift;b[3]=this.timer_initial_count;b[4]=this.timer_current_count;b[5]=this.next_tick;b[6]=this.lvt_timer;b[7]=this.lvt_perf_counter;b[8]=this.lvt_int0;
b[9]=this.lvt_int1;b[10]=this.lvt_error;b[11]=this.tpr;b[12]=this.icr0;b[13]=this.icr1;b[14]=this.irr;b[15]=this.isr;b[16]=this.tmr;b[17]=this.spurious_vector;b[18]=this.destination_format;b[19]=this.local_destination;b[20]=this.error;b[21]=this.read_error;return b};la.prototype.set_state=function(b){this.apic_id=b[0];this.timer_divider=b[1];this.timer_divider_shift=b[2];this.timer_initial_count=b[3];this.timer_current_count=b[4];this.next_tick=b[5];this.lvt_timer=b[6];this.lvt_perf_counter=b[7];
this.lvt_int0=b[8];this.lvt_int1=b[9];this.lvt_error=b[10];this.tpr=b[11];this.icr0=b[12];this.icr1=b[13];this.irr=b[14];this.isr=b[15];this.tmr=b[16];this.spurious_vector=b[17];this.destination_format=b[18];this.local_destination=b[19];this.error=b[20];this.read_error=b[21]};la.prototype.register_get_bit=function(b,c){H(0<=c&&256>c);return b[c>>5]>>(c&31)&1};la.prototype.register_set_bit=function(b,c){H(0<=c&&256>c);b[c>>5]|=1<<(c&31)};la.prototype.register_clear_bit=function(b,c){H(0<=c&&256>c);
b[c>>5]&=~(1<<(c&31))};la.prototype.register_get_highest_bit=function(b){for(var c=7;0<=c;c--){var g=b[c];if(g)return aa.int_log2(g>>>0)|c<<5}return-1};var Wa=65536,hb=0,Kb=4,Nb=5;qa.prototype.remote_eoi=function(b){for(var c=0;24>c;c++){var g=this.ioredtbl_config[c];(g&255)===b&&g&16384&&(r("Clear remote IRR for irq="+d(c),524288),this.ioredtbl_config[c]&=-16385,this.check_irq(c))}};qa.prototype.check_irq=function(b){var c=1<<b;if(0!==(this.irr&c)){var g=this.ioredtbl_config[b];if(0===(g&Wa)){var h=
g>>8&7,k=g>>11&1,y=g&255,u=this.ioredtbl_destination[b]>>>24,I=32768===(g&32768);if(0===(g&32768))this.irr&=~c;else if(this.ioredtbl_config[b]|=16384,g&16384){r("No route: level interrupt and remote IRR still set",524288);return}h===hb||1===h?this.cpu.devices.apic.route(y,h,I,u,k):H(!1,"TODO");this.ioredtbl_config[b]&=-4097}}};qa.prototype.set_irq=function(b){if(24<=b)H(!1,"Bad irq: "+b,524288);else{var c=1<<b;0===(this.irq_value&c)&&(this.irq_value|=c,(this.ioredtbl_config[b]&(32768|Wa))!==Wa&&(this.irr|=
c,this.check_irq(b)))}};qa.prototype.clear_irq=function(b){if(24<=b)H(!1,"Bad irq: "+b,524288);else{var c=1<<b;(this.irq_value&c)===c&&(this.irq_value&=~c,this.ioredtbl_config[b]&32768&&(this.irr&=~c))}};qa.prototype.read=function(b){if(0===b)return r("IOAPIC Read id",524288),this.ioapic_id<<24;if(1===b)return r("IOAPIC Read version",524288),1507345;if(2===b)return r("IOAPIC Read arbitration id",524288),this.ioapic_id<<24;if(16<=b&&64>b){var c=b-16>>1;b&1?(b=this.ioredtbl_destination[c],r("IOAPIC Read destination irq="+
d(c)+" -> "+d(b,8),524288)):(b=this.ioredtbl_config[c],r("IOAPIC Read config irq="+d(c)+" -> "+d(b,8),524288));return b}r("IOAPIC register read outside of range "+d(b),524288);H(!1);return 0};qa.prototype.write=function(b,c){if(0===b)this.ioapic_id=c>>>24&15;else if(1===b||2===b)r("Invalid write: "+b,524288);else if(16<=b&&64>b){var g=b-16>>1;if(b&1)this.ioredtbl_destination[g]=c&4278190080,r("Write destination "+d(c>>>0,8)+" irq="+d(g)+" dest="+d(c>>>24,2),524288);else{this.ioredtbl_config[g]=c&
110591|this.ioredtbl_config[g]&-110592;b=c&255;var h=c>>8&7,k=c>>11&1,y=c>>15&1,u=c>>16&1;r("Write config "+d(c>>>0,8)+" irq="+d(g)+" vector="+d(b,2)+" deliverymode="+Ga[h]+" destmode="+Ta[k]+" is_level="+y+" disabled="+u,524288);this.check_irq(g)}}else r("IOAPIC register write outside of range "+d(b)+": "+d(c>>>0,8),524288),H(!1)};qa.prototype.get_state=function(){var b=[];b[0]=this.ioredtbl_config;b[1]=this.ioredtbl_destination;b[2]=this.ioregsel;b[3]=this.ioapic_id;b[4]=this.irr;b[5]=this.irq_value;
return b};qa.prototype.set_state=function(b){this.ioredtbl_config=b[0];this.ioredtbl_destination=b[1];this.ioregsel=b[2];this.ioapic_id=b[3];this.irr=b[4];this.irq_value=b[5]};Pa.prototype=Error();const Mb={Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Float32Array,Float64Array};sa.prototype.save_state=function(){for(var b=[],c=Ba(this,b),g=[],h=0,k=0;k<b.length;k++){var y=b[k].byteLength;g[k]={offset:h,length:y};h+=y;h=h+3&-4}c=JSON.stringify({buffer_infos:g,state:c});c=(new TextEncoder).encode(c);
k=16+c.length;k=k+3&-4;var u=k+h;h=new ArrayBuffer(u);var I=new Int32Array(h,0,4);(new Uint8Array(h,16,c.length)).set(c);y=new Uint8Array(h,k);I[0]=-2039052682;I[1]=6;I[2]=u;I[3]=c.length;for(k=0;k<b.length;k++)u=b[k],H(u.constructor===Uint8Array),y.set(u,g[k].offset);r("State: json size "+(c.byteLength>>10)+"k");r("State: Total buffers size "+(y.byteLength>>10)+"k");return h};sa.prototype.restore_state=function(b){function c(fa,na){const oa=fa.length;if(16>oa)throw new Pa("Invalid length: "+oa);
fa=new Int32Array(fa.buffer,fa.byteOffset,4);if(-2039052682!==fa[0])throw new Pa("Invalid header: "+d(fa[0]>>>0));if(6!==fa[1])throw new Pa("Version mismatch: dump="+fa[1]+" we=6");if(na&&fa[2]!==oa)throw new Pa("Length doesn't match header: real="+oa+" header="+fa[2]);return fa[3]}function g(fa){fa=(new TextDecoder).decode(fa);return JSON.parse(fa)}b=new Uint8Array(b);if(4247762216===(new Uint32Array(b.buffer,0,1))[0]){var h=this.zstd_create_ctx(b.length);(new Uint8Array(this.wasm_memory.buffer,
this.zstd_get_src_ptr(h),b.length)).set(b);var k=this.zstd_read(h,16),y=new Uint8Array(this.wasm_memory.buffer,k,16),u=c(y,!1);this.zstd_read_free(k,16);k=this.zstd_read(h,u);y=new Uint8Array(this.wasm_memory.buffer,k,u);y=g(y);this.zstd_read_free(k,u);k=y.state;var I=y.buffer_infos;y=[];u=16+u;for(var ba of I){I=(u+3&-4)-u;if(1048576<ba.length){var R=this.zstd_read(h,I);this.zstd_read_free(R,I);R=new Uint8Array(ba.length);y.push(R.buffer);for(var U=0;U<ba.length;){var Y=ba.length-U;H(0<=Y);Y=Math.min(Y,
1048576);const fa=this.zstd_read(h,Y);R.set(new Uint8Array(this.wasm_memory.buffer,fa,Y),U);this.zstd_read_free(fa,Y);U+=Y}}else R=this.zstd_read(h,I+ba.length),U=R+I,y.push(this.wasm_memory.buffer.slice(U,U+ba.length)),this.zstd_read_free(R,I+ba.length);u+=I+ba.length}k=wa(k,y);this.set_state(k);this.zstd_free_ctx(h)}else{h=c(b,!0);if(0>h||h+12>=b.length)throw new Pa("Invalid info block length: "+h);ba=b.subarray(16,16+h);k=g(ba);ba=k.state;k=k.buffer_infos;let fa=16+h;fa=fa+3&-4;h=k.map(na=>{const oa=
fa+na.offset;return b.buffer.slice(oa,oa+na.length)});ba=wa(ba,h);this.set_state(ba)}};Aa.prototype.get_state=function(){var b=[];b[0]=this.isr;b[1]=this.imr;b[2]=this.cr;b[3]=this.dcfg;b[4]=this.rcnt;b[5]=this.tcnt;b[6]=this.tpsr;b[7]=this.rsar;b[8]=this.pstart;b[9]=this.curpg;b[10]=this.boundary;b[11]=this.pstop;b[12]=this.rxcr;b[13]=this.txcr;b[14]=this.tsr;b[15]=this.mac;b[16]=this.memory;return b};Aa.prototype.set_state=function(b){this.isr=b[0];this.imr=b[1];this.cr=b[2];this.dcfg=b[3];this.rcnt=
b[4];this.tcnt=b[5];this.tpsr=b[6];this.rsar=b[7];this.pstart=b[8];this.curpg=b[9];this.boundary=b[10];this.pstop=b[11];this.rxcr=b[12];this.txcr=b[13];this.tsr=b[14];this.preserve_mac_from_state_image?(this.mac=b[15],this.memory=b[16]):this.mac_address_translation&&(this.mac_address_in_state=b[15],this.memory=b[16],r("Using mac address translation guest_os_mac="+Sa(this.mac_address_in_state)+" real_mac="+Sa(this.mac),1048576))};Aa.prototype.do_interrupt=function(b){r("Do interrupt "+d(b,2),1048576);
this.isr|=b;this.update_irq()};Aa.prototype.update_irq=function(){this.imr&this.isr?this.pci.raise_irq(this.pci_id):this.pci.lower_irq(this.pci_id)};Aa.prototype.data_port_write=function(b){if(16>=this.rsar||16384<=this.rsar&&32768>this.rsar)this.memory[this.rsar]=b;this.rsar++;this.rcnt--;this.rsar>=this.pstop<<8&&(this.rsar+=this.pstart-this.pstop<<8);0===this.rcnt&&this.do_interrupt(64)};Aa.prototype.data_port_write16=function(b){this.data_port_write(b);this.dcfg&1&&this.data_port_write(b>>8)};
Aa.prototype.data_port_write32=function(b){this.data_port_write(b);this.data_port_write(b>>8);this.data_port_write(b>>16);this.data_port_write(b>>24)};Aa.prototype.data_port_read=function(){let b=0;32768>this.rsar&&(b=this.memory[this.rsar]);this.rsar++;this.rcnt--;this.rsar>=this.pstop<<8&&(this.rsar+=this.pstart-this.pstop<<8);0===this.rcnt&&this.do_interrupt(64);return b};Aa.prototype.data_port_read8=function(){return this.data_port_read16()&255};Aa.prototype.data_port_read16=function(){return this.dcfg&
1?this.data_port_read()|this.data_port_read()<<8:this.data_port_read()};Aa.prototype.data_port_read32=function(){return this.data_port_read()|this.data_port_read()<<8|this.data_port_read()<<16|this.data_port_read()<<24};Aa.prototype.receive=function(b){if(!(this.cr&1)&&(this.bus.send("eth-receive-end",[b.length]),this.rxcr&16||this.rxcr&4&&255===b[0]&&255===b[1]&&255===b[2]&&255===b[3]&&255===b[4]&&255===b[5]||!(this.rxcr&8&&1===(b[0]&1)||b[0]!==this.mac[0]||b[1]!==this.mac[1]||b[2]!==this.mac[2]||
b[3]!==this.mac[3]||b[4]!==this.mac[4]||b[5]!==this.mac[5]))){this.mac_address_in_state&&(b=new Uint8Array(b),Na(b,this.mac,this.mac_address_in_state));var c=this.curpg<<8,g=Math.max(60,b.length)+4,h=c+4,k=this.curpg+1+(g>>8),y=c+g,u=1+(g>>8),I=this.boundary>this.curpg?this.boundary-this.curpg:this.pstop-this.curpg+this.boundary-this.pstart;I<u&&0!==this.boundary?r("Buffer full, dropping packet pstart="+d(this.pstart)+" pstop="+d(this.pstop)+" curpg="+d(this.curpg)+" needed="+d(u)+" boundary="+d(this.boundary)+
" available="+d(I),1048576):(y>this.pstop<<8?(H(60<=b.length),y=(this.pstop<<8)-h,H(0<=y),this.memory.set(b.subarray(0,y),h),this.memory.set(b.subarray(y),this.pstart<<8),r("rcv cut="+d(y),1048576)):(this.memory.set(b,h),60>b.length&&this.memory.fill(0,h+b.length,h+60)),k>=this.pstop&&(k+=this.pstart-this.pstop),this.memory[c]=1,this.memory[c+1]=k,this.memory[c+2]=g,this.memory[c+3]=g>>8,this.curpg=k,r("rcv offset="+d(c)+" len="+d(g)+" next="+d(k),1048576),this.do_interrupt(1))}};Aa.prototype.get_page=
function(){return this.cr>>6&3};var pb=new Uint8Array(256),fb=[],gb=[],Cb=[],ac=new Uint8Array(256),dc=[];ya.prototype.dsp_reset=function(){this.write_buffer.clear();this.read_buffer.clear();this.command_size=this.command=0;this.dummy_speaker_enabled=!1;this.test_register=0;this.dsp_signed=this.dsp_16bit=this.dsp_stereo=this.dsp_highspeed=!1;this.dac_buffers[0].clear();this.dac_buffers[1].clear();this.dma_channel=this.dma_irq=this.dma_bytes_block=this.dma_bytes_left=this.dma_bytes_count=this.dma_sample_count=
0;this.dma_autoinit=!1;this.dma_buffer_uint8.fill(0);this.dma_paused=this.dma_waiting_transfer=!1;this.e2_value=170;this.e2_count=0;this.sampling_rate=22050;this.bytes_per_sample=1;this.lower_irq(1);this.irq_triggered.fill(0);this.asp_registers.fill(0);this.asp_registers[5]=1;this.asp_registers[9]=248};ya.prototype.get_state=function(){var b=[];b[2]=this.read_buffer_lastvalue;b[3]=this.command;b[4]=this.command_size;b[5]=this.mixer_current_address;b[6]=this.mixer_registers;b[7]=this.dummy_speaker_enabled;
b[8]=this.test_register;b[9]=this.dsp_highspeed;b[10]=this.dsp_stereo;b[11]=this.dsp_16bit;b[12]=this.dsp_signed;b[15]=this.dma_sample_count;b[16]=this.dma_bytes_count;b[17]=this.dma_bytes_left;b[18]=this.dma_bytes_block;b[19]=this.dma_irq;b[20]=this.dma_channel;b[21]=this.dma_channel_8bit;b[22]=this.dma_channel_16bit;b[23]=this.dma_autoinit;b[24]=this.dma_buffer_uint8;b[25]=this.dma_waiting_transfer;b[26]=this.dma_paused;b[27]=this.sampling_rate;b[28]=this.bytes_per_sample;b[29]=this.e2_value;b[30]=
this.e2_count;b[31]=this.asp_registers;b[33]=this.mpu_read_buffer_last_value;b[34]=this.irq;b[35]=this.irq_triggered;return b};ya.prototype.set_state=function(b){this.read_buffer_lastvalue=b[2];this.command=b[3];this.command_size=b[4];this.mixer_current_address=b[5];this.mixer_registers=b[6];this.mixer_full_update();this.dummy_speaker_enabled=b[7];this.test_register=b[8];this.dsp_highspeed=b[9];this.dsp_stereo=b[10];this.dsp_16bit=b[11];this.dsp_signed=b[12];this.dma_sample_count=b[15];this.dma_bytes_count=
b[16];this.dma_bytes_left=b[17];this.dma_bytes_block=b[18];this.dma_irq=b[19];this.dma_channel=b[20];this.dma_channel_8bit=b[21];this.dma_channel_16bit=b[22];this.dma_autoinit=b[23];this.dma_buffer_uint8=b[24];this.dma_waiting_transfer=b[25];this.dma_paused=b[26];this.sampling_rate=b[27];this.bytes_per_sample=b[28];this.e2_value=b[29];this.e2_count=b[30];this.asp_registers=b[31];this.mpu_read_buffer_last_value=b[33];this.irq=b[34];this.irq_triggered=b[35];this.dma_buffer=this.dma_buffer_uint8.buffer;
this.dma_buffer_int8=new Int8Array(this.dma_buffer);this.dma_buffer_int16=new Int16Array(this.dma_buffer);this.dma_buffer_uint16=new Uint16Array(this.dma_buffer);this.dma_syncbuffer=new aa.SyncBuffer(this.dma_buffer);this.dma_paused?this.bus.send("dac-disable"):this.bus.send("dac-enable")};ya.prototype.port2x0_read=function(){r("220 read: fm music status port (unimplemented)",8388608);return 255};ya.prototype.port2x1_read=function(){r("221 read: fm music data port (write only)",8388608);return 255};
ya.prototype.port2x2_read=function(){r("222 read: advanced fm music status port (unimplemented)",8388608);return 255};ya.prototype.port2x3_read=function(){r("223 read: advanced music data port (write only)",8388608);return 255};ya.prototype.port2x4_read=function(){r("224 read: mixer address port",8388608);return this.mixer_current_address};ya.prototype.port2x5_read=function(){r("225 read: mixer data port",8388608);return this.mixer_read(this.mixer_current_address)};ya.prototype.port2x6_read=function(){r("226 read: (write only)",
8388608);return 255};ya.prototype.port2x7_read=function(){r("227 read: undocumented",8388608);return 255};ya.prototype.port2x8_read=function(){r("228 read: fm music status port (unimplemented)",8388608);return 255};ya.prototype.port2x9_read=function(){r("229 read: fm music data port (write only)",8388608);return 255};ya.prototype.port2xA_read=function(){r("22A read: read data",8388608);this.read_buffer.length&&(this.read_buffer_lastvalue=this.read_buffer.shift());r(" <- "+this.read_buffer_lastvalue+
" "+d(this.read_buffer_lastvalue)+" '"+String.fromCharCode(this.read_buffer_lastvalue)+"'",8388608);return this.read_buffer_lastvalue};ya.prototype.port2xB_read=function(){r("22B read: undocumented",8388608);return 255};ya.prototype.port2xC_read=function(){r("22C read: write-buffer status",8388608);return 127};ya.prototype.port2xD_read=function(){r("22D read: undocumented",8388608);return 255};ya.prototype.port2xE_read=function(){r("22E read: read-buffer status / irq 8bit ack.",8388608);this.irq_triggered[1]&&
this.lower_irq(1);return(this.read_buffer.length&&!this.dsp_highspeed)<<7|127};ya.prototype.port2xF_read=function(){r("22F read: irq 16bit ack",8388608);this.lower_irq(2);return 0};ya.prototype.port2x0_write=function(b){r("220 write: (unimplemented) fm register 0 address = "+d(b),8388608);this.fm_current_address0=0};ya.prototype.port2x1_write=function(b){r("221 write: (unimplemented) fm register 0 data = "+d(b),8388608);var c=dc[this.fm_current_address0];c||=this.fm_default_write;c.call(this,b,0,
this.fm_current_address0)};ya.prototype.port2x2_write=function(b){r("222 write: (unimplemented) fm register 1 address = "+d(b),8388608);this.fm_current_address1=0};ya.prototype.port2x3_write=function(b){r("223 write: (unimplemented) fm register 1 data ="+d(b),8388608);var c=dc[this.fm_current_address1];c||=this.fm_default_write;c.call(this,b,1,this.fm_current_address1)};ya.prototype.port2x4_write=function(b){r("224 write: mixer address = "+d(b),8388608);this.mixer_current_address=b};ya.prototype.port2x5_write=
function(b){r("225 write: mixer data = "+d(b),8388608);this.mixer_write(this.mixer_current_address,b)};ya.prototype.port2x6_write=function(b){r("226 write: reset = "+d(b),8388608);this.dsp_highspeed?(r(" -> exit highspeed",8388608),this.dsp_highspeed=!1):b&&(r(" -> reset",8388608),this.dsp_reset());this.read_buffer.clear();this.read_buffer.push(170)};ya.prototype.port2x7_write=function(b){r("227 write: undocumented",8388608)};ya.prototype.port2x8_write=function(b){r("228 write: fm music register port (unimplemented)",
8388608)};ya.prototype.port2x9_write=function(b){r("229 write: fm music data port (unimplemented)",8388608)};ya.prototype.port2xA_write=function(b){r("22A write: dsp read data port (read only)",8388608)};ya.prototype.port2xB_write=function(b){r("22B write: undocumented",8388608)};ya.prototype.port2xC_write=function(b){r("22C write: write command/data",8388608);0===this.command?(r("22C write: command = "+d(b),8388608),this.command=b,this.write_buffer.clear(),this.command_size=pb[b]):(r("22C write: data: "+
d(b),8388608),this.write_buffer.push(b));this.write_buffer.length>=this.command_size&&this.command_do()};ya.prototype.port2xD_write=function(b){r("22D write: undocumented",8388608)};ya.prototype.port2xE_write=function(b){r("22E write: dsp read buffer status (read only)",8388608)};ya.prototype.port2xF_write=function(b){r("22F write: undocumented",8388608)};ya.prototype.port3x0_read=function(){r("330 read: mpu data",8388608);this.mpu_read_buffer.length&&(this.mpu_read_buffer_lastvalue=this.mpu_read_buffer.shift());
r(" <- "+d(this.mpu_read_buffer_lastvalue),8388608);return this.mpu_read_buffer_lastvalue};ya.prototype.port3x0_write=function(b){r("330 write: mpu data (unimplemented) : "+d(b),8388608)};ya.prototype.port3x1_read=function(){r("331 read: mpu status",8388608);return 0|128*!this.mpu_read_buffer.length};ya.prototype.port3x1_write=function(b){r("331 write: mpu command: "+d(b),8388608);255==b&&(this.mpu_read_buffer.clear(),this.mpu_read_buffer.push(254))};ya.prototype.command_do=function(){var b=fb[this.command];
b||=this.dsp_default_handler;b.call(this);this.command_size=this.command=0;this.write_buffer.clear()};ya.prototype.dsp_default_handler=function(){r("Unhandled command: "+d(this.command),8388608)};x([14],2,function(){this.asp_registers[this.write_buffer.shift()]=this.write_buffer.shift()});x([15],1,function(){this.read_buffer.clear();this.read_buffer.push(this.asp_registers[this.write_buffer.shift()])});x([16],1,function(){var b=this.write_buffer.shift();b=Fa(b/127.5+-1,-1,1);this.dac_buffers[0].push(b);
this.dac_buffers[1].push(b);this.bus.send("dac-enable")});x([20,21],2,function(){this.dma_irq=1;this.dma_channel=this.dma_channel_8bit;this.dsp_highspeed=this.dsp_16bit=this.dsp_signed=this.dma_autoinit=!1;this.dma_transfer_size_set();this.dma_transfer_start()});x([22],2);x([23],2);x([28],0,function(){this.dma_irq=1;this.dma_channel=this.dma_channel_8bit;this.dma_autoinit=!0;this.dsp_highspeed=this.dsp_16bit=this.dsp_signed=!1;this.dma_transfer_start()});x([31],0);x([32],0,function(){this.read_buffer.clear();
this.read_buffer.push(127)});x([36],2);x([44],0);x([48],0);x([49],0);x([52],0);x([53],0);x([54],0);x([55],0);x([56],0);x([64],1,function(){this.sampling_rate_change(1E6/(256-this.write_buffer.shift())/this.get_channel_count())});x([65,66],2,function(){this.sampling_rate_change(this.write_buffer.shift()<<8|this.write_buffer.shift())});x([72],2,function(){this.dma_transfer_size_set()});x([116],2);x([117],2);x([118],2);x([119],2);x([125],0);x([127],0);x([128],2);x([144],0,function(){this.dma_irq=1;this.dma_channel=
this.dma_channel_8bit;this.dma_autoinit=!0;this.dsp_signed=!1;this.dsp_highspeed=!0;this.dsp_16bit=!1;this.dma_transfer_start()});x([145],0);x([152],0);x([153],0);x([160],0);x([168],0);x(D(176),3,function(){if(this.command&8)this.dsp_default_handler();else{var b=this.write_buffer.shift();this.dma_irq=2;this.dma_channel=this.dma_channel_16bit;this.dma_autoinit=!!(this.command&4);this.dsp_signed=!!(b&16);this.dsp_stereo=!!(b&32);this.dsp_16bit=!0;this.dma_transfer_size_set();this.dma_transfer_start()}});
x(D(192),3,function(){if(this.command&8)this.dsp_default_handler();else{var b=this.write_buffer.shift();this.dma_irq=1;this.dma_channel=this.dma_channel_8bit;this.dma_autoinit=!!(this.command&4);this.dsp_signed=!!(b&16);this.dsp_stereo=!!(b&32);this.dsp_16bit=!1;this.dma_transfer_size_set();this.dma_transfer_start()}});x([208],0,function(){this.dma_paused=!0;this.bus.send("dac-disable")});x([209],0,function(){this.dummy_speaker_enabled=!0});x([211],0,function(){this.dummy_speaker_enabled=!1});x([212],
0,function(){this.dma_paused=!1;this.bus.send("dac-enable")});x([213],0,function(){this.dma_paused=!0;this.bus.send("dac-disable")});x([214],0,function(){this.dma_paused=!1;this.bus.send("dac-enable")});x([216],0,function(){this.read_buffer.clear();this.read_buffer.push(255*this.dummy_speaker_enabled)});x([217,218],0,function(){this.dma_autoinit=!1});x([224],1,function(){this.read_buffer.clear();this.read_buffer.push(~this.write_buffer.shift())});x([225],0,function(){this.read_buffer.clear();this.read_buffer.push(4);
this.read_buffer.push(5)});x([226],1);x([227],0,function(){this.read_buffer.clear();for(var b=0;44>b;b++)this.read_buffer.push("COPYRIGHT (C) CREATIVE TECHNOLOGY LTD, 1992.".charCodeAt(b));this.read_buffer.push(0)});x([228],1,function(){this.test_register=this.write_buffer.shift()});x([232],0,function(){this.read_buffer.clear();this.read_buffer.push(this.test_register)});x([242,243],0,function(){this.raise_irq()});var cc=new Uint8Array(256);cc[14]=255;cc[15]=7;cc[55]=56;x([249],1,function(){var b=
this.write_buffer.shift();r("dsp 0xf9: unknown function. input: "+b,8388608);this.read_buffer.clear();this.read_buffer.push(cc[b])});ya.prototype.mixer_read=function(b){var c=gb[b];c?c=c.call(this):(c=this.mixer_registers[b],r("unhandled mixer register read. addr:"+d(b)+" data:"+d(c),8388608));return c};ya.prototype.mixer_write=function(b,c){var g=Cb[b];g?g.call(this,c):r("unhandled mixer register write. addr:"+d(b)+" data:"+d(c),8388608)};ya.prototype.mixer_default_read=function(){r("mixer register read. addr:"+
d(this.mixer_current_address),8388608);return this.mixer_registers[this.mixer_current_address]};ya.prototype.mixer_default_write=function(b){r("mixer register write. addr:"+d(this.mixer_current_address)+" data:"+d(b),8388608);this.mixer_registers[this.mixer_current_address]=b};ya.prototype.mixer_reset=function(){this.mixer_registers[4]=204;this.mixer_registers[34]=204;this.mixer_registers[38]=204;this.mixer_registers[40]=0;this.mixer_registers[46]=0;this.mixer_registers[10]=0;this.mixer_registers[48]=
192;this.mixer_registers[49]=192;this.mixer_registers[50]=192;this.mixer_registers[51]=192;this.mixer_registers[52]=192;this.mixer_registers[53]=192;this.mixer_registers[54]=0;this.mixer_registers[55]=0;this.mixer_registers[56]=0;this.mixer_registers[57]=0;this.mixer_registers[59]=0;this.mixer_registers[60]=31;this.mixer_registers[61]=21;this.mixer_registers[62]=11;this.mixer_registers[63]=0;this.mixer_registers[64]=0;this.mixer_registers[65]=0;this.mixer_registers[66]=0;this.mixer_registers[67]=
0;this.mixer_registers[68]=128;this.mixer_registers[69]=128;this.mixer_registers[70]=128;this.mixer_registers[71]=128;this.mixer_full_update()};ya.prototype.mixer_full_update=function(){for(var b=1;b<this.mixer_registers.length;b++)ac[b]||this.mixer_write(b,this.mixer_registers[b])};L(0,function(){this.mixer_reset();return 0});Z(0);pa(4,50,51);pa(34,48,49);pa(38,52,53);pa(40,54,55);pa(46,56,57);Ja(48,0,0);Ja(49,0,1);Ja(50,2,0);Ja(51,2,1);L(59);Z(59,function(b){this.mixer_registers[59]=b;this.bus.send("mixer-volume",
[1,2,6*(b>>>6)-18])});L(65);Z(65,function(b){this.mixer_registers[65]=b;this.bus.send("mixer-gain-left",6*(b>>>6))});L(66);Z(66,function(b){this.mixer_registers[66]=b;this.bus.send("mixer-gain-right",6*(b>>>6))});L(68);Z(68,function(b){this.mixer_registers[68]=b;b>>>=3;this.bus.send("mixer-treble-left",b-(16>b?14:16))});L(69);Z(69,function(b){this.mixer_registers[69]=b;b>>>=3;this.bus.send("mixer-treble-right",b-(16>b?14:16))});L(70);Z(70,function(b){this.mixer_registers[70]=b;b>>>=3;this.bus.send("mixer-bass-right",
b-(16>b?14:16))});L(71);Z(71,function(b){this.mixer_registers[71]=b;b>>>=3;this.bus.send("mixer-bass-right",b-(16>b?14:16))});L(128,function(){switch(this.irq){case 2:return 1;case 5:return 2;case 7:return 4;case 10:return 8;default:return 0}});Z(128,function(b){b&1&&(this.irq=2);b&2&&(this.irq=5);b&4&&(this.irq=7);b&8&&(this.irq=10)});L(129,function(){var b=0;switch(this.dma_channel_8bit){case 0:b|=1;break;case 1:b|=2;break;case 3:b|=8}switch(this.dma_channel_16bit){case 5:b|=32;break;case 6:b|=
64;break;case 7:b|=128}return b});Z(129,function(b){b&1&&(this.dma_channel_8bit=0);b&2&&(this.dma_channel_8bit=1);b&8&&(this.dma_channel_8bit=3);b&32&&(this.dma_channel_16bit=5);b&64&&(this.dma_channel_16bit=6);b&128&&(this.dma_channel_16bit=7)});L(130,function(){for(var b=32,c=0;16>c;c++)b|=c*this.irq_triggered[c];return b});ya.prototype.fm_default_write=function(b,c,g){r("unhandled fm register write. addr:"+c+"|"+d(g)+" data:"+d(b),8388608)};var Gb=new Uint8Array(32);Gb[0]=0;Gb[1]=1;Gb[2]=2;Gb[3]=
3;Gb[4]=4;Gb[5]=5;Gb[8]=6;Gb[9]=7;Gb[10]=8;Gb[11]=9;Gb[12]=10;Gb[13]=11;Gb[16]=12;Gb[17]=13;Gb[18]=14;Gb[19]=15;Gb[20]=16;Gb[21]=17;ea([1],function(b,c,g){this.fm_waveform_select_enable[c]=b&1;this.fm_update_waveforms()});ea([2]);ea([3]);ea([4],function(b,c,g){});ea([5],function(b,c,g){0===c&&this.fm_default_write(b,c,g)});ea([8],function(b,c,g){});ea(ra(32,53),function(b,c,g){});ea(ra(64,85),function(b,c,g){});ea(ra(96,117),function(b,c,g){});ea(ra(128,149),function(b,c,g){});ea(ra(160,168),function(b,
c,g){});ea(ra(176,184),function(b,c,g){});ea([189],function(b,c,g){});ea(ra(192,200),function(b,c,g){});ea(ra(224,245),function(b,c,g){});ya.prototype.fm_update_waveforms=function(){};ya.prototype.sampling_rate_change=function(b){this.sampling_rate=b;this.bus.send("dac-tell-sampling-rate",b)};ya.prototype.get_channel_count=function(){return this.dsp_stereo?2:1};ya.prototype.dma_transfer_size_set=function(){this.dma_sample_count=1+(this.write_buffer.shift()<<0)+(this.write_buffer.shift()<<8)};ya.prototype.dma_transfer_start=
function(){r("begin dma transfer",8388608);this.bytes_per_sample=1;this.dsp_16bit&&(this.bytes_per_sample*=2);this.dma_bytes_count=this.dma_sample_count*this.bytes_per_sample;this.dma_bytes_block=1024*this.bytes_per_sample;this.dma_bytes_block=Math.min(Math.max(this.dma_bytes_count>>2&-4,32),this.dma_bytes_block);this.dma_waiting_transfer=!0;this.dma.channel_mask[this.dma_channel]||this.dma_on_unmask(this.dma_channel)};ya.prototype.dma_on_unmask=function(b){b===this.dma_channel&&this.dma_waiting_transfer&&
(this.dma_waiting_transfer=!1,this.dma_bytes_left=this.dma_bytes_count,this.dma_paused=!1,this.bus.send("dac-enable"))};ya.prototype.dma_transfer_next=function(){r("dma transfering next block",8388608);var b=Math.min(this.dma_bytes_left,this.dma_bytes_block),c=Math.floor(b/this.bytes_per_sample);this.dma.do_write(this.dma_syncbuffer,0,b,this.dma_channel,g=>{r("dma block transfer "+(g?"unsuccessful":"successful"),8388608);g||(this.dma_to_dac(c),this.dma_bytes_left-=b,this.dma_bytes_left||(this.raise_irq(this.dma_irq),
this.dma_autoinit&&(this.dma_bytes_left=this.dma_bytes_count)))})};ya.prototype.dma_to_dac=function(b){for(var c=this.dsp_16bit?32767.5:127.5,g=this.dsp_signed?0:-1,h=this.dsp_stereo?1:2,k=this.dsp_16bit?this.dsp_signed?this.dma_buffer_int16:this.dma_buffer_uint16:this.dsp_signed?this.dma_buffer_int8:this.dma_buffer_uint8,y=0,u=0;u<b;u++)for(var I=Fa(k[u]/c+g,-1,1),ba=0;ba<h;ba++)this.dac_buffers[y].push(I),y^=1;this.dac_send()};ya.prototype.dac_handle_request=function(){!this.dma_bytes_left||this.dma_paused?
this.dac_send():this.dma_transfer_next()};ya.prototype.dac_send=function(){if(this.dac_buffers[0].length){var b=this.dac_buffers[0].shift_block(this.dac_buffers[0].length),c=this.dac_buffers[1].shift_block(this.dac_buffers[1].length);this.bus.send("dac-send-data",[b,c],[b.buffer,c.buffer])}};ya.prototype.raise_irq=function(b){r("raise irq",8388608);this.irq_triggered[b]=1;this.cpu.device_raise_irq(this.irq)};ya.prototype.lower_irq=function(b){r("lower irq",8388608);this.irq_triggered[b]=0;this.cpu.device_lower_irq(this.irq)};
P.prototype.create_common_capability=function(b){return{type:1,bar:0,port:b.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array(0),struct:[{bytes:4,name:"device_feature_select",read:()=>this.device_feature_select,write:c=>{this.device_feature_select=c}},{bytes:4,name:"device_feature",read:()=>this.device_feature[this.device_feature_select]||0,write:c=>{}},{bytes:4,name:"driver_feature_select",read:()=>this.driver_feature_select,write:c=>{this.driver_feature_select=c}},{bytes:4,name:"driver_feature",
read:()=>this.driver_feature[this.driver_feature_select]||0,write:c=>{const g=this.device_feature[this.driver_feature_select];this.driver_feature_select<this.driver_feature.length&&(this.driver_feature[this.driver_feature_select]=c&g);this.features_ok=this.features_ok&&!(c&~g)}},{bytes:2,name:"msix_config",read:()=>{r("No msi-x capability supported.",2097152);return 65535},write:c=>{r("No msi-x capability supported.",2097152)}},{bytes:2,name:"num_queues",read:()=>this.queues.length,write:c=>{}},{bytes:1,
name:"device_status",read:()=>this.device_status,write:c=>{0===c?(r("Reset device<"+this.name+">",2097152),this.reset()):c&128?r("Warning: Device<"+this.name+"> status failed",2097152):r("Device<"+this.name+"> status: "+(c&1?"ACKNOWLEDGE ":"")+(c&2?"DRIVER ":"")+(c&4?"DRIVER_OK":"")+(c&8?"FEATURES_OK ":"")+(c&64?"DEVICE_NEEDS_RESET":""),2097152);c&~this.device_status&4&&this.device_status&64&&this.notify_config_changes();this.features_ok||(N&&c&8&&r("Removing FEATURES_OK",2097152),c&=-9);this.device_status=
c;if(c&~this.device_status&4)b.on_driver_ok()}},{bytes:1,name:"config_generation",read:()=>this.config_generation,write:c=>{}},{bytes:2,name:"queue_select",read:()=>this.queue_select,write:c=>{this.queue_select=c;this.queue_selected=this.queue_select<this.queues.length?this.queues[this.queue_select]:null}},{bytes:2,name:"queue_size",read:()=>this.queue_selected?this.queue_selected.size:0,write:c=>{this.queue_selected&&(c&c-1&&(r("Warning: dev<"+this.name+"> Given queue size was not a power of 2. Rounding up to next power of 2.",
2097152),c=1<<aa.int_log2(c-1)+1),c>this.queue_selected.size_supported&&(r("Warning: dev<"+this.name+"> Trying to set queue size greater than supported. Clamping to supported size.",2097152),c=this.queue_selected.size_supported),this.queue_selected.set_size(c))}},{bytes:2,name:"queue_msix_vector",read:()=>{r("No msi-x capability supported.",2097152);return 65535},write:c=>{r("No msi-x capability supported.",2097152)}},{bytes:2,name:"queue_enable",read:()=>this.queue_selected?this.queue_selected.enabled|
0:0,write:c=>{this.queue_selected&&(1===c?this.queue_selected.is_configured()?this.queue_selected.enable():r("Driver bug: tried enabling unconfigured queue",2097152):0===c&&r("Driver bug: tried writing 0 to queue_enable",2097152))}},{bytes:2,name:"queue_notify_off",read:()=>this.queue_selected?this.queue_selected.notify_offset:0,write:c=>{}},{bytes:4,name:"queue_desc (low dword)",read:()=>this.queue_selected?this.queue_selected.desc_addr:0,write:c=>{this.queue_selected&&(this.queue_selected.desc_addr=
c)}},{bytes:4,name:"queue_desc (high dword)",read:()=>0,write:c=>{r("Warning: High dword of 64 bit queue_desc ignored",2097152)}},{bytes:4,name:"queue_avail (low dword)",read:()=>this.queue_selected?this.queue_selected.avail_addr:0,write:c=>{this.queue_selected&&(this.queue_selected.avail_addr=c)}},{bytes:4,name:"queue_avail (high dword)",read:()=>0,write:c=>{r("Warning: High dword of 64 bit queue_avail ignored",2097152)}},{bytes:4,name:"queue_used (low dword)",read:()=>this.queue_selected?this.queue_selected.used_addr:
0,write:c=>{this.queue_selected&&(this.queue_selected.used_addr=c)}},{bytes:4,name:"queue_used (high dword)",read:()=>0,write:c=>{r("Warning: High dword of 64 bit queue_used ignored",2097152)}}]}};P.prototype.create_notification_capability=function(b){const c=[];let g;b.single_handler?(H(1===b.handlers.length,"VirtIO device<"+this.name+"> too many notify handlers specified: expected single handler"),g=0):g=2;for(const [h,k]of b.handlers.entries())c.push({bytes:2,name:"notify"+h,read:()=>65535,write:k||
(y=>{})});return{type:2,bar:1,port:b.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array([g&255,g>>8&255,g>>16&255,g>>24]),struct:c}};P.prototype.create_isr_capability=function(b){return{type:3,bar:2,port:b.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array(0),struct:[{bytes:1,name:"isr_status",read:()=>{const c=this.isr_status;this.lower_irq();return c},write:c=>{}}]}};P.prototype.create_device_specific_capability=function(b){H(~b.offset&3,"VirtIO device<"+this.name+"> device specific cap offset must be 4-byte aligned");
return{type:4,bar:3,port:b.initial_port,use_mmio:!1,offset:0,extra:new Uint8Array(0),struct:b.struct}};P.prototype.init_capabilities=function(b){let c=this.pci_space[52]=64;var g=c;for(const k of b){b=16+k.extra.length;g=c;c=g+b;H(256>=c,"VirtIO device<"+this.name+"> can't fit all capabilities into 256byte configspace");H(0<=k.bar&&6>k.bar,"VirtIO device<"+this.name+"> capability invalid bar number");var h=k.struct.reduce((y,u)=>y+u.bytes,0);h+=k.offset;h=16>h?16:1<<aa.int_log2(h-1)+1;H(0===(k.port&
h-1),"VirtIO device<"+this.name+"> capability port should be aligned to pci bar size");this.pci_bars[k.bar]={size:h};this.pci_space[g]=9;this.pci_space[g+1]=c;this.pci_space[g+2]=b;this.pci_space[g+3]=k.type;this.pci_space[g+4]=k.bar;this.pci_space[g+5]=0;this.pci_space[g+6]=0;this.pci_space[g+7]=0;this.pci_space[g+8]=k.offset&255;this.pci_space[g+9]=k.offset>>>8&255;this.pci_space[g+10]=k.offset>>>16&255;this.pci_space[g+11]=k.offset>>>24;this.pci_space[g+12]=h&255;this.pci_space[g+13]=h>>>8&255;
this.pci_space[g+14]=h>>>16&255;this.pci_space[g+15]=h>>>24;for(const [y,u]of k.extra.entries())this.pci_space[g+16+y]=u;g=16+4*k.bar;this.pci_space[g]=k.port&254|!k.use_mmio;this.pci_space[g+1]=k.port>>>8&255;this.pci_space[g+2]=k.port>>>16&255;this.pci_space[g+3]=k.port>>>24&255;g=k.port+k.offset;for(const y of k.struct){let u=y.read;b=y.write;N&&(u=()=>{const I=y.read();r("Device<"+this.name+"> cap["+k.type+"] read["+y.name+"] => "+d(I,8*y.bytes),2097152);return I},b=I=>{r("Device<"+this.name+
"> cap["+k.type+"] write["+y.name+"] <= "+d(I,8*y.bytes),2097152);y.write(I)});if(k.use_mmio)H(!1,"VirtIO device <"+this.name+"> mmio capability not implemented.");else{h=function(ba){r("Warning: 8-bit read from 16-bit virtio port",2097152);return u(ba&-2)>>((ba&1)<<3)&255};const I=function(ba){r("Warning: 8-bit read from 32-bit virtio port",2097152);return u(ba&-4)>>((ba&3)<<3)&255};switch(y.bytes){case 4:this.cpu.io.register_read(g,this,I,void 0,u);this.cpu.io.register_write(g,this,void 0,void 0,
b);break;case 2:this.cpu.io.register_read(g,this,h,u);this.cpu.io.register_write(g,this,void 0,b);break;case 1:this.cpu.io.register_read(g,this,u);this.cpu.io.register_write(g,this,b);break;default:H(!1,"VirtIO device <"+this.name+"> invalid capability field width of "+y.bytes+" bytes")}}g+=y.bytes}}g=20;H(256>=c+g,"VirtIO device<"+this.name+"> can't fit all capabilities into 256byte configspace");this.pci_space[c]=9;this.pci_space[c+1]=0;this.pci_space[c+2]=g;this.pci_space[c+3]=5;this.pci_space[c+
4]=0;this.pci_space[c+5]=0;this.pci_space[c+6]=0;this.pci_space[c+7]=0;this.pci_space[c+8]=0;this.pci_space[c+9]=0;this.pci_space[c+10]=0;this.pci_space[c+11]=0;this.pci_space[c+12]=0;this.pci_space[c+13]=0;this.pci_space[c+14]=0;this.pci_space[c+15]=0;this.pci_space[c+16]=0;this.pci_space[c+17]=0;this.pci_space[c+18]=0;this.pci_space[c+19]=0};P.prototype.get_state=function(){let b=[];b[0]=this.device_feature_select;b[1]=this.driver_feature_select;b[2]=this.device_feature;b[3]=this.driver_feature;
b[4]=this.features_ok;b[5]=this.device_status;b[6]=this.config_has_changed;b[7]=this.config_generation;b[8]=this.isr_status;b[9]=this.queue_select;return b.concat(this.queues)};P.prototype.set_state=function(b){this.device_feature_select=b[0];this.driver_feature_select=b[1];this.device_feature=b[2];this.driver_feature=b[3];this.features_ok=b[4];this.device_status=b[5];this.config_has_changed=b[6];this.config_generation=b[7];this.isr_status=b[8];this.queue_select=b[9];let c=0;for(let g of b.slice(10))this.queues[c].set_state(g),
c++;this.queue_selected=this.queues[this.queue_select]||null};P.prototype.reset=function(){this.driver_feature_select=this.device_feature_select=0;this.driver_feature.set(this.device_feature);this.features_ok=!0;this.queue_select=this.device_status=0;this.queue_selected=this.queues[0];for(const b of this.queues)b.reset();this.config_has_changed=!1;this.config_generation=0;this.lower_irq()};P.prototype.notify_config_changes=function(){this.config_has_changed=!0;this.device_status&4?this.raise_irq(2):
H(!1,"VirtIO device<"+this.name+"> attempted to notify driver before DRIVER_OK")};P.prototype.update_config_generation=function(){this.config_has_changed&&(this.config_generation++,this.config_generation&=255,this.config_has_changed=!1)};P.prototype.is_feature_negotiated=function(b){return 0<(this.driver_feature[b>>>5]&1<<(b&31))};P.prototype.needs_reset=function(){r("Device<"+this.name+"> experienced error - requires reset",2097152);this.device_status|=64;this.device_status&4&&this.notify_config_changes()};
P.prototype.raise_irq=function(b){r("Raise irq "+d(b),2097152);this.isr_status|=b;this.pci.raise_irq(this.pci_id)};P.prototype.lower_irq=function(){r("Lower irq ",2097152);this.isr_status=0;this.pci.lower_irq(this.pci_id)};Ia.prototype.get_state=function(){const b=[];b[0]=this.size;b[1]=this.size_supported;b[2]=this.enabled;b[3]=this.notify_offset;b[4]=this.desc_addr;b[5]=this.avail_addr;b[6]=this.avail_last_idx;b[7]=this.used_addr;b[8]=this.num_staged_replies;return b};Ia.prototype.set_state=function(b){this.size=
b[0];this.size_supported=b[1];this.enabled=b[2];this.notify_offset=b[3];this.desc_addr=b[4];this.avail_addr=b[5];this.avail_last_idx=b[6];this.used_addr=b[7];this.num_staged_replies=b[8];this.mask=this.size-1};Ia.prototype.reset=function(){this.enabled=!1;this.num_staged_replies=this.used_addr=this.avail_last_idx=this.avail_addr=this.desc_addr=0;this.set_size(this.size_supported)};Ia.prototype.is_configured=function(){return this.desc_addr&&this.avail_addr&&this.used_addr};Ia.prototype.enable=function(){H(this.is_configured(),
"VirtQueue must be configured before enabled");this.enabled=!0};Ia.prototype.set_size=function(b){H(0===(b&b-1),"VirtQueue size must be power of 2 or zero");H(b<=this.size_supported,"VirtQueue size must be within supported size");this.size=b;this.mask=b-1};Ia.prototype.count_requests=function(){H(this.avail_addr,"VirtQueue addresses must be configured before use");return this.avail_get_idx()-this.avail_last_idx&this.mask};Ia.prototype.has_request=function(){H(this.avail_addr,"VirtQueue addresses must be configured before use");
return(this.avail_get_idx()&this.mask)!==this.avail_last_idx};Ia.prototype.pop_request=function(){H(this.avail_addr,"VirtQueue addresses must be configured before use");H(this.has_request(),"VirtQueue must not pop nonexistent request");var b=this.avail_get_entry(this.avail_last_idx);r("Pop request: avail_last_idx="+this.avail_last_idx+" desc_idx="+b,2097152);b=new ha(this,b);this.avail_last_idx=this.avail_last_idx+1&this.mask;return b};Ia.prototype.push_reply=function(b){H(this.used_addr,"VirtQueue addresses must be configured before use");
H(this.num_staged_replies<this.size,"VirtQueue replies must not exceed queue size");const c=this.used_get_idx()+this.num_staged_replies&this.mask;r("Push reply: used_idx="+c+" desc_idx="+b.head_idx,2097152);this.used_set_entry(c,b.head_idx,b.length_written);this.num_staged_replies++};Ia.prototype.flush_replies=function(){H(this.used_addr,"VirtQueue addresses must be configured before use");if(0===this.num_staged_replies)r("flush_replies: Nothing to flush",2097152);else{r("Flushing "+this.num_staged_replies+
" replies",2097152);var b=this.used_get_idx()+this.num_staged_replies&65535;this.used_set_idx(b);this.num_staged_replies=0;this.virtio.is_feature_negotiated(29)?(this.avail_get_used_event(),this.virtio.raise_irq(1)):~this.avail_get_flags()&1&&this.virtio.raise_irq(1)}};Ia.prototype.notify_me_after=function(b){H(0<=b,"Must skip a non-negative number of requests");b=this.avail_get_idx()+b&65535;this.used_set_avail_event(b)};Ia.prototype.get_descriptor=function(b,c){return{addr_low:this.cpu.read32s(b+
16*c),addr_high:this.cpu.read32s(b+16*c+4),len:this.cpu.read32s(b+16*c+8),flags:this.cpu.read16(b+16*c+12),next:this.cpu.read16(b+16*c+14)}};Ia.prototype.avail_get_flags=function(){return this.cpu.read16(this.avail_addr)};Ia.prototype.avail_get_idx=function(){return this.cpu.read16(this.avail_addr+2)};Ia.prototype.avail_get_entry=function(b){return this.cpu.read16(this.avail_addr+4+2*b)};Ia.prototype.avail_get_used_event=function(){return this.cpu.read16(this.avail_addr+4+2*this.size)};Ia.prototype.used_get_flags=
function(){return this.cpu.read16(this.used_addr)};Ia.prototype.used_set_flags=function(b){this.cpu.write16(this.used_addr,b)};Ia.prototype.used_get_idx=function(){return this.cpu.read16(this.used_addr+2)};Ia.prototype.used_set_idx=function(b){this.cpu.write16(this.used_addr+2,b)};Ia.prototype.used_set_entry=function(b,c,g){this.cpu.write32(this.used_addr+4+8*b,c);this.cpu.write32(this.used_addr+8+8*b,g)};Ia.prototype.used_set_avail_event=function(b){this.cpu.write16(this.used_addr+4+8*this.size,
b)};ha.prototype.get_next_blob=function(b){let c=0,g=b.length;for(;g;){if(this.read_buffer_idx===this.read_buffers.length){r("Device<"+this.virtio.name+"> Read more than device-readable buffers has",2097152);break}var h=this.read_buffers[this.read_buffer_idx];const k=h.addr_low+this.read_buffer_offset;h=h.len-this.read_buffer_offset;h>g?(h=g,this.read_buffer_offset+=g):(this.read_buffer_idx++,this.read_buffer_offset=0);b.set(this.cpu.read_blob(k,h),c);c+=h;g-=h}return c};ha.prototype.set_next_blob=
function(b){let c=0,g=b.length;for(;g;){if(this.write_buffer_idx===this.write_buffers.length){r("Device<"+this.virtio.name+"> Write more than device-writable capacity",2097152);break}var h=this.write_buffers[this.write_buffer_idx];const k=h.addr_low+this.write_buffer_offset;h=h.len-this.write_buffer_offset;h>g?(h=g,this.write_buffer_offset+=g):(this.write_buffer_idx++,this.write_buffer_offset=0);this.cpu.write_blob(b.subarray(c,c+h),k);c+=h;g-=h}this.length_written+=c;return c};var hc={};va.prototype.register=
function(b,c,g){var h=this.listeners[b];void 0===h&&(h=this.listeners[b]=[]);h.push({fn:c,this_value:g})};va.prototype.unregister=function(b,c){var g=this.listeners[b];void 0!==g&&(this.listeners[b]=g.filter(function(h){return h.fn!==c}))};va.prototype.send=function(b,c,g){if(this.pair&&(b=this.pair.listeners[b],void 0!==b))for(g=0;g<b.length;g++){var h=b[g];h.fn.call(h.this_value,c)}};va.prototype.send_async=function(b,c){H(1===arguments.length||2===arguments.length);setTimeout(this.send.bind(this,
b,c),0)};hc.create=function(){var b=new va,c=new va;b.pair=c;c.pair=b;return[b,c]};var r=function(){if(!N)return function(){};var b=Qb.reduce(function(h,k){h[k[0]]=k[1];return h},{}),c="",g=0;return function(h,k){N&&(k=k||1,k&Q)&&(h="["+aa.pads(b[k]||"",4)+"] "+h,h===c&&(g++,2048>g)||(k=new Date,k=aa.pad0(k.getHours(),2)+":"+aa.pad0(k.getMinutes(),2)+":"+aa.pad0(k.getSeconds(),2)+"+"+aa.pad0(k.getMilliseconds(),3)+" ",g&&(1===g?console.log(k+c):console.log("Previous message repeated "+g+" times"),
g=0),console.log(k+h),c=h))}}();sa.prototype.clear_opstats=function(){(new Uint8Array(this.wasm_memory.buffer,32768,131072)).fill(0);this.wm.exports.profiler_init()};sa.prototype.create_jit_imports=function(){const b=Object.create(null);b.m=this.wm.exports.memory;for(let c of Object.keys(this.wm.exports))c.startsWith("_")||c.startsWith("zstd")||c.endsWith("_js")||(b[c]=this.wm.exports[c]);this.jit_imports=b};sa.prototype.wasm_patch=function(){const b=g=>this.wm.exports[g],c=g=>{const h=b(g);console.assert(h,
"Missing import: "+g);return h};this.reset_cpu=c("reset_cpu");this.getiopl=c("getiopl");this.get_eflags=c("get_eflags");this.get_eflags_no_arith=c("get_eflags_no_arith");this.pic_call_irq=c("pic_call_irq");this.do_many_cycles_native=c("do_many_cycles_native");this.cycle_internal=c("cycle_internal");this.read8=c("read8");this.read16=c("read16");this.read32s=c("read32s");this.write8=c("write8");this.write16=c("write16");this.write32=c("write32");this.in_mapped_range=c("in_mapped_range");this.fpu_load_tag_word=
c("fpu_load_tag_word");this.fpu_load_status_word=c("fpu_load_status_word");this.fpu_get_sti_f64=c("fpu_get_sti_f64");this.translate_address_system_read=c("translate_address_system_read_js");this.get_seg_cs=c("get_seg_cs");this.get_real_eip=c("get_real_eip");this.clear_tlb=c("clear_tlb");this.full_clear_tlb=c("full_clear_tlb");this.update_state_flags=c("update_state_flags");this.set_tsc=c("set_tsc");this.store_current_tsc=c("store_current_tsc");this.set_cpuid_level=c("set_cpuid_level");N&&(this.jit_force_generate_unsafe=
b("jit_force_generate_unsafe"));this.jit_clear_cache=c("jit_clear_cache_js");this.jit_dirty_cache=c("jit_dirty_cache");this.codegen_finalize_finished=c("codegen_finalize_finished");this.allocate_memory=c("allocate_memory");this.zero_memory=c("zero_memory");this.svga_allocate_memory=c("svga_allocate_memory");this.svga_allocate_dest_buffer=c("svga_allocate_dest_buffer");this.svga_fill_pixel_buffer=c("svga_fill_pixel_buffer");this.svga_mark_dirty=c("svga_mark_dirty");this.zstd_create_ctx=c("zstd_create_ctx");
this.zstd_get_src_ptr=c("zstd_get_src_ptr");this.zstd_free_ctx=c("zstd_free_ctx");this.zstd_read=c("zstd_read");this.zstd_read_free=c("zstd_read_free")};sa.prototype.jit_force_generate=function(b){this.jit_force_generate_unsafe?this.jit_force_generate_unsafe(b):H(!1,"Not supported in this wasm build: jit_force_generate_unsafe")};sa.prototype.jit_clear_func=function(b){H(0<=b&&900>b);this.wm.wasm_table.set(b+1024,null)};sa.prototype.jit_clear_all_funcs=function(){const b=this.wm.wasm_table;for(let c=
0;900>c;c++)b.set(1024+c,null)};sa.prototype.get_state=function(){var b=[];b[0]=this.memory_size[0];b[1]=this.segment_is_null;b[2]=this.segment_offsets;b[3]=this.segment_limits;b[4]=this.protected_mode[0];b[5]=this.idtr_offset[0];b[6]=this.idtr_size[0];b[7]=this.gdtr_offset[0];b[8]=this.gdtr_size[0];b[9]=this.page_fault[0];b[10]=this.cr;b[11]=this.cpl[0];b[13]=this.is_32[0];b[16]=this.stack_size_32[0];b[17]=this.in_hlt[0];b[18]=this.last_virt_eip[0];b[19]=this.eip_phys[0];b[22]=this.sysenter_cs[0];
b[23]=this.sysenter_eip[0];b[24]=this.sysenter_esp[0];b[25]=this.prefixes[0];b[26]=this.flags[0];b[27]=this.flags_changed[0];b[28]=this.last_op1[0];b[30]=this.last_op_size[0];b[37]=this.instruction_pointer[0];b[38]=this.previous_ip[0];b[39]=this.reg32;b[40]=this.sreg;b[41]=this.dreg;b[42]=this.reg_pdpte;this.store_current_tsc();b[43]=this.current_tsc;b[45]=this.devices.virtio_9p;b[46]=this.devices.apic;b[47]=this.devices.rtc;b[48]=this.devices.pci;b[49]=this.devices.dma;b[50]=this.devices.acpi;b[51]=
this.devices.hpet;b[52]=this.devices.vga;b[53]=this.devices.ps2;b[54]=this.devices.uart0;b[55]=this.devices.fdc;b[56]=this.devices.cdrom;b[57]=this.devices.hda;b[58]=this.devices.pit;b[59]=this.devices.net;b[60]=this.devices.pic;b[61]=this.devices.sb16;b[62]=this.fw_value;b[63]=this.devices.ioapic;b[64]=this.tss_size_32[0];b[66]=this.reg_xmm32s;b[67]=this.fpu_st;b[68]=this.fpu_stack_empty[0];b[69]=this.fpu_stack_ptr[0];b[70]=this.fpu_control_word[0];b[71]=this.fpu_ip[0];b[72]=this.fpu_ip_selector[0];
b[73]=this.fpu_dp[0];b[74]=this.fpu_dp_selector[0];b[75]=this.fpu_opcode[0];const {packed_memory:c,bitmap:g}=this.pack_memory();b[77]=c;b[78]=new Uint8Array(g.get_buffer());b[79]=this.devices.uart1;b[80]=this.devices.uart2;b[81]=this.devices.uart3;return b};sa.prototype.set_state=function(b){this.memory_size[0]=b[0];this.mem8.length!==this.memory_size[0]&&console.warn("Note: Memory size mismatch. we="+this.mem8.length+" state="+this.memory_size[0]);this.segment_is_null.set(b[1]);this.segment_offsets.set(b[2]);
this.segment_limits.set(b[3]);this.protected_mode[0]=b[4];this.idtr_offset[0]=b[5];this.idtr_size[0]=b[6];this.gdtr_offset[0]=b[7];this.gdtr_size[0]=b[8];this.page_fault[0]=b[9];this.cr.set(b[10]);this.cpl[0]=b[11];this.is_32[0]=b[13];this.stack_size_32[0]=b[16];this.in_hlt[0]=b[17];this.last_virt_eip[0]=b[18];this.eip_phys[0]=b[19];this.sysenter_cs[0]=b[22];this.sysenter_eip[0]=b[23];this.sysenter_esp[0]=b[24];this.prefixes[0]=b[25];this.flags[0]=b[26];this.flags_changed[0]=b[27];this.last_op1[0]=
b[28];this.last_op_size[0]=b[30];this.instruction_pointer[0]=b[37];this.previous_ip[0]=b[38];this.reg32.set(b[39]);this.sreg.set(b[40]);this.dreg.set(b[41]);b[42]&&this.reg_pdpte.set(b[42]);this.set_tsc(b[43][0],b[43][1]);this.devices.virtio_9p&&this.devices.virtio_9p.set_state(b[45]);this.devices.apic&&this.devices.apic.set_state(b[46]);this.devices.rtc&&this.devices.rtc.set_state(b[47]);this.devices.pci&&this.devices.pci.set_state(b[48]);this.devices.dma&&this.devices.dma.set_state(b[49]);this.devices.acpi&&
this.devices.acpi.set_state(b[50]);this.devices.hpet&&this.devices.hpet.set_state(b[51]);this.devices.vga&&this.devices.vga.set_state(b[52]);this.devices.ps2&&this.devices.ps2.set_state(b[53]);this.devices.uart0&&this.devices.uart0.set_state(b[54]);this.devices.fdc&&this.devices.fdc.set_state(b[55]);this.devices.cdrom&&this.devices.cdrom.set_state(b[56]);this.devices.hda&&this.devices.hda.set_state(b[57]);this.devices.pit&&this.devices.pit.set_state(b[58]);this.devices.net&&this.devices.net.set_state(b[59]);
this.devices.pic&&this.devices.pic.set_state(b[60]);this.devices.sb16&&this.devices.sb16.set_state(b[61]);this.devices.uart1&&this.devices.uart1.set_state(b[79]);this.devices.uart2&&this.devices.uart2.set_state(b[80]);this.devices.uart3&&this.devices.uart3.set_state(b[81]);this.fw_value=b[62];this.devices.ioapic&&this.devices.ioapic.set_state(b[63]);this.tss_size_32[0]=b[64];this.reg_xmm32s.set(b[66]);this.fpu_st.set(b[67]);this.fpu_stack_empty[0]=b[68];this.fpu_stack_ptr[0]=b[69];this.fpu_control_word[0]=
b[70];this.fpu_ip[0]=b[71];this.fpu_ip_selector[0]=b[72];this.fpu_dp[0]=b[73];this.fpu_dp_selector[0]=b[74];this.fpu_opcode[0]=b[75];const c=new aa.Bitmap(b[78].buffer);this.unpack_memory(c,b[77]);this.update_state_flags();this.full_clear_tlb();this.jit_clear_cache()};sa.prototype.pack_memory=function(){H(0===(this.mem8.length&4095));for(var b=this.mem8.length>>12,c=[],g=0;g<b;g++){var h=g<<12;h=this.mem32s.subarray(h>>2,h+4096>>2);let k=!0;for(let y=0;y<h.length;y++)if(0!==h[y]){k=!1;break}k||c.push(g)}b=
new aa.Bitmap(b);g=new Uint8Array(c.length<<12);for(let [k,y]of c.entries())b.set(y,1),c=y<<12,c=this.mem8.subarray(c,c+4096),g.set(c,k<<12);return{bitmap:b,packed_memory:g}};sa.prototype.unpack_memory=function(b,c){this.zero_memory(this.memory_size[0]);const g=this.memory_size[0]>>12;let h=0;for(let y=0;y<g;y++)if(b.get(y)){var k=h<<12;k=c.subarray(k,k+4096);this.mem8.set(k,y<<12);h++}};sa.prototype.main_run=function(){if(this.in_hlt[0]){var b=this.hlt_loop();if(this.in_hlt[0])return b}let c=b=f.microtick();
for(;1>c-b;){this.do_many_cycles();c=f.microtick();const g=this.run_hardware_timers(c);this.handle_irqs();if(this.in_hlt[0])return g}return 0};sa.prototype.reboot_internal=function(){this.reset_cpu();this.fw_value=[];this.devices.virtio&&this.devices.virtio.reset();this.load_bios()};sa.prototype.reset_memory=function(){this.mem8.fill(0)};sa.prototype.create_memory=function(b){1048576>b?b=1048576:0>(b|0)&&(b=Math.pow(2,31)-131072);b=(b-1|131071)+1|0;H(0<(b|0));H(0===(b&131071));console.assert(0===
this.memory_size[0],"Expected uninitialised memory");this.memory_size[0]=b;const c=this.allocate_memory(b);this.mem8=aa.view(Uint8Array,this.wasm_memory,c,b);this.mem32s=aa.view(Uint32Array,this.wasm_memory,c,b>>2)};ma.exportProperty(sa.prototype,"create_memory",sa.prototype.create_memory);sa.prototype.init=function(b,c){"number"===typeof b.log_level&&(Q=b.log_level);this.create_memory("number"===typeof b.memory_size?b.memory_size:67108864);b.cpuid_level&&this.set_cpuid_level(b.cpuid_level);this.acpi_enabled[0]=
+b.acpi;this.reset_cpu();var g=new l(this);this.io=g;this.bios.main=b.bios;this.bios.vga=b.vga_bios;this.load_bios();if(b.bzimage){const {option_rom:k}=ob(this.mem8,b.bzimage,b.initrd,b.cmdline||"");k&&this.option_roms.push(k)}g.register_read(179,this,function(){r("port 0xB3 read");return 0});var h=0;g.register_read(146,this,function(){return h});g.register_write(146,this,function(k){h=k});g.register_read(1297,this,function(){if(this.fw_pointer<this.fw_value.length)return this.fw_value[this.fw_pointer++];
H(!1,"config port: Read past value");return 0});g.register_write(1296,this,void 0,function(k){function y(ba){return new Uint8Array((new Int32Array([ba])).buffer)}function u(ba){return ba>>8|ba<<8&65280}function I(ba){return ba<<24|ba<<8&16711680|ba>>8&65280|ba>>>24}r("bios config port, index="+d(k));this.fw_pointer=0;if(0===k)this.fw_value=y(1431127377);else if(1===k)this.fw_value=y(0);else if(3===k)this.fw_value=y(this.memory_size[0]);else if(5===k)this.fw_value=y(1);else if(15===k)this.fw_value=
y(1);else if(13===k)this.fw_value=new Uint8Array(16);else if(25===k){k=new Int32Array(4+64*this.option_roms.length);const ba=new Uint8Array(k.buffer);k[0]=I(this.option_roms.length);for(let R=0;R<this.option_roms.length;R++){const {name:U,data:Y}=this.option_roms[R],fa=4+64*R;H(65536>49152+R);k[fa+0>>2]=I(Y.length);k[fa+4>>2]=u(49152+R);H(56>U.length);for(let na=0;na<U.length;na++)ba[fa+8+na]=U.charCodeAt(na)}this.fw_value=ba}else 32768<=k&&49152>k?this.fw_value=y(0):49152<=k&&k-49152<this.option_roms.length?
this.fw_value=this.option_roms[k-49152].data:(r("Warning: Unimplemented fw index: "+d(k)),this.fw_value=y(0))});N&&(g.register_write(128,this,function(k){}),g.register_read(128,this,function(){return 255}),g.register_write(233,this,function(k){}));this.devices={};b.load_devices&&(this.devices.pic=new J(this),this.devices.pci=new z(this),this.acpi_enabled[0]&&(this.devices.ioapic=new qa(this),this.devices.apic=new la(this),this.devices.acpi=new W(this)),this.devices.rtc=new X(this),this.fill_cmos(this.devices.rtc,
b),this.devices.dma=new A(this),V&&(this.devices.hpet=new S(this)),this.devices.vga=new E(this,c,b.vga_memory_size||8388608),this.devices.ps2=new M(this,c),this.devices.uart0=new ja(this,1016,c),b.uart1&&(this.devices.uart1=new ja(this,760,c)),b.uart2&&(this.devices.uart2=new ja(this,1E3,c)),b.uart3&&(this.devices.uart3=new ja(this,744,c)),this.devices.fdc=new C(this,b.fda,b.fdb),g=0,b.hda&&(this.devices.hda=new B(this,b.hda,b.hdb,!1,g++,c)),b.cdrom&&(this.devices.cdrom=new B(this,b.cdrom,void 0,
!0,g++,c)),this.devices.pit=new F(this,c),b.enable_ne2k&&(this.devices.net=new Aa(this,c,b.preserve_mac_from_state_image,b.mac_address_translation)),b.fs9p&&(this.devices.virtio_9p=new e(b.fs9p,this,c)),this.devices.sb16=new ya(this,c));b.multiboot&&this.load_multiboot(b.multiboot);N&&this.debug.init()};sa.prototype.load_multiboot=function(b){r("Trying multiboot from buffer of size "+b.byteLength,2);if(8192>b.byteLength){var c=new Int32Array(2048);(new Uint8Array(c.buffer)).set(new Uint8Array(b))}else c=
new Int32Array(b,0,2048);for(var g=0;8192>g;g+=4)if(464367618===c[g>>2]){var h=c[g+4>>2];if(464367618+h+c[g+8>>2]|0)r("Multiboot checksum check failed",2);else{r("Multiboot magic found, flags: "+d(h>>>0,8),2);H(0===(h&-65537),"TODO");this.reg32[0]=732803074;this.reg32[3]=31744;this.write32(31744,0);this.cr[0]=1;this.protected_mode[0]=1;this.flags[0]=2;this.is_32[0]=1;this.stack_size_32[0]=1;for(var k=0;6>k;k++)this.segment_is_null[k]=0,this.segment_offsets[k]=0,this.segment_limits[k]=4294967295,this.sreg[k]=
45058;if(h&65536){r("Multiboot specifies its own address table",2);k=c[g+12>>2];var y=c[g+16>>2];h=c[g+20>>2];var u=c[g+24>>2];c=c[g+28>>2];r("header="+d(k,8)+" load="+d(y,8)+" load_end="+d(h,8)+" bss_end="+d(u,8)+" entry="+d(c,8));H(y<=k);g-=k-y;0===h?h=void 0:(H(h>=y),h-=y);b=new Uint8Array(b,g,h);this.write_blob(b,y);this.instruction_pointer[0]=this.get_seg_cs()+c|0}else if(1179403647===c[0]){r("Multiboot image is in elf format",2);g=Xa(b);this.instruction_pointer[0]=this.get_seg_cs()+g.header.entry|
0;for(y of g.program_headers)0!==y.type&&(1===y.type?(H(y.paddr===y.vaddr),H(y.filesz<=y.memsz),y.paddr+y.memsz<this.memory_size[0]?y.filesz&&(g=new Uint8Array(b,y.offset,y.filesz),this.write_blob(g,y.paddr)):r("Warning: Skipped loading section, paddr="+d(y.paddr)+" memsz="+y.memsz,2)):2!==y.type&&3!==y.type&&4!==y.type&&6!==y.type&&1685382480!==y.type&&1685382481!==y.type&&1685382483!==y.type&&H(!1,"unimplemented elf section type: "+d(y.type)))}else H(!1,"Not a bootable multiboot format");this.io.register_write_consecutive(244,
this,function(I){console.log("Test exited with code "+d(I,2));throw"HALT";},function(){},function(){},function(){});for(let I=0;15>=I;I++){function ba(R){r("kvm-unit-test: Set irq "+d(I)+" to "+d(R,2));R?this.device_raise_irq(I):this.device_lower_irq(I)}this.io.register_write(8192+I,this,ba,ba,ba)}this.update_state_flags();r("Starting multiboot kernel at:",2);this.debug.dump_state();this.debug.dump_regs();break}}};sa.prototype.fill_cmos=function(b,c){var g=c.boot_order||531;b.cmos_write(56,1|g>>4&
240);b.cmos_write(61,g&255);b.cmos_write(21,128);b.cmos_write(22,2);g=0;1048576<=this.memory_size[0]&&(g=this.memory_size[0]-1048576>>10,g=Math.min(g,65535));b.cmos_write(23,g&255);b.cmos_write(24,g>>8&255);b.cmos_write(48,g&255);b.cmos_write(49,g>>8&255);g=0;16777216<=this.memory_size[0]&&(g=this.memory_size[0]-16777216>>16,g=Math.min(g,65535));b.cmos_write(52,g&255);b.cmos_write(53,g>>8&255);b.cmos_write(91,0);b.cmos_write(92,0);b.cmos_write(93,0);b.cmos_write(20,47);b.cmos_write(95,0);c.fastboot&&
b.cmos_write(63,1)};sa.prototype.load_bios=function(){var b=this.bios.main,c=this.bios.vga;if(b){var g=new Uint8Array(b);this.write_blob(g,1048576-b.byteLength);if(c){var h=new Uint8Array(c);this.write_blob(h,786432);this.io.mmap_register(4272947200,1048576,function(k){k=k-4272947200|0;return k<h.length?h[k]:0},function(k,y){H(!1,"Unexpected write to VGA rom")})}else r("Warning: No VGA BIOS");this.io.mmap_register(4293918720,1048576,function(k){return this.mem8[k&1048575]}.bind(this),function(k,y){this.mem8[k&
1048575]=y}.bind(this))}else r("Warning: No BIOS")};sa.prototype.do_many_cycles=function(){if(N)var b=f.microtick();this.do_many_cycles_native();N&&(this.do_many_cycles_total+=f.microtick()-b,this.do_many_cycles_count++)};sa.prototype.cycle=function(){this.cycle_internal()};ma.exportProperty(sa.prototype,"cycle",sa.prototype.cycle);sa.prototype.codegen_finalize=function(b,c,g,h,k){h>>>=0;k>>>=0;H(0<=b&&900>b);const y=new Uint8Array(this.wasm_memory.buffer,h,k);N&&(this.seen_code[c]=(this.seen_code[c]||
0)+1,this.test_hook_did_generate_wasm&&this.test_hook_did_generate_wasm(y));h=WebAssembly.instantiate(y,{e:this.jit_imports}).then(u=>{this.wm.wasm_table.set(b+1024,u.instance.exports.f);this.codegen_finalize_finished(b,c,g);this.test_hook_did_finalize_wasm&&this.test_hook_did_finalize_wasm(y)});N&&h.catch(u=>{console.log(u);debugger;throw u;})};sa.prototype.log_uncompiled_code=function(b,c){};sa.prototype.dump_function_code=function(b,c){};sa.prototype.hlt_loop=function(){if(this.get_eflags_no_arith()&
512){const b=this.run_hardware_timers(f.microtick());this.handle_irqs();return b}return 100};sa.prototype.run_hardware_timers=function(b){if(V)var c=this.devices.pit.timer(b,this.devices.hpet.legacy_mode),g=this.devices.rtc.timer(b,this.devices.hpet.legacy_mode),h=this.devices.hpet.timer(b);else c=this.devices.pit.timer(b,!1),g=this.devices.rtc.timer(b,!1),h=100;let k=100,y=100;this.acpi_enabled[0]&&(k=this.devices.acpi.timer(b),y=this.devices.apic.timer(b));return Math.min(c,g,h,k,y)};sa.prototype.hlt_op=
function(){0===(this.get_eflags_no_arith()&512)&&this.bus.send("cpu-event-halt");this.in_hlt[0]=1;this.hlt_loop()};sa.prototype.handle_irqs=function(){this.get_eflags_no_arith()&512&&(this.pic_acknowledge(),this.next_tick_immediately())};sa.prototype.pic_acknowledge=function(){H(this.get_eflags_no_arith()&512);this.devices.pic&&this.devices.pic.acknowledge_irq();this.devices.apic&&this.devices.apic.acknowledge_irq()};sa.prototype.device_raise_irq=function(b){H(1===arguments.length);this.devices.pic&&
this.devices.pic.set_irq(b);this.devices.ioapic&&this.devices.ioapic.set_irq(b)};sa.prototype.device_lower_irq=function(b){this.devices.pic&&this.devices.pic.clear_irq(b);this.devices.ioapic&&this.devices.ioapic.clear_irq(b)};"undefined"!==typeof window?window.CPU=sa:"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports.CPU=sa:"function"===typeof importScripts&&(self.CPU=sa);sa.prototype.debug_init=function(){function b(R){if(N){for(var U=k.protected_mode[0]?"prot":"real",
Y=k.get_eflags(),fa=k.getiopl(),na=k.cpl[0],oa=d(k.sreg[1],4)+":"+d(k.get_real_eip()>>>0,8),Ca=d(k.sreg[2],4)+":"+d(k.reg32[0]>>>0,8),Ya=k.is_32[0]?"32":"16",ib=k.flags[0]&512?1:0,zb={[1]:"c",[4]:"p",[16]:"a",[64]:"z",[128]:"s",[256]:"t",[512]:"i",[1024]:"d",[2048]:"o"},Ib="",vb=0;16>vb;vb++)zb[1<<vb]&&(Ib=Y&1<<vb?Ib+zb[1<<vb]:Ib+" ");return"mode="+U+"/"+Ya+" paging="+ +(0!==(k.cr[0]&-2147483648))+" pae="+ +(0!==(k.cr[4]&32))+" iopl="+fa+" cpl="+na+" if="+ib+" cs:eip="+oa+" cs_off="+d(k.get_seg_cs()>>>
0,8)+" flgs="+d(k.get_eflags()>>>0,6)+" ("+Ib+") ss:esp="+Ca+" ssize="+ +k.stack_size_32[0]+(R?" in "+R:"")}}function c(){if(N){for(var R={eax:0,ecx:1,edx:2,ebx:3,esp:4,ebp:5,esi:6,edi:7},U="eax ecx edx ebx esp ebp esi edi".split(" "),Y="",fa="",na=0;4>na;na++)Y+=U[na]+"="+d(k.reg32[R[U[na]]]>>>0,8)+" ",fa+=U[na+4]+"="+d(k.reg32[R[U[na+4]]]>>>0,8)+" ";Y+="  ds="+d(k.sreg[3],4)+" es="+d(k.sreg[0],4)+" fs="+d(k.sreg[4],4);fa+="  gs="+d(k.sreg[5],4)+" cs="+d(k.sreg[1],4)+" ss="+d(k.sreg[2],4);return[Y,
fa]}}function g(R,U,Y){if(N){if(!(R&1))return!1;var fa=128===(R&128);return{size:fa,global:256===(R&256),accessed:32===(R&32),dirty:64===(R&64),cache_disable:16===(R&16),user:4===(R&4),read_write:2===(R&2),address:(fa&&!Y?R&(U?4292870144:4290772992):R&4294963200)>>>0}}}function h(R,U,Y){if(N)for(var fa=U?512:1024,na=U?8:4,oa=U?21:22,Ca=0;Ca<fa;Ca++){var Ya=k.read32s(R+Ca*na),ib=g(Ya,U,!0);if(ib)if(Ya="",Ya+=ib.size?"S ":"  ",Ya+=ib.accessed?"A ":"  ",Ya+=ib.cache_disable?"Cd ":"  ",Ya+=ib.user?"U ":
"  ",Ya+=ib.read_write?"Rw ":"   ",ib.size)r("=== "+d(Y+(Ca<<oa)>>>0,8)+" -> "+d(ib.address>>>0,8)+" | "+Ya);else{r("=== "+d(Y+(Ca<<oa)>>>0,8)+" | "+Ya);for(var zb=0;zb<fa;zb++){var Ib=ib.address+zb*na;Ya=k.read32s(Ib);var vb=g(Ya,U,!1);vb&&(Ya="",Ya+=vb.cache_disable?"Cd ":"   ",Ya+=vb.user?"U ":"  ",Ya+=vb.read_write?"Rw ":"   ",Ya+=vb.global?"G ":"  ",Ya+=vb.accessed?"A ":"  ",Ya+=vb.dirty?"Di ":"   ",r("# "+d(Y+(Ca<<oa|zb<<12)>>>0,8)+" -> "+d(vb.address,8)+" | "+Ya+"        (at "+d(Ib,8)+")"))}}}}
var k=this,y={};this.debug=y;y.init=function(){function R(Y){10===Y?(r(U,4096),U=""):U+=String.fromCharCode(Y)}if(N&&k.io){var U="";k.io.register_write(1026,this,R);k.io.register_write(1280,this,R)}};y.get_regs_short=c;y.dump_regs=function(){if(N){var R=c();r(R[0],2);r(R[1],2)}};y.get_state=b;y.dump_state=function(R){N&&r(b(R),2)};y.dump_stack=function(R,U){if(N){var Y=k.reg32[4];r("========= STACK ==========");if(U>=R||void 0===U)R=5,U=-5;for(;R>U;R--){var fa="    ";R||(fa="=>  ");fa+=d(R,2)+" | ";
r(fa+d(Y+4*R,8)+" | "+d(k.read32s(Y+4*R)>>>0))}}};y.dump_page_structures=function(){if(k.cr[4]&32){r("PAE enabled");for(var R=0;4>R;R++){var U=k.read32s(k.cr[3]+8*R);U&1&&h(U&4294963200,!0,R<<30)}}else r("PAE disabled"),h(k.cr[3],!1,0)};y.dump_gdt_ldt=function(){function R(U,Y){for(var fa=0;fa<Y;fa+=8,U+=8){var na=k.read16(U+2)|k.read8(U+4)<<16|k.read8(U+7)<<24,oa=k.read16(U)|(k.read8(U+6)&15)<<16,Ca=k.read8(U+5),Ya=k.read8(U+6)>>4,ib="",zb=Ca>>5&3;ib=Ca&128?ib+" P ":ib+"NP ";Ca&16?(ib=Ya&4?ib+"32b ":
ib+"16b ",Ca&8?(ib+="X ",Ca&4&&(ib+="C ")):ib+="R ",ib+="RW "):ib+="sys: "+d(Ca&15);Ya&8&&(oa=oa<<12|4095);r(d(fa&-8,4)+" "+d(na>>>0,8)+" ("+d(oa>>>0,8)+" bytes) "+ib+";  dpl = "+zb+", a = "+Ca.toString(2)+", f = "+Ya.toString(2))}}N&&(r("gdt: (len = "+d(k.gdtr_size[0])+")"),R(k.translate_address_system_read(k.gdtr_offset[0]),k.gdtr_size[0]),r("\nldt: (len = "+d(k.segment_limits[7])+")"),R(k.translate_address_system_read(k.segment_offsets[7]),k.segment_limits[7]))};y.dump_idt=function(){if(N)for(var R=
0;R<k.idtr_size[0];R+=8){var U=k.translate_address_system_read(k.idtr_offset[0]+R),Y=k.read16(U)|k.read16(U+6)<<16,fa=k.read16(U+2);U=k.read8(U+5);var na=U>>5&3,oa=5===(U&31)?"task gate ":14===(U&31)?"intr gate ":15===(U&31)?"trap gate ":"invalid   ";oa=U&128?oa+" P":oa+"NP";r(d(R>>3,4)+" "+d(Y>>>0,8)+", "+d(fa,4)+"; "+oa+";  dpl = "+na+", t = "+U.toString(2))}};y.get_memory_dump=function(R,U){if(N)return void 0===R?(R=0,U=k.memory_size[0]):void 0===U&&(U=R,R=0),k.mem8.slice(R,R+U).buffer};y.memory_hex_dump=
function(R,U){if(N){U=U||64;for(var Y,fa,na=0;na<U>>4;na++){Y=d(R+(na<<4),5)+"   ";for(var oa=0;16>oa;oa++)fa=k.read8(R+(na<<4)+oa),Y+=d(fa,2)+" ";Y+="  ";for(oa=0;16>oa;oa++)fa=k.read8(R+(na<<4)+oa),Y+=33>fa||126<fa?".":String.fromCharCode(fa);r(Y)}}};y.used_memory_dump=function(){if(N)for(var R=k.memory_size[0]/128/16|0,U,Y=0;16>Y;Y++){U=d(128*Y*R,8)+" | ";for(var fa=0;128>fa;fa++)U+=0<k.mem32s[(128*Y+fa)*R]?"X":" ";r(U)}};y.debug_interrupt=function(R){};let u,I;y.dump_code=function(R,U,Y){if(!I){if(void 0===
u&&(u="function"===typeof require?require("./capstone-x86.min.js"):window.cs,void 0===u)){r("Warning: Missing capstone library, disassembly not available");return}I=[new u.Capstone(u.ARCH_X86,u.MODE_16),new u.Capstone(u.ARCH_X86,u.MODE_32)]}try{I[R].disasm(U,Y).forEach(function(fa){r(d(fa.address>>>0)+": "+aa.pads(fa.bytes.map(na=>d(na,2).slice(-2)).join(" "),20)+" "+fa.mnemonic+" "+fa.op_str)}),r("")}catch(fa){r("Could not disassemble: "+Array.from(U).map(na=>d(na,2)).join(" "))}};let ba;y.dump_wasm=
function(R){if(void 0===ba&&(ba="function"===typeof require?require("./libwabt.js"):new window.WabtModule,void 0===ba))r("Warning: Missing libwabt, wasm dump not available");else{R=R.slice();try{var U=ba.readWasm(R,{readDebugNames:!1});U.generateNames();U.applyNames();const na=U.toText({foldExprs:!0,inlineExport:!0});r(na)}catch(na){var Y=new Blob([R]),fa=document.createElement("a");fa.download="failed.wasm";fa.href=window.URL.createObjectURL(Y);fa.dataset.downloadurl=["application/octet-stream",
fa.download,fa.href].join(":");fa.click();window.URL.revokeObjectURL(fa.src);console.log(na.toString())}finally{U&&U.destroy()}}}};let Wb=DataView.prototype,Yb={size:1,get:Wb.getUint8,set:Wb.setUint8},Rb={size:2,get:Wb.getUint16,set:Wb.setUint16},yb={size:4,get:Wb.getUint32,set:Wb.setUint32},ec=Ra([{magic:yb},{class:Yb},{data:Yb},{version0:Yb},{osabi:Yb},{abiversion:Yb},{pad0:function(b){return{size:b,get:c=>-1}}(7)},{type:Rb},{machine:Rb},{version1:yb},{entry:yb},{phoff:yb},{shoff:yb},{flags:yb},
{ehsize:Rb},{phentsize:Rb},{phnum:Rb},{shentsize:Rb},{shnum:Rb},{shstrndx:Rb}]);console.assert(52===ec.reduce((b,c)=>b+c.size,0));let fc=Ra([{type:yb},{offset:yb},{vaddr:yb},{paddr:yb},{filesz:yb},{memsz:yb},{flags:yb},{align:yb}]);console.assert(32===fc.reduce((b,c)=>b+c.size,0));let gc=Ra([{name:yb},{type:yb},{flags:yb},{addr:yb},{offset:yb},{size:yb},{link:yb},{info:yb},{addralign:yb},{entsize:yb}]);console.assert(40===gc.reduce((b,c)=>b+c.size,0));Db.prototype.destroy=function(){this.audio_context&&
this.audio_context.close();this.dac&&this.dac.node_processor&&this.dac.node_processor.port.close()};T.prototype.add_source=function(b,c){b=new ca(this.audio_context,b,this.input_left,this.input_right);H(!this.sources.has(c),"Mixer add source - overwritting source: "+c);this.sources.set(c,b);return b};T.prototype.connect_source=function(b,c){var g=this.sources.get(b);void 0===g?H(!1,"Mixer connect - cannot connect undefined source: "+b):g.connect(c)};T.prototype.disconnect_source=function(b,c){var g=
this.sources.get(b);void 0===g?H(!1,"Mixer disconnect - cannot disconnect undefined source: "+b):g.disconnect(c)};T.prototype.set_volume=function(b,c){void 0===c&&(c=2);switch(c){case 0:this.volume_left=b;break;case 1:this.volume_right=b;break;case 2:this.volume_both=b;break;default:H(!1,"Mixer set master volume - unknown channel: "+c);return}this.update()};T.prototype.update=function(){var b=this.volume_both*this.volume_right*this.gain_right;this.node_gain_left.gain.setValueAtTime(this.volume_both*
this.volume_left*this.gain_left,this.audio_context.currentTime);this.node_gain_right.gain.setValueAtTime(b,this.audio_context.currentTime)};ca.prototype.update=function(){var b=this.connected_right*this.gain_hidden*this.volume_both*this.volume_right;this.node_gain_left.gain.setValueAtTime(this.connected_left*this.gain_hidden*this.volume_both*this.volume_left,this.audio_context.currentTime);this.node_gain_right.gain.setValueAtTime(b,this.audio_context.currentTime)};ca.prototype.connect=function(b){var c=
!b||2===b;if(c||0===b)this.connected_left=!0;if(c||1===b)this.connected_right=!0;this.update()};ca.prototype.disconnect=function(b){var c=!b||2===b;if(c||0===b)this.connected_left=!1;if(c||1===b)this.connected_right=!1;this.update()};ca.prototype.set_volume=function(b,c){void 0===c&&(c=2);switch(c){case 0:this.volume_left=b;break;case 1:this.volume_right=b;break;case 2:this.volume_both=b;break;default:H(!1,"Mixer set volume - unknown channel: "+c);return}this.update()};ca.prototype.set_gain_hidden=
function(b){this.gain_hidden=b};ia.prototype.start=function(){this.node_oscillator.start()};ta.prototype.queue=function(b){this.node_processor&&(N&&this.debugger.push_queued_data(b),this.node_processor.port.postMessage({type:"queue",value:b},[b[0].buffer,b[1].buffer]))};ta.prototype.pump=function(){this.enabled&&this.bus.send("dac-request-data")};Da.prototype.queue=function(b){N&&this.debugger.push_queued_data(b);var c=b[0].length,g=c/this.sampling_rate;if(1<this.rate_ratio)for(var h=this.audio_context.createBuffer(2,
c*this.rate_ratio,this.sampling_rate*this.rate_ratio),k=h.getChannelData(0),y=h.getChannelData(1),u=0,I=0;I<c;I++)for(var ba=0;ba<this.rate_ratio;ba++,u++)k[u]=b[0][I],y[u]=b[1][I];else h=this.audio_context.createBuffer(2,c,this.sampling_rate),h.copyToChannel?(h.copyToChannel(b[0],0),h.copyToChannel(b[1],1)):(h.getChannelData(0).set(b[0]),h.getChannelData(1).set(b[1]));b=this.audio_context.createBufferSource();b.buffer=h;b.connect(this.node_lowpass);b.addEventListener("ended",this.pump.bind(this));
h=this.audio_context.currentTime;if(this.buffered_time<h)for(r("Speaker DAC - Creating/Recreating reserve - shouldn't occur frequently during playback"),this.buffered_time=h,h=.2-g,c=0;c<=h;)c+=g,this.buffered_time+=g,setTimeout(()=>this.pump(),1E3*c);b.start(this.buffered_time);this.buffered_time+=g;setTimeout(()=>this.pump(),0)};Da.prototype.pump=function(){this.enabled&&(.2<this.buffered_time-this.audio_context.currentTime||this.bus.send("dac-request-data"))};Va.prototype.start=function(b){this.is_active=
!0;this.queued=[[],[]];this.output=[[],[]];this.queued_history.push(this.queued);this.output_history.push(this.output);this.node_processor=this.audio_context.createScriptProcessor(1024,2,2);this.node_processor.onaudioprocess=c=>{this.output[0].push(c.inputBuffer.getChannelData(0).slice());this.output[1].push(c.inputBuffer.getChannelData(1).slice())};this.node_source.connect(this.node_processor);this.node_processor.connect(this.node_gain);setTimeout(()=>{this.stop()},b)};Va.prototype.stop=function(){this.is_active=
!1;this.node_source.disconnect(this.node_processor);this.node_processor.disconnect();this.node_processor=null};Va.prototype.push_queued_data=function(b){this.is_active&&(this.queued[0].push(b[0].slice()),this.queued[1].push(b[1].slice()))};Va.prototype.download_txt=function(b,c){b=this.output_history[b][c].map(g=>g.join(" ")).join(" ");n(b,"dacdata.txt")};Va.prototype.download_csv=function(b){b=this.output_history[b];for(var c=[],g=0;g<b[0].length;g++)for(var h=0;h<b[0][g].length;h++)c.push(`${b[0][g][h]},${b[1][g][h]}`);
n(c.join("\n"),"dacdata.csv")};eb.prototype.show=function(){this.term&&this.term.open(this.element)};Ka.prototype.handle_message=function(b){this.bus&&this.bus.send("net0-receive",new Uint8Array(b.data))};Ka.prototype.handle_close=function(b){this.connect();setTimeout(this.connect.bind(this),this.reconnect_interval)};Ka.prototype.handle_open=function(b){for(b=0;b<this.send_queue.length;b++)this.send(this.send_queue[b]);this.send_queue=[]};Ka.prototype.handle_error=function(b){};Ka.prototype.destroy=
function(){this.socket&&this.socket.close()};Ka.prototype.connect=function(){if("undefined"!==typeof WebSocket){if(this.socket){var b=this.socket.readyState;if(0===b||1===b)return}b=Date.now();this.last_connect_attempt+this.reconnect_interval>b||(this.last_connect_attempt=Date.now(),this.socket=new WebSocket(this.url),this.socket.binaryType="arraybuffer",this.socket.onopen=this.handle_open.bind(this),this.socket.onmessage=this.handle_message.bind(this),this.socket.onclose=this.handle_close.bind(this),
this.socket.onerror=this.handle_error.bind(this))}};Ka.prototype.send=function(b){this.socket&&1===this.socket.readyState?this.socket.send(b):(this.send_queue.push(b),this.send_queue.length>2*this.send_queue_limit&&(this.send_queue=this.send_queue.slice(-this.send_queue_limit)),this.connect())};Ka.prototype.change_proxy=function(b){this.url=b;this.socket&&(this.socket.onclose=function(){},this.socket.onerror=function(){},this.socket.close(),this.socket=void 0)};ua.prototype.continue_init=async function(b,
c){function g(na,oa){switch(na){case "hda":y.hda=this.disk_images.hda=oa;break;case "hdb":y.hdb=this.disk_images.hdb=oa;break;case "cdrom":y.cdrom=this.disk_images.cdrom=oa;break;case "fda":y.fda=this.disk_images.fda=oa;break;case "fdb":y.fdb=this.disk_images.fdb=oa;break;case "multiboot":y.multiboot=this.disk_images.multiboot=oa.buffer;break;case "bzimage":y.bzimage=this.disk_images.bzimage=oa.buffer;break;case "initrd":y.initrd=this.disk_images.initrd=oa.buffer;break;case "bios":y.bios=oa.buffer;
break;case "vga_bios":y.vga_bios=oa.buffer;break;case "initial_state":y.initial_state=oa.buffer;break;case "fs9p_json":y.fs9p_json=oa;break;default:H(!1,na)}}function h(na,oa){if(oa)if(oa.get&&oa.set&&oa.load)u.push({name:na,loadable:oa});else{if("bios"===na||"vga_bios"===na||"initial_state"===na||"multiboot"===na||"bzimage"===na||"initrd"===na)oa.async=!1;oa.buffer instanceof ArrayBuffer?(oa=new aa.SyncBuffer(oa.buffer),u.push({name:na,loadable:oa})):"undefined"!==typeof File&&oa.buffer instanceof
File?(void 0===oa.async&&(oa.async=268435456<=oa.buffer.size),oa=oa.async?new aa.AsyncFileBuffer(oa.buffer):new aa.SyncFileBuffer(oa.buffer),u.push({name:na,loadable:oa})):oa.url?oa.async?(oa=oa.use_parts?new aa.AsyncXHRPartfileBuffer(oa.url,oa.size,oa.fixed_chunk_size):new aa.AsyncXHRBuffer(oa.url,oa.size,oa.fixed_chunk_size),u.push({name:na,loadable:oa})):u.push({name:na,url:oa.url,size:oa.size}):r("Ignored file: url="+oa.url+" buffer="+oa.buffer)}}async function k(){if(y.fs9p&&y.fs9p_json){if(y.initial_state?
r("Filesystem basefs ignored: Overridden by state image"):y.fs9p.load_from_json(y.fs9p_json),c.bzimage_initrd_from_filesystem){const {bzimage_path:na,initrd_path:oa}=this.get_bzimage_initrd_from_filesystem(y.fs9p);r("Found bzimage: "+na+" and initrd: "+oa);const [Ca,Ya]=await Promise.all([y.fs9p.read_file(oa),y.fs9p.read_file(na)]);g.call(this,"initrd",new aa.SyncBuffer(Ca.buffer));g.call(this,"bzimage",new aa.SyncBuffer(Ya.buffer))}}else H(!c.bzimage_initrd_from_filesystem,"bzimage_initrd_from_filesystem: Requires a filesystem");
this.serial_adapter&&this.serial_adapter.show&&this.serial_adapter.show();this.bus.send("cpu-init",y);y.initial_state&&(b.restore_state(y.initial_state),y.initial_state=void 0);c.autostart&&this.bus.send("cpu-run");this.emulator_bus.send("emulator-loaded")}this.bus.register("emulator-stopped",function(){this.cpu_is_running=!1},this);this.bus.register("emulator-started",function(){this.cpu_is_running=!0},this);var y={};this.disk_images={fda:void 0,fdb:void 0,hda:void 0,hdb:void 0,cdrom:void 0};y.acpi=
c.acpi;y.load_devices=!0;y.log_level=c.log_level;y.memory_size=c.memory_size||67108864;y.vga_memory_size=c.vga_memory_size||8388608;y.boot_order=c.boot_order||531;y.fastboot=c.fastboot||!1;y.fda=void 0;y.fdb=void 0;y.uart1=c.uart1;y.uart2=c.uart2;y.uart3=c.uart3;y.cmdline=c.cmdline;y.preserve_mac_from_state_image=c.preserve_mac_from_state_image;y.mac_address_translation=c.mac_address_translation;y.cpuid_level=c.cpuid_level;c.network_adapter?this.network_adapter=c.network_adapter(this.bus):c.network_relay_url&&
(this.network_adapter=new Ka(c.network_relay_url,this.bus));y.enable_ne2k=!0;c.disable_keyboard||(this.keyboard_adapter=new Ob(this.bus));c.disable_mouse||(this.mouse_adapter=new db(this.bus,c.screen_container));c.screen_container?this.screen_adapter=new t(c.screen_container,this.bus):c.screen_dummy&&(this.screen_adapter=new Ab(this.bus));c.serial_container&&(this.serial_adapter=new Za(c.serial_container,this.bus));c.serial_container_xtermjs&&(this.serial_adapter=new eb(c.serial_container_xtermjs,
this.bus));c.disable_speaker||(this.speaker_adapter=new Db(this.bus));var u=[];c.state&&console.warn("Warning: Unknown option 'state'. Did you mean 'initial_state'?");for(var I="bios vga_bios cdrom hda hdb fda fdb initial_state multiboot bzimage initrd".split(" "),ba=0;ba<I.length;ba++)h(I[ba],c[I[ba]]);if(c.filesystem){I=c.filesystem.basefs;ba=c.filesystem.baseurl;let na=new sb;ba&&(na=new qb(na,ba));y.fs9p=c.filesystem.fs?this.fs9p=c.filesystem:this.fs9p=new ka(na);if(I){H(ba,"Filesystem: baseurl must be specified");
if("object"===typeof I){var R=I.size;I=I.url}H("string"===typeof I);u.push({name:"fs9p_json",url:I,size:R,as_json:!0})}}var U=this,Y=u.length,fa=function(na){if(na===Y)setTimeout(k.bind(this),0);else{var oa=u[na];oa.loadable?(oa.loadable.onload=function(Ca){g.call(this,oa.name,oa.loadable);fa(na+1)}.bind(this),oa.loadable.load()):aa.load_file(oa.url,{done:function(Ca){g.call(this,oa.name,oa.as_json?Ca:new aa.SyncBuffer(Ca));fa(na+1)}.bind(this),progress:function(Ca){200===Ca.target.status?U.emulator_bus.send("download-progress",
{file_index:na,file_count:Y,file_name:oa.url,lengthComputable:Ca.lengthComputable,total:Ca.total||oa.size,loaded:Ca.loaded}):U.emulator_bus.send("download-error",{file_index:na,file_count:Y,file_name:oa.url,request:Ca.target})},as_json:oa.as_json})}}.bind(this);fa(0)};ua.prototype.get_bzimage_initrd_from_filesystem=function(b){const c=(b.read_dir("/")||[]).map(k=>"/"+k);b=(b.read_dir("/boot/")||[]).map(k=>"/boot/"+k);let g,h;for(let k of[].concat(c,b)){const y=/old/i.test(k)||/fallback/i.test(k),
u=/vmlinuz/i.test(k)||/bzimage/i.test(k),I=/initrd/i.test(k)||/initramfs/i.test(k);!u||h&&y||(h=k);!I||g&&y||(g=k)}g&&h||(console.log("Failed to find bzimage or initrd in filesystem. Files:"),console.log(c.join(" ")),console.log(b.join(" ")));return{initrd_path:g,bzimage_path:h}};ua.prototype.run=async function(){this.bus.send("cpu-run")};ma.exportProperty(ua.prototype,"run",ua.prototype.run);ua.prototype.stop=async function(){this.cpu_is_running&&await new Promise(b=>{const c=()=>{this.remove_listener("emulator-stopped",
c);b()};this.add_listener("emulator-stopped",c);this.bus.send("cpu-stop")})};ma.exportProperty(ua.prototype,"stop",ua.prototype.stop);ua.prototype.destroy=async function(){await this.stop();this.v86.destroy();this.keyboard_adapter&&this.keyboard_adapter.destroy();this.network_adapter&&this.network_adapter.destroy();this.mouse_adapter&&this.mouse_adapter.destroy();this.screen_adapter&&this.screen_adapter.destroy();this.serial_adapter&&this.serial_adapter.destroy();this.speaker_adapter&&this.speaker_adapter.destroy()};
ma.exportProperty(ua.prototype,"destroy",ua.prototype.destroy);ua.prototype.restart=function(){this.bus.send("cpu-restart")};ma.exportProperty(ua.prototype,"restart",ua.prototype.restart);ua.prototype.add_listener=function(b,c){this.bus.register(b,c,this)};ma.exportProperty(ua.prototype,"add_listener",ua.prototype.add_listener);ua.prototype.remove_listener=function(b,c){this.bus.unregister(b,c)};ma.exportProperty(ua.prototype,"remove_listener",ua.prototype.remove_listener);ua.prototype.restore_state=
async function(b){H(1===arguments.length);this.v86.restore_state(b)};ma.exportProperty(ua.prototype,"restore_state",ua.prototype.restore_state);ua.prototype.save_state=async function(){H(0===arguments.length);return this.v86.save_state()};ma.exportProperty(ua.prototype,"save_state",ua.prototype.save_state);ua.prototype.get_statistics=function(){console.warn("V86Starter.prototype.get_statistics is deprecated. Use events instead.");var b={cpu:{instruction_counter:this.get_instruction_counter()}};if(!this.v86)return b;
var c=this.v86.cpu.devices;c.hda&&(b.hda=c.hda.stats);c.cdrom&&(b.cdrom=c.cdrom.stats);c.ps2&&(b.mouse={enabled:c.ps2.use_mouse});c.vga&&(b.vga={is_graphical:c.vga.stats.is_graphical});return b};ma.exportProperty(ua.prototype,"get_statistics",ua.prototype.get_statistics);ua.prototype.get_instruction_counter=function(){return this.v86?this.v86.cpu.instruction_counter[0]>>>0:0};ma.exportProperty(ua.prototype,"get_instruction_counter",ua.prototype.get_instruction_counter);ua.prototype.is_running=function(){return this.cpu_is_running};
ma.exportProperty(ua.prototype,"is_running",ua.prototype.is_running);ua.prototype.keyboard_send_scancodes=function(b){for(var c=0;c<b.length;c++)this.bus.send("keyboard-code",b[c])};ma.exportProperty(ua.prototype,"keyboard_send_scancodes",ua.prototype.keyboard_send_scancodes);ua.prototype.keyboard_send_keys=function(b){for(var c=0;c<b.length;c++)this.keyboard_adapter.simulate_press(b[c])};ma.exportProperty(ua.prototype,"keyboard_send_keys",ua.prototype.keyboard_send_keys);ua.prototype.keyboard_send_text=
function(b){for(var c=0;c<b.length;c++)this.keyboard_adapter.simulate_char(b[c])};ma.exportProperty(ua.prototype,"keyboard_send_text",ua.prototype.keyboard_send_text);ua.prototype.screen_make_screenshot=function(){return this.screen_adapter?this.screen_adapter.make_screenshot():null};ma.exportProperty(ua.prototype,"screen_make_screenshot",ua.prototype.screen_make_screenshot);ua.prototype.screen_set_scale=function(b,c){this.screen_adapter&&this.screen_adapter.set_scale(b,c)};ma.exportProperty(ua.prototype,
"screen_set_scale",ua.prototype.screen_set_scale);ua.prototype.screen_go_fullscreen=function(){if(this.screen_adapter){var b=document.getElementById("screen_container");if(b){var c=b.requestFullScreen||b.webkitRequestFullscreen||b.mozRequestFullScreen||b.msRequestFullScreen;c&&(c.call(b),(b=document.getElementsByClassName("phone_keyboard")[0])&&b.focus());try{navigator.keyboard.lock()}catch(g){}this.lock_mouse()}}};ma.exportProperty(ua.prototype,"screen_go_fullscreen",ua.prototype.screen_go_fullscreen);
ua.prototype.lock_mouse=function(){var b=document.body,c=b.requestPointerLock||b.mozRequestPointerLock||b.webkitRequestPointerLock;c&&c.call(b)};ma.exportProperty(ua.prototype,"lock_mouse",ua.prototype.lock_mouse);ua.prototype.mouse_set_status=function(b){this.mouse_adapter&&(this.mouse_adapter.emu_enabled=b)};ua.prototype.keyboard_set_status=function(b){this.keyboard_adapter&&(this.keyboard_adapter.emu_enabled=b)};ma.exportProperty(ua.prototype,"keyboard_set_status",ua.prototype.keyboard_set_status);
ua.prototype.serial0_send=function(b){for(var c=0;c<b.length;c++)this.bus.send("serial0-input",b.charCodeAt(c))};ma.exportProperty(ua.prototype,"serial0_send",ua.prototype.serial0_send);ua.prototype.serial_send_bytes=function(b,c){for(var g=0;g<c.length;g++)this.bus.send("serial"+b+"-input",c[g])};ma.exportProperty(ua.prototype,"serial_send_bytes",ua.prototype.serial_send_bytes);ua.prototype.mount_fs=async function(b,c,g,h){let k=new sb;c&&(k=new qb(k,c));const y=new ka(k,this.fs9p.qidcounter),u=
()=>{const I=this.fs9p.Mount(b,y);h&&(-2===I?h(new lb):-17===I?h(new kb):0>I?(H(!1,"Unexpected error code: "+-I),h(Error("Failed to mount. Error number: "+-I))):h(null))};c?(H("object"===typeof g,"Filesystem: basefs must be a JSON object"),y.load_from_json(g,()=>u())):u()};ma.exportProperty(ua.prototype,"mount_fs",ua.prototype.mount_fs);ua.prototype.create_file=async function(b,c){H(2===arguments.length);var g=this.fs9p;if(g){var h=b.split("/");h=h[h.length-1];var k=g.SearchPath(b).parentid;if(""!==
h&&-1!==k)await g.CreateBinaryFile(h,k,c);else return Promise.reject(new lb)}};ma.exportProperty(ua.prototype,"create_file",ua.prototype.create_file);ua.prototype.read_file=async function(b){H(1===arguments.length);var c=this.fs9p;if(c)return(c=await c.read_file(b))?c:Promise.reject(new lb)};ma.exportProperty(ua.prototype,"read_file",ua.prototype.read_file);ua.prototype.automatically=function(b){const c=g=>{const h=g[0];if(h){var k=g.slice(1);if(h.sleep)setTimeout(()=>c(k),1E3*h.sleep);else if(h.vga_text){const y=
this.screen_adapter.get_text_screen();for(let u of y)if(u.includes(h.vga_text)){c(k);return}setTimeout(()=>c(g),1E3)}else h.keyboard_send?(h.keyboard_send instanceof Array?this.keyboard_send_scancodes(h.keyboard_send):(H("string"===typeof h.keyboard_send),this.keyboard_send_text(h.keyboard_send)),c(k)):h.call?(h.call(),c(k)):H(!1,h)}};c(b)};ua.prototype.read_memory=function(b,c){return this.v86.cpu.read_blob(b,c)};ua.prototype.write_memory=function(b,c){this.v86.cpu.write_blob(b,c)};kb.prototype=
Error.prototype;lb.prototype=Error.prototype;"undefined"!==typeof window?(window.V86Starter=ua,window.V86=ua):"undefined"!==typeof module&&"undefined"!==typeof module.exports?(module.exports.V86Starter=ua,module.exports.V86=ua):"function"===typeof importScripts&&(self.V86Starter=ua,self.V86=ua);const Sb={stats_to_string:function(b){return Sb.print_misc_stats(b)+Sb.print_instruction_counts(b)},print_misc_stats:function(b){let c="";var g="COMPILE COMPILE_SKIPPED_NO_NEW_ENTRY_POINTS COMPILE_WRONG_ADDRESS_SPACE COMPILE_CUT_OFF_AT_END_OF_PAGE COMPILE_WITH_LOOP_SAFETY COMPILE_PAGE COMPILE_PAGE/COMPILE COMPILE_BASIC_BLOCK COMPILE_DUPLICATED_BASIC_BLOCK COMPILE_WASM_BLOCK COMPILE_WASM_LOOP COMPILE_DISPATCHER COMPILE_ENTRY_POINT COMPILE_WASM_TOTAL_BYTES COMPILE_WASM_TOTAL_BYTES/COMPILE_PAGE RUN_INTERPRETED RUN_INTERPRETED_NEW_PAGE RUN_INTERPRETED_PAGE_HAS_CODE RUN_INTERPRETED_PAGE_HAS_ENTRY_AFTER_PAGE_WALK RUN_INTERPRETED_NEAR_END_OF_PAGE RUN_INTERPRETED_DIFFERENT_STATE RUN_INTERPRETED_DIFFERENT_STATE_CPL3 RUN_INTERPRETED_DIFFERENT_STATE_FLAT RUN_INTERPRETED_DIFFERENT_STATE_IS32 RUN_INTERPRETED_DIFFERENT_STATE_SS32 RUN_INTERPRETED_MISSED_COMPILED_ENTRY_RUN_INTERPRETED RUN_INTERPRETED_STEPS RUN_FROM_CACHE RUN_FROM_CACHE_STEPS RUN_FROM_CACHE_STEPS/RUN_FROM_CACHE RUN_FROM_CACHE_STEPS/RUN_INTERPRETED_STEPS DIRECT_EXIT INDIRECT_JUMP INDIRECT_JUMP_NO_ENTRY NORMAL_PAGE_CHANGE NORMAL_FALLTHRU NORMAL_FALLTHRU_WITH_TARGET_BLOCK NORMAL_BRANCH NORMAL_BRANCH_WITH_TARGET_BLOCK CONDITIONAL_JUMP CONDITIONAL_JUMP_PAGE_CHANGE CONDITIONAL_JUMP_EXIT CONDITIONAL_JUMP_FALLTHRU CONDITIONAL_JUMP_FALLTHRU_WITH_TARGET_BLOCK CONDITIONAL_JUMP_BRANCH CONDITIONAL_JUMP_BRANCH_WITH_TARGET_BLOCK DISPATCHER_SMALL DISPATCHER_LARGE LOOP LOOP_SAFETY CONDITION_OPTIMISED CONDITION_UNOPTIMISED CONDITION_UNOPTIMISED_PF CONDITION_UNOPTIMISED_UNHANDLED_L CONDITION_UNOPTIMISED_UNHANDLED_LE FAILED_PAGE_CHANGE SAFE_READ_FAST SAFE_READ_SLOW_PAGE_CROSSED SAFE_READ_SLOW_NOT_VALID SAFE_READ_SLOW_NOT_USER SAFE_READ_SLOW_IN_MAPPED_RANGE SAFE_WRITE_FAST SAFE_WRITE_SLOW_PAGE_CROSSED SAFE_WRITE_SLOW_NOT_VALID SAFE_WRITE_SLOW_NOT_USER SAFE_WRITE_SLOW_IN_MAPPED_RANGE SAFE_WRITE_SLOW_READ_ONLY SAFE_WRITE_SLOW_HAS_CODE SAFE_READ_WRITE_FAST SAFE_READ_WRITE_SLOW_PAGE_CROSSED SAFE_READ_WRITE_SLOW_NOT_VALID SAFE_READ_WRITE_SLOW_NOT_USER SAFE_READ_WRITE_SLOW_IN_MAPPED_RANGE SAFE_READ_WRITE_SLOW_READ_ONLY SAFE_READ_WRITE_SLOW_HAS_CODE PAGE_FAULT TLB_MISS DO_MANY_CYCLES CYCLE_INTERNAL INVALIDATE_ALL_MODULES_NO_FREE_WASM_INDICES INVALIDATE_MODULE_WRITTEN_WHILE_COMPILED INVALIDATE_MODULE_UNUSED_AFTER_OVERWRITE INVALIDATE_MODULE_DIRTY_PAGE INVALIDATE_PAGE_HAD_CODE INVALIDATE_PAGE_HAD_ENTRY_POINTS DIRTY_PAGE_DID_NOT_HAVE_CODE RUN_FROM_CACHE_EXIT_SAME_PAGE RUN_FROM_CACHE_EXIT_NEAR_END_OF_PAGE RUN_FROM_CACHE_EXIT_DIFFERENT_PAGE CLEAR_TLB FULL_CLEAR_TLB TLB_FULL TLB_GLOBAL_FULL MODRM_SIMPLE_REG MODRM_SIMPLE_REG_WITH_OFFSET MODRM_SIMPLE_CONST_OFFSET MODRM_COMPLEX SEG_OFFSET_OPTIMISED SEG_OFFSET_NOT_OPTIMISED SEG_OFFSET_NOT_OPTIMISED_ES SEG_OFFSET_NOT_OPTIMISED_FS SEG_OFFSET_NOT_OPTIMISED_GS SEG_OFFSET_NOT_OPTIMISED_NOT_FLAT".split(" "),
h=0;const k={};for(let u=0;u<g.length;u++){const I=g[u];if(I.includes("/")){h++;const [ba,R]=I.split("/");var y=k[ba]/k[R]}else y=k[I]=b.wm.exports.profiler_stat_get(u-h),y=1E8<=y?Math.round(y/1E6)+"m":1E5<=y?Math.round(y/1E3)+"k":y;c+=I+"="+y+"\n"}c+="\n";g=b.wm.exports.get_valid_tlb_entries_count();h=b.wm.exports.get_valid_global_tlb_entries_count();c=c+("TLB_ENTRIES="+g+" ("+h+" global, "+(g-h)+" non-global)\nWASM_TABLE_FREE=")+(b.wm.exports.jit_get_wasm_table_index_free_list_count()+"\n");c+=
"JIT_CACHE_SIZE="+b.wm.exports.jit_get_cache_size()+"\n";c+="FLAT_SEGMENTS="+b.wm.exports.has_flat_segmentation()+"\n";c+="do_many_cycles avg: "+(b.do_many_cycles_total/b.do_many_cycles_count||0)+"\n";c+="wasm memory size: "+(b.wasm_memory.buffer.byteLength>>20)+"m\n";c=c+"Config:\nMAX_PAGES="+(b.wm.exports.get_jit_config(0)+"\n");c+="JIT_USE_LOOP_SAFETY="+!!b.wm.exports.get_jit_config(1)+"\n";return c+("MAX_EXTRA_BASIC_BLOCKS="+b.wm.exports.get_jit_config(2)+"\n")},print_instruction_counts:function(b){return[Sb.print_instruction_counts_offset(b,
!1,!1,!1,!1),Sb.print_instruction_counts_offset(b,!0,!1,!1,!1),Sb.print_instruction_counts_offset(b,!1,!0,!1,!1),Sb.print_instruction_counts_offset(b,!1,!1,!0,!1),Sb.print_instruction_counts_offset(b,!1,!1,!1,!0)].join("\n\n")},print_instruction_counts_offset:function(b,c,g,h,k){let y="";var u=[],I=c?"compiled":g?"jit exit":h?"unguarded register":k?"wasm size":"executed";for(let U=0;256>U;U++)for(let Y=0;8>Y;Y++)for(let fa of[!1,!0]){var ba=b.wm.exports.get_opstats_buffer(c,g,h,k,U,!1,fa,Y);u.push({opcode:U,
count:ba,is_mem:fa,fixed_g:Y});ba=b.wm.exports.get_opstats_buffer(c,g,h,k,U,!0,fa,Y);u.push({opcode:3840|U,count:ba,is_mem:fa,fixed_g:Y})}b=0;c=new Set([38,46,54,62,100,101,102,103,240,242,243]);for(let {count:U,opcode:Y}of u)c.has(Y)||(b+=U);if(0===b)return"";g=new Uint32Array(256);c=new Uint32Array(256);for(let {opcode:U,count:Y}of u)3840==(U&65280)?c[U&255]+=Y:g[U&255]+=Y;y=y+"------------------\nTotal: "+(b+"\n");const R=1E7<b?1E3:1;h=Math.max.apply(Math,u.map(({count:U})=>Math.round(U/R)));h=
String(h).length;y+=`Instruction counts ${I} (in ${R}):\n`;for(k=0;256>k;k++)y+=k.toString(16).padStart(2,"0")+":"+aa.pads(Math.round(g[k]/R),h),y=15==k%16?y+"\n":y+" ";y=y+"\n"+`Instruction counts ${I} (0f, in ${R}):\n`;for(I=0;256>I;I++)y+=(I&255).toString(16).padStart(2,"0")+":"+aa.pads(Math.round(c[I]/R),h),y=15==I%16?y+"\n":y+" ";y+="\n";u=u.filter(({count:U})=>U).sort(({count:U},{count:Y})=>Y-U);for(let {opcode:U,is_mem:Y,fixed_g:fa,count:na}of u.slice(0,200))u=U.toString(16)+"_"+fa+(Y?"_m":
"_r"),y+=u+":"+(na/b*100).toFixed(2)+" ";return y+"\n"}};"undefined"!==typeof module&&"undefined"!==typeof module.exports&&(module.exports.print_stats=Sb);sb.prototype.read=async function(b,c,g){H(b,"MemoryFileStorage read: sha256sum should be a non-empty string");return(b=this.filedata.get(b))?b.subarray(c,c+g):null};sb.prototype.cache=async function(b,c){H(b,"MemoryFileStorage cache: sha256sum should be a non-empty string");this.filedata.set(b,c)};sb.prototype.uncache=function(b){this.filedata.delete(b)};
qb.prototype.load_from_server=function(b){return new Promise((c,g)=>{aa.load_file(this.baseurl+b,{done:async h=>{h=new Uint8Array(h);await this.cache(b,h);c(h)}})})};qb.prototype.read=async function(b,c,g){const h=await this.storage.read(b,c,g);return h?h:(await this.load_from_server(b)).subarray(c,c+g)};qb.prototype.cache=async function(b,c){return await this.storage.cache(b,c)};qb.prototype.uncache=function(b){this.storage.uncache(b)};"undefined"!==typeof window?(window.MemoryFileStorage=sb,window.ServerFileStorageWrapper=
qb):"undefined"!==typeof module&&"undefined"!==typeof module.exports?(module.exports.MemoryFileStorage=sb,module.exports.ServerFileStorageWrapper=qb):"function"===typeof importScripts&&(self.MemoryFileStorage=sb,self.ServerFileStorageWrapper=qb);ka.prototype.get_state=function(){let b=[];b[0]=this.inodes;b[1]=this.qidcounter.last_qidnumber;b[2]=[];for(const [c,g]of Object.entries(this.inodedata))0===(this.inodes[c].mode&16384)&&b[2].push([c,g]);b[3]=this.total_size;b[4]=this.used_size;return b.concat(this.mounts)};
ka.prototype.set_state=function(b){this.inodes=b[0].map(c=>{const g=new xb(0);g.set_state(c);return g});this.qidcounter.last_qidnumber=b[1];this.inodedata={};for(let [c,g]of b[2])g.buffer.byteLength!==g.byteLength&&(g=g.slice()),this.inodedata[c]=g;this.total_size=b[3];this.used_size=b[4];this.mounts=b.slice(5)};ka.prototype.AddEvent=function(b,c){var g=this.inodes[b];0==g.status||2==g.status?c():this.is_forwarder(g)?this.follow_fs(g).AddEvent(g.foreign_id,c):this.events.push({id:b,OnEvent:c})};ka.prototype.HandleEvent=
function(b){var c=this.inodes[b];this.is_forwarder(c)&&this.follow_fs(c).HandleEvent(c.foreign_id);c=[];for(var g=0;g<this.events.length;g++)this.events[g].id==b?this.events[g].OnEvent():c.push(this.events[g]);this.events=c};ka.prototype.load_from_json=function(b,c){H(b,"Invalid fs passed to load_from_json");if(3!==b.version)throw"The filesystem JSON format has changed. Please update your fs2json (https://github.com/copy/fs2json) and recreate the filesystem JSON.";var g=b.fsroot;this.used_size=b.size;
for(b=0;b<g.length;b++)this.LoadRecursive(g[b],0);c&&c()};ka.prototype.LoadRecursive=function(b,c){var g=this.CreateInode();const h=b[0];g.size=b[1];g.mtime=b[2];g.ctime=g.mtime;g.atime=g.mtime;g.mode=b[3];g.uid=b[4];g.gid=b[5];var k=g.mode&61440;16384===k?(this.PushInode(g,c,h),this.LoadDir(this.inodes.length-1,b[6])):32768===k?(g.status=2,g.sha256sum=b[6],H(g.sha256sum),this.PushInode(g,c,h)):40960===k?(g.symlink=b[6],this.PushInode(g,c,h)):49152!==k&&r("Unexpected ifmt: "+d(k)+" ("+h+")")};ka.prototype.LoadDir=
function(b,c){for(var g=0;g<c.length;g++)this.LoadRecursive(c[g],b)};ka.prototype.should_be_linked=function(b){return!this.is_forwarder(b)||0===b.foreign_id};ka.prototype.link_under_dir=function(b,c,g){const h=this.inodes[c],k=this.inodes[b];H(!this.is_forwarder(k),"Filesystem: Shouldn't link under fowarder parents");H(this.IsDirectory(b),"Filesystem: Can't link under non-directories");H(this.should_be_linked(h),"Filesystem: Can't link across filesystems apart from their root");H(0<=h.nlinks,"Filesystem: Found negative nlinks value of "+
h.nlinks);H(!k.direntries.has(g),"Filesystem: Name '"+g+"' is already taken");k.direntries.set(g,c);h.nlinks++;this.IsDirectory(c)&&(H(!h.direntries.has(".."),"Filesystem: Cannot link a directory twice"),h.direntries.has(".")||h.nlinks++,h.direntries.set(".",c),h.direntries.set("..",b),k.nlinks++)};ka.prototype.unlink_from_dir=function(b,c){const g=this.Search(b,c),h=this.inodes[g],k=this.inodes[b];H(!this.is_forwarder(k),"Filesystem: Can't unlink from forwarders");H(this.IsDirectory(b),"Filesystem: Can't unlink from non-directories");
k.direntries.delete(c)?(h.nlinks--,this.IsDirectory(g)&&(H(h.direntries.get("..")===b,"Filesystem: Found directory with bad parent id"),h.direntries.delete(".."),k.nlinks--),H(0<=h.nlinks,"Filesystem: Found negative nlinks value of "+h.nlinks)):H(!1,"Filesystem: Can't unlink non-existent file: "+c)};ka.prototype.PushInode=function(b,c,g){-1!=c?(this.inodes.push(b),b.fid=this.inodes.length-1,this.link_under_dir(c,b.fid,g)):0==this.inodes.length?(this.inodes.push(b),b.direntries.set(".",0),b.direntries.set("..",
0),b.nlinks=2):(mb.Debug("Error in Filesystem: Pushed inode with name = "+g+" has no parent"),mb.Abort())};xb.prototype.get_state=function(){const b=[];b[0]=this.mode;b[1]=16384===(this.mode&61440)?[...this.direntries]:32768===(this.mode&61440)?this.sha256sum:40960===(this.mode&61440)?this.symlink:49152===(this.mode&61440)?[this.minor,this.major]:null;b[2]=this.locks;b[3]=this.status;b[4]=this.size;b[5]=this.uid;b[6]=this.gid;b[7]=this.fid;b[8]=this.ctime;b[9]=this.atime;b[10]=this.mtime;b[11]=this.qid.version;
b[12]=this.qid.path;b[13]=this.nlinks;return b};xb.prototype.set_state=function(b){this.mode=b[0];if(16384===(this.mode&61440)){this.direntries=new Map;for(const [c,g]of b[1])this.direntries.set(c,g)}else 32768===(this.mode&61440)?this.sha256sum=b[1]:40960===(this.mode&61440)?this.symlink=b[1]:49152===(this.mode&61440)&&([this.minor,this.major]=b[1]);this.locks=[];for(const c of b[2]){const g=new tb;g.set_state(c);this.locks.push(g)}this.status=b[3];this.size=b[4];this.uid=b[5];this.gid=b[6];this.fid=
b[7];this.ctime=b[8];this.atime=b[9];this.mtime=b[10];this.qid.type=(this.mode&61440)>>8;this.qid.version=b[11];this.qid.path=b[12];this.nlinks=b[13]};ka.prototype.divert=function(b,c){const g=this.Search(b,c),h=this.inodes[g],k=new xb(-1);H(h,"Filesystem divert: name ("+c+") not found");H(this.IsDirectory(g)||1>=h.nlinks,"Filesystem: can't divert hardlinked file '"+c+"' with nlinks="+h.nlinks);Object.assign(k,h);const y=this.inodes.length;this.inodes.push(k);k.fid=y;this.is_forwarder(h)&&this.mounts[h.mount_id].backtrack.set(h.foreign_id,
y);this.should_be_linked(h)&&(this.unlink_from_dir(b,c),this.link_under_dir(b,y,c));if(this.IsDirectory(g)&&!this.is_forwarder(h))for(const [u,I]of k.direntries)"."!==u&&".."!==u&&this.IsDirectory(I)&&this.inodes[I].direntries.set("..",y);this.inodedata[y]=this.inodedata[g];delete this.inodedata[g];h.direntries=new Map;h.nlinks=0;return y};ka.prototype.copy_inode=function(b,c){Object.assign(c,b,{fid:c.fid,direntries:c.direntries,nlinks:c.nlinks})};ka.prototype.CreateInode=function(){const b=Math.round(Date.now()/
1E3),c=new xb(++this.qidcounter.last_qidnumber);c.atime=c.ctime=c.mtime=b;return c};ka.prototype.CreateDirectory=function(b,c){var g=this.inodes[c];if(0<=c&&this.is_forwarder(g))return c=g.foreign_id,b=this.follow_fs(g).CreateDirectory(b,c),this.create_forwarder(g.mount_id,b);g=this.CreateInode();g.mode=16895;0<=c&&(g.uid=this.inodes[c].uid,g.gid=this.inodes[c].gid,g.mode=this.inodes[c].mode&511|16384);g.qid.type=64;this.PushInode(g,c,b);this.NotifyListeners(this.inodes.length-1,"newdir");return this.inodes.length-
1};ka.prototype.CreateFile=function(b,c){var g=this.inodes[c];if(this.is_forwarder(g))return c=g.foreign_id,b=this.follow_fs(g).CreateFile(b,c),this.create_forwarder(g.mount_id,b);g=this.CreateInode();g.uid=this.inodes[c].uid;g.gid=this.inodes[c].gid;g.qid.type=128;g.mode=this.inodes[c].mode&438|32768;this.PushInode(g,c,b);this.NotifyListeners(this.inodes.length-1,"newfile");return this.inodes.length-1};ka.prototype.CreateNode=function(b,c,g,h){var k=this.inodes[c];if(this.is_forwarder(k))return c=
k.foreign_id,b=this.follow_fs(k).CreateNode(b,c,g,h),this.create_forwarder(k.mount_id,b);k=this.CreateInode();k.major=g;k.minor=h;k.uid=this.inodes[c].uid;k.gid=this.inodes[c].gid;k.qid.type=192;k.mode=this.inodes[c].mode&438;this.PushInode(k,c,b);return this.inodes.length-1};ka.prototype.CreateSymlink=function(b,c,g){var h=this.inodes[c];if(this.is_forwarder(h))return c=h.foreign_id,b=this.follow_fs(h).CreateSymlink(b,c,g),this.create_forwarder(h.mount_id,b);h=this.CreateInode();h.uid=this.inodes[c].uid;
h.gid=this.inodes[c].gid;h.qid.type=160;h.symlink=g;h.mode=40960;this.PushInode(h,c,b);return this.inodes.length-1};ka.prototype.CreateTextFile=async function(b,c,g){var h=this.inodes[c];if(this.is_forwarder(h))return c=h.foreign_id,g=await this.follow_fs(h).CreateTextFile(b,c,g),this.create_forwarder(h.mount_id,g);h=this.CreateFile(b,c);c=this.inodes[h];b=new Uint8Array(g.length);c.size=g.length;for(c=0;c<g.length;c++)b[c]=g.charCodeAt(c);await this.set_data(h,b);return h};ka.prototype.CreateBinaryFile=
async function(b,c,g){var h=this.inodes[c];if(this.is_forwarder(h))return c=h.foreign_id,g=await this.follow_fs(h).CreateBinaryFile(b,c,g),this.create_forwarder(h.mount_id,g);h=this.CreateFile(b,c);b=this.inodes[h];c=new Uint8Array(g.length);c.set(g);await this.set_data(h,c);b.size=g.length;return h};ka.prototype.OpenInode=function(b,c){var g=this.inodes[b];if(this.is_forwarder(g))return this.follow_fs(g).OpenInode(g.foreign_id,c);16384==(g.mode&61440)&&this.FillDirectory(b);return!0};ka.prototype.CloseInode=
async function(b){var c=this.inodes[b];if(this.is_forwarder(c))return await this.follow_fs(c).CloseInode(c.foreign_id);2===c.status&&this.storage.uncache(c.sha256sum);4==c.status&&(c.status=-1,await this.DeleteData(b))};ka.prototype.Rename=async function(b,c,g,h){if(b==g&&c==h)return 0;var k=this.Search(b,c);if(-1===k)return-2;var y=this.GetFullPath(b)+"/"+c;if(-1!=this.Search(g,h)){var u=this.Unlink(g,h);if(0>u)return u}var I=this.inodes[k],ba=this.inodes[b];u=this.inodes[g];if(this.is_forwarder(ba)||
this.is_forwarder(u))if(this.is_forwarder(ba)&&ba.mount_id===u.mount_id){if(b=await this.follow_fs(ba).Rename(ba.foreign_id,c,u.foreign_id,h),0>b)return b}else{if(this.is_a_root(k))return r("XXX: Attempted to move mountpoint ("+c+") - skipped",4194304),-1;if(!this.IsDirectory(k)&&1<this.GetInode(k).nlinks)return r("XXX: Attempted to move hardlinked file ("+c+") across filesystems - skipped",4194304),-1;ba=this.divert(b,c);const R=this.GetInode(k),U=await this.Read(ba,0,R.size);this.is_forwarder(u)?
(g=this.follow_fs(u),h=this.IsDirectory(ba)?g.CreateDirectory(h,u.foreign_id):g.CreateFile(h,u.foreign_id),g=g.GetInode(h),this.copy_inode(R,g),this.set_forwarder(k,u.mount_id,h)):(this.delete_forwarder(I),this.copy_inode(R,I),this.link_under_dir(g,k,h));await this.ChangeSize(k,R.size);U&&U.length&&await this.Write(k,0,U.length,U);if(this.IsDirectory(k))for(const Y of this.GetChildren(ba))if(u=await this.Rename(ba,Y,k,Y),0>u)return u;await this.DeleteData(ba);b=this.Unlink(b,c);if(0>b)return b}else this.unlink_from_dir(b,
c),this.link_under_dir(g,k,h),I.qid.version++;this.NotifyListeners(k,"rename",{oldpath:y});return 0};ka.prototype.Write=async function(b,c,g,h){this.NotifyListeners(b,"write");var k=this.inodes[b];if(this.is_forwarder(k))b=k.foreign_id,await this.follow_fs(k).Write(b,c,g,h);else{var y=await this.get_buffer(b);!y||y.length<c+g?(await this.ChangeSize(b,Math.floor(3*(c+g)/2)),k.size=c+g,y=await this.get_buffer(b)):k.size<c+g&&(k.size=c+g);h&&y.set(h.subarray(0,g),c);await this.set_data(b,y)}};ka.prototype.Read=
async function(b,c,g){const h=this.inodes[b];return this.is_forwarder(h)?(b=h.foreign_id,await this.follow_fs(h).Read(b,c,g)):await this.get_data(b,c,g)};ka.prototype.Search=function(b,c){b=this.inodes[b];if(this.is_forwarder(b)){const g=b.foreign_id;c=this.follow_fs(b).Search(g,c);return-1===c?-1:this.get_forwarder(b.mount_id,c)}c=b.direntries.get(c);return void 0===c?-1:c};ka.prototype.CountUsedInodes=function(){let b=this.inodes.length;for(const {fs:c,backtrack:g}of this.mounts)b+=c.CountUsedInodes(),
b-=g.size;return b};ka.prototype.CountFreeInodes=function(){let b=1048576;for(const {fs:c}of this.mounts)b+=c.CountFreeInodes();return b};ka.prototype.GetTotalSize=function(){let b=this.used_size;for(const {fs:c}of this.mounts)b+=c.GetTotalSize();return b};ka.prototype.GetSpace=function(){let b=this.total_size;for(const {fs:c}of this.mounts)b+=c.GetSpace();return this.total_size};ka.prototype.GetDirectoryName=function(b){const c=this.inodes[this.GetParent(b)];if(this.is_forwarder(c))return this.follow_fs(c).GetDirectoryName(this.inodes[b].foreign_id);
if(!c)return"";for(const [g,h]of c.direntries)if(h===b)return g;H(!1,"Filesystem: Found directory inode whose parent doesn't link to it");return""};ka.prototype.GetFullPath=function(b){H(this.IsDirectory(b),"Filesystem: Cannot get full path of non-directory inode");for(var c="";0!=b;)c="/"+this.GetDirectoryName(b)+c,b=this.GetParent(b);return c.substring(1)};ka.prototype.Link=function(b,c,g){if(this.IsDirectory(c))return-1;const h=this.inodes[b],k=this.inodes[c];if(this.is_forwarder(h))return this.is_forwarder(k)&&
k.mount_id===h.mount_id?this.follow_fs(h).Link(h.foreign_id,k.foreign_id,g):(r("XXX: Attempted to hardlink a file into a child filesystem - skipped",4194304),-1);if(this.is_forwarder(k))return r("XXX: Attempted to hardlink file across filesystems - skipped",4194304),-1;this.link_under_dir(b,c,g);return 0};ka.prototype.Unlink=function(b,c){if("."===c||".."===c)return-1;const g=this.Search(b,c),h=this.inodes[g],k=this.inodes[b];if(this.is_forwarder(k))return H(this.is_forwarder(h),"Children of forwarders should be forwarders"),
b=k.foreign_id,this.follow_fs(k).Unlink(b,c);if(this.IsDirectory(g)&&!this.IsEmpty(g))return-39;this.unlink_from_dir(b,c);0===h.nlinks&&(h.status=4,this.NotifyListeners(g,"delete"));return 0};ka.prototype.DeleteData=async function(b){const c=this.inodes[b];this.is_forwarder(c)?await this.follow_fs(c).DeleteData(c.foreign_id):(c.size=0,delete this.inodedata[b])};ka.prototype.get_buffer=async function(b){const c=this.inodes[b];H(c,`Filesystem get_buffer: idx ${b} does not point to an inode`);return this.inodedata[b]?
this.inodedata[b]:2===c.status?(H(c.sha256sum,"Filesystem get_data: found inode on server without sha256sum"),await this.storage.read(c.sha256sum,0,c.size)):null};ka.prototype.get_data=async function(b,c,g){const h=this.inodes[b];H(h,`Filesystem get_data: idx ${b} does not point to an inode`);return this.inodedata[b]?this.inodedata[b].subarray(c,c+g):2===h.status?(H(h.sha256sum,"Filesystem get_data: found inode on server without sha256sum"),await this.storage.read(h.sha256sum,c,g)):null};ka.prototype.set_data=
async function(b,c){this.inodedata[b]=c;2===this.inodes[b].status&&(this.inodes[b].status=0,this.storage.uncache(this.inodes[b].sha256sum))};ka.prototype.GetInode=function(b){H(!isNaN(b),"Filesystem GetInode: NaN idx");H(0<=b&&b<this.inodes.length,"Filesystem GetInode: out of range idx:"+b);b=this.inodes[b];return this.is_forwarder(b)?this.follow_fs(b).GetInode(b.foreign_id):b};ka.prototype.ChangeSize=async function(b,c){var g=this.GetInode(b),h=await this.get_data(b,0,g.size);if(c!=g.size){var k=
new Uint8Array(c);g.size=c;h&&k.set(h.subarray(0,Math.min(h.length,g.size)),0);await this.set_data(b,k)}};ka.prototype.SearchPath=function(b){b=b.replace("//","/");b=b.split("/");0<b.length&&0===b[b.length-1].length&&b.pop();0<b.length&&0===b[0].length&&b.shift();const c=b.length;var g=-1,h=0;let k=null;for(var y=0;y<c;y++)if(g=h,h=this.Search(g,b[y]),!k&&this.is_forwarder(this.inodes[g])&&(k="/"+b.slice(y).join("/")),-1==h)return y<c-1?{id:-1,parentid:-1,name:b[y],forward_path:k}:{id:-1,parentid:g,
name:b[y],forward_path:k};return{id:h,parentid:g,name:b[y],forward_path:k}};ka.prototype.GetRecursiveList=function(b,c){if(this.is_forwarder(this.inodes[b])){const g=this.follow_fs(this.inodes[b]),h=this.inodes[b].mount_id,k=c.length;g.GetRecursiveList(this.inodes[b].foreign_id,c);for(b=k;b<c.length;b++)c[b].parentid=this.get_forwarder(h,c[b].parentid)}else for(const [g,h]of this.inodes[b].direntries)"."!==g&&".."!==g&&(c.push({parentid:b,name:g}),this.IsDirectory(h)&&this.GetRecursiveList(h,c))};
ka.prototype.RecursiveDelete=function(b){var c=[];b=this.SearchPath(b);if(-1!==b.id)for(this.GetRecursiveList(b.id,c),b=c.length-1;0<=b;b--){const g=this.Unlink(c[b].parentid,c[b].name);H(0===g,"Filesystem RecursiveDelete failed at parent="+c[b].parentid+", name='"+c[b].name+"' with error code: "+-g)}};ka.prototype.DeleteNode=function(b){var c=this.SearchPath(b);-1!=c.id&&(32768==(this.inodes[c.id].mode&61440)?(b=this.Unlink(c.parentid,c.name),H(0===b,"Filesystem DeleteNode failed with error code: "+
-b)):16384==(this.inodes[c.id].mode&61440)&&(this.RecursiveDelete(b),b=this.Unlink(c.parentid,c.name),H(0===b,"Filesystem DeleteNode failed with error code: "+-b)))};ka.prototype.NotifyListeners=function(b,c,g){};ka.prototype.Check=function(){for(var b=1;b<this.inodes.length;b++)if(-1!=this.inodes[b].status){var c=this.GetInode(b);0>c.nlinks&&mb.Debug("Error in filesystem: negative nlinks="+c.nlinks+" at id ="+b);if(this.IsDirectory(b)){c=this.GetInode(b);this.IsDirectory(b)&&0>this.GetParent(b)&&
mb.Debug("Error in filesystem: negative parent id "+b);for(const [g,h]of c.direntries){0===g.length&&mb.Debug("Error in filesystem: inode with no name and id "+h);for(const k of g)32>k&&mb.Debug("Error in filesystem: Unallowed char in filename")}}}};ka.prototype.FillDirectory=function(b){var c=this.inodes[b];if(this.is_forwarder(c))this.follow_fs(c).FillDirectory(c.foreign_id);else{var g=0;for(const h of c.direntries.keys())g+=24+bc.UTF8Length(h);b=this.inodedata[b]=new Uint8Array(g);c.size=g;g=0;
for(const [h,k]of c.direntries)c=this.GetInode(k),g+=cb.Marshall(["Q","d","b","s"],[c.qid,g+13+8+1+2+bc.UTF8Length(h),c.mode>>12,h],b,g)}};ka.prototype.RoundToDirentry=function(b,c){const g=this.inodedata[b];H(g,`FS directory data for dirid=${b} should be generated`);H(g.length,"FS directory should have at least an entry");if(c>=g.length)return g.length;for(b=0;;){const h=cb.Unmarshall(["Q","d"],g,{offset:b})[1];if(h>c)break;b=h}return b};ka.prototype.IsDirectory=function(b){b=this.inodes[b];return this.is_forwarder(b)?
this.follow_fs(b).IsDirectory(b.foreign_id):16384===(b.mode&61440)};ka.prototype.IsEmpty=function(b){b=this.inodes[b];if(this.is_forwarder(b))return this.follow_fs(b).IsDirectory(b.foreign_id);for(const c of b.direntries.keys())if("."!==c&&".."!==c)return!1;return!0};ka.prototype.GetChildren=function(b){H(this.IsDirectory(b),"Filesystem: cannot get children of non-directory inode");b=this.inodes[b];if(this.is_forwarder(b))return this.follow_fs(b).GetChildren(b.foreign_id);const c=[];for(const g of b.direntries.keys())"."!==
g&&".."!==g&&c.push(g);return c};ka.prototype.GetParent=function(b){H(this.IsDirectory(b),"Filesystem: cannot get parent of non-directory inode");b=this.inodes[b];if(this.should_be_linked(b))return b.direntries.get("..");const c=this.follow_fs(b).GetParent(b.foreign_id);H(-1!==c,"Filesystem: should not have invalid parent ids");return this.get_forwarder(b.mount_id,c)};ka.prototype.PrepareCAPs=function(b){b=this.GetInode(b);if(b.caps)return b.caps.length;b.caps=new Uint8Array(20);b.caps[0]=0;b.caps[1]=
0;b.caps[2]=0;b.caps[3]=2;b.caps[4]=255;b.caps[5]=255;b.caps[6]=255;b.caps[7]=255;b.caps[8]=255;b.caps[9]=255;b.caps[10]=255;b.caps[11]=255;b.caps[12]=63;b.caps[13]=0;b.caps[14]=0;b.caps[15]=0;b.caps[16]=63;b.caps[17]=0;b.caps[18]=0;b.caps[19]=0;return b.caps.length};jb.prototype.get_state=function(){const b=[];b[0]=this.fs;b[1]=[...this.backtrack];return b};jb.prototype.set_state=function(b){this.fs=b[0];this.backtrack=new Map(b[1])};ka.prototype.set_forwarder=function(b,c,g){const h=this.inodes[b];
H(0===h.nlinks,"Filesystem: attempted to convert an inode into forwarder before unlinking the inode");this.is_forwarder(h)&&this.mounts[h.mount_id].backtrack.delete(h.foreign_id);h.status=5;h.mount_id=c;h.foreign_id=g;this.mounts[c].backtrack.set(g,b)};ka.prototype.create_forwarder=function(b,c){const g=this.CreateInode(),h=this.inodes.length;this.inodes.push(g);g.fid=h;this.set_forwarder(h,b,c);return h};ka.prototype.is_forwarder=function(b){return 5===b.status};ka.prototype.is_a_root=function(b){return 0===
this.GetInode(b).fid};ka.prototype.get_forwarder=function(b,c){var g=this.mounts[b];H(0<=c,"Filesystem get_forwarder: invalid foreign_id: "+c);H(g,"Filesystem get_forwarder: invalid mount number: "+b);g=g.backtrack.get(c);return void 0===g?this.create_forwarder(b,c):g};ka.prototype.delete_forwarder=function(b){H(this.is_forwarder(b),"Filesystem delete_forwarder: expected forwarder");b.status=-1;this.mounts[b.mount_id].backtrack.delete(b.foreign_id)};ka.prototype.follow_fs=function(b){const c=this.mounts[b.mount_id];
H(this.is_forwarder(b),"Filesystem follow_fs: inode should be a forwarding inode");H(c,"Filesystem follow_fs: inode<id="+b.fid+"> should point to valid mounted FS");return c.fs};ka.prototype.Mount=function(b,c){H(c.qidcounter===this.qidcounter,"Cannot mount filesystem whose qid numbers aren't synchronised with current filesystem.");var g=this.SearchPath(b);if(-1===g.parentid)return r("Mount failed: parent for path not found: "+b,4194304),-2;if(-1!==g.id)return r("Mount failed: file already exists at path: "+
b,4194304),-17;if(g.forward_path)return b=this.inodes[g.parentid],g=this.follow_fs(b).Mount(g.forward_path,c),0>g?g:this.get_forwarder(b.mount_id,g);b=this.mounts.length;this.mounts.push(new jb(c));c=this.create_forwarder(b,0);this.link_under_dir(g.parentid,c,g.name);return c};tb.prototype.get_state=function(){const b=[];b[0]=this.type;b[1]=this.start;b[2]=Infinity===this.length?0:this.length;b[3]=this.proc_id;b[4]=this.client_id;return b};tb.prototype.set_state=function(b){this.type=b[0];this.start=
b[1];this.length=0===b[2]?Infinity:b[2];this.proc_id=b[3];this.client_id=b[4]};tb.prototype.clone=function(){const b=new tb;b.set_state(this.get_state());return b};tb.prototype.conflicts_with=function(b){return this.proc_id===b.proc_id&&this.client_id===b.client_id||2===this.type||2===b.type||1!==this.type&&1!==b.type||this.start+this.length<=b.start||b.start+b.length<=this.start?!1:!0};tb.prototype.is_alike=function(b){return b.proc_id===this.proc_id&&b.client_id===this.client_id&&b.type===this.type};
tb.prototype.may_merge_after=function(b){return this.is_alike(b)&&b.start+b.length===this.start};ka.prototype.DescribeLock=function(b,c,g,h,k){H(0===b||1===b||2===b,"Filesystem: Invalid lock type: "+b);H(0<=c,"Filesystem: Invalid negative lock starting offset: "+c);H(0<g,"Filesystem: Invalid non-positive lock length: "+g);const y=new tb;y.type=b;y.start=c;y.length=g;y.proc_id=h;y.client_id=k;return y};ka.prototype.GetLock=function(b,c){b=this.inodes[b];if(this.is_forwarder(b)){var g=b.foreign_id;
return this.follow_fs(b).GetLock(g,c)}for(g of b.locks)if(c.conflicts_with(g))return g.clone();return null};ka.prototype.Lock=function(b,c,g){const h=this.inodes[b];if(this.is_forwarder(h))return b=h.foreign_id,this.follow_fs(h).Lock(b,c,g);c=c.clone();if(2!==c.type&&this.GetLock(b,c))return 1;for(g=0;g<h.locks.length;g++){b=h.locks[g];H(0<b.length,"Filesystem: Found non-positive lock region length: "+b.length);H(0===b.type||1===b.type,"Filesystem: Found invalid lock type: "+b.type);H(!h.locks[g-
1]||h.locks[g-1].start<=b.start,"Filesystem: Locks should be sorted by starting offset");if(b.start+b.length<=c.start)continue;if(c.start+c.length<=b.start)break;if(b.proc_id!==c.proc_id||b.client_id!==c.client_id){H(!b.conflicts_with(c),"Filesytem: Found conflicting lock region, despite already checked for conflicts");continue}var k=c.start+c.length;const y=c.start-b.start,u=b.start+b.length-k;if(0<y&&0<u&&b.type===c.type)return 0;0<y&&(b.length=y);if(0>=y&&0<u)b.start=k,b.length=u;else if(0<u){for(;g<
h.locks.length&&h.locks[g].start<k;)g++;h.locks.splice(g,0,this.DescribeLock(b.type,k,u,b.proc_id,b.client_id))}else 0>=y&&(h.locks.splice(g,1),g--)}if(2!==c.type){g=c;b=!1;for(k=0;k<h.locks.length&&!(g.may_merge_after(h.locks[k])&&(h.locks[k].length+=c.length,g=h.locks[k],b=!0),c.start<=h.locks[k].start);k++);for(b||(h.locks.splice(k,0,g),k++);k<h.locks.length;k++)if(h.locks[k].is_alike(g)){h.locks[k].may_merge_after(g)&&(g.length+=h.locks[k].length,h.locks.splice(k,1));break}}return 0};ka.prototype.read_dir=
function(b){b=this.SearchPath(b);if(-1!==b.id)return b=this.GetInode(b.id),Array.from(b.direntries.keys()).filter(c=>"."!==c&&".."!==c)};ka.prototype.read_file=function(b){b=this.SearchPath(b);if(-1===b.id)return Promise.resolve(null);const c=this.GetInode(b.id);return this.Read(b.id,0,c.size)};var mb={Debug:function(b){r([].slice.apply(arguments).join(" "),4194304)},Abort:function(){if(N)throw Error("message.Abort()");}},cb={Marshall:function(b,c,g,h){for(var k,y=0,u=0;u<b.length;u++)switch(k=c[u],
b[u]){case "w":g[h++]=k&255;g[h++]=k>>8&255;g[h++]=k>>16&255;g[h++]=k>>24&255;y+=4;break;case "d":g[h++]=k&255;g[h++]=k>>8&255;g[h++]=k>>16&255;g[h++]=k>>24&255;g[h++]=0;g[h++]=0;g[h++]=0;g[h++]=0;y+=8;break;case "h":g[h++]=k&255;g[h++]=k>>8;y+=2;break;case "b":g[h++]=k;y+=1;break;case "s":var I=h,ba=0;g[h++]=0;g[h++]=0;y+=2;for(var R of k)Eb(R.charCodeAt(0)).forEach(function(U){g[h++]=U;y+=1;ba++});g[I+0]=ba&255;g[I+1]=ba>>8&255;break;case "Q":cb.Marshall(["b","w","d"],[k.type,k.version,k.path],
g,h);h+=13;y+=13;break;default:mb.Debug("Marshall: Unknown type="+b[u])}return y},Unmarshall:function(b,c,g){let h=g.offset;for(var k=[],y=0;y<b.length;y++)switch(b[y]){case "w":var u=c[h++];u+=c[h++]<<8;u+=c[h++]<<16;u+=c[h++]<<24>>>0;k.push(u);break;case "d":u=c[h++];u+=c[h++]<<8;u+=c[h++]<<16;u+=c[h++]<<24>>>0;h+=4;k.push(u);break;case "h":u=c[h++];k.push(u+(c[h++]<<8));break;case "b":k.push(c[h++]);break;case "s":u=c[h++];u+=c[h++]<<8;for(var I="",ba=new Hb,R=0;R<u;R++){var U=ba.Put(c[h++]);-1!=
U&&(I+=String.fromCharCode(U))}k.push(I);break;case "Q":g.offset=h;u=cb.Unmarshall(["b","w","d"],c,g);h=g.offset;k.push({type:u[0],version:u[1],path:u[2]});break;default:mb.Debug("Error in Unmarshall: Unknown type="+b[y])}g.offset=h;return k}},bc={UTF8Length:function(b){for(var c=0,g=0;g<b.length;g++){var h=b.charCodeAt(g);c+=128>h?1:2}return c}}}).call(this);parcelRequire=function(t,G,K,e){function l(p,w){function B(z){return l(B.resolve(z))}if(!G[p]){if(!t[p]){var v="function"==typeof parcelRequire&&parcelRequire;if(!w&&v)return v(p,!0);if(d)return d(p,!0);if(m&&"string"==typeof p)return m(p);w=Error("Cannot find module '"+p+"'");throw w.code="MODULE_NOT_FOUND",w;}B.resolve=function(z){return t[p][1][z]||z};B.cache={};w=G[p]=new l.Module(p);t[p][0].call(w.exports,B,w,w.exports,this)}return G[p].exports}var f,d="function"==typeof parcelRequire&&parcelRequire,
m="function"==typeof require&&require;l.isParcelRequire=!0;l.Module=function(p){this.id=p;this.bundle=l;this.exports={}};l.modules=t;l.cache=G;l.parent=d;l.register=function(p,w){t[p]=[function(B,v){v.exports=w},{}]};for(var q=0;q<K.length;q++)try{l(K[q])}catch(p){f||=p}if(K.length){var n=l(K[K.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=n:"function"==typeof define&&define.amd?define(function(){return n}):e&&(this[e]=n)}if(parcelRequire=l,f)throw f;return l}({b1ZG:[function(t,
G,K){function e(f){if("function"!=typeof f)throw new TypeError("Argument to promisify must be a function");var d=f[l],m=e.Promise||Promise;if("function"!=typeof m)throw Error("No Promise implementation found; do you need a polyfill?");return function(){for(var q=this,n=arguments.length,p=Array(n),w=0;w<n;w++)p[w]=arguments[w];return new m(function(B,v){p.push(function(z){if(z)return v(z);for(var C=arguments.length,A=Array(1<C?C-1:0),F=1;F<C;F++)A[F-1]=arguments[F];if(1===A.length||!d)return B(A[0]);
var E={};A.forEach(function(M,J){(J=d[J])&&(E[J]=M)});B(E)});f.apply(q,p)})}}Object.defineProperty(K,"__esModule",{value:!0});K.promisify=e;var l="__ES6-PROMISIFY--CUSTOM-ARGUMENTS__";e.argumentNames="__ES6-PROMISIFY--CUSTOM-ARGUMENTS__";e.Promise=void 0},{}],pBGv:[function(t,G,K){function e(){throw Error("setTimeout has not been defined");}function l(){throw Error("clearTimeout has not been defined");}function f(F){if(w===setTimeout)return setTimeout(F,0);if((w===e||!w)&&setTimeout)return w=setTimeout,
setTimeout(F,0);try{return w(F,0)}catch(E){try{return w.call(null,F,0)}catch(M){return w.call(this,F,0)}}}function d(F){if(B===clearTimeout)return clearTimeout(F);if((B===l||!B)&&clearTimeout)return B=clearTimeout,clearTimeout(F);try{return B(F)}catch(E){try{return B.call(null,F)}catch(M){return B.call(this,F)}}}function m(){C&&v&&(C=!1,v.length?z=v.concat(z):A=-1,z.length&&q())}function q(){if(!C){var F=f(m);C=!0;for(var E=z.length;E;){v=z;for(z=[];++A<E;)v&&v[A].run();A=-1;E=z.length}v=null;C=!1;
d(F)}}function n(F,E){this.fun=F;this.array=E}function p(){}t=G.exports={};try{var w="function"==typeof setTimeout?setTimeout:e}catch(F){w=e}try{var B="function"==typeof clearTimeout?clearTimeout:l}catch(F){B=l}!0;var v,z=[],C=!1,A=-1;t.nextTick=function(F){var E=Array(arguments.length-1);if(1<arguments.length)for(var M=1;M<arguments.length;M++)E[M-1]=arguments[M];z.push(new n(F,E));1!==z.length||C||f(q)};n.prototype.run=function(){this.fun.apply(null,this.array)};t.title="browser";t.env={};t.argv=
[];t.version="";t.versions={};t.on=p;t.addListener=p;t.once=p;t.off=p;t.removeListener=p;t.removeAllListeners=p;t.emit=p;t.prependListener=p;t.prependOnceListener=p;t.listeners=function(F){return[]};t.binding=function(F){throw Error("process.binding is not supported");};t.cwd=function(){return"/"};t.chdir=function(F){throw Error("process.chdir is not supported");};t.umask=function(){return 0}},{}],UUq2:[function(t,G,K){function e(m,q){for(var n=0,p=m.length-1;0<=p;p--){var w=m[p];"."===w?m.splice(p,
1):".."===w?(m.splice(p,1),n++):n&&(m.splice(p,1),n--)}if(q)for(;n--;n)m.unshift("..");return m}function l(m,q){if(m.filter)return m.filter(q);for(var n=[],p=0;p<m.length;p++)q(m[p],p,m)&&n.push(m[p]);return n}t("process");var f=t("process");K.resolve=function(){for(var m="",q=!1,n=arguments.length-1;-1<=n&&!q;n--){var p=0<=n?arguments[n]:f.cwd();if("string"!=typeof p)throw new TypeError("Arguments to path.resolve must be strings");p&&(m=p+"/"+m,q="/"===p.charAt(0))}return(q?"/":"")+(m=e(l(m.split("/"),
function(w){return!!w}),!q).join("/"))||"."};K.normalize=function(m){var q=K.isAbsolute(m),n="/"===d(m,-1);return(m=e(l(m.split("/"),function(p){return!!p}),!q).join("/"))||q||(m="."),m&&n&&(m+="/"),(q?"/":"")+m};K.isAbsolute=function(m){return"/"===m.charAt(0)};K.join=function(){var m=Array.prototype.slice.call(arguments,0);return K.normalize(l(m,function(q,n){if("string"!=typeof q)throw new TypeError("Arguments to path.join must be strings");return q}).join("/"))};K.relative=function(m,q){function n(v){for(var z=
0;z<v.length&&""===v[z];z++);for(var C=v.length-1;0<=C&&""===v[C];C--);return z>C?[]:v.slice(z,C-z+1)}m=K.resolve(m).substr(1);q=K.resolve(q).substr(1);m=n(m.split("/"));q=n(q.split("/"));for(var p=Math.min(m.length,q.length),w=p,B=0;B<p;B++)if(m[B]!==q[B]){w=B;break}p=[];for(B=w;B<m.length;B++)p.push("..");return(p=p.concat(q.slice(w))).join("/")};K.sep="/";K.delimiter=":";K.dirname=function(m){if("string"!=typeof m&&(m+=""),0===m.length)return".";for(var q=47===m.charCodeAt(0),n=-1,p=!0,w=m.length-
1;1<=w;--w)if(47===m.charCodeAt(w)){if(!p){n=w;break}}else p=!1;return-1===n?q?"/":".":q&&1===n?"/":m.slice(0,n)};K.basename=function(m,q){"string"!=typeof m&&(m+="");var n,p=0,w=-1,B=!0;for(n=m.length-1;0<=n;--n)if(47===m.charCodeAt(n)){if(!B){p=n+1;break}}else-1===w&&(B=!1,w=n+1);m=-1===w?"":m.slice(p,w);return q&&m.substr(-1*q.length)===q&&(m=m.substr(0,m.length-q.length)),m};K.extname=function(m){"string"!=typeof m&&(m+="");for(var q=-1,n=0,p=-1,w=!0,B=0,v=m.length-1;0<=v;--v){var z=m.charCodeAt(v);
if(47!==z)-1===p&&(w=!1,p=v+1),46===z?-1===q?q=v:1!==B&&(B=1):-1!==q&&(B=-1);else if(!w){n=v+1;break}}return-1===q||-1===p||0===B||1===B&&q===p-1&&q===n+1?"":m.slice(q,p)};var d="b"==="ab".substr(-1)?function(m,q,n){return m.substr(q,n)}:function(m,q,n){return 0>q&&(q=m.length+q),m.substr(q,n)}},{process:"pBGv"}],UzoP:[function(t,G,K){t("process");t("process").cwd=function(){return"/"};var e=t("path"),l=Object.assign({},e);l.basename=function(f,d){f=e.basename(f,d);return""===f?"/":f};l.normalize=
function(f){return"/"===(f=e.normalize(f))?f:l.removeTrailing(f)};l.isNull=function(f){return-1!==(""+f).indexOf("\x00")};l.addTrailing=function(f){return f.replace(/\/*$/,"/")};l.removeTrailing=function(f){return""===(f=f.replace(/\/*$/,""))?"/":f};G.exports=l},{path:"UUq2",process:"pBGv"}],iJA9:[function(t,G,K){G.exports={FILE_SYSTEM_NAME:"local",FILE_STORE_NAME:"files",IDB_RO:"readonly",IDB_RW:"readwrite",WSQL_VERSION:"1",WSQL_SIZE:5242880,WSQL_DESC:"FileSystem Storage",NODE_TYPE_FILE:"FILE",NODE_TYPE_DIRECTORY:"DIRECTORY",
NODE_TYPE_SYMBOLIC_LINK:"SYMLINK",NODE_TYPE_META:"META",DEFAULT_DIR_PERMISSIONS:493,DEFAULT_FILE_PERMISSIONS:420,FULL_READ_WRITE_EXEC_PERMISSIONS:511,READ_WRITE_PERMISSIONS:438,SYMLOOP_MAX:10,BINARY_MIME_TYPE:"application/octet-stream",JSON_MIME_TYPE:"application/json",ROOT_DIRECTORY_NAME:"/",FS_FORMAT:"FORMAT",FS_NOCTIME:"NOCTIME",FS_NOMTIME:"NOMTIME",FS_NODUPEIDCHECK:"FS_NODUPEIDCHECK",O_READ:"READ",O_WRITE:"WRITE",O_CREATE:"CREATE",O_EXCLUSIVE:"EXCLUSIVE",O_TRUNCATE:"TRUNCATE",O_APPEND:"APPEND",
O_FLAGS:{r:["READ"],"r+":["READ","WRITE"],w:["WRITE","CREATE","TRUNCATE"],"w+":["WRITE","READ","CREATE","TRUNCATE"],wx:["WRITE","CREATE","EXCLUSIVE","TRUNCATE"],"wx+":["WRITE","READ","CREATE","EXCLUSIVE","TRUNCATE"],a:["WRITE","CREATE","APPEND"],"a+":["WRITE","READ","CREATE","APPEND"],ax:["WRITE","CREATE","EXCLUSIVE","APPEND"],"ax+":["WRITE","READ","CREATE","EXCLUSIVE","APPEND"]},XATTR_CREATE:"CREATE",XATTR_REPLACE:"REPLACE",FS_READY:"READY",FS_PENDING:"PENDING",FS_ERROR:"ERROR",SUPER_NODE_ID:"00000000-0000-0000-0000-000000000000",
STDIN:0,STDOUT:1,STDERR:2,FIRST_DESCRIPTOR:3,ENVIRONMENT:{TMP:"/tmp",PATH:""},fsConstants:{O_RDONLY:0,O_WRONLY:1,O_RDWR:2,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:512,O_EXCL:2048,O_NOCTTY:131072,O_TRUNC:1024,O_APPEND:8,O_DIRECTORY:1048576,O_NOFOLLOW:256,O_SYNC:128,O_DSYNC:4194304,O_SYMLINK:2097152,O_NONBLOCK:4,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,
S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1}}},{}],yh9p:[function(t,G,K){function e(m){var q=m.length;if(0<q%4)throw Error("Invalid string. Length must be a multiple of 4");m=m.indexOf("=");return-1===m&&(m=q),[m,m===q?0:4-m%4]}K.byteLength=function(m){m=e(m);var q=m[1];return 3*(m[0]+q)/4-q};K.toByteArray=function(m){var q=e(m);var n=q[0];q=q[1];var p=new d(3*(n+q)/4-q),w=0,B=0<q?n-4:n;for(n=0;n<B;n+=4){var v=f[m.charCodeAt(n)]<<18|f[m.charCodeAt(n+1)]<<12|f[m.charCodeAt(n+
2)]<<6|f[m.charCodeAt(n+3)];p[w++]=v>>16&255;p[w++]=v>>8&255;p[w++]=255&v}return 2===q&&(v=f[m.charCodeAt(n)]<<2|f[m.charCodeAt(n+1)]>>4,p[w++]=255&v),1===q&&(v=f[m.charCodeAt(n)]<<10|f[m.charCodeAt(n+1)]<<4|f[m.charCodeAt(n+2)]>>2,p[w++]=v>>8&255,p[w++]=255&v),p};K.fromByteArray=function(m){for(var q,n=m.length,p=n%3,w=[],B=0,v=n-p;B<v;B+=16383){for(var z=w,C=z.push,A,F=m,E=B+16383>v?v:B+16383,M=[],J=B;J<E;J+=3)A=(F[J]<<16&16711680)+(F[J+1]<<8&65280)+(255&F[J+2]),M.push(l[A>>18&63]+l[A>>12&63]+l[A>>
6&63]+l[63&A]);A=M.join("");C.call(z,A)}return 1===p?(q=m[n-1],w.push(l[q>>2]+l[q<<4&63]+"==")):2===p&&(q=(m[n-2]<<8)+m[n-1],w.push(l[q>>10]+l[q>>4&63]+l[q<<2&63]+"=")),w.join("")};var l=[],f=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array;for(t=0;64>t;++t)l[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t],f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;f[45]=62;f[95]=63},{}],JgNJ:[function(t,G,K){K.read=function(e,l,f,d,m){var q=
8*m-d-1;var n=(1<<q)-1,p=n>>1,w=-7;m=f?m-1:0;var B=f?-1:1,v=e[l+m];m+=B;f=v&(1<<-w)-1;v>>=-w;for(w+=q;0<w;f=256*f+e[l+m],m+=B,w-=8);q=f&(1<<-w)-1;f>>=-w;for(w+=d;0<w;q=256*q+e[l+m],m+=B,w-=8);if(0===f)f=1-p;else{if(f===n)return q?NaN:1/0*(v?-1:1);q+=Math.pow(2,d);f-=p}return(v?-1:1)*q*Math.pow(2,f-d)};K.write=function(e,l,f,d,m,q){var n,p,w,B=8*q-m-1,v=(1<<B)-1,z=v>>1,C=23===m?Math.pow(2,-24)-Math.pow(2,-77):0;q=d?0:q-1;d=d?1:-1;var A=0>l||0===l&&0>1/l?1:0;l=Math.abs(l);for(isNaN(l)||l===1/0?(p=isNaN(l)?
1:0,n=v):(n=Math.floor(Math.log(l)/Math.LN2),1>l*(w=Math.pow(2,-n))&&(n--,w*=2),2<=(l+=1<=n+z?C/w:C*Math.pow(2,1-z))*w&&(n++,w/=2),n+z>=v?(p=0,n=v):1<=n+z?(p=(l*w-1)*Math.pow(2,m),n+=z):(p=l*Math.pow(2,z-1)*Math.pow(2,m),n=0));8<=m;e[f+q]=255&p,q+=d,p/=256,m-=8);n=n<<m|p;for(B+=m;0<B;e[f+q]=255&n,q+=d,n/=256,B-=8);e[f+q-d]|=128*A}},{}],REa7:[function(t,G,K){var e={}.toString;G.exports=Array.isArray||function(l){return"[object Array]"==e.call(l)}},{}],dskh:[function(t,G,K,e){function l(){try{var x=
new Uint8Array(1);return x.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===x.foo()&&"function"==typeof x.subarray&&0===x.subarray(1,1).byteLength}catch(D){return!1}}function f(x,D){if((d.TYPED_ARRAY_SUPPORT?2147483647:1073741823)<D)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?(x=new Uint8Array(D)).__proto__=d.prototype:(null===x&&(x=new d(D)),x.length=D),x}function d(x,D,L){if(!(d.TYPED_ARRAY_SUPPORT||this instanceof d))return new d(x,D,
L);if("number"==typeof x){if("string"==typeof D)throw Error("If encoding is specified then the first argument must be a string");return n(this,x)}return m(this,x,D,L)}function m(x,D,L,Z){if("number"==typeof D)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&D instanceof ArrayBuffer){if(D.byteLength,0>L||D.byteLength<L)throw new RangeError("'offset' is out of bounds");if(D.byteLength<L+(Z||0))throw new RangeError("'length' is out of bounds");L=(D=void 0===
L&&void 0===Z?new Uint8Array(D):void 0===Z?new Uint8Array(D,L):new Uint8Array(D,L,Z),d.TYPED_ARRAY_SUPPORT?(x=D).__proto__=d.prototype:x=p(x,D),x)}else{if("string"==typeof D){Z=x;if("string"==typeof L&&""!==L||(L="utf8"),!d.isEncoding(L))throw new TypeError('"encoding" must be a valid string encoding');x=0|B(D,L);var pa=(Z=f(Z,x)).write(D,L);x=(pa!==x&&(Z=Z.slice(0,pa)),Z)}else a:if(L=x,d.isBuffer(D))Z=0|w(D.length),x=0===(L=f(L,Z)).length?L:(D.copy(L,0,0,Z),L);else{if(D){if("undefined"!=typeof ArrayBuffer&&
D.buffer instanceof ArrayBuffer||"length"in D){(Z="number"!=typeof D.length)||(Z=D.length,Z=Z!=Z);x=Z?f(L,0):p(L,D);break a}if("Buffer"===D.type&&Sa(D.data)){x=p(L,D.data);break a}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");}L=x}return L}function q(x){if("number"!=typeof x)throw new TypeError('"size" argument must be a number');if(0>x)throw new RangeError('"size" argument must not be negative');}function n(x,D){if(q(D),x=f(x,0>D?0:0|w(D)),
!d.TYPED_ARRAY_SUPPORT)for(var L=0;L<D;++L)x[L]=0;return x}function p(x,D){var L=0>D.length?0:0|w(D.length);x=f(x,L);for(var Z=0;Z<L;Z+=1)x[Z]=255&D[Z];return x}function w(x){if(x>=(d.TYPED_ARRAY_SUPPORT?2147483647:1073741823))throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(d.TYPED_ARRAY_SUPPORT?2147483647:1073741823).toString(16)+" bytes");return 0|x}function B(x,D){if(d.isBuffer(x))return x.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&
(ArrayBuffer.isView(x)||x instanceof ArrayBuffer))return x.byteLength;"string"!=typeof x&&(x=""+x);var L=x.length;if(0===L)return 0;for(var Z=!1;;)switch(D){case "ascii":case "latin1":case "binary":return L;case "utf8":case "utf-8":case void 0:return la(x).length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return 2*L;case "hex":return L>>>1;case "base64":return Pa(x).length;default:if(Z)return la(x).length;D=(""+D).toLowerCase();Z=!0}}function v(x,D,L){var Z=!1;if(((void 0===D||0>D)&&
(D=0),D>this.length)||((void 0===L||L>this.length)&&(L=this.length),0>=L)||(L>>>=0)<=(D>>>=0))return"";for(x||="utf8";;)switch(x){case "hex":x=D;D=L;L=this.length;(!x||0>x)&&(x=0);(!D||0>D||D>L)&&(D=L);Z="";for(L=x;L<D;++L)x=Z,Z=this[L],Z=16>Z?"0"+Z.toString(16):Z.toString(16),Z=x+Z;return Z;case "utf8":case "utf-8":return F(this,D,L);case "ascii":x="";for(L=Math.min(this.length,L);D<L;++D)x+=String.fromCharCode(127&this[D]);return x;case "latin1":case "binary":x="";for(L=Math.min(this.length,L);D<
L;++D)x+=String.fromCharCode(this[D]);return x;case "base64":return 0===D&&L===this.length?wa.fromByteArray(this):wa.fromByteArray(this.slice(D,L));case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":D=this.slice(D,L);L="";for(x=0;x<D.length;x+=2)L+=String.fromCharCode(D[x]+256*D[x+1]);return L;default:if(Z)throw new TypeError("Unknown encoding: "+x);x=(x+"").toLowerCase();Z=!0}}function z(x,D,L){var Z=x[D];x[D]=x[L];x[L]=Z}function C(x,D,L,Z,pa){if(0===x.length)return-1;if("string"==typeof L?
(Z=L,L=0):2147483647<L?L=2147483647:-2147483648>L&&(L=-2147483648),L=+L,isNaN(L)&&(L=pa?0:x.length-1),0>L&&(L=x.length+L),L>=x.length){if(pa)return-1;L=x.length-1}else if(0>L){if(!pa)return-1;L=0}if("string"==typeof D&&(D=d.from(D,Z)),d.isBuffer(D))return 0===D.length?-1:A(x,D,L,Z,pa);if("number"==typeof D)return D&=255,d.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?pa?Uint8Array.prototype.indexOf.call(x,D,L):Uint8Array.prototype.lastIndexOf.call(x,D,L):A(x,[D],L,Z,pa);throw new TypeError("val must be string, number or Buffer");
}function A(x,D,L,Z,pa){function Ja(P,Ia){return 1===ea?P[Ia]:P.readUInt16BE(Ia*ea)}var ea=1,ra=x.length,Fa=D.length;if(void 0!==Z&&("ucs2"===(Z=String(Z).toLowerCase())||"ucs-2"===Z||"utf16le"===Z||"utf-16le"===Z)){if(2>x.length||2>D.length)return-1;ea=2;ra/=2;Fa/=2;L/=2}if(pa)for(Z=-1;L<ra;L++)if(Ja(x,L)===Ja(D,-1===Z?0:L-Z)){if(-1===Z&&(Z=L),L-Z+1===Fa)return Z*ea}else-1!==Z&&(L-=L-Z),Z=-1;else for(L+Fa>ra&&(L=ra-Fa);0<=L;L--){ra=!0;for(Z=0;Z<Fa;Z++)if(Ja(x,L+Z)!==Ja(D,Z)){ra=!1;break}if(ra)return L}return-1}
function F(x,D,L){L=Math.min(x.length,L);for(var Z=[];D<L;){var pa,Ja,ea=x[D],ra=null,Fa=239<ea?4:223<ea?3:191<ea?2:1;if(D+Fa<=L)switch(Fa){case 1:128>ea&&(ra=ea);break;case 2:128==(192&(pa=x[D+1]))&&127<(Ja=(31&ea)<<6|63&pa)&&(ra=Ja);break;case 3:pa=x[D+1];var P=x[D+2];128==(192&pa)&&128==(192&P)&&2047<(Ja=(15&ea)<<12|(63&pa)<<6|63&P)&&(55296>Ja||57343<Ja)&&(ra=Ja);break;case 4:pa=x[D+1];P=x[D+2];var Ia=x[D+3];128==(192&pa)&&128==(192&P)&&128==(192&Ia)&&65535<(Ja=(15&ea)<<18|(63&pa)<<12|(63&P)<<
6|63&Ia)&&1114112>Ja&&(ra=Ja)}null===ra?(ra=65533,Fa=1):65535<ra&&(ra-=65536,Z.push(ra>>>10&1023|55296),ra=56320|1023&ra);Z.push(ra);D+=Fa}x=Z.length;if(x<=Aa)Z=String.fromCharCode.apply(String,Z);else{L="";for(pa=0;pa<x;)L+=String.fromCharCode.apply(String,Z.slice(pa,pa+=Aa));Z=L}return Z}function E(x,D,L){if(0!=x%1||0>x)throw new RangeError("offset is not uint");if(x+D>L)throw new RangeError("Trying to access beyond buffer length");}function M(x,D,L,Z,pa,Ja){if(!d.isBuffer(x))throw new TypeError('"buffer" argument must be a Buffer instance');
if(D>pa||D<Ja)throw new RangeError('"value" argument is out of bounds');if(L+Z>x.length)throw new RangeError("Index out of range");}function J(x,D,L,Z){0>D&&(D=65535+D+1);for(var pa=0,Ja=Math.min(x.length-L,2);pa<Ja;++pa)x[L+pa]=(D&255<<8*(Z?pa:1-pa))>>>8*(Z?pa:1-pa)}function X(x,D,L,Z){0>D&&(D=4294967295+D+1);for(var pa=0,Ja=Math.min(x.length-L,4);pa<Ja;++pa)x[L+pa]=D>>>8*(Z?pa:3-pa)&255}function ja(x,D,L,Z,pa,Ja){if(L+Z>x.length)throw new RangeError("Index out of range");if(0>L)throw new RangeError("Index out of range");
}function S(x,D,L,Z,pa){return pa||ja(x,D,L,4,3.4028234663852886E38,-3.4028234663852886E38),Na.write(x,D,L,Z,23,4),L+4}function W(x,D,L,Z,pa){return pa||ja(x,D,L,8,1.7976931348623157E308,-1.7976931348623157E308),Na.write(x,D,L,Z,52,8),L+8}function la(x,D){var L;D=D||1/0;for(var Z=x.length,pa=null,Ja=[],ea=0;ea<Z;++ea){if(55295<(L=x.charCodeAt(ea))&&57344>L){if(!pa){if(56319<L){-1<(D-=3)&&Ja.push(239,191,189);continue}if(ea+1===Z){-1<(D-=3)&&Ja.push(239,191,189);continue}pa=L;continue}if(56320>L){-1<
(D-=3)&&Ja.push(239,191,189);pa=L;continue}L=65536+(pa-55296<<10|L-56320)}else pa&&-1<(D-=3)&&Ja.push(239,191,189);if(pa=null,128>L){if(0>--D)break;Ja.push(L)}else if(2048>L){if(0>(D-=2))break;Ja.push(L>>6|192,63&L|128)}else if(65536>L){if(0>(D-=3))break;Ja.push(L>>12|224,L>>6&63|128,63&L|128)}else{if(!(1114112>L))throw Error("Invalid code point");if(0>(D-=4))break;Ja.push(L>>18|240,L>>12&63|128,L>>6&63|128,63&L|128)}}return Ja}function qa(x){for(var D=[],L=0;L<x.length;++L)D.push(255&x.charCodeAt(L));
return D}function Pa(x){var D=wa,L=D.toByteArray;if(2>(x=(x.trim?x.trim():x.replace(/^\s+|\s+$/g,"")).replace(ya,"")).length)x="";else for(;0!=x.length%4;)x+="=";return L.call(D,x)}function Ba(x,D,L,Z){for(var pa=0;pa<Z&&!(pa+L>=D.length||pa>=x.length);++pa)D[pa+L]=x[pa];return pa}var wa=t("base64-js"),Na=t("ieee754"),Sa=t("isarray");K.Buffer=d;K.SlowBuffer=function(x){return+x!=x&&(x=0),d.alloc(+x)};K.INSPECT_MAX_BYTES=50;d.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:
l();K.kMaxLength=d.TYPED_ARRAY_SUPPORT?2147483647:1073741823;d.poolSize=8192;d._augment=function(x){return x.__proto__=d.prototype,x};d.from=function(x,D,L){return m(null,x,D,L)};d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0}));d.alloc=function(x,D,L){return q(x),0>=x?f(null,x):void 0!==D?"string"==typeof L?f(null,x).fill(D,
L):f(null,x).fill(D):f(null,x)};d.allocUnsafe=function(x){return n(null,x)};d.allocUnsafeSlow=function(x){return n(null,x)};d.isBuffer=function(x){return!(null==x||!x._isBuffer)};d.compare=function(x,D){if(!d.isBuffer(x)||!d.isBuffer(D))throw new TypeError("Arguments must be Buffers");if(x===D)return 0;for(var L=x.length,Z=D.length,pa=0,Ja=Math.min(L,Z);pa<Ja;++pa)if(x[pa]!==D[pa]){L=x[pa];Z=D[pa];break}return L<Z?-1:Z<L?1:0};d.isEncoding=function(x){switch(String(x).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "latin1":case "binary":case "base64":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;
default:return!1}};d.concat=function(x,D){if(!Sa(x))throw new TypeError('"list" argument must be an Array of Buffers');if(0===x.length)return d.alloc(0);var L;if(void 0===D)for(L=D=0;L<x.length;++L)D+=x[L].length;D=d.allocUnsafe(D);var Z=0;for(L=0;L<x.length;++L){var pa=x[L];if(!d.isBuffer(pa))throw new TypeError('"list" argument must be an Array of Buffers');pa.copy(D,Z);Z+=pa.length}return D};d.byteLength=B;d.prototype._isBuffer=!0;d.prototype.swap16=function(){var x=this.length;if(0!=x%2)throw new RangeError("Buffer size must be a multiple of 16-bits");
for(var D=0;D<x;D+=2)z(this,D,D+1);return this};d.prototype.swap32=function(){var x=this.length;if(0!=x%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var D=0;D<x;D+=4)z(this,D,D+3),z(this,D+1,D+2);return this};d.prototype.swap64=function(){var x=this.length;if(0!=x%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var D=0;D<x;D+=8)z(this,D,D+7),z(this,D+1,D+6),z(this,D+2,D+5),z(this,D+3,D+4);return this};d.prototype.toString=function(){var x=0|this.length;
return 0===x?"":0===arguments.length?F(this,0,x):v.apply(this,arguments)};d.prototype.equals=function(x){if(!d.isBuffer(x))throw new TypeError("Argument must be a Buffer");return this===x||0===d.compare(this,x)};d.prototype.inspect=function(){var x="",D=K.INSPECT_MAX_BYTES;return 0<this.length&&(x=this.toString("hex",0,D).match(/.{2}/g).join(" "),this.length>D&&(x+=" ... ")),"<Buffer "+x+">"};d.prototype.compare=function(x,D,L,Z,pa){if(!d.isBuffer(x))throw new TypeError("Argument must be a Buffer");
if(void 0===D&&(D=0),void 0===L&&(L=x?x.length:0),void 0===Z&&(Z=0),void 0===pa&&(pa=this.length),0>D||L>x.length||0>Z||pa>this.length)throw new RangeError("out of range index");if(Z>=pa&&D>=L)return 0;if(Z>=pa)return-1;if(D>=L)return 1;if(this===x)return 0;var Ja=(pa>>>=0)-(Z>>>=0),ea=(L>>>=0)-(D>>>=0),ra=Math.min(Ja,ea);Z=this.slice(Z,pa);x=x.slice(D,L);for(D=0;D<ra;++D)if(Z[D]!==x[D]){Ja=Z[D];ea=x[D];break}return Ja<ea?-1:ea<Ja?1:0};d.prototype.includes=function(x,D,L){return-1!==this.indexOf(x,
D,L)};d.prototype.indexOf=function(x,D,L){return C(this,x,D,L,!0)};d.prototype.lastIndexOf=function(x,D,L){return C(this,x,D,L,!1)};d.prototype.write=function(x,D,L,Z){if(void 0===D)Z="utf8",L=this.length,D=0;else if(void 0===L&&"string"==typeof D)Z=D,L=this.length,D=0;else{if(!isFinite(D))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");D|=0;isFinite(L)?(L|=0,void 0===Z&&(Z="utf8")):(Z=L,L=void 0)}var pa=this.length-D;if((void 0===L||L>pa)&&(L=pa),0<x.length&&
(0>L||0>D)||D>this.length)throw new RangeError("Attempt to write outside buffer bounds");Z||="utf8";for(pa=!1;;)switch(Z){case "hex":a:{D=Number(D)||0;Z=this.length-D;L?(L=Number(L))>Z&&(L=Z):L=Z;Z=x.length;if(0!=Z%2)throw new TypeError("Invalid hex string");L>Z/2&&(L=Z/2);for(Z=0;Z<L;++Z){pa=parseInt(x.substr(2*Z,2),16);if(isNaN(pa)){x=Z;break a}this[D+Z]=pa}x=Z}return x;case "utf8":case "utf-8":return Ba(la(x,this.length-D),this,D,L);case "ascii":return Ba(qa(x),this,D,L);case "latin1":case "binary":return Ba(qa(x),
this,D,L);case "base64":return Ba(Pa(x),this,D,L);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":var Ja;Z=x;pa=this.length-D;for(var ea=[],ra=0;ra<Z.length&&!(0>(pa-=2));++ra)x=(Ja=Z.charCodeAt(ra))>>8,Ja%=256,ea.push(Ja),ea.push(x);return Ba(ea,this,D,L);default:if(pa)throw new TypeError("Unknown encoding: "+Z);Z=(""+Z).toLowerCase();pa=!0}};d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Aa=4096;d.prototype.slice=function(x,D){var L=
this.length;if(0>(x=~~x)?0>(x+=L)&&(x=0):x>L&&(x=L),0>(D=void 0===D?L:~~D)?0>(D+=L)&&(D=0):D>L&&(D=L),D<x&&(D=x),d.TYPED_ARRAY_SUPPORT)(D=this.subarray(x,D)).__proto__=d.prototype;else{L=D-x;D=new d(L,void 0);for(var Z=0;Z<L;++Z)D[Z]=this[Z+x]}return D};d.prototype.readUIntLE=function(x,D,L){x|=0;D|=0;L||E(x,D,this.length);L=this[x];for(var Z=1,pa=0;++pa<D&&(Z*=256);)L+=this[x+pa]*Z;return L};d.prototype.readUIntBE=function(x,D,L){x|=0;D|=0;L||E(x,D,this.length);L=this[x+--D];for(var Z=1;0<D&&(Z*=
256);)L+=this[x+--D]*Z;return L};d.prototype.readUInt8=function(x,D){return D||E(x,1,this.length),this[x]};d.prototype.readUInt16LE=function(x,D){return D||E(x,2,this.length),this[x]|this[x+1]<<8};d.prototype.readUInt16BE=function(x,D){return D||E(x,2,this.length),this[x]<<8|this[x+1]};d.prototype.readUInt32LE=function(x,D){return D||E(x,4,this.length),(this[x]|this[x+1]<<8|this[x+2]<<16)+16777216*this[x+3]};d.prototype.readUInt32BE=function(x,D){return D||E(x,4,this.length),16777216*this[x]+(this[x+
1]<<16|this[x+2]<<8|this[x+3])};d.prototype.readIntLE=function(x,D,L){x|=0;D|=0;L||E(x,D,this.length);L=this[x];for(var Z=1,pa=0;++pa<D&&(Z*=256);)L+=this[x+pa]*Z;return L>=128*Z&&(L-=Math.pow(2,8*D)),L};d.prototype.readIntBE=function(x,D,L){x|=0;D|=0;L||E(x,D,this.length);L=D;for(var Z=1,pa=this[x+--L];0<L&&(Z*=256);)pa+=this[x+--L]*Z;return pa>=128*Z&&(pa-=Math.pow(2,8*D)),pa};d.prototype.readInt8=function(x,D){return D||E(x,1,this.length),128&this[x]?-1*(255-this[x]+1):this[x]};d.prototype.readInt16LE=
function(x,D){D||E(x,2,this.length);x=this[x]|this[x+1]<<8;return 32768&x?4294901760|x:x};d.prototype.readInt16BE=function(x,D){D||E(x,2,this.length);x=this[x+1]|this[x]<<8;return 32768&x?4294901760|x:x};d.prototype.readInt32LE=function(x,D){return D||E(x,4,this.length),this[x]|this[x+1]<<8|this[x+2]<<16|this[x+3]<<24};d.prototype.readInt32BE=function(x,D){return D||E(x,4,this.length),this[x]<<24|this[x+1]<<16|this[x+2]<<8|this[x+3]};d.prototype.readFloatLE=function(x,D){return D||E(x,4,this.length),
Na.read(this,x,!0,23,4)};d.prototype.readFloatBE=function(x,D){return D||E(x,4,this.length),Na.read(this,x,!1,23,4)};d.prototype.readDoubleLE=function(x,D){return D||E(x,8,this.length),Na.read(this,x,!0,52,8)};d.prototype.readDoubleBE=function(x,D){return D||E(x,8,this.length),Na.read(this,x,!1,52,8)};d.prototype.writeUIntLE=function(x,D,L,Z){(x=+x,D|=0,L|=0,Z)||M(this,x,D,L,Math.pow(2,8*L)-1,0);Z=1;var pa=0;for(this[D]=255&x;++pa<L&&(Z*=256);)this[D+pa]=x/Z&255;return D+L};d.prototype.writeUIntBE=
function(x,D,L,Z){(x=+x,D|=0,L|=0,Z)||M(this,x,D,L,Math.pow(2,8*L)-1,0);Z=L-1;var pa=1;for(this[D+Z]=255&x;0<=--Z&&(pa*=256);)this[D+Z]=x/pa&255;return D+L};d.prototype.writeUInt8=function(x,D,L){return x=+x,D|=0,L||M(this,x,D,1,255,0),d.TYPED_ARRAY_SUPPORT||(x=Math.floor(x)),this[D]=255&x,D+1};d.prototype.writeUInt16LE=function(x,D,L){return x=+x,D|=0,L||M(this,x,D,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[D]=255&x,this[D+1]=x>>>8):J(this,x,D,!0),D+2};d.prototype.writeUInt16BE=function(x,D,L){return x=
+x,D|=0,L||M(this,x,D,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[D]=x>>>8,this[D+1]=255&x):J(this,x,D,!1),D+2};d.prototype.writeUInt32LE=function(x,D,L){return x=+x,D|=0,L||M(this,x,D,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[D+3]=x>>>24,this[D+2]=x>>>16,this[D+1]=x>>>8,this[D]=255&x):X(this,x,D,!0),D+4};d.prototype.writeUInt32BE=function(x,D,L){return x=+x,D|=0,L||M(this,x,D,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[D]=x>>>24,this[D+1]=x>>>16,this[D+2]=x>>>8,this[D+3]=255&x):X(this,x,D,!1),D+4};
d.prototype.writeIntLE=function(x,D,L,Z){(x=+x,D|=0,Z)||(Z=Math.pow(2,8*L-1),M(this,x,D,L,Z-1,-Z));Z=0;var pa=1,Ja=0;for(this[D]=255&x;++Z<L&&(pa*=256);)0>x&&0===Ja&&0!==this[D+Z-1]&&(Ja=1),this[D+Z]=(x/pa>>0)-Ja&255;return D+L};d.prototype.writeIntBE=function(x,D,L,Z){(x=+x,D|=0,Z)||(Z=Math.pow(2,8*L-1),M(this,x,D,L,Z-1,-Z));Z=L-1;var pa=1,Ja=0;for(this[D+Z]=255&x;0<=--Z&&(pa*=256);)0>x&&0===Ja&&0!==this[D+Z+1]&&(Ja=1),this[D+Z]=(x/pa>>0)-Ja&255;return D+L};d.prototype.writeInt8=function(x,D,L){return x=
+x,D|=0,L||M(this,x,D,1,127,-128),d.TYPED_ARRAY_SUPPORT||(x=Math.floor(x)),0>x&&(x=255+x+1),this[D]=255&x,D+1};d.prototype.writeInt16LE=function(x,D,L){return x=+x,D|=0,L||M(this,x,D,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[D]=255&x,this[D+1]=x>>>8):J(this,x,D,!0),D+2};d.prototype.writeInt16BE=function(x,D,L){return x=+x,D|=0,L||M(this,x,D,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[D]=x>>>8,this[D+1]=255&x):J(this,x,D,!1),D+2};d.prototype.writeInt32LE=function(x,D,L){return x=+x,D|=0,L||M(this,
x,D,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[D]=255&x,this[D+1]=x>>>8,this[D+2]=x>>>16,this[D+3]=x>>>24):X(this,x,D,!0),D+4};d.prototype.writeInt32BE=function(x,D,L){return x=+x,D|=0,L||M(this,x,D,4,2147483647,-2147483648),0>x&&(x=4294967295+x+1),d.TYPED_ARRAY_SUPPORT?(this[D]=x>>>24,this[D+1]=x>>>16,this[D+2]=x>>>8,this[D+3]=255&x):X(this,x,D,!1),D+4};d.prototype.writeFloatLE=function(x,D,L){return S(this,x,D,!0,L)};d.prototype.writeFloatBE=function(x,D,L){return S(this,x,D,!1,L)};d.prototype.writeDoubleLE=
function(x,D,L){return W(this,x,D,!0,L)};d.prototype.writeDoubleBE=function(x,D,L){return W(this,x,D,!1,L)};d.prototype.copy=function(x,D,L,Z){if((L||=0,Z||0===Z||(Z=this.length),D>=x.length&&(D=x.length),D||=0,0<Z&&Z<L&&(Z=L),Z===L)||0===x.length||0===this.length)return 0;if(0>D)throw new RangeError("targetStart out of bounds");if(0>L||L>=this.length)throw new RangeError("sourceStart out of bounds");if(0>Z)throw new RangeError("sourceEnd out of bounds");Z>this.length&&(Z=this.length);x.length-D<
Z-L&&(Z=x.length-D+L);var pa=Z-L;if(this===x&&L<D&&D<Z)for(Z=pa-1;0<=Z;--Z)x[Z+D]=this[Z+L];else if(1E3>pa||!d.TYPED_ARRAY_SUPPORT)for(Z=0;Z<pa;++Z)x[Z+D]=this[Z+L];else Uint8Array.prototype.set.call(x,this.subarray(L,L+pa),D);return pa};d.prototype.fill=function(x,D,L,Z){if("string"==typeof x){if("string"==typeof D?(Z=D,D=0,L=this.length):"string"==typeof L&&(Z=L,L=this.length),1===x.length){var pa=x.charCodeAt(0);256>pa&&(x=pa)}if(void 0!==Z&&"string"!=typeof Z)throw new TypeError("encoding must be a string");
if("string"==typeof Z&&!d.isEncoding(Z))throw new TypeError("Unknown encoding: "+Z);}else"number"==typeof x&&(x&=255);if(0>D||this.length<D||this.length<L)throw new RangeError("Out of range index");if(L<=D)return this;if(D>>>=0,L=void 0===L?this.length:L>>>0,x||=0,"number"==typeof x)for(Z=D;Z<L;++Z)this[Z]=x;else for(x=d.isBuffer(x)?x:la((new d(x,Z)).toString()),pa=x.length,Z=0;Z<L-D;++Z)this[Z+D]=x[Z%pa];return this};var ya=/[^+\/0-9A-Za-z-_]/g},{"base64-js":"yh9p",ieee754:"JgNJ",isarray:"REa7",
buffer:"dskh"}],QO4x:[function(t,G,K,e){function l(w,B){this.db=w;this.mode=B}function f(w){this.name=w||m;this.db=null}t("buffer");var d=t("buffer").Buffer,m=t("../constants.js").FILE_SYSTEM_NAME,q=t("../constants.js").FILE_STORE_NAME,n=t("../constants.js").IDB_RW,p=t("../constants.js").IDB_RO;l.prototype._getObjectStore=function(){return this.objectStore?this.objectStore:(this.objectStore=this.db.transaction(q,this.mode).objectStore(q),this.objectStore)};l.prototype.clear=function(w){try{var B=
this._getObjectStore().clear();B.onsuccess=function(){w()};B.onerror=function(v){v.preventDefault();w(v.error)}}catch(v){w(v)}};l.prototype._get=function(w,B){try{var v=this._getObjectStore().get(w);v.onsuccess=function(z){B(null,z.target.result)};v.onerror=function(z){z.preventDefault();B(z.error)}}catch(z){B(z)}};l.prototype.getObject=function(w,B){this._get(w,B)};l.prototype.getBuffer=function(w,B){this._get(w,function(v,z){if(v)return B(v);B(null,d.from(z))})};l.prototype._put=function(w,B,v){try{var z=
this._getObjectStore().put(B,w);z.onsuccess=function(C){v(null,C.target.result)};z.onerror=function(C){C.preventDefault();v(C.error)}}catch(C){v(C)}};l.prototype.putObject=function(w,B,v){this._put(w,B,v)};l.prototype.putBuffer=function(w,B,v){this._put(w,B.buffer,v)};l.prototype.delete=function(w,B){try{var v=this._getObjectStore().delete(w);v.onsuccess=function(z){B(null,z.target.result)};v.onerror=function(z){z.preventDefault();B(z.error)}}catch(z){B(z)}};f.isSupported=function(){return!!(e.indexedDB||
e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB)};f.prototype.open=function(w){var B=this;if(B.db)return w();try{var v=(e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB).open(B.name);v.onupgradeneeded=function(z){z=z.target.result;z.objectStoreNames.contains(q)&&z.deleteObjectStore(q);z.createObjectStore(q)};v.onsuccess=function(z){B.db=z.target.result;w()};v.onerror=function(z){z.preventDefault();w(z.error)}}catch(z){w(z)}};f.prototype.getReadOnlyContext=function(){return new l(this.db,
p)};f.prototype.getReadWriteContext=function(){return new l(this.db,n)};G.exports=f},{"../constants.js":"iJA9",buffer:"dskh"}],u4Zs:[function(t,G,K){t("process");var e=t("process");!function(){var l={};void 0!==e&&e.nextTick?(l.nextTick=e.nextTick,"undefined"!=typeof setImmediate?l.setImmediate=function(f){setImmediate(f)}:l.setImmediate=l.nextTick):"function"==typeof setImmediate?(l.nextTick=function(f){setImmediate(f)},l.setImmediate=l.nextTick):(l.nextTick=function(f){setTimeout(f,0)},l.setImmediate=
l.nextTick);l.eachSeries=function(f,d,m){if(m=m||function(){},!f.length)return m();var q=0;!function p(){d(f[q],function(w){w?(m(w),m=function(){}):(q+=1)>=f.length?m():p()})}()};l.forEachSeries=l.eachSeries;"undefined"!=typeof G&&G.exports?G.exports=l:root.async=l}()},{process:"pBGv"}],OWym:[function(t,G,K){function e(q,n){this.readOnly=n;this.objectStore=q}function l(q){this.name=q||f}var f=t("../constants.js").FILE_SYSTEM_NAME,d=t("../../lib/async.js").setImmediate,m=function(){var q={};return function(n){return Object.prototype.hasOwnProperty.call(q,
n)||(q[n]={}),q[n]}}();e.prototype.clear=function(q){if(this.readOnly)d(function(){q("[MemoryContext] Error: write operation on read only context")});else{var n=this.objectStore;Object.keys(n).forEach(function(p){delete n[p]});d(q)}};e.prototype.getObject=e.prototype.getBuffer=function(q,n){var p=this;d(function(){n(null,p.objectStore[q])})};e.prototype.putObject=e.prototype.putBuffer=function(q,n,p){this.readOnly?d(function(){p("[MemoryContext] Error: write operation on read only context")}):(this.objectStore[q]=
n,d(p))};e.prototype.delete=function(q,n){this.readOnly?d(function(){n("[MemoryContext] Error: write operation on read only context")}):(delete this.objectStore[q],d(n))};l.isSupported=function(){return!0};l.prototype.open=function(q){this.db=m(this.name);d(q)};l.prototype.getReadOnlyContext=function(){return new e(this.db,!0)};l.prototype.getReadWriteContext=function(){return new e(this.db,!1)};G.exports=l},{"../constants.js":"iJA9","../../lib/async.js":"u4Zs"}],AiW7:[function(t,G,K){K=t("./indexeddb.js");
t=t("./memory.js");G.exports={IndexedDB:K,Default:K,Memory:t}},{"./indexeddb.js":"QO4x","./memory.js":"OWym"}],p8GN:[function(t,G,K){var e={};"3:EACCES:permission denied;9:EBADF:bad file descriptor;10:EBUSY:resource busy or locked;18:EINVAL:invalid argument;27:ENOTDIR:not a directory;28:EISDIR:illegal operation on a directory;34:ENOENT:no such file or directory;47:EEXIST:file already exists;50:EPERM:operation not permitted;51:ELOOP:too many symbolic links encountered;53:ENOTEMPTY:directory not empty;55:EIO:i/o error;1000:ENOTMOUNTED:not mounted;1001:EFILESYSTEMERROR:missing super node, use 'FORMAT' flag to format filesystem.;1002:ENOATTR:attribute does not exist".split(";").forEach(function(l){function f(n,
p){Error.call(this);this.code=this.name=m;this.errno=d;this.message=n||q;p&&(this.path=p);this.stack=Error(this.message).stack}var d=+(l=l.split(":"))[0],m=l[1],q=l[2];f.prototype=Object.create(Error.prototype);f.prototype.constructor=f;f.prototype.toString=function(){return this.name+": "+this.message+(this.path?", '"+this.path+"'":"")};e[m]=e[d]=f});G.exports=e},{}],QMiB:[function(t,G,K){var e=t("../constants.js").ENVIRONMENT;G.exports=function(l){(l=l||{}).TMP=l.TMP||e.TMP;l.PATH=l.PATH||e.PATH;
this.get=function(f){return l[f]};this.set=function(f,d){l[f]=d}}},{"../constants.js":"iJA9"}],bQx9:[function(t,G,K){G.exports=function(l,f){for(var d=[],m=0;m<l.length;m++){var q=f(l[m],m);e(q)?d.push.apply(d,q):d.push(q)}return d};var e=Array.isArray||function(l){return"[object Array]"===Object.prototype.toString.call(l)}},{}],D9yG:[function(t,G,K){function e(d,m,q){d instanceof RegExp&&(d=l(d,q));m instanceof RegExp&&(m=l(m,q));var n=f(d,m,q);return n&&{start:n[0],end:n[1],pre:q.slice(0,n[0]),
body:q.slice(n[0]+d.length,n[1]),post:q.slice(n[1]+m.length)}}function l(d,m){return(d=m.match(d))?d[0]:null}function f(d,m,q){var n,p,w,B,v=q.indexOf(d),z=q.indexOf(m,v+1),C=v;if(0<=v&&0<z){var A=[];for(p=q.length;0<=C&&!B;)C==v?(A.push(C),v=q.indexOf(d,C+1)):1==A.length?B=[A.pop(),z]:((n=A.pop())<p&&(p=n,w=z),z=q.indexOf(m,C+1)),C=v<z&&0<=v?v:z;A.length&&(B=[p,w])}return B}G.exports=e;e.range=f},{}],dwXQ:[function(t,G,K){function e(E){return parseInt(E,10)==E?parseInt(E,10):E.charCodeAt(0)}function l(E){return E.split(v).join("\\").split(z).join("{").split(C).join("}").split(A).join(",").split(F).join(".")}
function f(E){if(!E)return[""];var M=[],J=B("{","}",E);if(!J)return E.split(",");var X=J.body;E=J.post;J=J.pre.split(",");J[J.length-1]+="{"+X+"}";X=f(E);return E.length&&(J[J.length-1]+=X.shift(),J.push.apply(J,X)),M.push.apply(M,J),M}function d(E){return"{"+E+"}"}function m(E){return/^-?0\d/.test(E)}function q(E,M){return E<=M}function n(E,M){return E>=M}function p(E,M){var J=[],X=B("{","}",E);if(!X||/\$$/.test(X.pre))return[E];var ja=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(X.body),S=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(X.body);
ja=ja||S;var W=0<=X.body.indexOf(",");if(!ja&&!W)return X.post.match(/,.*\}/)?p(E=X.pre+"{"+X.body+C+X.post):[E];if(ja)var la=X.body.split(/\.\./);else if(1===(la=f(X.body)).length&&1===(la=p(la[0],!1).map(d)).length)return(qa=X.post.length?p(X.post,!1):[""]).map(function(D){return X.pre+la[0]+D});W=X.pre;var qa=X.post.length?p(X.post,!1):[""];if(ja){var Pa=e(la[0]),Ba=e(la[1]),wa=Math.max(la[0].length,la[1].length),Na=3==la.length?Math.abs(e(la[2])):1,Sa=q;Ba<Pa&&(Na*=-1,Sa=n);var Aa=la.some(m);
for(E=[];Sa(Pa,Ba);Pa+=Na){var ya;if(S)"\\"===(ya=String.fromCharCode(Pa))&&(ya="");else if(ya=String(Pa),Aa){var x=wa-ya.length;0<x&&(x=Array(x+1).join("0"),ya=0>Pa?"-"+x+ya.slice(1):x+ya)}E.push(ya)}}else E=w(la,function(D){return p(D,!1)});for(S=0;S<E.length;S++)for(Ba=0;Ba<qa.length;Ba++)wa=W+E[S]+qa[Ba],(!M||ja||wa)&&J.push(wa);return J}var w=t("concat-map"),B=t("balanced-match");G.exports=function(E){return E?("{}"===E.substr(0,2)&&(E="\\{\\}"+E.substr(2)),p(E.split("\\\\").join(v).split("\\{").join(z).split("\\}").join(C).split("\\,").join(A).split("\\.").join(F),
!0).map(l)):[]};var v="\x00SLASH"+Math.random()+"\x00",z="\x00OPEN"+Math.random()+"\x00",C="\x00CLOSE"+Math.random()+"\x00",A="\x00COMMA"+Math.random()+"\x00",F="\x00PERIOD"+Math.random()+"\x00"},{"concat-map":"bQx9","balanced-match":"D9yG"}],NtKi:[function(t,G,K){function e(z,C){z=z||{};C=C||{};var A={};return Object.keys(C).forEach(function(F){A[F]=C[F]}),Object.keys(z).forEach(function(F){A[F]=z[F]}),A}function l(z,C,A){if("string"!=typeof C)throw new TypeError("glob pattern string required");
return A||={},!(!A.nocomment&&"#"===C.charAt(0))&&(""===C.trim()?""===z:(new f(C,A)).match(z))}function f(z,C){if(!(this instanceof f))return new f(z,C);if("string"!=typeof z)throw new TypeError("glob pattern string required");C||={};z=z.trim();"/"!==m.sep&&(z=z.split(m.sep).join("/"));this.options=C;this.set=[];this.pattern=z;this.regexp=null;this.empty=this.comment=this.negate=!1;this.make()}function d(z,C){if(C||=this instanceof f?this.options:{},void 0===(z=void 0===z?this.pattern:z))throw new TypeError("undefined pattern");
return C.nobrace||!z.match(/\{.*\}/)?[z]:n(z)}G.exports=l;l.Minimatch=f;var m={sep:"/"};try{m=t("path")}catch(z){}var q=l.GLOBSTAR=f.GLOBSTAR={},n=t("brace-expansion"),p={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},w=function(z){return z.split("").reduce(function(C,A){return C[A]=!0,C},{})}("().*{}+?[]^$\\!"),B=/\/+/;l.filter=function(z,C){return C=C||{},function(A,F,E){return l(A,z,C)}};l.defaults=
function(z){if(!z||!Object.keys(z).length)return l;var C=function(A,F,E){return l.minimatch(A,F,e(z,E))};return C.Minimatch=function(A,F){return new l.Minimatch(A,e(z,F))},C};f.defaults=function(z){return z&&Object.keys(z).length?l.defaults(z).Minimatch:f};f.prototype.debug=function(){};f.prototype.make=function(){if(!this._made){var z=this.pattern,C=this.options;C.nocomment||"#"!==z.charAt(0)?z?(this.parseNegate(),z=this.globSet=this.braceExpand(),C.debug&&(this.debug=console.error),this.debug(this.pattern,
z),z=this.globParts=z.map(function(A){return A.split(B)}),this.debug(this.pattern,z),z=z.map(function(A,F,E){return A.map(this.parse,this)},this),this.debug(this.pattern,z),z=z.filter(function(A){return-1===A.indexOf(!1)}),this.debug(this.pattern,z),this.set=z):this.empty=!0:this.comment=!0}};f.prototype.parseNegate=function(){var z=this.pattern,C=!1,A=0;if(!this.options.nonegate){for(var F=0,E=z.length;F<E&&"!"===z.charAt(F);F++)C=!C,A++;A&&(this.pattern=z.substr(A));this.negate=C}};l.braceExpand=
function(z,C){return d(z,C)};f.prototype.braceExpand=d;f.prototype.parse=function(z,C){function A(){if(E){switch(E){case "*":M+="[^/]*?";J=!0;break;case "?":M+="[^/]";J=!0;break;default:M+="\\"+E}Ba.debug("clearStateChar %j %j",E,M);E=!1}}if(65536<z.length)throw new TypeError("pattern is too long");var F=this.options;if(!F.noglobstar&&"**"===z)return q;if(""===z)return"";for(var E,M="",J=!!F.nocase,X=!1,ja=[],S=[],W=!1,la=-1,qa=-1,Pa="."===z.charAt(0)?"":F.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",
Ba=this,wa,Na=0,Sa=z.length;Na<Sa&&(wa=z.charAt(Na));Na++)if(this.debug("%s\t%s %s %j",z,Na,M,wa),X&&w[wa])M+="\\"+wa,X=!1;else switch(wa){case "/":return!1;case "\\":A();X=!0;continue;case "?":case "*":case "+":case "@":case "!":if(this.debug("%s\t%s %s %j <-- stateChar",z,Na,M,wa),W){this.debug("  in class");"!"===wa&&Na===qa+1&&(wa="^");M+=wa;continue}Ba.debug("call clearStateChar %j",E);A();E=wa;F.noext&&A();continue;case "(":if(W){M+="(";continue}if(!E){M+="\\(";continue}ja.push({type:E,start:Na-
1,reStart:M.length,open:p[E].open,close:p[E].close});M+="!"===E?"(?:(?!(?:":"(?:";this.debug("plType %j %j",E,M);E=!1;continue;case ")":if(W||!ja.length){M+="\\)";continue}A();J=!0;var Aa=ja.pop();M+=Aa.close;"!"===Aa.type&&S.push(Aa);Aa.reEnd=M.length;continue;case "|":if(W||!ja.length||X){M+="\\|";X=!1;continue}A();M+="|";continue;case "[":if(A(),W){M+="\\"+wa;continue}W=!0;qa=Na;la=M.length;M+=wa;continue;case "]":if(Na===qa+1||!W){M+="\\"+wa;X=!1;continue}if(W){var ya=z.substring(qa+1,Na);try{RegExp("["+
ya+"]")}catch(L){var x=this.parse(ya,v);M=M.substr(0,la)+"\\["+x[0]+"\\]";J=J||x[1];W=!1;continue}}J=!0;W=!1;M+=wa;continue;default:A(),X?X=!1:!w[wa]||"^"===wa&&W||(M+="\\"),M+=wa}W&&(ya=z.substr(qa+1),x=this.parse(ya,v),M=M.substr(0,la)+"\\["+x[0],J=J||x[1]);for(Aa=ja.pop();Aa;Aa=ja.pop())Na=M.slice(Aa.reStart+Aa.open.length),this.debug("setting tail",M,Aa),Na=Na.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(L,Z,pa){return pa||="\\",Z+Z+pa+"|"}),this.debug("tail=%j\n   %s",Na,Na,Aa,M),W="*"===Aa.type?
"[^/]*?":"?"===Aa.type?"[^/]":"\\"+Aa.type,J=!0,M=M.slice(0,Aa.reStart)+W+"\\("+Na;A();X&&(M+="\\\\");X=!1;switch(M.charAt(0)){case ".":case "[":case "(":X=!0}for(ja=S.length-1;-1<ja;ja--){Na=S[ja];Aa=M.slice(0,Na.reStart);W=M.slice(Na.reStart,Na.reEnd-8);la=M.slice(Na.reEnd-8,Na.reEnd);Na=M.slice(Na.reEnd);la+=Na;qa=Aa.split("(").length-1;wa=Na;for(Na=0;Na<qa;Na++)wa=wa.replace(/\)[+*?]?/,"");qa="";""===(Na=wa)&&C!==v&&(qa="$");M=Aa+W+Na+qa+la}if(""!==M&&J&&(M="(?=.)"+M),X&&(M=Pa+M),C===v)return[M,
J];if(!J)return z.replace(/\\(.)/g,"$1");C=F.nocase?"i":"";try{var D=new RegExp("^"+M+"$",C)}catch(L){return RegExp("$.")}return D._glob=z,D._src=M,D};var v={};l.makeRe=function(z,C){return(new f(z,C||{})).makeRe()};f.prototype.makeRe=function(){if(this.regexp||!1===this.regexp)return this.regexp;var z=this.set;if(!z.length)return this.regexp=!1,this.regexp;var C=this.options,A=C.noglobstar?"[^/]*?":C.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?";C=C.nocase?"i":"";z=z.map(function(F){return F.map(function(E){return E===
q?A:"string"==typeof E?E.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):E._src}).join("\\/")}).join("|");z="^(?:"+z+")$";this.negate&&(z="^(?!"+z+").*$");try{this.regexp=new RegExp(z,C)}catch(F){this.regexp=!1}return this.regexp};l.match=function(z,C,A){var F=new f(C,A=A||{});return z=z.filter(function(E){return F.match(E)}),F.options.nonull&&!z.length&&z.push(C),z};f.prototype.match=function(z,C){if(this.debug("match",z,this.pattern),this.comment)return!1;if(this.empty)return""===z;if("/"===z&&C)return!0;
var A=this.options;"/"!==m.sep&&(z=z.split(m.sep).join("/"));z=z.split(B);this.debug(this.pattern,"split",z);var F,E,M=this.set;this.debug(this.pattern,"set",M);for(E=z.length-1;0<=E&&!(F=z[E]);E--);for(E=0;E<M.length;E++){var J=M[E],X=z;if(A.matchBase&&1===J.length&&(X=[F]),this.matchOne(X,J,C))return!!A.flipNegate||!this.negate}return!A.flipNegate&&this.negate};f.prototype.matchOne=function(z,C,A){var F=this.options;this.debug("matchOne",{this:this,file:z,pattern:C});this.debug("matchOne",z.length,
C.length);for(var E=0,M=0,J=z.length,X=C.length;E<J&&M<X;E++,M++){this.debug("matchOne loop");var ja=C[M],S=z[E];if(this.debug(C,ja,S),!1===ja)return!1;if(ja===q){this.debug("GLOBSTAR",[C,ja,S]);var W=E;M+=1;if(M===X){for(this.debug("** at the end");E<J;E++)if("."===z[E]||".."===z[E]||!F.dot&&"."===z[E].charAt(0))return!1;return!0}for(;W<J;){E=z[W];if(this.debug("\nglobstar while",z,W,C,M,E),this.matchOne(z.slice(W),C.slice(M),A))return this.debug("globstar found match!",W,J,E),!0;if("."===E||".."===
E||!F.dot&&"."===E.charAt(0)){this.debug("dot detected!",z,W,C,M);break}this.debug("globstar swallow a segment, and continue");W++}return!(!A||(this.debug("\n>>> no match, partial?",z,W,C,M),W!==J))}if("string"==typeof ja?(W=F.nocase?S.toLowerCase()===ja.toLowerCase():S===ja,this.debug("string match",ja,S,W)):(W=S.match(ja),this.debug("pattern match",ja,S,W)),!W)return!1}if(E===J&&M===X)return!0;if(E===J)return A;if(M===X)return E===J-1&&""===z[E];throw Error("wtf?");}},{path:"UUq2","brace-expansion":"dwXQ"}],
D1Ra:[function(t,G,K){function e(p,w){var B=this,v=new m((w=w||{}).env),z="/";Object.defineProperty(this,"fs",{get:function(){return p},enumerable:!0});Object.defineProperty(this,"env",{get:function(){return v},enumerable:!0});this.cd=function(C,A){C=f.resolve(z,C);p.stat(C,function(F,E){F?A(new d.ENOTDIR(null,C)):"DIRECTORY"===E.type?(z=C,A()):A(new d.ENOTDIR(null,C))})};this.pwd=function(){return z};this.promises={};"cd exec touch cat ls rm tempDir mkdirp find".split(" ").forEach(function(C){B.promises[C]=
l(B[C].bind(B))})}var l=t("es6-promisify").promisify,f=t("../path.js"),d=t("../errors.js"),m=t("./environment.js"),q=t("../../lib/async.js"),n=t("minimatch");e.prototype.exec=function(p,w,B){var v=this.fs;"function"==typeof w&&(B=w,w=[]);w=w||[];B=B||function(){};p=f.resolve(this.pwd(),p);v.readFile(p,"utf8",function(z,C){if(z)B(z);else try{(new Function("fs","args","callback",C))(v,w,B)}catch(A){B(A)}})};e.prototype.touch=function(p,w,B){var v=this.fs;"function"==typeof w&&(B=w,w={});w=w||{};B=B||
function(){};p=f.resolve(this.pwd(),p);v.stat(p,function(z){if(z)!0===w.updateOnly?B():v.writeFile(p,"",B);else{z=p;var C=Date.now();v.utimes(z,w.date||C,w.date||C,B)}})};e.prototype.cat=function(p,w){var B=this,v=B.fs,z="";w=w||function(){};p?(p="string"==typeof p?[p]:p,q.eachSeries(p,function(C,A){C=f.resolve(B.pwd(),C);v.readFile(C,"utf8",function(F,E){F?A(F):(z+=E+"\n",A())})},function(C){C?w(C):w(null,z.replace(/\n$/,""))})):w(new d.EINVAL("Missing files argument"))};e.prototype.ls=function(p,
w,B){var v=this,z=v.fs;"function"==typeof w&&(B=w,w={});w=w||{};B=B||function(){};p?function E(A,F){var M=f.resolve(v.pwd(),A),J=[];z.readdir(M,function(X,ja){X?F(X):q.eachSeries(ja,function(S,W){S=f.join(M,S);z.stat(S,function(la,qa){la?W(la):w.recursive&&"DIRECTORY"===qa.type?E(f.join(M,qa.name),function(Pa,Ba){Pa?W(Pa):(qa.contents=Ba,J.push(qa),W())}):(J.push(qa),W())})},function(S){F(S,J)})})}(p,B):B(new d.EINVAL("Missing dir argument"))};e.prototype.rm=function(p,w,B){var v=this,z=v.fs;"function"==
typeof w&&(B=w,w={});w=w||{};B=B||function(){};p?function E(A,F){A=f.resolve(v.pwd(),A);z.stat(A,function(M,J){M?F(M):"FILE"!==J.type?z.readdir(A,function(X,ja){X?F(X):0!==ja.length?w.recursive?(ja=ja.map(function(S){return f.join(A,S)}),q.eachSeries(ja,E,function(S){S?F(S):z.rmdir(A,F)})):F(new d.ENOTEMPTY(null,A)):z.rmdir(A,F)}):z.unlink(A,F)})}(p,B):B(new d.EINVAL("Missing path argument"))};e.prototype.tempDir=function(p){var w=this.fs,B=this.env.get("TMP");p=p||function(){};w.mkdir(B,function(){p(null,
B)})};e.prototype.mkdirp=function(p,w){var B=this.fs;w=w||function(){};p?"/"!==(p=f.resolve(this.pwd(),p))?function A(z,C){B.stat(z,function(F,E){if(E){if(E.isDirectory())return void C();if(E.isFile())return void C(new d.ENOTDIR(null,z))}else{if(F&&"ENOENT"!==F.code)return void C(F);F=f.dirname(z);"/"===F?B.mkdir(z,function(M){M&&"EEXIST"!==M.code?C(M):C()}):A(F,function(M){if(M)return C(M);B.mkdir(z,function(J){J&&"EEXIST"!==J.code?C(J):C()})})}})}(p,w):w():w(new d.EINVAL("Missing path argument"))};
e.prototype.find=function(p,w,B){function v(M,J){var X=f.removeTrailing(M);!w.regex||w.regex.test(X)?w.name&&!n(f.basename(X),w.name)||w.path&&!n(f.dirname(X),w.path)?J():function(ja,S){F(ja,function(W){W?S(W):(E.push(ja),S())})}(M,J):J()}function z(M,J){M=f.resolve(C.pwd(),M);A.readdir(M,function(X,ja){X?"ENOTDIR"===X.code?v(M,J):J(X):v(f.addTrailing(M),function(S){S?J(S):(ja=ja.map(function(W){return f.join(M,W)}),q.eachSeries(ja,z,function(W){J(W,E)}))})})}var C=this,A=C.fs;"function"==typeof w&&
(B=w,w={});B=B||function(){};var F=(w=w||{}).exec||function(M,J){J()},E=[];p?A.stat(p,function(M,J){M?B(M):J.isDirectory()?z(p,B):B(new d.ENOTDIR(null,p))}):B(new d.EINVAL("Missing path argument"))};G.exports=e},{"es6-promisify":"b1ZG","../path.js":"UzoP","../errors.js":"p8GN","./environment.js":"QMiB","../../lib/async.js":"u4Zs",minimatch:"NtKi"}],J4Qg:[function(t,G,K){t=function(){};t.createInterface=function(l){return{on:function(f,d){void 0===this[l]&&(this[l]={});this[l].hasOwnProperty(f)||(this[l][f]=
[]);this[l][f].push(d)},off:function(f,d){if(void 0!==this[l]&&this[l].hasOwnProperty(f)){f=this[l][f];for(var m=f.length-1;0<=m;m--)f[m]===d&&f.splice(m,1)}},trigger:function(f){if(void 0!==this[l]&&this[l].hasOwnProperty(f))for(var d=Array.prototype.slice.call(arguments,1),m=0;m<this[l][f].length;m++)this[l][f][m].apply(this[l][f][m],d)},removeAllListeners:function(f){if(void 0!==this[l]){var d=this;d[l][f].forEach(function(m){d.off(f,m)})}}}};K=t.createInterface("_handlers");t.prototype._on=K.on;
t.prototype._off=K.off;t.prototype._trigger=K.trigger;var e=t.createInterface("handlers");t.prototype.on=function(){e.on.apply(this,arguments);Array.prototype.unshift.call(arguments,"on");this._trigger.apply(this,arguments)};t.prototype.off=e.off;t.prototype.trigger=e.trigger;t.prototype.removeAllListeners=e.removeAllListeners;G.exports=t},{}],zBMa:[function(t,G,K){function e(l){return l.replace(/[xy]/g,function(f){var d=16*Math.random()|0;return("x"===f?d:3&d|8).toString(16)})}G.exports={guid:function(){return e("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx").toUpperCase()},
nop:function(){},randomChars:function(l){return e("x".repeat(l||6))}}},{}],u7Jv:[function(t,G,K,e){function l(C){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A})(C)}function f(C,A){var F=0;return function(){var E=Date.now();E-F>C&&(F=E,A.apply(this,arguments))}}function d(){var C=this,A=Date.now();this.origin=q();this.lastMessage=A;this.receivedIDs=
{};this.previousValues={};A=function(){C._onStorageEvent.apply(C,arguments)};"undefined"!=typeof document&&(document.attachEvent?document.attachEvent("onstorage",A):m.addEventListener("storage",A,!1))}var m=e;K=t("./eventemitter.js");var q=t("../src/shared.js").guid,n=function(C){return void 0===C||void 0===C.localStorage?{getItem:function(){},setItem:function(){},removeItem:function(){}}:C.localStorage}(m);d.prototype._transaction=function(C){function A(){if(!E){var X=Date.now(),ja=0|n.getItem(B);
if(ja&&1E3>X-ja)return M||(F._on("storage",A),M=!0),void(J=setTimeout(A,20));E=!0;n.setItem(B,X);C();M&&F._off("storage",A);J&&clearTimeout(J);n.removeItem(B)}}var F=this,E=!1,M=!1,J=null;A()};d.prototype._cleanup_emit=f(100,function(){this._transaction(function(){var C=Date.now()-v,A=0;try{var F=JSON.parse(n.getItem(p)||"[]")}catch(M){F=[]}for(var E=F.length-1;0<=E;E--)F[E].timestamp<C&&(F.splice(E,1),A++);0<A&&n.setItem(p,JSON.stringify(F))})});d.prototype._cleanup_once=f(100,function(){var C=this;
C._transaction(function(){Date.now();var A,F=0;try{var E=JSON.parse(n.getItem(w)||"{}")}catch(M){E={}}for(A in E)C._once_expired(A,E)&&(delete E[A],F++);0<F&&n.setItem(w,JSON.stringify(E))})});d.prototype._once_expired=function(C,A){if(!A||!A.hasOwnProperty(C)||"object"!==l(A[C]))return!0;var F=A[C].ttl||z,E=Date.now();return A[C].timestamp<E-F};d.prototype._localStorageChanged=function(C,A){if(C&&C.key)return C.key===A;C=n.getItem(A);return C!==this.previousValues[A]&&(this.previousValues[A]=C,!0)};
d.prototype._onStorageEvent=function(C){C=C||m.event;var A=this;this._localStorageChanged(C,p)&&this._transaction(function(){var F=Date.now(),E=n.getItem(p);try{var M=JSON.parse(E||"[]")}catch(J){M=[]}for(E=0;E<M.length;E++)if(M[E].origin!==A.origin&&!(M[E].timestamp<A.lastMessage)){if(M[E].id){if(A.receivedIDs.hasOwnProperty(M[E].id))continue;A.receivedIDs[M[E].id]=!0}A.trigger(M[E].name,M[E].payload)}A.lastMessage=F});this._trigger("storage",C)};d.prototype._emit=function(C,A,F){if((F="string"==
typeof F||"number"==typeof F?String(F):null)&&F.length){if(this.receivedIDs.hasOwnProperty(F))return;this.receivedIDs[F]=!0}var E={id:F,name:C,origin:this.origin,timestamp:Date.now(),payload:A},M=this;this._transaction(function(){var J=n.getItem(p)||"[]",X="[]"===J?"":",";J=[J.substring(0,J.length-1),X,JSON.stringify(E),"]"].join("");n.setItem(p,J);M.trigger(C,A);setTimeout(function(){M._cleanup_emit()},50)})};d.prototype.emit=function(C,A){this._emit.apply(this,arguments);this._trigger("emit",C,
A)};d.prototype.once=function(C,A,F){if(d.supported){var E=this;this._transaction(function(){try{var M=JSON.parse(n.getItem(w)||"{}")}catch(J){M={}}E._once_expired(C,M)&&(M[C]={},M[C].timestamp=Date.now(),"number"==typeof F&&(M[C].ttl=1E3*F),n.setItem(w,JSON.stringify(M)),A(),setTimeout(function(){E._cleanup_once()},50))})}};(function(C,A){if(void 0!==C&&C||(C={}),"object"===l(A))for(var F in A)A.hasOwnProperty(F)&&(C[F]=A[F]);return C})(d.prototype,K.prototype);d.supported=void 0!==n;var p="intercom",
w="intercom_once",B="intercom_lock",v=5E4,z=36E5;d.destroy=function(){n.removeItem(B);n.removeItem(p);n.removeItem(w)};d.getInstance=function(){var C;return function(){return C||=new d,C}}();G.exports=d},{"./eventemitter.js":"J4Qg","../src/shared.js":"zBMa"}],VLEe:[function(t,G,K){function e(){function m(B){(n===B||w&&0===B.indexOf(q))&&p.trigger("change","change",B)}l.call(this);var q,n,p=this,w=!1;p.start=function(B,v,z){if(!n){if(f.isNull(B))throw Error("Path must be a string without null bytes.");
n=f.normalize(B);(w=!0===z)&&(q="/"===n?"/":n+"/");d.getInstance().on("change",m)}};p.close=function(){d.getInstance().off("change",m);p.removeAllListeners("change")}}var l=t("../lib/eventemitter.js"),f=t("./path.js"),d=t("../lib/intercom.js");e.prototype=new l;e.prototype.constructor=e;G.exports=e},{"../lib/eventemitter.js":"J4Qg","./path.js":"UzoP","../lib/intercom.js":"u7Jv"}],ZECt:[function(t,G,K){var e=t("./constants.js").NODE_TYPE_FILE;G.exports=function(l,f){this.id=l;this.type=f||e}},{"./constants.js":"iJA9"}],
osLK:[function(t,G,K){var e=t("./constants").FIRST_DESCRIPTOR,l={};G.exports={allocDescriptor:function(f){var d;for(d=e;l[d];)d++;return l[d]=f,d},releaseDescriptor:function(f){return delete l[f]},getOpenFileDescription:function(f){return l[f]}}},{"./constants":"iJA9"}],KKNo:[function(t,G,K){function e(A,F){for(var E=0;E<F.length;E++){var M=F[E];M.enumerable=M.enumerable||!1;M.configurable=!0;"value"in M&&(M.writable=!0);Object.defineProperty(A,M.key,M)}}function l(A,F,E){return F&&e(A.prototype,
F),E&&e(A,E),A}function f(A,F,E){if(A[F])return E();A.guid(function(M,J){if(M)return E(M);A[F]=J;E()})}function d(A,F){switch(A){case q:return(F||w)|v;case n:return(F||p)|z;default:return(F||p)|B}}K=t("./constants");var m=K.NODE_TYPE_FILE,q=K.NODE_TYPE_DIRECTORY,n=K.NODE_TYPE_SYMBOLIC_LINK,p=K.DEFAULT_FILE_PERMISSIONS,w=K.DEFAULT_DIR_PERMISSIONS;t=t("./constants").fsConstants;var B=t.S_IFREG,v=t.S_IFDIR,z=t.S_IFLNK,C=function(){function A(F){if(!(this instanceof A))throw new TypeError("Cannot call a class as a function");
var E=Date.now();this.id=F.id;this.data=F.data;this.size=F.size||0;this.atime=F.atime||E;this.ctime=F.ctime||E;this.mtime=F.mtime||E;this.flags=F.flags||[];this.xattrs=F.xattrs||{};this.nlinks=F.nlinks||0;"string"==typeof F.type?this.type=F.type:"string"==typeof F.mode?this.type=F.mode:this.type=m;this.permissions=F.permissions||d(this.type);this.uid=F.uid||0;this.gid=F.gid||0}return l(A,[{key:"toJSON",value:function(){return{id:this.id,data:this.data,size:this.size,atime:this.atime,ctime:this.ctime,
mtime:this.ctime,flags:this.flags,xattrs:this.xattrs,nlinks:this.nlinks,mode:this.type,permissions:this.permissions,uid:this.uid,gid:this.gid}}},{key:"mode",get:function(){return d(this.type,this.permissions)},set:function(F){this.permissions=F}}]),A}();G.exports.create=function(A,F){f(A,"id",function(E){if(E)return F(E);f(A,"data",function(M){if(M)return F(M);F(null,new C(A))})})}},{"./constants":"iJA9"}],XWaV:[function(t,G,K){function e(d,m,q,n){this.path=d;this.id=m;this.flags=q;this.position=
n}var l=t("./errors.js"),f=t("./node");e.prototype.getNode=function(d,m){var q=this.path;d.getObject(this.id,function(n,p){return n?m(n):p?void f.create(p,m):m(new l.EBADF("file descriptor refers to unknown node",q))})};G.exports=e},{"./errors.js":"p8GN","./node":"KKNo"}],JEp0:[function(t,G,K){function e(f){var d=Date.now();this.id=l.SUPER_NODE_ID;this.type=l.NODE_TYPE_META;this.atime=f.atime||d;this.ctime=f.ctime||d;this.mtime=f.mtime||d;this.rnode=f.rnode}var l=t("./constants.js");e.create=function(f,
d){f.guid(function(m,q){m?d(m):(f.rnode=f.rnode||q,d(null,new e(f)))})};G.exports=e},{"./constants.js":"iJA9"}],dsCT:[function(t,G,K){function e(d,m,q){this.dev=q;this.node=m.id;this.type=m.type;this.size=m.size;this.nlinks=m.nlinks;this.atime=new Date(Number(m.atime));this.mtime=new Date(Number(m.mtime));this.ctime=new Date(Number(m.ctime));this.atimeMs=m.atime;this.mtimeMs=m.mtime;this.ctimeMs=m.ctime;this.version=m.version;this.mode=m.mode;this.uid=m.uid;this.gid=m.gid;this.name=f.basename(d)}
var l=t("./constants.js"),f=t("./path.js");e.prototype.isFile=function(){return this.type===l.NODE_TYPE_FILE};e.prototype.isDirectory=function(){return this.type===l.NODE_TYPE_DIRECTORY};e.prototype.isSymbolicLink=function(){return this.type===l.NODE_TYPE_SYMBOLIC_LINK};e.prototype.isSocket=e.prototype.isFIFO=e.prototype.isCharacterDevice=e.prototype.isBlockDevice=function(){return!1};G.exports=e},{"./constants.js":"iJA9","./path.js":"UzoP"}],q4Wu:[function(t,G,K){function e(f,d,m){this.constructor=
e;l.call(this,f,d,m)}var l=t("./stats.js");e.prototype=l.prototype;G.exports=e},{"./stats.js":"dsCT"}],bsBG:[function(t,G,K){function e(N){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(Q){return typeof Q}:function(Q){return Q&&"function"==typeof Symbol&&Q.constructor===Symbol&&Q!==Symbol.prototype?"symbol":typeof Q})(N)}function l(N,Q,O,V,da){function ma(xa){N.changes.push({event:"change",path:Q});da(xa)}var aa=N.flags;aa.includes(qb)&&delete V.ctime;aa.includes(sb)&&
delete V.mtime;aa=!1;V.ctime&&(O.ctime=V.ctime,O.atime=V.ctime,aa=!0);V.atime&&(O.atime=V.atime,aa=!0);V.mtime&&(O.mtime=V.mtime,aa=!0);aa?N.putObject(O.id,O,ma):ma()}function f(N,Q,O,V){function da(Ga,Ta){!Ga&&Ta?V(new ka.EEXIST("path name already exists",Q)):!Ga||Ga instanceof ka.ENOENT?N.getObject(Ea.data,ma):V(Ga)}function ma(Ga,Ta){Ga?V(Ga):(za=Ta,Eb.create({guid:N.guid,type:O},function(Wa,hb){Wa?V(Wa):((Ha=hb).nlinks+=1,N.putObject(Ha.id,Ha,xa))}))}function aa(Ga){Ga?V(Ga):(Ga=Date.now(),l(N,
Ma,Ha,{mtime:Ga,ctime:Ga},V))}function xa(Ga){Ga?V(Ga):(za[ab]=new xb(Ha.id,O),N.putObject(Ea.data,za,aa))}if(O!==db&&O!==Ob)return V(new ka.EINVAL("type must be a directory or file",Q));Q=H(Q);var Ea,za,Ha,ab=Ra(Q),Ma=sa(Q);d(N,Ma,function(Ga,Ta){Ga?V(Ga):Ta.type!==db?V(new ka.ENOTDIR("a component of the path prefix is not a directory",Q)):(Ea=Ta,d(N,Q,da))})}function d(N,Q,O){function V(Ma,Ga){if(Ma)return O(Ma);(Ma=new Hb(Ga),Ma.type===T)&&Ma.rnode?N.getObject(Ma.rnode,da):O(new ka.EFILESYSTEMERROR)}
function da(Ma,Ga){Ma?O(Ma):Ga?Eb.create(Ga,O):O(new ka.ENOENT)}function ma(Ma,Ga){Ma?O(Ma):Ga.type===db&&Ga.data?N.getObject(Ga.data,aa):O(new ka.ENOTDIR("a component of the path prefix is not a directory",Q))}function aa(Ma,Ga){Ma?O(Ma):Object.prototype.hasOwnProperty.call(Ga,za)?N.getObject(Ga[za].id,xa):O(new ka.ENOENT(null,Q))}function xa(Ma,Ga){if(Ma)return O(Ma);Eb.create(Ga,Ea)}function Ea(Ma,Ga){var Ta;Ma?O(Ma):Ga.type===Db?++ab>Da?O(new ka.ELOOP(null,Q)):(Ta=Ga.data,Ta=H(Ta),Ha=sa(Ta),za=
Ra(Ta),ia===za?N.getObject(ta,V):d(N,Ha,ma)):O(null,Ga)}if(!(Q=H(Q)))return O(new ka.ENOENT("path is an empty string"));var za=Ra(Q),Ha=sa(Q),ab=0;ia===za?N.getObject(ta,V):d(N,Ha,ma)}function m(N,Q,O,V,da,ma,aa){var xa=O.xattrs;ma===lb&&Object.prototype.hasOwnProperty.call(xa,V)?aa(new ka.EEXIST("attribute already exists",Q)):ma!==Ab||Object.prototype.hasOwnProperty.call(xa,V)?(xa[V]=da,N.putObject(O.id,O,function(Ea){Ea?aa(Ea):l(N,Q,O,{ctime:Date.now()},aa)})):aa(new ka.ENOATTR(null,Q))}function q(N,
Q,O){function V(Ta,Wa){Ta?O(Ta):(Ha=Wa,N.getObject(Ha.data,da))}function da(Ta,Wa){Ta?O(Ta):(ab=Wa,Eb.create({guid:N.guid,type:db},function(hb,Kb){hb?O(hb):((Ea=Kb).nlinks+=1,N.putObject(Ea.id,Ea,ma))}))}function ma(Ta){Ta?O(Ta):(za={},N.putObject(Ea.data,za,xa))}function aa(Ta){Ta?O(Ta):(Ta=Date.now(),l(N,Ga,Ha,{mtime:Ta,ctime:Ta},O))}function xa(Ta){Ta?O(Ta):(ab[Ma]=new xb(Ea.id,db),N.putObject(Ha.data,ab,aa))}Q=H(Q);var Ea,za,Ha,ab,Ma=Ra(Q),Ga=sa(Q);d(N,Q,function(Ta,Wa){!Ta&&Wa?O(new ka.EEXIST(null,
Q)):!Ta||Ta instanceof ka.ENOENT?d(N,Ga,V):O(Ta)})}function n(N,Q,O,V){var da=ob.fsConstants,ma=da.F_OK,aa=da.R_OK,xa=da.W_OK,Ea=da.X_OK,za=da.S_IXUSR,Ha=da.S_IXGRP,ab=da.S_IXOTH;d(N,Q=H(Q),function(Ma,Ga){return Ma?V(Ma):O===ma?V(null):(Ma=Ja(Ga.mode,V))?O&(aa|xa)?V(null):O&Ea&&Ma&(za|Ha|ab)?V(null):void V(new ka.EACCES("permission denied",Q)):void 0})}function p(N,Q,O){function V(Wa,hb){Wa?O(Wa):ia===Ga?O(new ka.EBUSY(null,Q)):Object.prototype.hasOwnProperty.call(hb,Ga)?(za=(Ma=hb)[Ga].id,N.getObject(za,
da)):O(new ka.ENOENT(null,Q))}function da(Wa,hb){Wa?O(Wa):hb.type!==db?O(new ka.ENOTDIR(null,Q)):(za=hb,N.getObject(za.data,ma))}function ma(Wa,hb){Wa?O(Wa):(Ha=hb,0<Object.keys(Ha).length?O(new ka.ENOTEMPTY(null,Q)):(delete Ma[Ga],N.putObject(ab.data,Ma,aa)))}function aa(Wa){Wa?O(Wa):(Wa=Date.now(),l(N,Ta,ab,{mtime:Wa,ctime:Wa},xa))}function xa(Wa){Wa?O(Wa):N.delete(za.id,Ea)}function Ea(Wa){Wa?O(Wa):N.delete(za.data,O)}Q=H(Q);var za,Ha,ab,Ma,Ga=Ra(Q),Ta=sa(Q);d(N,Ta,function(Wa,hb){Wa?O(Wa):(ab=
hb,N.getObject(ab.data,V))})}function w(N,Q,O,V,da){function ma(fb,gb){fb?da(fb):gb.type!==db?da(new ka.ENOENT(null,Q)):(Ga=gb,N.getObject(Ga.data,aa))}function aa(fb,gb){fb?da(fb):(Ta=gb,Object.prototype.hasOwnProperty.call(Ta,Nb)?O.includes(Ka)?da(new ka.EEXIST("O_CREATE and O_EXCLUSIVE are set, and the named file exists",Q)):(Wa=Ta[Nb]).type===db&&O.includes(Za)?da(new ka.EISDIR("the named file is a directory and O_WRITE is set",Q)):N.getObject(Wa.id,xa):O.includes(eb)?Eb.create({guid:N.guid,type:Ob},
function(Cb,ac){Cb?da(Cb):((hb=ac).nlinks+=1,V&&(hb.mode=V),N.putObject(hb.id,hb,za))}):da(new ka.ENOENT("O_CREATE is not set and the named file does not exist",Q)))}function xa(fb,gb){fb?da(fb):gb.type===Db?++pb>Da?da(new ka.ELOOP(null,Q)):(fb=gb.data,fb=H(fb),Mb=sa(fb),Nb=Ra(fb),ia===Nb&&(O.includes(Za)?da(new ka.EISDIR("the named file is a directory and O_WRITE is set",Q)):d(N,Q,Ea)),d(N,Mb,ma)):Ea(void 0,gb)}function Ea(fb,gb){fb?da(fb):da(null,hb=gb)}function za(fb){fb?da(fb):(Kb=ha.alloc(0),
N.putBuffer(hb.data,Kb,ab))}function Ha(fb){fb?da(fb):(fb=Date.now(),l(N,Mb,Ga,{mtime:fb,ctime:fb},Ma))}function ab(fb){fb?da(fb):(Ta[Nb]=new xb(hb.id,Ob),N.putObject(Ga.data,Ta,Ha))}function Ma(fb){fb?da(fb):da(null,hb)}"function"==typeof V&&(da=V,V=null);Q=H(Q);var Ga,Ta,Wa,hb,Kb,Nb=Ra(Q),Mb=sa(Q),pb=0;ia===Nb?O.includes(Za)?da(new ka.EISDIR("the named file is a directory and O_WRITE is set",Q)):d(N,Q,Ea):d(N,Mb,ma)}function B(N,Q,O,V,da,ma){function aa(Ha){Ha?ma(Ha):ma(null,da)}function xa(Ha){Ha?
ma(Ha):(Ha=Date.now(),l(N,Q.path,za,{mtime:Ha,ctime:Ha},aa))}function Ea(Ha){Ha?ma(Ha):N.putObject(za.id,za,xa)}var za;N.getObject(Q.id,function(Ha,ab){Ha?ma(Ha):(za=ab,Ha=ha.alloc(da),O.copy(Ha,0,V,V+da),Q.position=da,za.size=da,za.version+=1,N.putBuffer(za.data,Ha,Ea))})}function v(N,Q,O,V,da,ma,aa){function xa(Ga){Ga?aa(Ga):aa(null,da)}function Ea(Ga){Ga?aa(Ga):(Ga=Date.now(),l(N,Q.path,ab,{mtime:Ga,ctime:Ga},xa))}function za(Ga){Ga?aa(Ga):N.putObject(ab.id,ab,Ea)}function Ha(Ga,Ta){if(Ga)aa(Ga);
else{if(!(Ma=Ta))return aa(new ka.EIO("Expected Buffer"));Ga=null!=ma?ma:Q.position;Ta=Math.max(Ma.length,Ga+da);var Wa=ha.alloc(Ta);Ma&&Ma.copy(Wa);O.copy(Wa,Ga,V,V+da);void 0===ma&&(Q.position+=da);ab.size=Ta;ab.version+=1;N.putBuffer(ab.data,Wa,za)}}var ab,Ma;N.getObject(Q.id,function(Ga,Ta){Ga?aa(Ga):(ab=Ta,N.getBuffer(ab.data,Ha))})}function z(N,Q,O,V,da,ma,aa){function xa(Ha,ab){if(Ha)aa(Ha);else{if(!(za=ab))return aa(new ka.EIO("Expected Buffer"));Ha=null!=ma?ma:Q.position;da=Ha+da>O.length?
da-Ha:da;za.copy(O,V,Ha,Ha+da);void 0===ma&&(Q.position+=da);aa(null,da)}}var Ea,za;N.getObject(Q.id,function(Ha,ab){Ha?aa(Ha):ab.type===db?aa(new ka.EISDIR("the named file is a directory",Q.path)):(Ea=ab,N.getBuffer(Ea.data,xa))})}function C(N,Q,O){d(N,H(Q),O)}function A(N,Q,O){Q.getNode(N,O)}function F(N,Q,O){function V(za,Ha){if(za)return O(za);Eb.create(Ha,O)}function da(za,Ha){za?O(za):(aa=Ha,Object.prototype.hasOwnProperty.call(aa,xa)?N.getObject(aa[xa].id,V):O(new ka.ENOENT("a component of the path does not name an existing file",
Q)))}Q=H(Q);var ma,aa,xa=Ra(Q),Ea=sa(Q);ia===xa?d(N,Q,O):d(N,Ea,function(za,Ha){za?O(za):(ma=Ha,N.getObject(ma.data,da))})}function E(N,Q,O,V){function da(pb){pb?V(pb):l(N,O,hb,{ctime:Mb},V)}function ma(pb,fb){pb?V(pb):((hb=fb).nlinks+=1,N.putObject(hb.id,hb,da))}function aa(pb){pb?V(pb):N.getObject(Wa,ma)}function xa(pb,fb){pb?V(pb):(Ta=fb,Object.prototype.hasOwnProperty.call(Ta,Kb)?V(new ka.EEXIST("newpath resolves to an existing file",Kb)):(Ta[Kb]=Ma[Ha],Wa=Ta[Kb].id,N.putObject(Ga.data,Ta,aa)))}
function Ea(pb,fb){pb?V(pb):(Ga=fb,N.getObject(Ga.data,xa))}function za(pb,fb){pb?V(pb):(Ma=fb,Object.prototype.hasOwnProperty.call(Ma,Ha)?Ma[Ha].type===db?V(new ka.EPERM("oldpath refers to a directory")):d(N,Nb,Ea):V(new ka.ENOENT("a component of either path prefix does not exist",Ha)))}Q=H(Q);var Ha=Ra(Q);Q=sa(Q);O=H(O);var ab,Ma,Ga,Ta,Wa,hb,Kb=Ra(O),Nb=sa(O),Mb=Date.now();d(N,Q,function(pb,fb){pb?V(pb):(ab=fb,N.getObject(ab.data,za))})}function M(N,Q,O){function V(Ma){Ma?O(Ma):(delete Ea[Ha],N.putObject(xa.data,
Ea,function(Ga){Ga?O(Ga):(Ga=Date.now(),l(N,ab,xa,{mtime:Ga,ctime:Ga},O))}))}function da(Ma){Ma?O(Ma):N.delete(za.data,V)}function ma(Ma,Ga){Ma?O(Ma):Ga.type===db?O(new ka.EPERM("unlink not permitted on directories",Ha)):function(Ta,Wa){Ta?O(Ta):(--(za=Wa).nlinks,1>za.nlinks?N.delete(za.id,da):N.putObject(za.id,za,function(hb){hb?O(hb):l(N,Q,za,{ctime:Date.now()},V)}))}(null,Ga)}function aa(Ma,Ga){Ma?O(Ma):(Ea=Ga,Object.prototype.hasOwnProperty.call(Ea,Ha)?N.getObject(Ea[Ha].id,ma):O(new ka.ENOENT("a component of the path does not name an existing file",
Ha)))}Q=H(Q);var xa,Ea,za,Ha=Ra(Q),ab=sa(Q);d(N,ab,function(Ma,Ga){Ma?O(Ma):(xa=Ga,N.getObject(xa.data,aa))})}function J(N,Q,O,V){function da(xa,Ea){if(xa)V(xa);else if(aa=Ea,xa=Object.keys(aa),O.encoding&&(xa=xa.map(function(Ha){return ha.from(Ha)}),xa="buffer"===O.encoding?xa:xa.map(function(Ha){return Ha.toString(O.encoding)})),O.withFileTypes){var za=[];Bb.eachSeries(xa,function(Ha,ab){var Ma=ha.from(Ha,O.encoding).toString();Ma=va.join(Q,Ma);X(N,Ma,function(Ga,Ta){Ga&&ab(Ga);Ta.name=Ha;za.push(Ta);
ab()})},function(Ha){V(Ha,za)})}else V(null,xa)}var ma,aa;Q=H(Q);"function"==typeof O&&(V=O,O={});O=ja(O);d(N,Q,function(xa,Ea){xa?V(xa):Ea.type!==db?V(new ka.ENOTDIR(null,Q)):(ma=Ea,N.getObject(ma.data,da))})}function X(N,Q,O){F(N,Q,function(V,da){V?O(V):(V=new bb(Q,da,N.name),O(null,V))})}function ja(N,Q){return N?"function"==typeof N?N={encoding:Q}:"string"==typeof N&&(N={encoding:N}):N={encoding:Q},N}function S(N,Q,O,V){function da(Ma,Ga){Ma?V(Ma):(Ea=Ga,Object.prototype.hasOwnProperty.call(Ea,
Ha)?V(new ka.EEXIST(null,Ha)):Eb.create({guid:N.guid,type:Db},function(Ta,Wa){Ta?V(Ta):((za=Wa).nlinks+=1,Xa(Q)||(za.symlink_relpath=Q,Q=va.resolve(ab,Q)),za.size=Q.length,za.data=Q,N.putObject(za.id,za,aa))}))}function ma(Ma){Ma?V(Ma):(Ma=Date.now(),l(N,ab,xa,{mtime:Ma,ctime:Ma},V))}function aa(Ma){Ma?V(Ma):(Ea[Ha]=new xb(za.id,Db),N.putObject(xa.data,Ea,ma))}O=H(O);var xa,Ea,za,Ha=Ra(O),ab=sa(O);ia===Ha?V(new ka.EEXIST(null,Ha)):d(N,ab,function(Ma,Ga){Ma?V(Ma):(xa=Ga,N.getObject(xa.data,da))})}
function W(N,Q,O){function V(za,Ha){za?O(za):(aa=Ha,Object.prototype.hasOwnProperty.call(aa,xa)?N.getObject(aa[xa].id,da):O(new ka.ENOENT("a component of the path does not name an existing file",xa)))}function da(za,Ha){za?O(za):Ha.type!==Db?O(new ka.EINVAL("path not a symbolic link",Q)):O(null,Ha.symlink_relpath?Ha.symlink_relpath:Ha.data)}Q=H(Q);var ma,aa,xa=Ra(Q),Ea=sa(Q);d(N,Ea,function(za,Ha){za?O(za):(ma=Ha,N.getObject(ma.data,V))})}function la(N,Q,O,V){function da(Ea,za){if(Ea)V(Ea);else{if(!za)return V(new ka.EIO("Expected Buffer"));
Ea=ha.alloc(O);za&&za.copy(Ea);N.putBuffer(xa.data,Ea,aa)}}function ma(Ea){Ea?V(Ea):(Ea=Date.now(),l(N,Q,xa,{mtime:Ea,ctime:Ea},V))}function aa(Ea){Ea?V(Ea):(xa.size=O,xa.version+=1,N.putObject(xa.id,xa,ma))}var xa;Q=H(Q);0>O?V(new ka.EINVAL("length cannot be negative")):d(N,Q,function(Ea,za){Ea?V(Ea):za.type===db?V(new ka.EISDIR(null,Q)):(xa=za,N.getBuffer(xa.data,da))})}function qa(N,Q,O,V){function da(Ea,za){if(Ea)V(Ea);else{if(!za)return V(new ka.EIO("Expected Buffer"));Ea=za?za.slice(0,O):ha.alloc(O);
N.putBuffer(xa.data,Ea,aa)}}function ma(Ea){Ea?V(Ea):(Ea=Date.now(),l(N,Q.path,xa,{mtime:Ea,ctime:Ea},V))}function aa(Ea){Ea?V(Ea):(xa.size=O,xa.version+=1,N.putObject(xa.id,xa,ma))}var xa;0>O?V(new ka.EINVAL("length cannot be negative")):Q.getNode(N,function(Ea,za){Ea?V(Ea):za.type===db?V(new ka.EISDIR):(xa=za,N.getBuffer(xa.data,da))})}function Pa(N,Q,O,V,da){Q=H(Q);"number"!=typeof O||"number"!=typeof V?da(new ka.EINVAL("atime and mtime must be number",Q)):0>O||0>V?da(new ka.EINVAL("atime and mtime must be positive integers",
Q)):d(N,Q,function(ma,aa){ma?da(ma):l(N,Q,aa,{atime:O,ctime:V,mtime:V},da)})}function Ba(N,Q,O,V,da){"number"!=typeof O||"number"!=typeof V?da(new ka.EINVAL("atime and mtime must be a number")):0>O||0>V?da(new ka.EINVAL("atime and mtime must be positive integers")):Q.getNode(N,function(ma,aa){ma?da(ma):l(N,Q.path,aa,{atime:O,ctime:V,mtime:V},da)})}function wa(N,Q,O,V,da,ma){Q=H(Q);"string"!=typeof O?ma(new ka.EINVAL("attribute name must be a string",Q)):O?null!==da&&da!==lb&&da!==Ab?ma(new ka.EINVAL("invalid flag, must be null, XATTR_CREATE or XATTR_REPLACE",
Q)):d(N,Q,function(aa,xa){if(aa)return ma(aa);m(N,Q,xa,O,V,da,ma)}):ma(new ka.EINVAL("attribute name cannot be an empty string",Q))}function Na(N,Q,O,V,da,ma){"string"!=typeof O?ma(new ka.EINVAL("attribute name must be a string")):O?null!==da&&da!==lb&&da!==Ab?ma(new ka.EINVAL("invalid flag, must be null, XATTR_CREATE or XATTR_REPLACE")):Q.getNode(N,function(aa,xa){if(aa)return ma(aa);m(N,Q.path,xa,O,V,da,ma)}):ma(new ka.EINVAL("attribute name cannot be an empty string"))}function Sa(N,Q,O,V){Q=H(Q);
"string"!=typeof O?V(new ka.EINVAL("attribute name must be a string",Q)):O?d(N,Q,function(da,ma){if(da)return V(da);da=ma.xattrs;Object.prototype.hasOwnProperty.call(da,O)?V(null,da[O]):V(new ka.ENOATTR(null,Q))}):V(new ka.EINVAL("attribute name cannot be an empty string",Q))}function Aa(N,Q,O,V){"string"!=typeof O?V(new ka.EINVAL):O?Q.getNode(N,function(da,ma){if(da)return V(da);da=ma.xattrs;Object.prototype.hasOwnProperty.call(da,O)?V(null,da[O]):V(new ka.ENOATTR)}):V(new ka.EINVAL("attribute name cannot be an empty string"))}
function ya(N,Q,O,V){Q=H(Q);"string"!=typeof O?V(new ka.EINVAL("attribute name must be a string",Q)):O?d(N,Q,function(da,ma){if(da)return V(da);da=ma.xattrs;Object.prototype.hasOwnProperty.call(da,O)?(delete da[O],N.putObject(ma.id,ma,function(aa){aa?V(aa):l(N,Q,ma,{ctime:Date.now()},V)})):V(new ka.ENOATTR(null,Q))}):V(new ka.EINVAL("attribute name cannot be an empty string",Q))}function x(N,Q,O,V){"string"!=typeof O?V(new ka.EINVAL("attribute name must be a string")):O?Q.getNode(N,function(da,ma){if(da)return V(da);
da=ma.xattrs;Object.prototype.hasOwnProperty.call(da,O)?(delete da[O],N.putObject(ma.id,ma,function(aa){aa?V(aa):l(N,Q.path,ma,{ctime:Date.now()},V)})):V(new ka.ENOATTR)}):V(new ka.EINVAL("attribute name cannot be an empty string"))}function D(N){return Object.prototype.hasOwnProperty.call(kb,N)?kb[N]:null}function L(N,Q,O){return N?"function"==typeof N?N={encoding:Q,flag:O}:"string"==typeof N&&(N={encoding:N,flag:O}):N={encoding:Q,flag:O},N}function Z(N,Q,O){C(N,Q,function(V,da){V?O(V):(V=new Qb(Q,
da,N.name),O(null,V))})}function pa(N,Q){if("number"==typeof N)return N;Q(new ka.EINVAL("Expected integer",N))}function Ja(N,Q,O){return"function"==typeof Q&&(O=Q,Q=void 0),N===N>>>0?N&ca:"number"==typeof N?(Number.isInteger(N),O(new ka.EINVAL("mode not a valid an integer value",N)),!1):"string"==typeof N?Vb.test(N)?parseInt(N,8)&ca:(O(new ka.EINVAL("mode not a valid octal string",N)),!1):void 0!==Q?Q:(O(new ka.EINVAL("mode not valid",N)),!1)}function ea(N,Q,O,V){Q=H(Q);"number"!=typeof O?V(new ka.EINVAL("mode must be number",
Q)):d(N,Q,function(da,ma){da?V(da):(ma.mode=O,l(N,Q,ma,{mtime:Date.now()},V))})}function ra(N,Q,O,V){"number"!=typeof O?V(new ka.EINVAL("mode must be a number")):Q.getNode(N,function(da,ma){da?V(da):(ma.mode=O,l(N,Q.path,ma,{mtime:Date.now()},V))})}function Fa(N,Q,O,V,da){Q=H(Q);d(N,Q,function(ma,aa){ma?da(ma):(aa.uid=O,aa.gid=V,l(N,Q,aa,{mtime:Date.now()},da))})}function P(N,Q,O,V,da){Q.getNode(N,function(ma,aa){ma?da(ma):(aa.uid=O,aa.gid=V,l(N,Q.path,aa,{mtime:Date.now()},da))})}function Ia(N){return"number"==
typeof N?N:"object"===e(N)&&"function"==typeof N.getTime?N.getTime():void 0}t("buffer");var ha=t("buffer").Buffer,va=t("../path.js"),H=va.normalize,sa=va.dirname,Ra=va.basename,Xa=va.isAbsolute,rb=t("../shared.js"),Bb=t("../../lib/async.js"),ob=t("../constants.js"),Ob=ob.NODE_TYPE_FILE,db=ob.NODE_TYPE_DIRECTORY,Db=ob.NODE_TYPE_SYMBOLIC_LINK,T=ob.NODE_TYPE_META,ca=ob.FULL_READ_WRITE_EXEC_PERMISSIONS,ia=ob.ROOT_DIRECTORY_NAME,ta=ob.SUPER_NODE_ID,Da=ob.SYMLOOP_MAX,Va=ob.O_READ,Za=ob.O_WRITE,eb=ob.O_CREATE,
Ka=ob.O_EXCLUSIVE,ua=ob.O_APPEND,kb=ob.O_FLAGS,lb=ob.XATTR_CREATE,Ab=ob.XATTR_REPLACE,sb=ob.FS_NOMTIME,qb=ob.FS_NOCTIME,ka=t("../errors.js"),xb=t("../directory-entry.js"),jb=t("../open-files.js"),tb=t("../open-file-description.js"),Hb=t("../super-node.js"),Eb=t("../node.js"),bb=t("../dirent.js"),Qb=t("../stats.js"),Vb=/^[0-7]+$/;G.exports={appendFile:function(N,Q,O,V,da){da=arguments[arguments.length-1];var ma=D((V=L(V,"utf8","a")).flag||"a");if(!ma)return da(new ka.EINVAL("flags is not valid",Q));
"number"==typeof(O=O||"")&&(O=""+O);"string"==typeof O&&"utf8"===V.encoding&&(O=ha.from(O));w(N,Q,ma,function(aa,xa){if(aa)return da(aa);aa=new tb(Q,xa.id,ma,xa.size);var Ea=jb.allocDescriptor(aa);v(N,aa,O,0,O.length,aa.position,function(za){if(jb.releaseDescriptor(Ea),za)return da(za);da(null)})})},access:function(N,Q,O,V){"function"==typeof O&&(V=O,O=ob.fsConstants.F_OK);n(N,Q,O|ob.fsConstants.F_OK,V)},chown:function(N,Q,O,V,da){return O===O>>>0?V===V>>>0?void Fa(N,Q,O,V,da):da(new ka.EINVAL("gid must be a valid integer",
V)):da(new ka.EINVAL("uid must be a valid integer",O))},chmod:function(N,Q,O,V){(O=Ja(O,V))&&ea(N,Q,O,V)},close:function(N,Q,O){jb.getOpenFileDescription(Q)?(jb.releaseDescriptor(Q),O(null)):O(new ka.EBADF)},ensureRootDirectory:function(N,Q){function O(xa){xa?Q(xa):Eb.create({guid:N.guid,id:da.rnode,type:db},function(Ea,za){Ea?Q(Ea):((ma=za).nlinks+=1,N.putObject(ma.id,ma,V))})}function V(xa){xa?Q(xa):(aa={},N.putObject(ma.data,aa,Q))}var da,ma,aa;N.getObject(ta,function(xa,Ea){!xa&&Ea?Q():!xa||xa instanceof
ka.ENOENT?Hb.create({guid:N.guid},function(za,Ha){za?Q(za):(da=Ha,N.putObject(da.id,da,O))}):Q(xa)})},exists:function(N,Q,O){Z(N,Q,function(V){O(!V)})},fchown:function(N,Q,O,V,da){if(O!==O>>>0)return da(new ka.EINVAL("uid must be a valid integer",O));if(V!==V>>>0)return da(new ka.EINVAL("gid must be a valid integer",V));(Q=jb.getOpenFileDescription(Q))?Q.flags.includes(Za)?P(N,Q,O,V,da):da(new ka.EBADF("descriptor does not permit writing")):da(new ka.EBADF)},fchmod:function(N,Q,O,V){if(O=Ja(O,V))(Q=
jb.getOpenFileDescription(Q))?Q.flags.includes(Za)?ra(N,Q,O,V):V(new ka.EBADF("descriptor does not permit writing")):V(new ka.EBADF)},fgetxattr:function(N,Q,O,V){(Q=jb.getOpenFileDescription(Q))?Aa(N,Q,O,V):V(new ka.EBADF)},fremovexattr:function(N,Q,O,V){(Q=jb.getOpenFileDescription(Q))?Q.flags.includes(Za)?x(N,Q,O,V):V(new ka.EBADF("descriptor does not permit writing")):V(new ka.EBADF)},fsetxattr:function(N,Q,O,V,da,ma){"function"==typeof da&&(ma=da,da=null);(Q=jb.getOpenFileDescription(Q))?Q.flags.includes(Za)?
Na(N,Q,O,V,da,ma):ma(new ka.EBADF("descriptor does not permit writing")):ma(new ka.EBADF)},fstat:function(N,Q,O){var V=jb.getOpenFileDescription(Q);V?A(N,V,function(da,ma){da?O(da):(da=new Qb(V.path,ma,N.name),O(null,da))}):O(new ka.EBADF)},fsync:function(N,Q,O){pa(Q,O)===Q&&(jb.getOpenFileDescription(Q)?O():O(new ka.EBADF))},ftruncate:function(N,Q,O,V){V=arguments[arguments.length-1];O=O||0;var da=jb.getOpenFileDescription(Q);da?da.flags.includes(Za)?pa(O,V)===O&&qa(N,da,O,V):V(new ka.EBADF("descriptor does not permit writing")):
V(new ka.EBADF)},futimes:function(N,Q,O,V,da){var ma=Date.now();O=Ia(O||ma);V=Ia(V||ma);(Q=jb.getOpenFileDescription(Q))?Q.flags.includes(Za)?Ba(N,Q,O,V,da):da(new ka.EBADF("descriptor does not permit writing")):da(new ka.EBADF)},getxattr:function(N,Q,O,V){Sa(N,Q,O,V)},link:function(N,Q,O,V){E(N,Q,O,V)},lseek:function(N,Q,O,V,da){var ma=jb.getOpenFileDescription(Q);ma||da(new ka.EBADF);"SET"===V?0>O?da(new ka.EINVAL("resulting file offset would be negative")):(ma.position=O,da(null,ma.position)):
"CUR"===V?0>ma.position+O?da(new ka.EINVAL("resulting file offset would be negative")):(ma.position+=O,da(null,ma.position)):"END"===V?A(N,ma,function(aa,xa){aa?da(aa):0>xa.size+O?da(new ka.EINVAL("resulting file offset would be negative")):(ma.position=xa.size+O,da(null,ma.position))}):da(new ka.EINVAL("whence argument is not a proper value"))},lstat:function(N,Q,O){F(N,Q,function(V,da){V?O(V):(V=new Qb(Q,da,N.name),O(null,V))})},mkdir:function(N,Q,O,V){if(4>arguments.length)V=O,O=ca;else if(!(O=
Ja(O,ca,V)))return;q(N,Q,V)},mkdtemp:function(N,Q,O,V){if(V=arguments[arguments.length-1],!Q)return V(Error("filename prefix is required"));var da=Q+"-"+rb.randomChars(6);q(N,da,function(ma){V(ma,da)})},mknod:function(N,Q,O,V){f(N,Q,O,V)},open:function(N,Q,O,V,da){if(5>arguments.length?(da=arguments[arguments.length-1],V=420):V=Ja(V,ca,da),!(O=D(O)))return da(new ka.EINVAL("flags is not valid"),Q);w(N,Q,O,V,function(ma,aa){ma?da(ma):(ma=O.includes(ua)?aa.size:0,aa=new tb(Q,aa.id,O,ma),aa=jb.allocDescriptor(aa),
da(null,aa))})},readdir:function(N,Q,O,V){J(N,Q,O,V)},read:function(N,Q,O,V,da,ma,aa){V=void 0===V?0:V;da=void 0===da?O.length-V:da;aa=arguments[arguments.length-1];var xa=jb.getOpenFileDescription(Q);xa?xa.flags.includes(Va)?z(N,xa,O,V,da,ma,function(Ea,za){aa(Ea,za||0,O)}):aa(new ka.EBADF("descriptor does not permit reading")):aa(new ka.EBADF)},readFile:function(N,Q,O,V){V=arguments[arguments.length-1];var da=D((O=L(O,null,"r")).flag||"r");if(!da)return V(new ka.EINVAL("flags is not valid",Q));
w(N,Q,da,function(ma,aa){if(ma)return V(ma);var xa=new tb(Q,aa.id,da,0),Ea=jb.allocDescriptor(xa);A(N,xa,function(za,Ha){if(za)return jb.releaseDescriptor(Ea),V(za);za=new Qb(xa.path,Ha,N.name);if(za.isDirectory())return jb.releaseDescriptor(Ea),V(new ka.EISDIR("illegal operation on directory",Q));za=za.size;var ab=ha.alloc(za);z(N,xa,ab,0,za,0,function(Ma){jb.releaseDescriptor(Ea);if(Ma)return V(Ma);Ma="utf8"===O.encoding?ab.toString("utf8"):ab;V(null,Ma)})})})},readlink:function(N,Q,O){W(N,Q,O)},
removexattr:function(N,Q,O,V){ya(N,Q,O,V)},rename:function(N,Q,O,V){function da(gb,Cb){gb?V(gb):l(N,O,Cb,{ctime:fb},V)}function ma(gb){gb?V(gb):N.getObject(hb[pb].id,da)}function aa(gb){gb?V(gb):(Ga.id===Wa.id&&(Ta=hb),delete Ta[Mb],N.putObject(Ga.data,Ta,ma))}function xa(gb){gb?V(gb):(hb[pb]=Ta[Mb],N.putObject(Wa.data,hb,aa))}function Ea(gb,Cb){gb?V(gb):(hb=Cb,Object.prototype.hasOwnProperty.call(hb,pb)?p(N,O,xa):xa())}function za(gb,Cb){gb?V(gb):(Wa=Cb,N.getObject(Wa.data,Ea))}function Ha(gb,Cb){gb?
V(gb):(Ta=Cb,d(N,Nb,za))}function ab(gb,Cb){gb?V(gb):(Ga=Cb,N.getObject(Cb.data,Ha))}function Ma(gb){gb?V(gb):M(N,Q,V)}Q=H(Q);O=H(O);var Ga,Ta,Wa,hb,Kb=va.dirname(Q),Nb=va.dirname(O),Mb=va.basename(Q),pb=va.basename(O),fb=Date.now();d(N,Q,function(gb,Cb){gb?V(gb):Cb.type===db?d(N,Kb,ab):E(N,Q,O,Ma)})},rmdir:function(N,Q,O){p(N,Q,O)},setxattr:function(N,Q,O,V,da,ma){"function"==typeof da&&(ma=da,da=null);wa(N,Q,O,V,da,ma)},stat:Z,symlink:function(N,Q,O,V,da){S(N,Q,O,da=arguments[arguments.length-1])},
truncate:function(N,Q,O,V){pa(O=O||0,V=arguments[arguments.length-1])===O&&la(N,Q,O,V)},unlink:function(N,Q,O){M(N,Q,O)},utimes:function(N,Q,O,V,da){var ma=Date.now();Pa(N,Q,Ia(O||ma),Ia(V||ma),da)},writeFile:function(N,Q,O,V,da){da=arguments[arguments.length-1];var ma=D((V=L(V,"utf8","w")).flag||"w");if(!ma)return da(new ka.EINVAL("flags is not valid",Q));ha.isBuffer(O)||("number"==typeof O&&(O=""+O),O="string"!=typeof(O=O||"")?ha.from(O.toString()):ha.from(O||"",V.encoding||"utf8"));w(N,Q,ma,function(aa,
xa){if(aa)return da(aa);aa=new tb(Q,xa.id,ma,0);var Ea=jb.allocDescriptor(aa);B(N,aa,O,0,O.length,function(za){if(jb.releaseDescriptor(Ea),za)return da(za);da(null)})})},write:function(N,Q,O,V,da,ma,aa){aa=arguments[arguments.length-1];V=void 0===V?0:V;da=void 0===da?O.length-V:da;var xa=jb.getOpenFileDescription(Q);xa?xa.flags.includes(Za)?O.length-V<da?aa(new ka.EIO("input buffer is too small")):v(N,xa,O,V,da,ma,aa):aa(new ka.EBADF("descriptor does not permit writing")):aa(new ka.EBADF)}}},{"../path.js":"UzoP",
"../shared.js":"zBMa","../../lib/async.js":"u4Zs","../constants.js":"iJA9","../errors.js":"p8GN","../directory-entry.js":"ZECt","../open-files.js":"osLK","../open-file-description.js":"XWaV","../super-node.js":"JEp0","../node.js":"KKNo","../dirent.js":"q4Wu","../stats.js":"dsCT",buffer:"dskh"}],GMi4:[function(t,G,K){function e(Ba){return"function"==typeof Ba?Ba:function(wa){if(wa)throw wa;}}function l(Ba){Ba&&console.error("Filer error: ",Ba)}function f(Ba,wa,Na){var Sa=Ba[wa];if(Sa&&Sa.protocol&&
Sa.pathname){if("file:"!==Sa.protocol)throw new z.EINVAL("only file: URLs are supported for paths",Sa);for(var Aa=Sa.pathname,ya=0;ya<Aa.length;ya++)if("%"===Aa[ya]){var x=32|Aa.codePointAt(ya+2);if("2"===Aa[ya+1]&&102===x)throw new z.EINVAL("file: URLs must not include encoded / characters",Sa);}Sa=decodeURIComponent(Aa)}if(Na=(Aa=Sa=m.isBuffer(Sa)?Sa.toString():Sa)?n.isNull(Aa)?new z.EINVAL("Path must be a string without null bytes.",Aa):Na||n.isAbsolute(Aa)?void 0:new z.EINVAL("Path must be absolute.",
Aa):new z.EINVAL("Path must be a string",Aa))throw Na;Ba[wa]=Sa}function d(Ba,wa){function Na(pa){return function(Ja){Sa.includes(S)?Ja(null,Aa()):function Fa(ra){var P=Aa();pa.getObject(P,function(Ia,ha){Ia?ra(Ia):ha?Fa(ra):ra(null,P)})}(Ja)}}wa=wa||l;var Sa=(Ba=Ba||{}).flags||[],Aa=Ba.guid?Ba.guid:A,ya=Ba.provider||new p.Default(Ba.name||E),x=Ba.name||ya.name,D=Sa.includes(M),L=this;L.readyState=X;L.name=x;L.error=null;L.stdin=W;L.stdout=la;L.stderr=qa;L.constants=F;L.F_OK=F.F_OK;L.R_OK=F.R_OK;
L.W_OK=F.W_OK;L.X_OK=F.X_OK;this.Shell=w.bind(void 0,this);var Z=[];this.queueOrRun=function(pa){var Ja;return J===L.readyState?pa.call(L):ja===L.readyState?Ja=new z.EFILESYSTEMERROR("unknown error"):Z.push(pa),Ja};this.watch=function(pa,Ja,ea){if(n.isNull(pa))throw Error("Path must be a string without null bytes.");"function"==typeof Ja&&(ea=Ja,Ja={});Ja=Ja||{};ea=ea||C;var ra=new v;return ra.start(pa,!1,Ja.recursive),ra.on("change",ea),ra};ya.open(function(pa){function Ja(ra){function Fa(P){var Ia=
ya[P]();return Ia.name=x,Ia.flags=Sa,Ia.changes=[],Ia.guid=Na(Ia),Ia.close=function(){var ha=Ia.changes;!function(va){if(va.length){var H=B.getInstance();va.forEach(function(sa){H.emit(sa.event,sa.path)})}}(ha);ha.length=0},Ia}L.provider={openReadWriteContext:function(){return Fa("getReadWriteContext")},openReadOnlyContext:function(){return Fa("getReadOnlyContext")}};L.readyState=ra?ja:J;Z.forEach(function(P){P.call(this)}.bind(L));Z=null;wa(ra,L)}if(pa)return Ja(pa);var ea=ya.getReadWriteContext();
ea.guid=Na(ea);D?ea.clear(function(ra){if(ra)return Ja(ra);Pa.ensureRootDirectory(ea,Ja)}):Pa.ensureRootDirectory(ea,Ja)});d.prototype.promises={};[{name:"appendFile",promises:!0,absPathArgs:[0]},{name:"access",promises:!0,absPathArgs:[0]},{name:"chown",promises:!0,absPathArgs:[0]},{name:"chmod",promises:!0,absPathArgs:[0]},{name:"close"},{name:"exists",absPathArgs:[0]},{name:"fchown"},{name:"fchmod"},{name:"fgetxattr"},{name:"fremovexattr"},{name:"fsetxattr"},{name:"fstat"},{name:"fsync"},{name:"ftruncate"},
{name:"futimes"},{name:"getxattr",promises:!0,absPathArgs:[0]},{name:"link",promises:!0,absPathArgs:[0,1]},{name:"lseek"},{name:"lstat",promises:!0},{name:"mkdir",promises:!0,absPathArgs:[0]},{name:"mkdtemp",promises:!0},{name:"mknod",promises:!0,absPathArgs:[0]},{name:"open",promises:!0,absPathArgs:[0]},{name:"readdir",promises:!0,absPathArgs:[0]},{name:"read"},{name:"readFile",promises:!0,absPathArgs:[0]},{name:"readlink",promises:!0,absPathArgs:[0]},{name:"removexattr",promises:!0,absPathArgs:[0]},
{name:"rename",promises:!0,absPathArgs:[0,1]},{name:"rmdir",promises:!0,absPathArgs:[0]},{name:"setxattr",promises:!0,absPathArgs:[0]},{name:"stat",promises:!0,absPathArgs:[0]},{name:"symlink",promises:!0,relPathArgs:[0],absPathArgs:[1]},{name:"truncate",promises:!0,absPathArgs:[0]},{name:"unlink",promises:!0,absPathArgs:[0]},{name:"utimes",promises:!0,absPathArgs:[0]},{name:"writeFile",promises:!0,absPathArgs:[0]},{name:"write"}].forEach(function(pa){var Ja=pa.name,ea=!0===pa.promises;d.prototype[Ja]=
function(){var ra=this,Fa=Array.prototype.slice.call(arguments,0),P=Fa.length-1,Ia="function"!=typeof Fa[P],ha=e(Fa[P]);pa.absPathArgs&&pa.absPathArgs.forEach(function(H){return f(Fa,H,!1)});pa.relPathArgs&&pa.relPathArgs.forEach(function(H){return f(Fa,H,!0)});var va=ra.queueOrRun(function(){function H(){sa.close();ha.apply(ra,arguments)}var sa=ra.provider.openReadWriteContext();if(ja===ra.readyState){var Ra=new z.EFILESYSTEMERROR("filesystem unavailable, operation canceled");return ha.call(ra,Ra)}Ia?
Fa.push(H):Fa[P]=H;Ra=[sa].concat(Fa);Pa[Ja].apply(null,Ra)});va&&ha(va)};ea&&(d.prototype.promises[Ja]=q(d.prototype[Ja].bind(L)))})}t("buffer");var m=t("buffer").Buffer,q=t("es6-promisify").promisify,n=t("../path.js"),p=t("../providers/index.js"),w=t("../shell/shell.js"),B=t("../../lib/intercom.js"),v=t("../fs-watcher.js"),z=t("../errors.js");K=t("../shared.js");var C=K.nop,A=K.guid;K=t("../constants.js");var F=K.fsConstants,E=K.FILE_SYSTEM_NAME,M=K.FS_FORMAT,J=K.FS_READY,X=K.FS_PENDING,ja=K.FS_ERROR,
S=K.FS_NODUPEIDCHECK,W=K.STDIN,la=K.STDOUT,qa=K.STDERR,Pa=t("./implementation.js");d.providers=p;G.exports=d},{"es6-promisify":"b1ZG","../path.js":"UzoP","../providers/index.js":"AiW7","../shell/shell.js":"D1Ra","../../lib/intercom.js":"u7Jv","../fs-watcher.js":"VLEe","../errors.js":"p8GN","../shared.js":"zBMa","../constants.js":"iJA9","./implementation.js":"bsBG",buffer:"dskh"}],iIhC:[function(t,G,K){function e(l,f,d){return{dataPath:void 0,schemaPath:void 0,keyword:"absolutePath",params:{absolutePath:d},
message:l,parentSchema:f}}Object.defineProperty(K,"__esModule",{value:!0});K.default=void 0;K.default=function(l){return l.addKeyword("absolutePath",{errors:!0,type:"string",compile:function(f,d){var m=function p(n){var w=!0;n.includes("!")&&(p.errors=[e("The provided value ".concat(JSON.stringify(n)," contains exclamation mark (!) which is not allowed because it's reserved for loader syntax."),d,n)],w=!1);f!==/^(?:[A-Za-z]:(\\|\/)|\\\\|\/)/.test(n)&&(n=e(f?"The provided value ".concat(JSON.stringify(n),
" is not an absolute path!"):"A relative path is expected. However, the provided value ".concat(JSON.stringify(n)," is an absolute path!"),d,n),p.errors=[n],w=!1);return w};return m.errors=[],m}}),l}},{}],GNtl:[function(t,G,K){function e(m,q){var n;var p=Array.isArray(m)?m:void 0;if(!p)if("undefined"!=typeof Symbol&&Symbol.iterator in Object(m)){p=[];var w=!0,B=!1,v=void 0;try{for(var z=m[Symbol.iterator]();!(w=(n=z.next()).done)&&(p.push(n.value),!q||p.length!==q);w=!0);}catch(C){B=!0,v=C}finally{try{w||
null==z.return||z.return()}finally{if(B)throw v;}}}else p=void 0;(n=p)||(m?"string"==typeof m?n=l(m,q):(z=Object.prototype.toString.call(m).slice(8,-1),n=("Object"===z&&m.constructor&&(z=m.constructor.name),"Map"===z||"Set"===z?Array.from(z):"Arguments"===z||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(z)?l(m,q):void 0)):n=void 0);if(!(m=n))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
return m}function l(m,q){(null==q||q>m.length)&&(q=m.length);for(var n=0,p=Array(q);n<q;n++)p[n]=m[n];return p}function f(m,q){for(var n=0;n<q.length;n++){var p=q[n];p.enumerable=p.enumerable||!1;p.configurable=!0;"value"in p&&(p.writable=!0);Object.defineProperty(m,p.key,p)}}function d(m,q,n){return q&&f(m.prototype,q),n&&f(m,n),m}t=function(){function m(){if(!(this instanceof m))throw new TypeError("Cannot call a class as a function");this._left=[];this._right=[]}return d(m,[{key:"left",value:function(q){this._left.push([q,
1<arguments.length&&void 0!==arguments[1]&&arguments[1]])}},{key:"right",value:function(q){this._right.push([q,1<arguments.length&&void 0!==arguments[1]&&arguments[1]])}},{key:"format",value:function(){var q=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n=e(m.getRangeValue(this._left,q),2),p=n[0];n=n[1];var w=e(m.getRangeValue(this._right,!q),2),B=w[0];w=w[1];if(!Number.isFinite(p)&&!Number.isFinite(B))return"";var v=n?p+1:p;return v===(w?B-1:B)?"should be ".concat(q?"":"!","= ").concat(v):
Number.isFinite(p)&&!Number.isFinite(B)?m.formatLeft(p,q,n):!Number.isFinite(p)&&Number.isFinite(B)?m.formatRight(B,q,w):m.formatRange(p,B,n,w,q)}}],[{key:"getOperator",value:function(q,n){return"left"===q?n?">":">=":n?"<":"<="}},{key:"formatRight",value:function(q,n,p){return!1===n?m.formatLeft(q,!n,!p):"should be ".concat(m.getOperator("right",p)," ").concat(q)}},{key:"formatLeft",value:function(q,n,p){return!1===n?m.formatRight(q,!n,!p):"should be ".concat(m.getOperator("left",p)," ").concat(q)}},
{key:"formatRange",value:function(q,n,p,w,B){var v="should be";return v+=" ".concat(m.getOperator(B?"left":"right",B?p:!p)," ").concat(q," "),v+=B?"and":"or",v+" ".concat(m.getOperator(B?"right":"left",B?w:!w)," ").concat(n)}},{key:"getRangeValue",value:function(q,n){var p=n?1/0:-1/0,w=-1;n=n?function(v){return e(v,1)[0]<=p}:function(v){return e(v,1)[0]>=p};for(var B=0;B<q.length;B++)n(q[B])&&(p=e(q[B],1)[0],w=B);return-1<w?q[w]:[1/0,!0]}}]),m}();G.exports=t},{}],SqDh:[function(t,G,K){function e(d,
m){var q=Object.keys(d);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(d);m&&(n=n.filter(function(p){return Object.getOwnPropertyDescriptor(d,p).enumerable}));q.push.apply(q,n)}return q}function l(d){for(var m=1;m<arguments.length;m++){var q=null!=arguments[m]?arguments[m]:{};m%2?e(Object(q),!0).forEach(function(n){var p=q[n];n in d?Object.defineProperty(d,n,{value:p,enumerable:!0,configurable:!0,writable:!0}):d[n]=p}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,
Object.getOwnPropertyDescriptors(q)):e(Object(q)).forEach(function(n){Object.defineProperty(d,n,Object.getOwnPropertyDescriptor(q,n))})}return d}var f=t("./Range");G.exports.stringHints=function(d,m){var q=[],n="string";d=l({},d);if(!m){var p=d.minLength,w=d.formatMinimum,B=d.formatExclusiveMaximum;d.minLength=d.maxLength;d.maxLength=p;d.formatMinimum=d.formatMaximum;d.formatMaximum=w;d.formatExclusiveMaximum=!d.formatExclusiveMinimum;d.formatExclusiveMinimum=!B}"number"==typeof d.minLength&&(1===
d.minLength?n="non-empty string":(p=Math.max(d.minLength-1,0),q.push("should be longer than ".concat(p," character").concat(1<p?"s":""))));"number"==typeof d.maxLength&&(0===d.maxLength?n="empty string":(p=d.maxLength+1,q.push("should be shorter than ".concat(p," character").concat(1<p?"s":""))));return d.pattern&&q.push("should".concat(m?"":" not"," match pattern ").concat(JSON.stringify(d.pattern))),d.format&&q.push("should".concat(m?"":" not"," match format ").concat(JSON.stringify(d.format))),
d.formatMinimum&&q.push("should be ".concat(d.formatExclusiveMinimum?">":">="," ").concat(JSON.stringify(d.formatMinimum))),d.formatMaximum&&q.push("should be ".concat(d.formatExclusiveMaximum?"<":"<="," ").concat(JSON.stringify(d.formatMaximum))),[n].concat(q)};G.exports.numberHints=function(d,m){var q=["integer"===d.type?"integer":"number"],n=new f;"number"==typeof d.minimum&&n.left(d.minimum);"number"==typeof d.exclusiveMinimum&&n.left(d.exclusiveMinimum,!0);"number"==typeof d.maximum&&n.right(d.maximum);
"number"==typeof d.exclusiveMaximum&&n.right(d.exclusiveMaximum,!0);n=n.format(m);return n&&q.push(n),"number"==typeof d.multipleOf&&q.push("should".concat(m?"":" not"," be multiple of ").concat(d.multipleOf)),q}},{"./Range":"GNtl"}],ySUA:[function(t,G,K){function e(ea){var ra=Array.isArray(ea)?n(ea):void 0;if(!(ea=ra||f(ea)||q(ea)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return ea}
function l(ea){return p(ea)||f(ea)||q(ea)||m()}function f(ea){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(ea))return Array.from(ea)}function d(ea,ra){var Fa;if(!(Fa=p(ea)))if("undefined"!=typeof Symbol&&Symbol.iterator in Object(ea)){Fa=[];var P=!0,Ia=!1,ha=void 0;try{for(var va,H=ea[Symbol.iterator]();!(P=(va=H.next()).done)&&(Fa.push(va.value),!ra||Fa.length!==ra);P=!0);}catch(sa){Ia=!0,ha=sa}finally{try{P||null==H.return||H.return()}finally{if(Ia)throw ha;}}}else Fa=void 0;return Fa||
q(ea,ra)||m()}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function q(ea,ra){if(ea){if("string"==typeof ea)return n(ea,ra);var Fa=Object.prototype.toString.call(ea).slice(8,-1);return"Object"===Fa&&ea.constructor&&(Fa=ea.constructor.name),"Map"===Fa||"Set"===Fa?Array.from(Fa):"Arguments"===Fa||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Fa)?n(ea,ra):void 0}}function n(ea,
ra){(null==ra||ra>ea.length)&&(ra=ea.length);for(var Fa=0,P=Array(ra);Fa<ra;Fa++)P[Fa]=ea[Fa];return P}function p(ea){if(Array.isArray(ea))return ea}function w(ea,ra){for(var Fa=0;Fa<ra.length;Fa++){var P=ra[Fa];P.enumerable=P.enumerable||!1;P.configurable=!0;"value"in P&&(P.writable=!0);Object.defineProperty(ea,P.key,P)}}function B(ea,ra,Fa){return ra&&w(ea.prototype,ra),Fa&&w(ea,Fa),ea}function v(ea,ra){if("function"!=typeof ra&&null!==ra)throw new TypeError("Super expression must either be null or a function");
ea.prototype=Object.create(ra&&ra.prototype,{constructor:{value:ea,writable:!0,configurable:!0}});ra&&M(ea,ra)}function z(ea){return function(){var ra=J(ea);if(E()){var Fa=J(this).constructor;ra=Reflect.construct(ra,arguments,Fa)}else ra=ra.apply(this,arguments);return!ra||"object"!==X(ra)&&"function"!=typeof ra?C(this):ra}}function C(ea){if(void 0===ea)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ea}function A(ea){var ra="function"==typeof Map?new Map:
void 0;return(A=function(Fa){function P(){return F(Fa,arguments,J(this).constructor)}if(null===Fa||-1===Function.toString.call(Fa).indexOf("[native code]"))return Fa;if("function"!=typeof Fa)throw new TypeError("Super expression must either be null or a function");if(void 0!==ra){if(ra.has(Fa))return ra.get(Fa);ra.set(Fa,P)}return P.prototype=Object.create(Fa.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),M(P,Fa)})(ea)}function F(ea,ra,Fa){return(F=E()?Reflect.construct:
function(P,Ia,ha){var va=[null];va.push.apply(va,Ia);P=new (Function.bind.apply(P,va));return ha&&M(P,ha.prototype),P}).apply(null,arguments)}function E(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(ea){return!1}}function M(ea,ra){return(M=Object.setPrototypeOf||function(Fa,P){return Fa.__proto__=P,Fa})(ea,ra)}function J(ea){return(J=
Object.setPrototypeOf?Object.getPrototypeOf:function(ra){return ra.__proto__||Object.getPrototypeOf(ra)})(ea)}function X(ea){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ra){return typeof ra}:function(ra){return ra&&"function"==typeof Symbol&&ra.constructor===Symbol&&ra!==Symbol.prototype?"symbol":typeof ra})(ea)}function ja(ea,ra){var Fa=ea.reduce(function(P,Ia){return Math.max(P,ra(Ia))},0);return ea.filter(function(P){return ra(P)===Fa})}function S(ea){return ea=
ja(ea,function(ra){return ra.dataPath?ra.dataPath.length:0}),ea=ja(ea,function(ra){return Ja[ra.keyword]||2})}function W(ea,ra){for(var Fa=ea.length-1,P=function(ha){return 0!==ea[Fa].schemaPath.indexOf(ha)};-1<Fa&&!ra.every(P);)if("anyOf"===ea[Fa].keyword||"oneOf"===ea[Fa].keyword){var Ia=la(ea[Fa]);Fa=W(ea.slice(0,Fa),Ia.concat(ea[Fa].schemaPath))-1}else--Fa;return Fa+1}function la(ea){ea=ea.schema;return Array.isArray(ea)?ea.map(function(ra){return ra.$ref}).filter(function(ra){return ra}):[]}
function qa(ea){for(var ra=[],Fa=ea.length-1;0<Fa;){var P=ea[Fa];if("anyOf"===P.keyword||"oneOf"===P.keyword){var Ia=la(P);Ia=W(ea.slice(0,Fa),Ia.concat(P.schemaPath));Ia!==Fa?(ra.push(Object.assign({},P,{children:ea.slice(Ia,Fa)})),Fa=Ia):ra.push(P)}else ra.push(P);--Fa}return 0===Fa&&ra.push(ea[Fa]),ra.reverse()}function Pa(ea){return ea.not?Pa(ea.not):ea}function Ba(ea){ea=Pa(ea);return Na(ea)||Sa(ea)||Aa(ea)||"null"===ea.type||"boolean"===ea.type}function wa(ea){return"object"===X(ea)&&null!==
ea}function Na(ea){return"number"===ea.type||void 0!==ea.minimum||void 0!==ea.exclusiveMinimum||void 0!==ea.maximum||void 0!==ea.exclusiveMaximum||void 0!==ea.multipleOf}function Sa(ea){return"integer"===ea.type||void 0!==ea.minimum||void 0!==ea.exclusiveMinimum||void 0!==ea.maximum||void 0!==ea.exclusiveMaximum||void 0!==ea.multipleOf}function Aa(ea){return"string"===ea.type||void 0!==ea.minLength||void 0!==ea.maxLength||void 0!==ea.pattern||void 0!==ea.format||void 0!==ea.formatMinimum||void 0!==
ea.formatMaximum}function ya(ea){return"array"===ea.type||"number"==typeof ea.minItems||"number"==typeof ea.maxItems||void 0!==ea.uniqueItems||void 0!==ea.items||void 0!==ea.additionalItems||void 0!==ea.contains}function x(ea){return"object"===ea.type||void 0!==ea.minProperties||void 0!==ea.maxProperties||void 0!==ea.required||void 0!==ea.properties||void 0!==ea.patternProperties||void 0!==ea.additionalProperties||void 0!==ea.dependencies||void 0!==ea.propertyNames||void 0!==ea.patternRequired}function D(ea){if(!ea)return"";
if(!ea.type){if(Na(ea)||Sa(ea))return" | should be any non-number";if(Aa(ea))return" | should be any non-string";if(ya(ea))return" | should be any non-array";if(x(ea))return" | should be any non-object"}return""}function L(ea,ra){return Na(ea)||Sa(ea)?pa(ea,ra):Aa(ea)?Z(ea,ra):[]}Object.defineProperty(K,"__esModule",{value:!0});K.default=void 0;t=t("./util/hints");var Z=t.stringHints,pa=t.numberHints,Ja={type:1,not:1,oneOf:1,anyOf:1,if:1,enum:1,const:1,instanceof:1,required:2,pattern:2,patternRequired:2,
format:2,formatMinimum:2,formatMaximum:2,minimum:2,exclusiveMinimum:2,maximum:2,exclusiveMaximum:2,multipleOf:2,uniqueItems:2,contains:2,minLength:2,maxLength:2,minItems:2,maxItems:2,minProperties:2,maxProperties:2,dependencies:2,propertyNames:2,additionalItems:2,additionalProperties:2,absolutePath:2};t=function(ea){function ra(P,Ia){var ha,va,H,sa=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!(this instanceof ra))throw new TypeError("Cannot call a class as a function");if((ha=Fa.call(this)).name=
"ValidationError",ha.errors=P,ha.schema=Ia,Ia.title&&(!sa.name||!sa.baseDataPath)){var Ra=Ia.title.match(/^(.+) (.+)$/);Ra&&(sa.name||(va=d(Ra,2)[1]),sa.baseDataPath||(H=d(Ra,3)[2]))}ha.headerName=sa.name||va||"Object";ha.baseDataPath=sa.baseDataPath||H||"configuration";ha.postFormatter=sa.postFormatter||null;va="Invalid ".concat(ha.baseDataPath," object. ").concat(ha.headerName," has been initialized using ").concat(/^[aeiou]/i.test(ha.baseDataPath)?"an":"a"," ").concat(ha.baseDataPath," object that does not match the API schema.\n");
return ha.message="".concat(va).concat(ha.formatValidationErrors(P)),Error.captureStackTrace(C(ha),ha.constructor),ha}v(ra,A(Error));var Fa=z(ra);return B(ra,[{key:"getSchemaPart",value:function(P){P=P.split("/");for(var Ia=this.schema,ha=1;ha<P.length;ha++){var va=Ia[P[ha]];if(!va)break;Ia=va}return Ia}},{key:"formatSchema",value:function(P){var Ia=this,ha=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],va=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],H=ha,sa=function(db,Db){return Db?
va.includes(db)?"(recursive)":Ia.formatSchema(db,H,va.concat(P)):Ia.formatSchema(db,H,va)};if(P.not&&!x(P)){if(Ba(P.not))return H=!ha,sa(P.not);var Ra=!P.not.not;return H=!ha,Ra?(ha?"":"non ")+sa(P.not):sa(P.not)}if(P.instanceof)return ha=P.instanceof,(Array.isArray(ha)?ha:[ha]).map(function(db){return"Function"===db?"function":db}).join(" | ");if(P.enum)return P.enum.map(function(db){return JSON.stringify(db)}).join(" | ");if(void 0!==P.const)return JSON.stringify(P.const);if(P.oneOf)return P.oneOf.map(function(db){return sa(db,
!0)}).join(" | ");if(P.anyOf)return P.anyOf.map(function(db){return sa(db,!0)}).join(" | ");if(P.allOf)return P.allOf.map(function(db){return sa(db,!0)}).join(" & ");if(P.if){ha=P.if;Ra=P.then;var Xa=P.else;return"".concat(ha?"if ".concat(sa(ha)):"").concat(Ra?" then ".concat(sa(Ra)):"").concat(Xa?" else ".concat(sa(Xa)):"")}if(P.$ref)return sa(this.getSchemaPart(P.$ref),!0);if(Na(P)||Sa(P)){Xa=l(L(P,ha));Ra=Xa[0];Xa=Xa.slice(1);var rb="".concat(Ra).concat(0<Xa.length?" ".concat(0<Xa.length?"(".concat(Xa.join(", "),
")"):""):"");return ha?rb:0<Xa.length?"non-".concat(Ra," | ").concat(rb):"non-".concat(Ra)}if(Aa(P))return Xa=l(L(P,ha)),Ra=Xa[0],Xa=Xa.slice(1),Ra="".concat(Ra).concat(0<Xa.length?" ".concat(0<Xa.length?"(".concat(Xa.join(", "),")"):""):""),ha?Ra:"string"===Ra?"non-string":"non-string | ".concat(Ra);if("boolean"===P.type)return"".concat(ha?"":"non-","boolean");if(ya(P))return H=!0,ha=[],"number"==typeof P.minItems&&ha.push("should not have fewer than ".concat(P.minItems," item").concat(1<P.minItems?
"s":"")),"number"==typeof P.maxItems&&ha.push("should not have more than ".concat(P.maxItems," item").concat(1<P.maxItems?"s":"")),P.uniqueItems&&ha.push("should not have duplicate items"),Ra=void 0===P.additionalItems||!!P.additionalItems,Xa="",P.items?Array.isArray(P.items)&&0<P.items.length?(Xa="".concat(P.items.map(function(db){return sa(db)}).join(", ")),Ra&&P.additionalItems&&wa(P.additionalItems)&&0<Object.keys(P.additionalItems).length&&ha.push("additional items should be ".concat(sa(P.additionalItems)))):
Xa=P.items&&0<Object.keys(P.items).length?"".concat(sa(P.items)):"any":Xa="any",P.contains&&0<Object.keys(P.contains).length&&ha.push("should contains at least one ".concat(this.formatSchema(P.contains)," item")),"[".concat(Xa).concat(Ra?", ...":"","]").concat(0<ha.length?" (".concat(ha.join(", "),")"):"");if(x(P)){H=!0;var Bb=[];if("number"==typeof P.minProperties&&Bb.push("should not have fewer than ".concat(P.minProperties," ").concat(1<P.minProperties?"properties":"property")),"number"==typeof P.maxProperties&&
Bb.push("should not have more than ".concat(P.maxProperties," ").concat(P.minProperties&&1<P.minProperties?"properties":"property")),P.patternProperties&&0<Object.keys(P.patternProperties).length)ha=Object.keys(P.patternProperties),Bb.push("additional property names should match pattern".concat(1<ha.length?"s":""," ").concat(ha.map(function(db){return JSON.stringify(db)}).join(" | ")));ha=P.properties?Object.keys(P.properties):[];var ob=P.required?P.required:[];ha=e(new Set([].concat(ob).concat(ha))).map(function(db){var Db=
ob.includes(db);return"".concat(db).concat(Db?"":"?")}).concat(void 0===P.additionalProperties||P.additionalProperties?P.additionalProperties&&wa(P.additionalProperties)?["<key>: ".concat(sa(P.additionalProperties))]:["\u2026"]:[]).join(", ");var Ob=P.dependencies;Ra=P.propertyNames;Xa=P.patternRequired;return Ob&&Object.keys(Ob).forEach(function(db){var Db=Ob[db];Array.isArray(Db)?Bb.push("should have ".concat(1<Db.length?"properties":"property"," ").concat(Db.map(function(T){return"'".concat(T,
"'")}).join(", ")," when property '").concat(db,"' is present")):Bb.push("should be valid according to the schema ".concat(sa(Db)," when property '").concat(db,"' is present"))}),Ra&&0<Object.keys(Ra).length&&Bb.push("each property name should match format ".concat(JSON.stringify(P.propertyNames.format))),Xa&&0<Xa.length&&Bb.push("should have property matching pattern ".concat(Xa.map(function(db){return JSON.stringify(db)}))),"object {".concat(ha?" ".concat(ha," "):"","}").concat(0<Bb.length?" (".concat(Bb.join(", "),
")"):"")}return"null"===P.type?"".concat(ha?"":"non-","null"):Array.isArray(P.type)?"".concat(P.type.join(" | ")):JSON.stringify(P,null,2)}},{key:"getSchemaPartText",value:function(P,Ia){var ha=2<arguments.length&&void 0!==arguments[2]&&arguments[2],va=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];if(!P)return"";if(Array.isArray(Ia))for(var H=0;H<Ia.length;H++){var sa=P[Ia[H]];if(!sa)break;P=sa}for(;P.$ref;)P=this.getSchemaPart(P.$ref);ha="".concat(this.formatSchema(P,va)).concat(ha?
".":"");return P.description&&(ha+="\n-> ".concat(P.description)),P.link&&(ha+="\n-> Read more at ".concat(P.link)),ha}},{key:"getSchemaPartDescription",value:function(P){if(!P)return"";for(;P.$ref;)P=this.getSchemaPart(P.$ref);var Ia="";return P.description&&(Ia+="\n-> ".concat(P.description)),P.link&&(Ia+="\n-> Read more at ".concat(P.link)),Ia}},{key:"formatValidationError",value:function(P){var Ia=this,ha=P.keyword,va=P.dataPath;va="".concat(this.baseDataPath).concat(va);switch(ha){case "type":switch(ha=
P.parentSchema,P.params.type){case "number":return"".concat(va," should be a ").concat(this.getSchemaPartText(ha,!1,!0));case "integer":return"".concat(va," should be an ").concat(this.getSchemaPartText(ha,!1,!0));case "string":case "boolean":return"".concat(va," should be a ").concat(this.getSchemaPartText(ha,!1,!0));case "array":return"".concat(va," should be an array:\n").concat(this.getSchemaPartText(ha));case "object":return"".concat(va," should be an object:\n").concat(this.getSchemaPartText(ha));
case "null":return"".concat(va," should be a ").concat(this.getSchemaPartText(ha,!1,!0));default:return"".concat(va," should be:\n").concat(this.getSchemaPartText(ha))}case "instanceof":return P=P.parentSchema,"".concat(va," should be an instance of ").concat(this.getSchemaPartText(P,!1,!0));case "pattern":return ha=P.parentSchema,P=P.params.pattern,"".concat(va," should match pattern ").concat(JSON.stringify(P)).concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "format":return ha=
P.parentSchema,P=P.params.format,"".concat(va," should match format ").concat(JSON.stringify(P)).concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "formatMinimum":case "formatMaximum":ha=P.params;P=P.parentSchema;var H=ha.comparison;ha=ha.limit;return"".concat(va," should be ").concat(H," ").concat(JSON.stringify(ha)).concat(D(P),".").concat(this.getSchemaPartDescription(P));case "minimum":case "maximum":case "exclusiveMinimum":case "exclusiveMaximum":ha=P.parentSchema;H=P.params;P=
H.comparison;H=H.limit;var sa=l(L(ha,!0)).slice(1);return 0===sa.length&&sa.push("should be ".concat(P," ").concat(H)),"".concat(va," ").concat(sa.join(" ")).concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "multipleOf":return ha=P.parentSchema,P=P.params.multipleOf,"".concat(va," should be multiple of ").concat(P).concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "patternRequired":return ha=P.parentSchema,P=P.params.missingPattern,"".concat(va," should have property matching pattern ").concat(JSON.stringify(P)).concat(D(ha),
".").concat(this.getSchemaPartDescription(ha));case "minLength":ha=P.parentSchema;P=P.params.limit;if(1===P)return"".concat(va," should be a non-empty string").concat(D(ha),".").concat(this.getSchemaPartDescription(ha));--P;return"".concat(va," should be longer than ").concat(P," character").concat(1<P?"s":"").concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "minItems":return ha=P.parentSchema,P=P.params.limit,1===P?"".concat(va," should be a non-empty array").concat(D(ha),".").concat(this.getSchemaPartDescription(ha)):
"".concat(va," should not have fewer than ").concat(P," items").concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "minProperties":return ha=P.parentSchema,P=P.params.limit,1===P?"".concat(va," should be a non-empty object").concat(D(ha),".").concat(this.getSchemaPartDescription(ha)):"".concat(va," should not have fewer than ").concat(P," properties").concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "maxLength":return ha=P.parentSchema,P=P.params.limit+1,"".concat(va,
" should be shorter than ").concat(P," character").concat(1<P?"s":"").concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "maxItems":return ha=P.parentSchema,P=P.params.limit,"".concat(va," should not have more than ").concat(P," items").concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "maxProperties":return ha=P.parentSchema,P=P.params.limit,"".concat(va," should not have more than ").concat(P," properties").concat(D(ha),".").concat(this.getSchemaPartDescription(ha));
case "uniqueItems":return ha=P.parentSchema,H=P.params.i,"".concat(va," should not contain the item '").concat(P.data[H],"' twice").concat(D(ha),".").concat(this.getSchemaPartDescription(ha));case "additionalItems":return ha=P.parentSchema,P=P.params.limit,"".concat(va," should not have more than ").concat(P," items").concat(D(ha),". These items are valid:\n").concat(this.getSchemaPartText(ha));case "contains":return P=P.parentSchema,"".concat(va," should contains at least one ").concat(this.getSchemaPartText(P,
["contains"])," item").concat(D(P),".");case "required":return ha=P.parentSchema,P=P.params.missingProperty.replace(/^\./,""),H=ha&&!(!ha.properties||!ha.properties[P]),"".concat(va," misses the property '").concat(P,"'").concat(D(ha),".").concat(H?" Should be:\n".concat(this.getSchemaPartText(ha,["properties",P])):this.getSchemaPartDescription(ha));case "additionalProperties":return ha=P.parentSchema,P=P.params.additionalProperty,"".concat(va," has an unknown property '").concat(P,"'").concat(D(ha),
". These properties are valid:\n").concat(this.getSchemaPartText(ha));case "dependencies":return ha=P.params,P=P.parentSchema,H=ha.property,ha=ha.deps.split(",").map(function(Ra){return"'".concat(Ra.trim(),"'")}).join(", "),"".concat(va," should have properties ").concat(ha," when property '").concat(H,"' is present").concat(D(P),".").concat(this.getSchemaPartDescription(P));case "propertyNames":return ha=P.parentSchema,H=P.schema,P=P.params.propertyName,"".concat(va," property name '").concat(P,
"' is invalid").concat(D(ha),". Property names should be match format ").concat(JSON.stringify(H.format),".").concat(this.getSchemaPartDescription(ha));case "enum":return(P=P.parentSchema)&&P.enum&&1===P.enum.length?"".concat(va," should be ").concat(this.getSchemaPartText(P,!1,!0)):"".concat(va," should be one of these:\n").concat(this.getSchemaPartText(P));case "const":return P=P.parentSchema,"".concat(va," should be equal to constant ").concat(this.getSchemaPartText(P,!1,!0));case "not":ha=x(P.parentSchema)?
"\n".concat(this.getSchemaPartText(P.parentSchema)):"";H=this.getSchemaPartText(P.schema,!1,!1,!1);if(Ba(P.schema))return"".concat(va," should be any ").concat(H).concat(ha,".");ha=P.schema;P=P.parentSchema;return"".concat(va," should not be ").concat(this.getSchemaPartText(ha,!1,!0)).concat(P&&x(P)?"\n".concat(this.getSchemaPartText(P)):"");case "oneOf":case "anyOf":ha=P.parentSchema;if((H=P.children)&&0<H.length){if(1===P.schema.length)return va=H[H.length-1],P=H.slice(0,H.length-1),this.formatValidationError(Object.assign({},
va,{children:P,parentSchema:Object.assign({},ha,va.parentSchema)}));P=S(H);return 1===P.length?this.formatValidationError(P[0]):(P=qa(P),"".concat(va," should be one of these:\n").concat(this.getSchemaPartText(ha),"\nDetails:\n").concat(P.map(function(Ra){var Xa=" * ".concat;Ra=Ia.formatValidationError(Ra).replace(/\n(?!$)/g,"\n".concat("   "));return Xa.call(" * ",Ra)}).join("\n")))}return"".concat(va," should be one of these:\n").concat(this.getSchemaPartText(ha));case "if":return ha=P.parentSchema,
P=P.params.failingKeyword,"".concat(va,' should match "').concat(P,'" schema:\n').concat(this.getSchemaPartText(ha,[P]));case "absolutePath":return ha=P.message,P=P.parentSchema,"".concat(va,": ").concat(ha).concat(this.getSchemaPartDescription(P));default:return ha=P.message,H=P.parentSchema,P=JSON.stringify(P,null,2),"".concat(va," ").concat(ha," (").concat(P,").\n").concat(this.getSchemaPartText(H,!1))}}},{key:"formatValidationErrors",value:function(P){var Ia=this;return P.map(function(ha){var va=
Ia.formatValidationError(ha);return Ia.postFormatter&&(va=Ia.postFormatter(va,ha))," - ".concat(va.replace(/\n(?!$)/g,"\n".concat("   ")))}).join("\n")}}]),ra}();K.default=t},{"./util/hints":"SqDh"}],wWOq:[function(t,G,K,e){!function(l,f){"object"==typeof K&&"undefined"!=typeof G?f(K):f(l.URI=l.URI||{})}(this,function(l){function f(){for(var T=arguments.length,ca=Array(T),ia=0;ia<T;ia++)ca[ia]=arguments[ia];if(1<ca.length){ca[0]=ca[0].slice(0,-1);T=ca.length-1;for(ia=1;ia<T;++ia)ca[ia]=ca[ia].slice(1,
-1);return ca[T]=ca[T].slice(1),ca.join("")}return ca[0]}function d(T){return"(?:"+T+")"}function m(T){return void 0===T?"undefined":null===T?"null":Object.prototype.toString.call(T).split(" ").pop().split("]").shift().toLowerCase()}function q(T){return T.toUpperCase()}function n(T){var ca=f("[0-9]","[A-Fa-f]"),ia=d(d("%[EFef]"+ca+"%"+ca+ca+"%"+ca+ca)+"|"+d("%[89A-Fa-f]"+ca+"%"+ca+ca)+"|"+d("%"+ca+ca)),ta=f("[\\:\\/\\?\\#\\[\\]\\@]","[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),Da=T?"[\\uE000-\\uF8FF]":
"[]";T=f("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]",T?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]");var Va=d("[A-Za-z]"+f("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),Za=d(d(ia+"|"+f(T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:]"))+"*"),eb=(d(d("25[0-5]")+"|"+d("2[0-4][0-9]")+"|"+d("1[0-9][0-9]")+"|"+d("[1-9][0-9]")+"|[0-9]"),d(d("25[0-5]")+"|"+d("2[0-4][0-9]")+"|"+d("1[0-9][0-9]")+"|"+d("0?[1-9][0-9]")+"|0?0?[0-9]"));eb=d(eb+"\\."+eb+"\\."+eb+"\\."+eb);var Ka=d(ca+"{1,4}"),
ua=d(d(Ka+"\\:"+Ka)+"|"+eb),kb=d(d(Ka+"\\:")+"{6}"+ua),lb=d("\\:\\:"+d(Ka+"\\:")+"{5}"+ua),Ab=d(d(Ka)+"?\\:\\:"+d(Ka+"\\:")+"{4}"+ua),sb=d(d(d(Ka+"\\:")+"{0,1}"+Ka)+"?\\:\\:"+d(Ka+"\\:")+"{3}"+ua),qb=d(d(d(Ka+"\\:")+"{0,2}"+Ka)+"?\\:\\:"+d(Ka+"\\:")+"{2}"+ua),ka=d(d(d(Ka+"\\:")+"{0,3}"+Ka)+"?\\:\\:"+Ka+"\\:"+ua);ua=d(d(d(Ka+"\\:")+"{0,4}"+Ka)+"?\\:\\:"+ua);var xb=d(d(d(Ka+"\\:")+"{0,5}"+Ka)+"?\\:\\:"+Ka);Ka=d(d(d(Ka+"\\:")+"{0,6}"+Ka)+"?\\:\\:");kb=d([kb,lb,Ab,sb,qb,ka,ua,xb,Ka].join("|"));lb=d(d(T+
"|"+ia)+"+");Ab=(d(kb+"\\%25"+lb),d(kb+d("\\%25|\\%(?!"+ca+"{2})")+lb));sb=d("[vV]"+ca+"+\\."+f(T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:]")+"+");Ab=d("\\["+d(Ab+"|"+kb+"|"+sb)+"\\]");sb=d(d(ia+"|"+f(T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"))+"*");Ab=d(Ab+"|"+eb+"(?!"+sb+")|"+sb);sb=d("[0-9]*");Ka=d(d(Za+"@")+"?"+Ab+d("\\:"+sb)+"?");var jb=d(ia+"|"+f(T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:\\@]"));qb=d(jb+"*");xb=d(jb+"+");ua=d(d(ia+"|"+f(T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\@]"))+
"+");qb=d(d("\\/"+qb)+"*");ka=d("\\/"+d(xb+qb)+"?");ua=d(ua+qb);xb=d(xb+qb);var tb="(?!"+jb+")",Hb=(d(qb+"|"+ka+"|"+ua+"|"+xb+"|"+tb),d(d(jb+"|"+f("[\\/\\?]",Da))+"*"));jb=d(d(jb+"|[\\/\\?]")+"*");var Eb=d(d("\\/\\/"+Ka+qb)+"|"+ka+"|"+xb+"|"+tb),bb=d(Va+"\\:"+Eb+d("\\?"+Hb)+"?"+d("\\#"+jb)+"?");Ka=d(d("\\/\\/"+Ka+qb)+"|"+ka+"|"+ua+"|"+tb);Ka=d(Ka+d("\\?"+Hb)+"?"+d("\\#"+jb)+"?");d(bb+"|"+Ka);d(Va+"\\:"+Eb+d("\\?"+Hb)+"?");d(d("\\/\\/("+d("("+Za+")@")+"?("+Ab+")"+d("\\:("+sb+")")+"?)")+"?("+qb+"|"+
ka+"|"+xb+"|"+tb+")");d("\\?("+Hb+")");d("\\#("+jb+")");d(d("\\/\\/("+d("("+Za+")@")+"?("+Ab+")"+d("\\:("+sb+")")+"?)")+"?("+qb+"|"+ka+"|"+ua+"|"+tb+")");d("\\?("+Hb+")");d("\\#("+jb+")");d(d("\\/\\/("+d("("+Za+")@")+"?("+Ab+")"+d("\\:("+sb+")")+"?)")+"?("+qb+"|"+ka+"|"+xb+"|"+tb+")");d("\\?("+Hb+")");d("\\#("+jb+")");d("("+Za+")@");d("\\:("+sb+")");return{NOT_SCHEME:new RegExp(f("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(f("[^\\%\\:]",T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),
"g"),NOT_HOST:new RegExp(f("[^\\%\\[\\]\\:]",T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),NOT_PATH:new RegExp(f("[^\\%\\/\\:\\@]",T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),NOT_PATH_NOSCHEME:new RegExp(f("[^\\%\\/\\@]",T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),NOT_QUERY:new RegExp(f("[^\\%]",T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:\\@\\/\\?]",Da),"g"),NOT_FRAGMENT:new RegExp(f("[^\\%]",T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(f("[^]",T,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),
"g"),UNRESERVED:new RegExp(T,"g"),OTHER_CHARS:new RegExp(f("[^\\%]",T,ta),"g"),PCT_ENCODED:new RegExp(ia,"g"),IPV4ADDRESS:new RegExp("^("+eb+")$"),IPV6ADDRESS:new RegExp("^\\[?("+kb+")"+d(d("\\%25|\\%(?!"+ca+"{2})")+"("+lb+")")+"?\\]?$")}}function p(T){throw new RangeError(Sa[T]);}function w(T,ca){var ia=T.split("@"),ta="";1<ia.length&&(ta=ia[0]+"@",T=ia[1]);T=T.replace(Na,".").split(".");ia=[];for(var Da=T.length;Da--;)ia[Da]=ca(T[Da]);ca=ia.join(".");return ta+ca}function B(T){for(var ca=[],ia=
0,ta=T.length;ia<ta;){var Da=T.charCodeAt(ia++);if(55296<=Da&&56319>=Da&&ia<ta){var Va=T.charCodeAt(ia++);56320==(64512&Va)?ca.push(((1023&Da)<<10)+(1023&Va)+65536):(ca.push(Da),ia--)}else ca.push(Da)}return ca}function v(T){T=T.charCodeAt(0);return 16>T?"%0"+T.toString(16).toUpperCase():128>T?"%"+T.toString(16).toUpperCase():2048>T?"%"+(T>>6|192).toString(16).toUpperCase()+"%"+(63&T|128).toString(16).toUpperCase():"%"+(T>>12|224).toString(16).toUpperCase()+"%"+(T>>6&63|128).toString(16).toUpperCase()+
"%"+(63&T|128).toString(16).toUpperCase()}function z(T){for(var ca="",ia=0,ta=T.length;ia<ta;){var Da=parseInt(T.substr(ia+1,2),16);if(128>Da)ca+=String.fromCharCode(Da),ia+=3;else if(194<=Da&&224>Da){if(6<=ta-ia){var Va=parseInt(T.substr(ia+4,2),16);ca+=String.fromCharCode((31&Da)<<6|63&Va)}else ca+=T.substr(ia,6);ia+=6}else if(224<=Da){if(9<=ta-ia){Va=parseInt(T.substr(ia+4,2),16);var Za=parseInt(T.substr(ia+7,2),16);ca+=String.fromCharCode((15&Da)<<12|(63&Va)<<6|63&Za)}else ca+=T.substr(ia,9);
ia+=9}else ca+=T.substr(ia,3),ia+=3}return ca}function C(T,ca){function ia(ta){var Da=z(ta);return Da.match(ca.UNRESERVED)?Da:ta}return T.scheme&&(T.scheme=String(T.scheme).replace(ca.PCT_ENCODED,ia).toLowerCase().replace(ca.NOT_SCHEME,"")),void 0!==T.userinfo&&(T.userinfo=String(T.userinfo).replace(ca.PCT_ENCODED,ia).replace(ca.NOT_USERINFO,v).replace(ca.PCT_ENCODED,q)),void 0!==T.host&&(T.host=String(T.host).replace(ca.PCT_ENCODED,ia).toLowerCase().replace(ca.NOT_HOST,v).replace(ca.PCT_ENCODED,
q)),void 0!==T.path&&(T.path=String(T.path).replace(ca.PCT_ENCODED,ia).replace(T.scheme?ca.NOT_PATH:ca.NOT_PATH_NOSCHEME,v).replace(ca.PCT_ENCODED,q)),void 0!==T.query&&(T.query=String(T.query).replace(ca.PCT_ENCODED,ia).replace(ca.NOT_QUERY,v).replace(ca.PCT_ENCODED,q)),void 0!==T.fragment&&(T.fragment=String(T.fragment).replace(ca.PCT_ENCODED,ia).replace(ca.NOT_FRAGMENT,v).replace(ca.PCT_ENCODED,q)),T}function A(T){return T.replace(/^0*(.*)/,"$1")||"0"}function F(T,ca){ca=T.match(ca.IPV4ADDRESS)||
[];return(ca=Pa(ca,2)[1])?ca.split(".").map(A).join("."):T}function E(T,ca){var ia=T.match(ca.IPV6ADDRESS)||[];ia=Pa(ia,3);var ta=ia[1];ia=ia[2];if(ta){T=ta.toLowerCase().split("::").reverse();ta=Pa(T,2);T=ta[0];ta=(ta=ta[1])?ta.split(":").map(A):[];var Da=T.split(":").map(A),Va=ca.IPV4ADDRESS.test(Da[Da.length-1]),Za=Va?7:8,eb=Da.length-Za;T=Array(Za);for(var Ka=0;Ka<Za;++Ka)T[Ka]=ta[Ka]||Da[eb+Ka]||"";Va&&(T[Za-1]=F(T[Za-1],ca));ca=T.reduce(function(ua,kb,lb){kb&&"0"!==kb||((kb=ua[ua.length-1])&&
kb.index+kb.length===lb?kb.length++:ua.push({index:lb,length:1}));return ua},[]).sort(function(ua,kb){return kb.length-ua.length})[0];ta=void 0;ca&&1<ca.length?(ta=T.slice(0,ca.index),ca=T.slice(ca.index+ca.length),ta=ta.join(":")+"::"+ca.join(":")):ta=T.join(":");return ia&&(ta+="%"+ia),ta}return T}function M(T){var ca=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},ia={},ta=!1!==ca.iri?qa:la;"suffix"===ca.reference&&(T=(ca.scheme?ca.scheme+":":"")+"//"+T);var Da=T.match(Ja);if(Da){ea?
(ia.scheme=Da[1],ia.userinfo=Da[3],ia.host=Da[4],ia.port=parseInt(Da[5],10),ia.path=Da[6]||"",ia.query=Da[7],ia.fragment=Da[8],isNaN(ia.port)&&(ia.port=Da[5])):(ia.scheme=Da[1]||void 0,ia.userinfo=-1!==T.indexOf("@")?Da[3]:void 0,ia.host=-1!==T.indexOf("//")?Da[4]:void 0,ia.port=parseInt(Da[5],10),ia.path=Da[6]||"",ia.query=-1!==T.indexOf("?")?Da[7]:void 0,ia.fragment=-1!==T.indexOf("#")?Da[8]:void 0,isNaN(ia.port)&&(ia.port=T.match(/\/\/(?:.|\n)*:(?:\/|\?|#|$)/)?Da[4]:void 0));ia.host&&(ia.host=
E(F(ia.host,ta),ta));void 0!==ia.scheme||void 0!==ia.userinfo||void 0!==ia.host||void 0!==ia.port||ia.path||void 0!==ia.query?void 0===ia.scheme?ia.reference="relative":void 0===ia.fragment?ia.reference="absolute":ia.reference="uri":ia.reference="same-document";ca.reference&&"suffix"!==ca.reference&&ca.reference!==ia.reference&&(ia.error=ia.error||"URI is not a "+ca.reference+" reference.");Da=pa[(ca.scheme||ia.scheme||"").toLowerCase()];if(ca.unicodeSupport||Da&&Da.unicodeSupport)C(ia,ta);else{if(ia.host&&
(ca.domainHost||Da&&Da.domainHost))try{ia.host=Z.toASCII(ia.host.replace(ta.PCT_ENCODED,z).toLowerCase())}catch(Va){ia.error=ia.error||"Host's domain name can not be converted to ASCII via punycode: "+Va}C(ia,la)}Da&&Da.parse&&Da.parse(ia,ca)}else ia.error=ia.error||"URI can not be parsed.";return ia}function J(T){for(var ca=[];T.length;)if(T.match(ra))T=T.replace(ra,"");else if(T.match(Fa))T=T.replace(Fa,"/");else if(T.match(P))T=T.replace(P,"/"),ca.pop();else if("."===T||".."===T)T="";else{var ia=
T.match(Ia);if(!ia)throw Error("Unexpected dot segment condition");ia=ia[0];T=T.slice(ia.length);ca.push(ia)}return ca.join("")}function X(T){var ca=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},ia=ca.iri?qa:la,ta=[],Da=pa[(ca.scheme||T.scheme||"").toLowerCase()];if((Da&&Da.serialize&&Da.serialize(T,ca),T.host)&&!ia.IPV6ADDRESS.test(T.host)&&(ca.domainHost||Da&&Da.domainHost))try{T.host=ca.iri?Z.toUnicode(T.host):Z.toASCII(T.host.replace(ia.PCT_ENCODED,z).toLowerCase())}catch(Za){T.error=
T.error||"Host's domain name can not be converted to "+(ca.iri?"Unicode":"ASCII")+" via punycode: "+Za}C(T,ia);"suffix"!==ca.reference&&T.scheme&&(ta.push(T.scheme),ta.push(":"));ia=function(Za,eb){eb=!1!==eb.iri?qa:la;var Ka=[];return void 0!==Za.userinfo&&(Ka.push(Za.userinfo),Ka.push("@")),void 0!==Za.host&&Ka.push(E(F(String(Za.host),eb),eb).replace(eb.IPV6ADDRESS,function(ua,kb,lb){return"["+kb+(lb?"%25"+lb:"")+"]"})),"number"==typeof Za.port&&(Ka.push(":"),Ka.push(Za.port.toString(10))),Ka.length?
Ka.join(""):void 0}(T,ca);if(void 0!==ia&&("suffix"!==ca.reference&&ta.push("//"),ta.push(ia),T.path&&"/"!==T.path.charAt(0)&&ta.push("/")),void 0!==T.path){var Va=T.path;ca.absolutePath||Da&&Da.absolutePath||(Va=J(Va));void 0===ia&&(Va=Va.replace(/^\/\//,"/%2F"));ta.push(Va)}return void 0!==T.query&&(ta.push("?"),ta.push(T.query)),void 0!==T.fragment&&(ta.push("#"),ta.push(T.fragment)),ta.join("")}function ja(T,ca){var ia=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},ta={};return arguments[3]||
(T=M(X(T,ia),ia),ca=M(X(ca,ia),ia)),!(ia||{}).tolerant&&ca.scheme?(ta.scheme=ca.scheme,ta.userinfo=ca.userinfo,ta.host=ca.host,ta.port=ca.port,ta.path=J(ca.path||""),ta.query=ca.query):(void 0!==ca.userinfo||void 0!==ca.host||void 0!==ca.port?(ta.userinfo=ca.userinfo,ta.host=ca.host,ta.port=ca.port,ta.path=J(ca.path||""),ta.query=ca.query):(ca.path?("/"===ca.path.charAt(0)?ta.path=J(ca.path):(void 0===T.userinfo&&void 0===T.host&&void 0===T.port||T.path?T.path?ta.path=T.path.slice(0,T.path.lastIndexOf("/")+
1)+ca.path:ta.path=ca.path:ta.path="/"+ca.path,ta.path=J(ta.path)),ta.query=ca.query):(ta.path=T.path,void 0!==ca.query?ta.query=ca.query:ta.query=T.query),ta.userinfo=T.userinfo,ta.host=T.host,ta.port=T.port),ta.scheme=T.scheme),ta.fragment=ca.fragment,ta}function S(T,ca){return T&&T.toString().replace(ca&&ca.iri?qa.PCT_ENCODED:la.PCT_ENCODED,z)}function W(T){var ca=z(T);return ca.match(Xa)?ca:T}var la=n(!1),qa=n(!0),Pa=function(){return function(T,ca){if(Array.isArray(T))return T;if(Symbol.iterator in
Object(T)){var ia=[],ta=!0,Da=!1,Va=void 0;try{for(var Za,eb=T[Symbol.iterator]();!(ta=(Za=eb.next()).done)&&(ia.push(Za.value),!ca||ia.length!==ca);ta=!0);}catch(Ka){Da=!0,Va=Ka}finally{try{!ta&&eb.return&&eb.return()}finally{if(Da)throw Va;}}return ia}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),Ba=/^xn--/,wa=/[^\0-\x7E]/,Na=/[\x2E\u3002\uFF0E\uFF61]/g,Sa={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)",
"invalid-input":"Invalid input"},Aa=Math.floor,ya=String.fromCharCode,x=function(T,ca,ia){var ta=0;T=ia?Aa(T/700):T>>1;for(T+=Aa(T/ca);455<T;ta+=36)T=Aa(T/35);return Aa(ta+36*T/(T+38))},D=function(T){var ca,ia=[],ta=T.length,Da=0,Va=128,Za=72,eb=T.lastIndexOf("-");0>eb&&(eb=0);for(var Ka=0;Ka<eb;++Ka)128<=T.charCodeAt(Ka)&&p("not-basic"),ia.push(T.charCodeAt(Ka));for(eb=0<eb?eb+1:0;eb<ta;){Ka=Da;for(var ua=1,kb=36;;kb+=36){eb>=ta&&p("invalid-input");var lb=10>(ca=T.charCodeAt(eb++))-48?ca-22:26>ca-
65?ca-65:26>ca-97?ca-97:36;(36<=lb||lb>Aa((2147483647-Da)/ua))&&p("overflow");Da+=lb*ua;var Ab=kb<=Za?1:kb>=Za+26?26:kb-Za;if(lb<Ab)break;lb=36-Ab;ua>Aa(2147483647/lb)&&p("overflow");ua*=lb}ua=ia.length+1;Za=x(Da-Ka,ua,0==Ka);Aa(Da/ua)>2147483647-Va&&p("overflow");Va+=Aa(Da/ua);Da%=ua;ia.splice(Da++,0,Va)}return String.fromCodePoint.apply(String,ia)},L=function(T){var ca=[],ia=(T=B(T)).length,ta=128,Da=0,Va=72,Za=!0,eb=!1,Ka=void 0;try{for(var ua,kb=T[Symbol.iterator]();!(Za=(ua=kb.next()).done);Za=
!0){var lb=ua.value;128>lb&&ca.push(ya(lb))}}catch(N){eb=!0,Ka=N}finally{try{!Za&&kb.return&&kb.return()}finally{if(eb)throw Ka;}}for((eb=Za=ca.length)&&ca.push("-");eb<ia;){ua=2147483647;Ka=!0;kb=!1;lb=void 0;try{for(var Ab,sb=T[Symbol.iterator]();!(Ka=(Ab=sb.next()).done);Ka=!0){var qb=Ab.value;qb>=ta&&qb<ua&&(ua=qb)}}catch(N){kb=!0,lb=N}finally{try{!Ka&&sb.return&&sb.return()}finally{if(kb)throw lb;}}Ka=eb+1;ua-ta>Aa((2147483647-Da)/Ka)&&p("overflow");Da+=(ua-ta)*Ka;ta=ua;ua=!0;kb=!1;lb=void 0;
try{for(var ka,xb=T[Symbol.iterator]();!(ua=(ka=xb.next()).done);ua=!0){var jb=ka.value;if(jb<ta&&2147483647<++Da&&p("overflow"),jb==ta){for(var tb=Da,Hb=36;;Hb+=36){var Eb=Hb<=Va?1:Hb>=Va+26?26:Hb-Va;if(tb<Eb)break;var bb=tb-Eb,Qb=36-Eb,Vb=ca;Eb+=bb%Qb;Vb.push.call(Vb,ya(Eb+22+75*(26>Eb)-0));tb=Aa(bb/Qb)}ca.push(ya(tb+22+75*(26>tb)-0));Va=x(Da,Ka,eb==Za);Da=0;++eb}}}catch(N){kb=!0,lb=N}finally{try{!ua&&xb.return&&xb.return()}finally{if(kb)throw lb;}}++Da;++ta}return ca.join("")},Z={version:"2.1.0",
ucs2:{decode:B,encode:function(T){var ca=String.fromCodePoint,ia=ca.apply,ta=String;if(Array.isArray(T)){for(var Da=0,Va=Array(T.length);Da<T.length;Da++)Va[Da]=T[Da];T=Va}else T=Array.from(T);return ia.call(ca,ta,T)}},decode:D,encode:L,toASCII:function(T){return w(T,function(ca){return wa.test(ca)?"xn--"+L(ca):ca})},toUnicode:function(T){return w(T,function(ca){return Ba.test(ca)?D(ca.slice(4).toLowerCase()):ca})}},pa={},Ja=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?::(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,
ea=void 0==="".match(/(){0}/)[1],ra=/^\.\.?\//,Fa=/^\/\.(\/|$)/,P=/^\/\.\.(\/|$)/,Ia=/^\/?(?:.|\n)*?(?=\/|$)/,ha={scheme:"http",domainHost:!0,parse:function(T,ca){return T.host||(T.error=T.error||"HTTP URIs must have a host."),T},serialize:function(T,ca){return T.port!==("https"!==String(T.scheme).toLowerCase()?80:443)&&""!==T.port||(T.port=void 0),T.path||(T.path="/"),T}},va={scheme:"https",domainHost:ha.domainHost,parse:ha.parse,serialize:ha.serialize},H={},sa=d(d("%[EFef][0-9A-Fa-f]%[0-9A-Fa-f][0-9A-Fa-f]%[0-9A-Fa-f][0-9A-Fa-f]")+
"|"+d("%[89A-Fa-f][0-9A-Fa-f]%[0-9A-Fa-f][0-9A-Fa-f]")+"|"+d("%[0-9A-Fa-f][0-9A-Fa-f]")),Ra=f("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),Xa=RegExp("[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]","g"),rb=new RegExp(sa,"g"),Bb=new RegExp(f("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',Ra),"g"),ob=new RegExp(f("[^]","[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",
"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g");sa={scheme:"mailto",parse:function(T,ca){var ia=T.to=T.path?T.path.split(","):[];if(T.path=void 0,T.query){for(var ta=!1,Da={},Va=T.query.split("&"),Za=0,eb=Va.length;Za<eb;++Za){var Ka=Va[Za].split("=");switch(Ka[0]){case "to":Ka=Ka[1].split(",");for(var ua=0,kb=Ka.length;ua<kb;++ua)ia.push(Ka[ua]);break;case "subject":T.subject=S(Ka[1],ca);break;case "body":T.body=S(Ka[1],ca);break;default:ta=!0,Da[S(Ka[0],ca)]=S(Ka[1],ca)}}ta&&(T.headers=Da)}T.query=
void 0;ta=0;for(Da=ia.length;ta<Da;++ta){Va=ia[ta].split("@");if(Va[0]=S(Va[0]),ca.unicodeSupport)Va[1]=S(Va[1],ca).toLowerCase();else try{Va[1]=Z.toASCII(S(Va[1],ca).toLowerCase())}catch(lb){T.error=T.error||"Email address's domain name can not be converted to ASCII via punycode: "+lb}ia[ta]=Va.join("@")}return T},serialize:function(T,ca){var ia,ta=null!=(ia=T.to)?ia instanceof Array?ia:"number"!=typeof ia.length||ia.split||ia.setInterval||ia.call?[ia]:Array.prototype.slice.call(ia):[];if(ta){ia=
0;for(var Da=ta.length;ia<Da;++ia){var Va=String(ta[ia]),Za=Va.lastIndexOf("@"),eb=Va.slice(0,Za).replace(rb,W).replace(rb,q).replace(Bb,v);Va=Va.slice(Za+1);try{Va=ca.iri?Z.toUnicode(Va):Z.toASCII(S(Va,ca).toLowerCase())}catch(ua){T.error=T.error||"Email address's domain name can not be converted to "+(ca.iri?"Unicode":"ASCII")+" via punycode: "+ua}ta[ia]=eb+"@"+Va}T.path=ta.join(",")}ca=T.headers=T.headers||{};T.subject&&(ca.subject=T.subject);T.body&&(ca.body=T.body);ta=[];for(var Ka in ca)ca[Ka]!==
H[Ka]&&ta.push(Ka.replace(rb,W).replace(rb,q).replace(ob,v)+"="+ca[Ka].replace(rb,W).replace(rb,q).replace(ob,v));return ta.length&&(T.query=ta.join("&")),T}};var Ob=/^([^:]+):(.*)/;Ra={scheme:"urn",parse:function(T,ca){var ia=T.path&&T.path.match(Ob);if(ia){var ta=ca.scheme||T.scheme||"urn",Da=ia[1].toLowerCase();ia=ia[2];ta=pa[ta+":"+(ca.nid||Da)];T.nid=Da;T.nss=ia;T.path=void 0;ta&&(T=ta.parse(T,ca))}else T.error=T.error||"URN can not be parsed.";return T},serialize:function(T,ca){var ia=T.nid,
ta=pa[(ca.scheme||T.scheme||"urn")+":"+(ca.nid||ia)];ta&&(T=ta.serialize(T,ca));ta=T;return ta.path=(ia||ca.nid)+":"+T.nss,ta}};var db=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Db={scheme:"urn:uuid",parse:function(T,ca){return T.uuid=T.nss,T.nss=void 0,ca.tolerant||T.uuid&&T.uuid.match(db)||(T.error=T.error||"UUID is not valid."),T},serialize:function(T,ca){return T.nss=(T.uuid||"").toLowerCase(),T}};pa[ha.scheme]=ha;pa[va.scheme]=va;pa[sa.scheme]=sa;pa[Ra.scheme]=Ra;pa[Db.scheme]=
Db;l.SCHEMES=pa;l.pctEncChar=v;l.pctDecChars=z;l.parse=M;l.removeDotSegments=J;l.serialize=X;l.resolveComponents=ja;l.resolve=function(T,ca,ia){var ta={scheme:"null"};if(ia)for(var Da in ia)ta[Da]=ia[Da];return X(ja(M(T,ta),M(ca,ta),ta,!0),ta)};l.normalize=function(T,ca){return"string"==typeof T?T=X(M(T,ca),ca):"object"===m(T)&&(T=M(X(T,ca),ca)),T};l.equal=function(T,ca,ia){return"string"==typeof T?T=X(M(T,ia),ia):"object"===m(T)&&(T=X(T,ia)),"string"==typeof ca?ca=X(M(ca,ia),ia):"object"===m(ca)&&
(ca=X(ca,ia)),T===ca};l.escapeComponent=function(T,ca){return T&&T.toString().replace(ca&&ca.iri?qa.ESCAPE:la.ESCAPE,v)};l.unescapeComponent=S;Object.defineProperty(l,"__esModule",{value:!0})})},{}],dPQH:[function(t,G,K){G.exports=function d(l,f){if(l===f)return!0;if(l&&f&&"object"==typeof l&&"object"==typeof f){if(l.constructor!==f.constructor)return!1;var m,q,n;if(Array.isArray(l)){if((m=l.length)!=f.length)return!1;for(q=m;0!=q--;)if(!d(l[q],f[q]))return!1;return!0}if(l.constructor===RegExp)return l.source===
f.source&&l.flags===f.flags;if(l.valueOf!==Object.prototype.valueOf)return l.valueOf()===f.valueOf();if(l.toString!==Object.prototype.toString)return l.toString()===f.toString();if((m=(n=Object.keys(l)).length)!==Object.keys(f).length)return!1;for(q=m;0!=q--;)if(!Object.prototype.hasOwnProperty.call(f,n[q]))return!1;for(q=m;0!=q--;)if(m=n[q],!d(l[m],f[m]))return!1;return!0}return l!=l&&f!=f}},{}],rD0p:[function(t,G,K){G.exports=function(e){for(var l,f=0,d=e.length,m=0;m<d;)f++,55296<=(l=e.charCodeAt(m++))&&
56319>=l&&m<d&&56320==(64512&(l=e.charCodeAt(m)))&&m++;return f}},{}],Q1F7:[function(t,G,K){function e(A,F,E,M){var J=M?" !== ":" === ",X=M?" || ":" && ",ja=M?"!":"";M=M?"":"!";switch(A){case "null":return F+J+"null";case "array":return ja+"Array.isArray("+F+")";case "object":return"("+ja+F+X+"typeof "+F+J+'"object"'+X+M+"Array.isArray("+F+"))";case "integer":return"(typeof "+F+J+'"number"'+X+M+"("+F+" % 1)"+X+F+J+F+(E?X+ja+"isFinite("+F+")":"")+")";case "number":return"(typeof "+F+J+'"'+A+'"'+(E?
X+ja+"isFinite("+F+")":"")+")";default:return"typeof "+F+J+'"'+A+'"'}}function l(A){for(var F={},E=0;E<A.length;E++)F[A[E]]=!0;return F}function f(A){return"number"==typeof A?"["+A+"]":B.test(A)?"."+A:"['"+d(A)+"']"}function d(A){return A.replace(v,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function m(A){return"'"+d(A)+"'"}function q(A,F){return'""'==A?F:(A+" + "+F).replace(/([^\\])' \+ '/g,"$1")}function n(A){return A.replace(/~/g,"~0").replace(/\//g,
"~1")}function p(A){return A.replace(/~1/g,"/").replace(/~0/g,"~")}G.exports={copy:function(A,F){for(var E in F=F||{},A)F[E]=A[E];return F},checkDataType:e,checkDataTypes:function(A,F,E){switch(A.length){case 1:return e(A[0],F,E,!0);default:var M="";A=l(A);for(var J in A.array&&A.object&&(M=A.null?"(":"(!"+F+" || ",M+="typeof "+F+' !== "object")',delete A.null,delete A.array,delete A.object),A.number&&delete A.integer,A)M+=(M?" && ":"")+e(J,F,E,!0);return M}},coerceToTypes:function(A,F){if(Array.isArray(F)){for(var E=
[],M=0;M<F.length;M++){var J=F[M];w[J]?E[E.length]=J:"array"===A&&"array"===J&&(E[E.length]=J)}if(E.length)return E}else{if(w[F])return[F];if("array"===A&&"array"===F)return["array"]}},toHash:l,getProperty:f,escapeQuotes:d,equal:t("fast-deep-equal"),ucs2length:t("./ucs2length"),varOccurences:function(A,F){return(A=A.match(new RegExp(F+"[^0-9]","g")))?A.length:0},varReplace:function(A,F,E){return F+="([^0-9])",E=E.replace(/\$/g,"$$$$"),A.replace(new RegExp(F,"g"),E+"$1")},schemaHasRules:function(A,
F){if("boolean"==typeof A)return!A;for(var E in A)if(F[E])return!0},schemaHasRulesExcept:function(A,F,E){if("boolean"==typeof A)return!A&&"not"!=E;for(var M in A)if(M!=E&&F[M])return!0},schemaUnknownRules:function(A,F){if("boolean"!=typeof A)for(var E in A)if(!F[E])return E},toQuotedString:m,getPathExpr:function(A,F,E,M){return q(A,E?"'/' + "+F+(M?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):M?"'[' + "+F+" + ']'":"'[\\'' + "+F+" + '\\']'")},getPath:function(A,F,E){return q(A,m(E?"/"+n(F):f(F)))},
getData:function(A,F,E){var M,J;if(""===A)return"rootData";if("/"==A[0]){if(!z.test(A))throw Error("Invalid JSON-pointer: "+A);F="rootData"}else{if(!(J=A.match(C)))throw Error("Invalid JSON-pointer: "+A);if(M=+J[1],"#"==(A=J[2])){if(M>=F)throw Error("Cannot access property/index "+M+" levels up, current level is "+F);return E[F-M]}if(M>F)throw Error("Cannot access data "+M+" levels up, current level is "+F);if(F="data"+(F-M||""),!A)return F}E=F;A=A.split("/");for(J=0;J<A.length;J++)(M=A[J])&&(E+=
" && "+(F+=f(p(M))));return E},unescapeFragment:function(A){return p(decodeURIComponent(A))},unescapeJsonPointer:p,escapeFragment:function(A){return encodeURIComponent(n(A))},escapeJsonPointer:n};var w=l(["string","number","integer","boolean","null"]),B=/^[a-z$_][a-z$_0-9]*$/i,v=/'|\\/g,z=/^\/(?:[^~]|~0|~1)*$/,C=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/},{"fast-deep-equal":"dPQH","./ucs2length":"rD0p"}],HHLG:[function(t,G,K){var e=t("./util");G.exports=function(l){e.copy(l,this)}},{"./util":"Q1F7"}],uMRE:[function(t,
G,K){function e(f,d,m,q,n,p,w,B,v,z){if(q&&"object"==typeof q&&!Array.isArray(q)){for(var C in d(q,n,p,w,B,v,z),q){var A=q[C];if(Array.isArray(A)){if(C in l.arrayKeywords)for(var F=0;F<A.length;F++)e(f,d,m,A[F],n+"/"+C+"/"+F,p,n,C,q,F)}else if(C in l.propsKeywords){if(A&&"object"==typeof A)for(var E in A)e(f,d,m,A[E],n+"/"+C+"/"+E.replace(/~/g,"~0").replace(/\//g,"~1"),p,n,C,q,E)}else(C in l.keywords||f.allKeys&&!(C in l.skipKeywords))&&e(f,d,m,A,n+"/"+C,p,n,C,q)}m(q,n,p,w,B,v,z)}}var l=G.exports=
function(f,d,m){"function"==typeof d&&(m=d,d={});e(d,"function"==typeof(m=d.cb||m)?m:m.pre||function(){},m.post||function(){},f,"",f)};l.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0};l.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};l.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};l.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,
maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},{}],w10T:[function(t,G,K){function e(J,X,ja){var S=this._refs[ja];if("string"==typeof S){if(!this._refs[S])return e.call(this,J,X,S);S=this._refs[S]}if((S=S||this._schemas[ja])instanceof C)return d(S.schema,this._opts.inlineRefs)?S.schema:S.validate||this._compile(S);var W,la,qa;ja=l.call(this,X,ja);return ja&&(W=ja.schema,X=ja.root,qa=ja.baseId),W instanceof C?la=W.validate||
J.call(this,W.schema,X,void 0,qa):void 0!==W&&(la=d(W,this._opts.inlineRefs)?W:J.call(this,W,X,void 0,qa)),la}function l(J,X){var ja=B.parse(X),S=B.serialize(ja).split("#")[0]+"#",W=n(this._getId(J.schema));if(0===Object.keys(J.schema).length||S!==W){S=p(S);var la=this._refs[S];if("string"==typeof la)return(W=l.call(this,J,la))?(J=W.schema,X=W.baseId,W=W.root,S=this._getId(J),S=(S&&(X=w(X,S)),f.call(this,ja,X,J,W))):S=void 0,S;if(la instanceof C)la.validate||this._compile(la);else{if(!((la=this._schemas[S])instanceof
C))return;if(la.validate||this._compile(la),S==p(X))return{schema:la,root:J,baseId:W}}J=la;if(!J.schema)return;W=n(this._getId(J.schema))}return f.call(this,ja,W,J.schema,J)}function f(J,X,ja,S){if(J.fragment=J.fragment||"","/"==J.fragment.slice(0,1)){J=J.fragment.split("/");for(var W=1;W<J.length;W++){var la=J[W];if(la){if(void 0===(ja=ja[la=z.unescapeFragment(la)]))break;var qa;!F[la]&&((qa=this._getId(ja))&&(X=w(X,qa)),ja.$ref)&&(la=w(X,ja.$ref),(la=l.call(this,S,la))&&(ja=la.schema,S=la.root,
X=la.baseId))}}return void 0!==ja&&ja!==S.schema?{schema:ja,root:S,baseId:X}:void 0}}function d(J,X){return!1!==X&&(void 0===X||!0===X?m(J):X?q(J)<=X:void 0)}function m(J){var X;if(Array.isArray(J))for(var ja=0;ja<J.length;ja++){if("object"==typeof(X=J[ja])&&!m(X))return!1}else for(ja in J)if("$ref"==ja||"object"==typeof(X=J[ja])&&!m(X))return!1;return!0}function q(J){var X,ja=0;if(Array.isArray(J))for(var S=0;S<J.length;S++){if("object"==typeof(X=J[S])&&(ja+=q(X)),ja==1/0)return 1/0}else for(S in J){if("$ref"==
S)return 1/0;if(E[S])ja++;else if("object"==typeof(X=J[S])&&(ja+=q(X)+1),ja==1/0)return 1/0}return ja}function n(J,X){return!1!==X&&(J=p(J)),B.serialize(B.parse(J)).split("#")[0]+"#"}function p(J){return J?J.replace(M,""):""}function w(J,X){return X=p(X),B.resolve(J,X)}var B=t("uri-js"),v=t("fast-deep-equal"),z=t("./util"),C=t("./schema_obj"),A=t("json-schema-traverse");G.exports=e;e.normalizeId=p;e.fullPath=n;e.url=w;e.ids=function(J){var X=p(this._getId(J)),ja={"":X},S={"":n(X,!1)},W={},la=this;
return A(J,{allKeys:!0},function(qa,Pa,Ba,wa,Na,Sa,Aa){if(""!==Pa){Ba=la._getId(qa);Sa=ja[wa];wa=S[wa]+"/"+Na;if(void 0!==Aa&&(wa+="/"+("number"==typeof Aa?Aa:z.escapeFragment(Aa))),"string"==typeof Ba)if(Ba=Sa=p(Sa?B.resolve(Sa,Ba):Ba),Aa=la._refs[Ba],"string"==typeof Aa&&(Aa=la._refs[Aa]),Aa&&Aa.schema){if(!v(qa,Aa.schema))throw Error('id "'+Ba+'" resolves to more than one schema');}else if(Ba!=p(wa))if("#"==Ba[0]){if(W[Ba]&&!v(qa,W[Ba]))throw Error('id "'+Ba+'" resolves to more than one schema');
W[Ba]=qa}else la._refs[Ba]=wa;ja[Pa]=Sa;S[Pa]=wa}}),W};e.inlineRef=d;e.schema=l;var F=z.toHash(["properties","patternProperties","enum","dependencies","definitions"]),E=z.toHash("type format pattern maxLength minLength maxProperties minProperties maxItems minItems maximum minimum uniqueItems multipleOf required enum".split(" ")),M=/#\/?$/},{"uri-js":"wWOq","fast-deep-equal":"dPQH","./util":"Q1F7","./schema_obj":"HHLG","json-schema-traverse":"uMRE"}],OtNE:[function(t,G,K){function e(d,m,q){this.message=
q||e.message(d,m);this.missingRef=f.url(d,m);this.missingSchema=f.normalizeId(f.fullPath(this.missingRef))}function l(d){return d.prototype=Object.create(Error.prototype),d.prototype.constructor=d,d}var f=t("./resolve");G.exports={Validation:l(function(d){this.message="validation failed";this.errors=d;this.ajv=this.validation=!0}),MissingRef:l(e)};e.message=function(d,m){return"can't resolve reference "+m+" from id "+d}},{"./resolve":"w10T"}],Xb3N:[function(t,G,K){G.exports=function(e,l){l||={};"function"==
typeof l&&(l={cmp:l});var f,d="boolean"==typeof l.cycles&&l.cycles,m=l.cmp&&(f=l.cmp,function(n){return function(p,w){return f({key:p,value:n[p]},{key:w,value:n[w]})}}),q=[];return function w(p){if(p&&p.toJSON&&"function"==typeof p.toJSON&&(p=p.toJSON()),void 0!==p){if("number"==typeof p)return isFinite(p)?""+p:"null";if("object"!=typeof p)return JSON.stringify(p);var B;if(Array.isArray(p)){var v="[";for(B=0;B<p.length;B++)B&&(v+=","),v+=w(p[B])||"null";return v+"]"}if(null===p)return"null";if(-1!==
q.indexOf(p)){if(d)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var z=q.push(p)-1,C=Object.keys(p).sort(m&&m(p));v="";for(B=0;B<C.length;B++){var A=C[B],F=w(p[A]);F&&(v&&(v+=","),v+=JSON.stringify(A)+":"+F)}return q.splice(z,1),"{"+v+"}"}}(e)}},{}],yhC1:[function(t,G,K){G.exports=function(e,l,f){function d(wa){wa=wa.rules;for(var Na=0;Na<wa.length;Na++)if(m(wa[Na]))return!0}function m(wa){var Na;if(!(Na=void 0!==e.schema[wa.keyword])&&(Na=wa.implements))a:{wa=
wa.implements;for(Na=0;Na<wa.length;Na++)if(void 0!==e.schema[wa[Na]]){Na=!0;break a}Na=void 0}return Na}l="";f=!0===e.schema.$async;var q=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),n=e.self._getId(e.schema);if(e.opts.strictKeywords){var p=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(p){p="unknown keyword: "+p;if("log"!==e.opts.strictKeywords)throw Error(p);e.logger.warn(p)}}if(e.isTop&&(l+=" var validate = ",f&&(e.async=!0,l+="async "),l+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",
n&&(e.opts.sourceCode||e.opts.processCode)&&(l+=" /*# sourceURL="+n+" */ ")),"boolean"==typeof e.schema||!q&&!e.schema.$ref){p=e.level;var w=e.dataLevel,B=e.schema["false schema"],v=e.schemaPath+e.util.getProperty("false schema"),z=e.errSchemaPath+"/false schema";n=!e.opts.allErrors;var C="data"+(w||""),A="valid"+p;!1===e.schema?(e.isTop?n=!0:l+=" var "+A+" = false; ",(Ba=Ba||[]).push(l),l="",!1!==e.createErrors?(l+=" { keyword: 'false schema' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+
e.util.toQuotedString(z)+" , params: {} ",!1!==e.opts.messages&&(l+=" , message: 'boolean schema is false' "),e.opts.verbose&&(l+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+C+" "),l+=" } "):l+=" {} ",v=l,l=Ba.pop(),!e.compositeRule&&n?e.async?l+=" throw new ValidationError(["+v+"]); ":l+=" validate.errors = ["+v+"]; return false; ":l+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "):e.isTop?l+=f?" return data; ":" validate.errors = null; return true; ":
l+=" var "+A+" = true; ";return e.isTop&&(l+=" }; return validate; "),l}if(e.isTop){var F=e.isTop;p=e.level=0;w=e.dataLevel=0;C="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],void 0!==e.schema.default&&e.opts.useDefaults&&e.opts.strictDefaults){z="default is ignored in the schema root";if("log"!==e.opts.strictDefaults)throw Error(z);e.logger.warn(z)}l+=" var vErrors = null;  var errors = 0;      if (rootData === undefined) rootData = data; "}else{p=
e.level;C="data"+((w=e.dataLevel)||"");if(n&&(e.baseId=e.resolve.url(e.baseId,n)),f&&!e.async)throw Error("async schema in sync schema");l+=" var errs_"+p+" = errors;"}A="valid"+p;n=!e.opts.allErrors;var E="",M="",J=e.schema.type,X=Array.isArray(J);if(J&&e.opts.nullable&&!0===e.schema.nullable&&(X?-1==J.indexOf("null")&&(J=J.concat("null")):"null"!=J&&(J=[J,"null"],X=!0)),X&&1==J.length&&(J=J[0],X=!1),e.schema.$ref&&q){if("fail"==e.opts.extendRefs)throw Error('$ref: validation keywords used in schema at path "'+
e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(q=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(l+=" "+e.RULES.all.$comment.code(e,"$comment")),J){if(e.opts.coerceTypes)var ja=e.util.coerceToTypes(e.opts.coerceTypes,J);v=e.RULES.types[J];if(ja||X||!0===v||v&&!d(v)){v=e.schemaPath+".type";z=e.errSchemaPath+"/type";v=e.schemaPath+".type";z=e.errSchemaPath+"/type";if(l+=" if ("+e.util[X?"checkDataTypes":
"checkDataType"](J,C,e.opts.strictNumbers,!0)+") { ",ja){var S="dataType"+p,W="coerced"+p;l+=" var "+S+" = typeof "+C+"; var "+W+" = undefined; ";"array"==e.opts.coerceTypes&&(l+=" if ("+S+" == 'object' && Array.isArray("+C+") && "+C+".length == 1) { "+C+" = "+C+"[0]; "+S+" = typeof "+C+"; if ("+e.util.checkDataType(e.schema.type,C,e.opts.strictNumbers)+") "+W+" = "+C+"; } ");l+=" if ("+W+" !== undefined) ; ";var la=ja;if(la){var qa;B=-1;for(var Pa=la.length-1;B<Pa;)"string"==(qa=la[B+=1])?l+=" else if ("+
S+" == 'number' || "+S+" == 'boolean') "+W+" = '' + "+C+"; else if ("+C+" === null) "+W+" = ''; ":"number"==qa||"integer"==qa?(l+=" else if ("+S+" == 'boolean' || "+C+" === null || ("+S+" == 'string' && "+C+" && "+C+" == +"+C+" ","integer"==qa&&(l+=" && !("+C+" % 1)"),l+=")) "+W+" = +"+C+"; "):"boolean"==qa?l+=" else if ("+C+" === 'false' || "+C+" === 0 || "+C+" === null) "+W+" = false; else if ("+C+" === 'true' || "+C+" === 1) "+W+" = true; ":"null"==qa?l+=" else if ("+C+" === '' || "+C+" === 0 || "+
C+" === false) "+W+" = null; ":"array"==e.opts.coerceTypes&&"array"==qa&&(l+=" else if ("+S+" == 'string' || "+S+" == 'number' || "+S+" == 'boolean' || "+C+" == null) "+W+" = ["+C+"]; ")}(Ba=Ba||[]).push(l+" else {   ");l="";!1!==e.createErrors?(l+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(z)+" , params: { type: '",l+=X?""+J.join(","):""+J,l+="' } ",!1!==e.opts.messages&&(l+=" , message: 'should be ",l+=X?""+J.join(","):""+J,l+="' "),
e.opts.verbose&&(l+=" , schema: validate.schema"+v+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+C+" "),l+=" } "):l+=" {} ";v=l;l=Ba.pop();!e.compositeRule&&n?e.async?l+=" throw new ValidationError(["+v+"]); ":l+=" validate.errors = ["+v+"]; return false; ":l+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";v=w?"data"+(w-1||""):"parentData";l=l+(" } if ("+W+" !== undefined) {   ")+(C+" = "+W+"; ");w||(l+="if ("+v+" !== undefined)");l+=" "+
v+"["+(w?e.dataPathArr[w]:"parentDataProperty")+"] = "+W+"; } "}else(Ba=Ba||[]).push(l),l="",!1!==e.createErrors?(l+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(z)+" , params: { type: '",l+=X?""+J.join(","):""+J,l+="' } ",!1!==e.opts.messages&&(l+=" , message: 'should be ",l+=X?""+J.join(","):""+J,l+="' "),e.opts.verbose&&(l+=" , schema: validate.schema"+v+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+C+" "),l+=" } "):l+=" {} ",
v=l,l=Ba.pop(),!e.compositeRule&&n?e.async?l+=" throw new ValidationError(["+v+"]); ":l+=" validate.errors = ["+v+"]; return false; ":l+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";l+=" } "}}if(e.schema.$ref&&!q)l+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",n&&(l+=" } if (errors === ",l+=F?"0":"errs_"+p,l+=") { ",M+="}");else if(q=e.RULES)for(qa=-1,w=q.length-1;qa<w;)if(d(v=q[qa+=1])){if(v.type&&(l+=" if ("+e.util.checkDataType(v.type,C,e.opts.strictNumbers)+
") { "),e.opts.useDefaults)if("object"==v.type&&e.schema.properties){if(B=e.schema.properties,S=Object.keys(B))for(la=-1,Pa=S.length-1;la<Pa;)if(void 0!==(z=B[W=S[la+=1]]).default)if(W=C+e.util.getProperty(W),e.compositeRule){if(e.opts.strictDefaults){z="default is ignored for: "+W;if("log"!==e.opts.strictDefaults)throw Error(z);e.logger.warn(z)}}else l+=" if ("+W+" === undefined ","empty"==e.opts.useDefaults&&(l+=" || "+W+" === null || "+W+" === '' "),l+=" ) "+W+" = ","shared"==e.opts.useDefaults?
l+=" "+e.useDefault(z.default)+" ":l+=" "+JSON.stringify(z.default)+" ",l+="; "}else if("array"==v.type&&Array.isArray(e.schema.items)&&(S=e.schema.items))for(B=-1,la=S.length-1;B<la;)if(void 0!==(z=S[B+=1]).default)if(W=C+"["+B+"]",e.compositeRule){if(e.opts.strictDefaults){z="default is ignored for: "+W;if("log"!==e.opts.strictDefaults)throw Error(z);e.logger.warn(z)}}else l+=" if ("+W+" === undefined ","empty"==e.opts.useDefaults&&(l+=" || "+W+" === null || "+W+" === '' "),l+=" ) "+W+" = ","shared"==
e.opts.useDefaults?l+=" "+e.useDefault(z.default)+" ":l+=" "+JSON.stringify(z.default)+" ",l+="; ";if(B=v.rules)for(z=-1,W=B.length-1;z<W;)m(S=B[z+=1])&&(S=S.code(e,S.keyword,v.type))&&(l+=" "+S+" ",n&&(E+="}"));if(n&&(l+=" "+E+" ",E=""),v.type&&(l+=" } ",J&&J===v.type&&!ja)){l+=" else { ";var Ba;v=e.schemaPath+".type";z=e.errSchemaPath+"/type";(Ba=Ba||[]).push(l);l="";!1!==e.createErrors?(l+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(z)+
" , params: { type: '",l+=X?""+J.join(","):""+J,l+="' } ",!1!==e.opts.messages&&(l+=" , message: 'should be ",l+=X?""+J.join(","):""+J,l+="' "),e.opts.verbose&&(l+=" , schema: validate.schema"+v+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+C+" "),l+=" } "):l+=" {} ";v=l;l=Ba.pop();!e.compositeRule&&n?e.async?l+=" throw new ValidationError(["+v+"]); ":l+=" validate.errors = ["+v+"]; return false; ":l+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";
l+=" } "}n&&(l+=" if (errors === ",l+=F?"0":"errs_"+p,l+=") { ",M+="}")}return n&&(l+=" "+M+" "),F?(f?(l+=" if (errors === 0) return data;           ",l+=" else throw new ValidationError(vErrors); "):(l+=" validate.errors = vErrors; ",l+=" return errors === 0;       "),l+=" }; return validate;"):l+=" var "+A+" = errors === errs_"+p+";",l}},{}],qdYs:[function(t,G,K){function e(J,X,ja,S){function W(va,H,sa,Ra){var Xa=!H||H&&H.schema==va;if(H.schema!=X.schema)return e.call(Sa,va,H,sa,Ra);sa=!0===va.$async;
Ra=A({isTop:!0,schema:va,isRoot:Xa,baseId:Ra,root:H,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:z.MissingRef,RULES:P,validate:A,util:v,resolve:B,resolveRef:la,usePattern:Ba,useDefault:wa,useCustomRule:Na,opts:Aa,formats:Fa,logger:Sa.logger,self:Sa});Ra=w(ya,n)+w(D,m)+w(Z,q)+w(Ja,p)+Ra;Aa.processCode&&(Ra=Aa.processCode(Ra,va));try{var rb=(new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",Ra))(Sa,P,Fa,X,ya,Z,Ja,
E,F,M);ya[0]=rb}catch(Bb){throw Sa.logger.error("Error compiling schema, function code:",Ra),Bb;}return rb.schema=va,rb.errors=null,rb.refs=x,rb.refVal=ya,rb.root=Xa?rb:H,sa&&(rb.$async=!0),!0===Aa.sourceCode&&(rb.source={code:Ra,patterns:D,defaults:Z}),rb}function la(va,H,sa){H=B.url(va,H);var Ra,Xa=x[H];if(void 0!==Xa)return Pa(ya[Xa],"refVal["+Xa+"]");if(!sa&&X.refs&&(sa=X.refs[H],void 0!==sa))return Pa(Ra=X.refVal[sa],qa(H,Ra));Ra=qa(H);sa=B.call(Sa,W,X,H);void 0===sa&&(Xa=ja&&ja[H])&&(sa=B.inlineRef(Xa,
Aa.inlineRefs)?Xa:e.call(Sa,Xa,X,ja,va));if(void 0!==sa)return ya[x[H]]=sa,Pa(sa,Ra);delete x[H];!0}function qa(va,H){var sa=ya.length;return ya[sa]=H,x[va]=sa,"refVal"+sa}function Pa(va,H){return"object"==typeof va||"boolean"==typeof va?{code:H,schema:va,inline:!0}:{code:H,$async:va&&!!va.$async}}function Ba(va){var H=L[va];return void 0===H&&(H=L[va]=D.length,D[H]=va),"pattern"+H}function wa(va){switch(typeof va){case "boolean":case "number":return""+va;case "string":return v.toQuotedString(va);
case "object":if(null===va)return"null";var H=C(va),sa=pa[H];return void 0===sa&&(sa=pa[H]=Z.length,Z[sa]=va),"default"+sa}}function Na(va,H,sa,Ra){if(!1!==Sa._opts.validateSchema){var Xa=va.definition.dependencies;if(Xa&&!Xa.every(function(ob){return Object.prototype.hasOwnProperty.call(sa,ob)}))throw Error("parent schema must have all required keywords: "+Xa.join(","));if((Xa=va.definition.validateSchema)&&!Xa(H)){Xa="keyword schema is invalid: "+Sa.errorsText(Xa.errors);if("log"!=Sa._opts.validateSchema)throw Error(Xa);
Sa.logger.error(Xa)}}Xa=va.definition.compile;var rb=va.definition.inline,Bb=va.definition.macro;if(Xa)H=Xa.call(Sa,H,sa,Ra);else if(Bb)H=Bb.call(Sa,H,sa,Ra),!1!==Aa.validateSchema&&Sa.validateSchema(H,!0);else if(rb)H=rb.call(Sa,Ra,va.keyword,H,sa);else if(!(H=va.definition.validate))return;if(void 0===H)throw Error('custom keyword "'+va.keyword+'"failed to compile');va=Ja.length;return Ja[va]=H,{code:"customRule"+va,validate:H}}var Sa=this,Aa=this._opts,ya=[void 0],x={},D=[],L={},Z=[],pa={},Ja=
[];X=X||{schema:J,refVal:ya,refs:x};var ea=l.call(this,J,X,S),ra=this._compilations[ea.index];if(ea.compiling)return ra.callValidate=function H(){var sa=ra.validate,Ra=sa.apply(this,arguments);H.errors=sa.errors;return Ra};var Fa=this._formats,P=this.RULES;try{var Ia=W(J,X,ja,S);ra.validate=Ia;var ha=ra.callValidate;return ha&&(ha.schema=Ia.schema,ha.errors=null,ha.refs=Ia.refs,ha.refVal=Ia.refVal,ha.root=Ia.root,ha.$async=Ia.$async,Aa.sourceCode&&(ha.source=Ia.source)),Ia}finally{f.call(this,J,X,
S)}}function l(J,X,ja){var S=d.call(this,J,X,ja);return 0<=S?{index:S,compiling:!0}:(S=this._compilations.length,this._compilations[S]={schema:J,root:X,baseId:ja},{index:S,compiling:!1})}function f(J,X,ja){J=d.call(this,J,X,ja);0<=J&&this._compilations.splice(J,1)}function d(J,X,ja){for(var S=0;S<this._compilations.length;S++){var W=this._compilations[S];if(W.schema==J&&W.root==X&&W.baseId==ja)return S}return-1}function m(J,X){return"var pattern"+J+" = new RegExp("+v.toQuotedString(X[J])+");"}function q(J){return"var default"+
J+" = defaults["+J+"];"}function n(J,X){return void 0===X[J]?"":"var refVal"+J+" = refVal["+J+"];"}function p(J){return"var customRule"+J+" = customRules["+J+"];"}function w(J,X){if(!J.length)return"";for(var ja="",S=0;S<J.length;S++)ja+=X(S,J);return ja}var B=t("./resolve"),v=t("./util"),z=t("./error_classes"),C=t("fast-json-stable-stringify"),A=t("../dotjs/validate"),F=v.ucs2length,E=t("fast-deep-equal"),M=z.Validation;G.exports=e},{"./resolve":"w10T","./util":"Q1F7","./error_classes":"OtNE","fast-json-stable-stringify":"Xb3N",
"../dotjs/validate":"yhC1","fast-deep-equal":"dPQH"}],fXCy:[function(t,G,K){t=G.exports=function(){this._cache={}};t.prototype.put=function(e,l){this._cache[e]=l};t.prototype.get=function(e){return this._cache[e]};t.prototype.del=function(e){delete this._cache[e]};t.prototype.clear=function(){this._cache={}}},{}],dfAH:[function(t,G,K){function e(J){return J="full"==J?"full":"fast",m.copy(e[J])}function l(J){var X=J.match(q);if(!X)return!1;J=+X[1];var ja=+X[2];X=+X[3];return 1<=ja&&12>=ja&&1<=X&&X<=
(2!=ja||0!=J%4||0==J%100&&0!=J%400?n[ja]:29)}function f(J,X){var ja=J.match(p);if(!ja)return!1;J=ja[1];var S=ja[2],W=ja[3];ja=ja[5];return(23>=J&&59>=S&&59>=W||23==J&&59==S&&60==W)&&(!X||ja)}function d(J){if(M.test(J))return!1;try{return new RegExp(J),!0}catch(X){return!1}}var m=t("./util"),q=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,n=[0,31,28,31,30,31,30,31,31,30,31,30,31],p=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;t=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i;
var w=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;
K=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i;var B=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,
v=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,z=/^(?:\/(?:[^~/]|~0|~1)*)*$/,C=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,A=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;G.exports=e;e.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,
"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":K,url:B,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:t,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,
regex:d,uuid:v,"json-pointer":z,"json-pointer-uri-fragment":C,"relative-json-pointer":A};e.full={date:l,time:f,"date-time":function(J){J=J.split(F);return 2==J.length&&l(J[0])&&f(J[1],!0)},uri:function(J){return E.test(J)&&w.test(J)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,
"uri-template":K,url:B,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:t,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,
regex:d,uuid:v,"json-pointer":z,"json-pointer-uri-fragment":C,"relative-json-pointer":A};var F=/t|\s/i,E=/\/|:/,M=/[^\\]\\Z/},{"./util":"Q1F7"}],a2na:[function(t,G,K){G.exports=function(e,l,f){var d,m;f=" ";var q=e.dataLevel,n=e.schema[l],p=e.errSchemaPath+"/"+l;l=!e.opts.allErrors;var w="data"+(q||""),B="valid"+e.level;if("#"==n||"#/"==n)e.isRoot?(d=e.async,m="validate"):(d=!0===e.root.schema.$async,m="root.refVal[0]");else{var v=e.resolveRef(e.baseId,n,e.isRoot);if(void 0===v)if(v=e.MissingRefError.message(e.baseId,
n),"fail"==e.opts.missingRefs)e.logger.error(v),(C=C||[]).push(f),f="",!1!==e.createErrors?(f+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { ref: '"+e.util.escapeQuotes(n)+"' } ",!1!==e.opts.messages&&(f+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(n)+"' "),e.opts.verbose&&(f+=" , schema: "+e.util.toQuotedString(n)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),f+=" } "):f+=" {} ",n=f,
f=C.pop(),!e.compositeRule&&l?e.async?f+=" throw new ValidationError(["+n+"]); ":f+=" validate.errors = ["+n+"]; return false; ":f+=" var err = "+n+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(f+=" if (false) { ");else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,n,v);e.logger.warn(v);l&&(f+=" if (true) { ")}else if(v.inline){p=e.util.copy(e);p.level++;var z="valid"+p.level;p.schema=v.schema;p.schemaPath="";p.errSchemaPath=n;f+=" "+e.validate(p).replace(/validate\.schema/g,
v.code)+" ";l&&(f+=" if ("+z+") { ")}else d=!0===v.$async||e.async&&!1!==v.$async,m=v.code}if(m){var C;(C=C||[]).push(f);f="";e.opts.passContext?f+=" "+m+".call(this, ":f+=" "+m+"( ";f+=" "+w+", (dataPath || '')";'""'!=e.errorPath&&(f+=" + "+e.errorPath);q=f+(" , "+(q?"data"+(q-1||""):"parentData")+" , "+(q?e.dataPathArr[q]:"parentDataProperty")+", rootData)  ");if(f=C.pop(),d){if(!e.async)throw Error("async schema referenced by sync schema");l&&(f+=" var "+B+"; ");f+=" try { await "+q+"; ";l&&(f+=
" "+B+" = true; ");f+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ";l&&(f+=" "+B+" = false; ");f+=" } ";l&&(f+=" if ("+B+") { ")}else f+=" if (!"+q+") { if (vErrors === null) vErrors = "+m+".errors; else vErrors = vErrors.concat("+m+".errors); errors = vErrors.length; } ",l&&(f+=" else { ")}return f}},{}],hRgn:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.schema[l],
m=e.schemaPath+e.util.getProperty(l);l=e.errSchemaPath+"/"+l;var q=!e.opts.allErrors,n=e.util.copy(e),p="";n.level++;var w="valid"+n.level,B=n.baseId,v=!0;if(d)for(var z,C=-1,A=d.length-1;C<A;)z=d[C+=1],(e.opts.strictKeywords?"object"==typeof z&&0<Object.keys(z).length||!1===z:e.util.schemaHasRules(z,e.RULES.all))&&(v=!1,n.schema=z,n.schemaPath=m+"["+C+"]",n.errSchemaPath=l+"/"+C,f+="  "+e.validate(n)+" ",n.baseId=B,q&&(f+=" if ("+w+") { ",p+="}"));return q&&(f+=v?" if (true) { ":" "+p.slice(0,-1)+
" "),f}},{}],lo6J:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l);l=e.errSchemaPath+"/"+l;var p=!e.opts.allErrors;m="data"+(m||"");var w="valid"+d;d="errs__"+d;var B=e.util.copy(e),v="";B.level++;var z="valid"+B.level;if(q.every(function(J){return e.opts.strictKeywords?"object"==typeof J&&0<Object.keys(J).length||!1===J:e.util.schemaHasRules(J,e.RULES.all)})){var C=B.baseId;f+=" var "+d+" = errors; var "+w+" = false;  ";
var A=e.compositeRule;e.compositeRule=B.compositeRule=!0;if(q)for(var F,E=-1,M=q.length-1;E<M;)F=q[E+=1],B.schema=F,B.schemaPath=n+"["+E+"]",B.errSchemaPath=l+"/"+E,f+="  "+e.validate(B)+" ",B.baseId=C,f+=" "+w+" = "+w+" || "+z+"; if (!"+w+") { ",v+="}";e.compositeRule=B.compositeRule=A;f+=" "+v+" if (!"+w+") {   var err =   ";!1!==e.createErrors?(f+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&
(f+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";!e.compositeRule&&p&&(e.async?f+=" throw new ValidationError(vErrors); ":f+=" validate.errors = vErrors; return false; ");f+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ";
e.opts.allErrors&&(f+=" } ")}else p&&(f+=" if (true) { ");return f}},{}],Kkzr:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.schema[l];l=e.errSchemaPath+"/"+l;d=(e.opts.allErrors,e.util.toQuotedString(d));return!0===e.opts.$comment?f+=" console.log("+d+");":"function"==typeof e.opts.$comment&&(f+=" self._opts.$comment("+d+", "+e.util.toQuotedString(l)+", validate.root.schema);"),f}},{}],U4sD:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+
e.util.getProperty(l),p=e.errSchemaPath+"/"+l;l=!e.opts.allErrors;var w="data"+(m||""),B="valid"+d,v=e.opts.$data&&q&&q.$data;v&&(f+=" var schema"+d+" = "+e.util.getData(q.$data,m,e.dataPathArr)+"; ");v||(f+=" var schema"+d+" = validate.schema"+n+";");var z=z||[];z.push(f+("var "+B+" = equal("+w+", schema"+d+"); if (!"+B+") {   "));f="";!1!==e.createErrors?(f+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { allowedValue: schema"+
d+" } ",!1!==e.opts.messages&&(f+=" , message: 'should be equal to constant' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),f+=" } "):f+=" {} ";d=f;return f=z.pop(),!e.compositeRule&&l?e.async?f+=" throw new ValidationError(["+d+"]); ":f+=" validate.errors = ["+d+"]; return false; ":f+=" var err = "+d+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+=" }",l&&(f+=" else { "),f}},{}],EypH:[function(t,
G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l),p=e.errSchemaPath+"/"+l;l=!e.opts.allErrors;var w="data"+(m||""),B="valid"+d;m="errs__"+d;var v=e.util.copy(e);v.level++;var z="valid"+v.level,C="i"+d,A=v.dataLevel=e.dataLevel+1,F="data"+A,E=e.baseId;d=e.opts.strictKeywords?"object"==typeof q&&0<Object.keys(q).length||!1===q:e.util.schemaHasRules(q,e.RULES.all);(f+="var "+m+" = errors;var "+B+";",d)?(B=e.compositeRule,e.compositeRule=
v.compositeRule=!0,v.schema=q,v.schemaPath=n,v.errSchemaPath=p,f+=" var "+z+" = false; for (var "+C+" = 0; "+C+" < "+w+".length; "+C+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,C,e.opts.jsonPointers,!0),q=w+"["+C+"]",v.dataPathArr[A]=C,C=e.validate(v),v.baseId=E,2>e.util.varOccurences(C,F)?f+=" "+e.util.varReplace(C,F,q)+" ":f+=" var "+F+" = "+q+"; "+C+" ",e.compositeRule=v.compositeRule=B,f=f+(" if ("+z+") break; }    if (!")+(z+") {")):f+=" if ("+w+".length == 0) {";var M=M||[];M.push(f);
f="";!1!==e.createErrors?(f+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: {} ",!1!==e.opts.messages&&(f+=" , message: 'should contain a valid item' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),f+=" } "):f+=" {} ";n=f;return f=M.pop(),!e.compositeRule&&l?e.async?f+=" throw new ValidationError(["+n+"]); ":f+=" validate.errors = ["+n+"]; return false; ":
f+=" var err = "+n+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+=" } else { ",d&&(f+="  errors = "+m+"; if (vErrors !== null) { if ("+m+") vErrors.length = "+m+"; else vErrors = null; } "),e.opts.allErrors&&(f+=" } "),f}},{}],Cpp7:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l);l=e.errSchemaPath+"/"+l;var p=!e.opts.allErrors;m="data"+(m||"");var w="errs__"+d,B=e.util.copy(e),v="";B.level++;
var z="valid"+B.level,C={},A={},F=e.opts.ownProperties;for(J in q)if("__proto__"!=J){var E=q[J],M=Array.isArray(E)?A:C;M[J]=E}f+="var "+w+" = errors;";q=e.errorPath;for(var J in f+="var missing"+d+";",A)if((M=A[J]).length){if(f+=" if ( "+m+e.util.getProperty(J)+" !== undefined ",F&&(f+=" && Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(J)+"') "),p){f+=" && ( ";var X=M;if(X)for(var ja=-1,S=X.length-1;ja<S;)E=X[ja+=1],ja&&(f+=" || "),f+=" ( ( "+(m+(qa=e.util.getProperty(E)))+" === undefined ",
F&&(f+=" || ! Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(E)+"') "),f+=") && (missing"+d+" = "+e.util.toQuotedString(e.opts.jsonPointers?E:qa)+") ) ";f+=")) {  ";E="missing"+d;X="' + "+E+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(q,E,!0):q+" + "+E);var W=W||[];W.push(f);f="";!1!==e.createErrors?(f+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+
e.util.escapeQuotes(J)+"', missingProperty: '"+X+"', depsCount: "+M.length+", deps: '"+e.util.escapeQuotes(1==M.length?M[0]:M.join(", "))+"' } ",!1!==e.opts.messages&&(f+=" , message: 'should have ",1==M.length?f+="property "+e.util.escapeQuotes(M[0]):f+="properties "+e.util.escapeQuotes(M.join(", ")),f+=" when property "+e.util.escapeQuotes(J)+" is present' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";
M=f;f=W.pop();!e.compositeRule&&p?e.async?f+=" throw new ValidationError(["+M+"]); ":f+=" validate.errors = ["+M+"]; return false; ":f+=" var err = "+M+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else if(f+=" ) { ",ja=M){S=-1;for(var la=ja.length-1;S<la;){E=ja[S+=1];var qa=e.util.getProperty(E),Pa=(X=e.util.escapeQuotes(E),m+qa);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(q,E,e.opts.jsonPointers));f+=" if ( "+Pa+" === undefined ";F&&(f+=" || ! Object.prototype.hasOwnProperty.call("+
m+", '"+e.util.escapeQuotes(E)+"') ");f+=") {  var err =   ";!1!==e.createErrors?(f+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(J)+"', missingProperty: '"+X+"', depsCount: "+M.length+", deps: '"+e.util.escapeQuotes(1==M.length?M[0]:M.join(", "))+"' } ",!1!==e.opts.messages&&(f+=" , message: 'should have ",1==M.length?f+="property "+e.util.escapeQuotes(M[0]):f+="properties "+e.util.escapeQuotes(M.join(", ")),
f+=" when property "+e.util.escapeQuotes(J)+" is present' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}f+=" }   ";p&&(v+="}",f+=" else { ")}e.errorPath=q;W=B.baseId;for(J in C)E=C[J],(e.opts.strictKeywords?"object"==typeof E&&0<Object.keys(E).length||!1===E:e.util.schemaHasRules(E,e.RULES.all))&&(f+=" "+z+" = true; if ( "+
m+e.util.getProperty(J)+" !== undefined ",F&&(f+=" && Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(J)+"') "),f+=") { ",B.schema=E,B.schemaPath=n+e.util.getProperty(J),B.errSchemaPath=l+"/"+e.util.escapeFragment(J),f+="  "+e.validate(B)+" ",B.baseId=W,f+=" }  ",p&&(f+=" if ("+z+") { ",v+="}"));return p&&(f+="   "+v+" if ("+w+" == errors) {"),f}},{}],fqDY:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l),
p=e.errSchemaPath+"/"+l;l=!e.opts.allErrors;var w="data"+(m||""),B="valid"+d,v=e.opts.$data&&q&&q.$data;v&&(f+=" var schema"+d+" = "+e.util.getData(q.$data,m,e.dataPathArr)+"; ");m="i"+d;q="schema"+d;v||(f+=" var "+q+" = validate.schema"+n+";");f+="var "+B+";";v&&(f+=" if (schema"+d+" === undefined) "+B+" = true; else if (!Array.isArray(schema"+d+")) "+B+" = false; else {");f+=B+" = false;for (var "+m+"=0; "+m+"<"+q+".length; "+m+"++) if (equal("+w+", "+q+"["+m+"])) { "+B+" = true; break; }";v&&(f+=
"  }  ");var z=z||[];z.push(f+(" if (!"+B+") {   "));f="";!1!==e.createErrors?(f+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { allowedValues: schema"+d+" } ",!1!==e.opts.messages&&(f+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),f+=" } "):f+=" {} ";d=f;return f=z.pop(),!e.compositeRule&&
l?e.async?f+=" throw new ValidationError(["+d+"]); ":f+=" validate.errors = ["+d+"]; return false; ":f+=" var err = "+d+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+=" }",l&&(f+=" else { "),f}},{}],avoW:[function(t,G,K){G.exports=function(e,l,f){var d=" ",m=e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+"/"+l;l=!e.opts.allErrors;var B="data"+(q||"");if(!1===e.opts.format)return l&&(d+=" if (true) { "),d;var v,z=e.opts.$data&&
n&&n.$data;z?(d+=" var schema"+m+" = "+e.util.getData(n.$data,q,e.dataPathArr)+"; ",v="schema"+m):v=n;q=e.opts.unknownFormats;var C=Array.isArray(q);if(z)d+=" var "+(A="format"+m)+" = formats["+v+"]; var "+(F="isObject"+m)+" = typeof "+A+" == 'object' && !("+A+" instanceof RegExp) && "+A+".validate; var "+(E="formatType"+m)+" = "+F+" && "+A+".type || 'string'; if ("+F+") { ",e.async&&(d+=" var async"+m+" = "+A+".async; "),d+=" "+A+" = "+A+".validate; } if (  ",z&&(d+=" ("+v+" !== undefined && typeof "+
v+" != 'string') || "),d+=" (","ignore"!=q&&(d+=" ("+v+" && !"+A+" ",C&&(d+=" && self._opts.unknownFormats.indexOf("+v+") == -1 "),d+=") || "),d+=" ("+A+" && "+E+" == '"+f+"' && !(typeof "+A+" == 'function' ? ",e.async?d+=" (async"+m+" ? await "+A+"("+B+") : "+A+"("+B+")) ":d+=" "+A+"("+B+") ",d+=" : "+A+".test("+B+"))))) {";else{var A;if(!(A=e.formats[n])){if("ignore"==q)return e.logger.warn('unknown format "'+n+'" ignored in schema at path "'+e.errSchemaPath+'"'),l&&(d+=" if (true) { "),d;if(C&&
0<=q.indexOf(n))return l&&(d+=" if (true) { "),d;throw Error('unknown format "'+n+'" is used in schema at path "'+e.errSchemaPath+'"');}var F,E=(F="object"==typeof A&&!(A instanceof RegExp)&&A.validate)&&A.type||"string";if(F){var M=!0===A.async;A=A.validate}if(E!=f)return l&&(d+=" if (true) { "),d;if(M){if(!e.async)throw Error("async format in sync schema");d+=" if (!(await formats"+(e.util.getProperty(n)+".validate(")+B+"))) { "}else d+=" if (! ",f="formats"+e.util.getProperty(n),F&&(f+=".validate"),
d=d+("function"==typeof A?" "+f+"("+B+") ":" "+f+".test("+B+") ")+") { "}var J=J||[];J.push(d);d="";!1!==e.createErrors?(d+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { format:  ",d+=z?""+v:""+e.util.toQuotedString(n),d+="  } ",!1!==e.opts.messages&&(d+=" , message: 'should match format \"",d+=z?"' + "+v+" + '":""+e.util.escapeQuotes(n),d+="\"' "),e.opts.verbose&&(d+=" , schema:  ",d+=z?"validate.schema"+p:""+e.util.toQuotedString(n),
d+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+B+" "),d+=" } "):d+=" {} ";n=d;return d=J.pop(),!e.compositeRule&&l?e.async?d+=" throw new ValidationError(["+n+"]); ":d+=" validate.errors = ["+n+"]; return false; ":d+=" var err = "+n+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" } ",l&&(d+=" else { "),d}},{}],JHQ3:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l);
l=e.errSchemaPath+"/"+l;var p=!e.opts.allErrors;m="data"+(m||"");var w="valid"+d,B="errs__"+d,v=e.util.copy(e);v.level++;var z="valid"+v.level,C=e.schema.then,A=e.schema.else;C=void 0!==C&&(e.opts.strictKeywords?"object"==typeof C&&0<Object.keys(C).length||!1===C:e.util.schemaHasRules(C,e.RULES.all));A=void 0!==A&&(e.opts.strictKeywords?"object"==typeof A&&0<Object.keys(A).length||!1===A:e.util.schemaHasRules(A,e.RULES.all));var F=v.baseId;if(C||A){var E;v.createErrors=!1;v.schema=q;v.schemaPath=
n;v.errSchemaPath=l;q=e.compositeRule;e.compositeRule=v.compositeRule=!0;f=f+(" var "+B+" = errors; var "+w+" = true;    ")+(e.validate(v)+" ");v.baseId=F;v.createErrors=!0;f+="  errors = "+B+"; if (vErrors !== null) { if ("+B+") vErrors.length = "+B+"; else vErrors = null; }  ";e.compositeRule=v.compositeRule=q;C?(f+=" if ("+z+") {  ",v.schema=e.schema.then,v.schemaPath=e.schemaPath+".then",v.errSchemaPath=e.errSchemaPath+"/then",f+="  "+e.validate(v)+" ",v.baseId=F,f+=" "+w+" = "+z+"; ",C&&A?f+=
" var "+(E="ifClause"+d)+" = 'then'; ":E="'then'",f+=" } ",A&&(f+=" else { ")):f+=" if (!"+z+") { ";A&&(v.schema=e.schema.else,v.schemaPath=e.schemaPath+".else",v.errSchemaPath=e.errSchemaPath+"/else",f+="  "+e.validate(v)+" ",v.baseId=F,f+=" "+w+" = "+z+"; ",C&&A?f+=" var "+(E="ifClause"+d)+" = 'else'; ":E="'else'",f+=" } ");f+=" if (!"+w+") {   var err =   ";!1!==e.createErrors?(f+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { failingKeyword: "+
E+" } ",!1!==e.opts.messages&&(f+=" , message: 'should match \"' + "+E+" + '\" schema' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";!e.compositeRule&&p&&(e.async?f+=" throw new ValidationError(vErrors); ":f+=" validate.errors = vErrors; return false; ");f+=" }   ";p&&(f+=" else { ")}else p&&(f+=" if (true) { ");return f}},
{}],aiPb:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l),p=e.errSchemaPath+"/"+l;l=!e.opts.allErrors;m="data"+(m||"");var w="valid"+d,B="errs__"+d,v=e.util.copy(e),z="";v.level++;var C="valid"+v.level;d="i"+d;var A=v.dataLevel=e.dataLevel+1,F="data"+A,E=e.baseId;if(f+="var "+B+" = errors;var "+w+";",Array.isArray(q)){var M=e.schema.additionalItems;if(!1===M){f+=" "+w+" = "+m+".length <= "+q.length+"; ";var J=p;p=e.errSchemaPath+
"/additionalItems";var X=X||[];X.push(f+("  if (!"+w+") {   "));f="";!1!==e.createErrors?(f+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { limit: "+q.length+" } ",!1!==e.opts.messages&&(f+=" , message: 'should NOT have more than "+q.length+" items' "),e.opts.verbose&&(f+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";p=f;f=X.pop();!e.compositeRule&&l?e.async?
f+=" throw new ValidationError(["+p+"]); ":f+=" validate.errors = ["+p+"]; return false; ":f+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";f+=" } ";p=J;l&&(z+="}",f+=" else { ")}if(q){var ja;X=-1;for(w=q.length-1;X<w;)if(ja=q[X+=1],e.opts.strictKeywords?"object"==typeof ja&&0<Object.keys(ja).length||!1===ja:e.util.schemaHasRules(ja,e.RULES.all)){f+=" "+C+" = true; if ("+m+".length > "+X+") { ";J=m+"["+X+"]";v.schema=ja;v.schemaPath=n+"["+X+"]";v.errSchemaPath=
p+"/"+X;v.errorPath=e.util.getPathExpr(e.errorPath,X,e.opts.jsonPointers,!0);v.dataPathArr[A]=X;var S=e.validate(v);v.baseId=E;2>e.util.varOccurences(S,F)?f+=" "+e.util.varReplace(S,F,J)+" ":f+=" var "+F+" = "+J+"; "+S+" ";f+=" }  ";l&&(f+=" if ("+C+") { ",z+="}")}}"object"==typeof M&&(e.opts.strictKeywords?"object"==typeof M&&0<Object.keys(M).length||!1===M:e.util.schemaHasRules(M,e.RULES.all))&&(v.schema=M,v.schemaPath=e.schemaPath+".additionalItems",v.errSchemaPath=e.errSchemaPath+"/additionalItems",
f+=" "+C+" = true; if ("+m+".length > "+q.length+") {  for (var "+d+" = "+q.length+"; "+d+" < "+m+".length; "+d+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,d,e.opts.jsonPointers,!0),J=m+"["+d+"]",v.dataPathArr[A]=d,S=e.validate(v),v.baseId=E,2>e.util.varOccurences(S,F)?f+=" "+e.util.varReplace(S,F,J)+" ":f+=" var "+F+" = "+J+"; "+S+" ",l&&(f+=" if (!"+C+") break; "),f+=" } }  ",l&&(f+=" if ("+C+") { ",z+="}"))}else if(e.opts.strictKeywords?"object"==typeof q&&0<Object.keys(q).length||!1===
q:e.util.schemaHasRules(q,e.RULES.all))v.schema=q,v.schemaPath=n,v.errSchemaPath=p,f+="  for (var "+d+" = 0; "+d+" < "+m+".length; "+d+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,d,e.opts.jsonPointers,!0),J=m+"["+d+"]",v.dataPathArr[A]=d,S=e.validate(v),v.baseId=E,2>e.util.varOccurences(S,F)?f+=" "+e.util.varReplace(S,F,J)+" ":f+=" var "+F+" = "+J+"; "+S+" ",l&&(f+=" if (!"+C+") break; "),f+=" }";return l&&(f+=" "+z+" if ("+B+" == errors) {"),f}},{}],UJAl:[function(t,G,K){G.exports=function(e,
l,f){var d;f=" ";var m=e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+"/"+l,B=!e.opts.allErrors,v="data"+(q||""),z=e.opts.$data&&n&&n.$data;z?(f+=" var schema"+m+" = "+e.util.getData(n.$data,q,e.dataPathArr)+"; ",d="schema"+m):d=n;var C="maximum"==l,A=C?"exclusiveMaximum":"exclusiveMinimum",F=e.schema[A],E=e.opts.$data&&F&&F.$data,M=C?"<":">",J=C?">":"<",X=void 0;if(!z&&"number"!=typeof n&&void 0!==n)throw Error(l+" must be number");if(!E&&void 0!==F&&"number"!=
typeof F&&"boolean"!=typeof F)throw Error(A+" must be number or boolean");if(E){F=e.util.getData(F.$data,q,e.dataPathArr);var ja="exclusive"+m,S="exclType"+m;q="' + "+(C="op"+m)+" + '";f=f+(" var schemaExcl"+m+" = "+F+";  var ")+(ja+"; var "+S+" = typeof "+(F="schemaExcl"+m)+"; if ("+S+" != 'boolean' && "+S+" != 'undefined' && "+S+" != 'number') { ");var W;X=A;(W=W||[]).push(f);f="";!1!==e.createErrors?(f+=" { keyword: '"+(X||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+
e.util.toQuotedString(w)+" , params: {} ",!1!==e.opts.messages&&(f+=" , message: '"+A+" should be boolean' "),e.opts.verbose&&(f+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+v+" "),f+=" } "):f+=" {} ";var la=f;f=W.pop();!e.compositeRule&&B?e.async?f+=" throw new ValidationError(["+la+"]); ":f+=" validate.errors = ["+la+"]; return false; ":f+=" var err = "+la+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";f+=" } else if ( ";
z&&(f+=" ("+d+" !== undefined && typeof "+d+" != 'number') || ");f+=" "+S+" == 'number' ? ( ("+ja+" = "+d+" === undefined || "+F+" "+M+"= "+d+") ? "+v+" "+J+"= "+F+" : "+v+" "+J+" "+d+" ) : ( ("+ja+" = "+F+" === true) ? "+v+" "+J+"= "+d+" : "+v+" "+J+" "+d+" ) || "+v+" !== "+v+") { var op"+m+" = "+ja+" ? '"+M+"' : '"+M+"='; ";void 0===n&&(X=A,w=e.errSchemaPath+"/"+A,d=F,z=E)}else q=M,(m="number"==typeof F)&&z?(C="'"+q+"'",f+=" if ( ",z&&(f+=" ("+d+" !== undefined && typeof "+d+" != 'number') || "),
f+=" ( "+d+" === undefined || "+F+" "+M+"= "+d+" ? "+v+" "+J+"= "+F+" : "+v+" "+J+" "+d+" ) || "+v+" !== "+v+") { "):(m&&void 0===n?(ja=!0,X=A,w=e.errSchemaPath+"/"+A,d=F,J+="="):(m&&(d=Math[C?"min":"max"](F,n)),F===(!m||d)?(ja=!0,X=A,w=e.errSchemaPath+"/"+A,J+="="):(ja=!1,q+="=")),C="'"+q+"'",f+=" if ( ",z&&(f+=" ("+d+" !== undefined && typeof "+d+" != 'number') || "),f+=" "+v+" "+J+" "+d+" || "+v+" !== "+v+") { ");X=X||l;(W=W||[]).push(f);f="";!1!==e.createErrors?(f+=" { keyword: '"+(X||"_limit")+
"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { comparison: "+C+", limit: "+d+", exclusive: "+ja+" } ",!1!==e.opts.messages&&(f+=" , message: 'should be "+q+" ",f+=z?"' + "+d:d+"'"),e.opts.verbose&&(f+=" , schema:  ",f+=z?"validate.schema"+p:""+n,f+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+v+" "),f+=" } "):f+=" {} ";la=f;return f=W.pop(),!e.compositeRule&&B?e.async?f+=" throw new ValidationError(["+la+"]); ":f+=" validate.errors = ["+
la+"]; return false; ":f+=" var err = "+la+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+=" } ",B&&(f+=" else { "),f}},{}],W8ih:[function(t,G,K){G.exports=function(e,l,f){var d;f=" ";var m=e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+"/"+l,B=!e.opts.allErrors,v="data"+(q||""),z=e.opts.$data&&n&&n.$data;if(z?(f+=" var schema"+m+" = "+e.util.getData(n.$data,q,e.dataPathArr)+"; ",d="schema"+m):d=n,!z&&"number"!=typeof n)throw Error(l+
" must be number");f+="if ( ";z&&(f+=" ("+d+" !== undefined && typeof "+d+" != 'number') || ");var C=C||[];C.push(f+(" "+v+".length "+("maxItems"==l?">":"<")+" "+d+") { "));f="";!1!==e.createErrors?(f+=" { keyword: '"+(l||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { limit: "+d+" } ",!1!==e.opts.messages&&(f+=" , message: 'should NOT have ",f+="maxItems"==l?"more":"fewer",f+=" than ",f+=z?"' + "+d+" + '":""+n,f+=" items' "),
e.opts.verbose&&(f+=" , schema:  ",f+=z?"validate.schema"+p:""+n,f+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+v+" "),f+=" } "):f+=" {} ";l=f;return f=C.pop(),!e.compositeRule&&B?e.async?f+=" throw new ValidationError(["+l+"]); ":f+=" validate.errors = ["+l+"]; return false; ":f+=" var err = "+l+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+="} ",B&&(f+=" else { "),f}},{}],fZGX:[function(t,G,K){G.exports=function(e,l,f){var d;f=" ";var m=
e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+"/"+l,B=!e.opts.allErrors,v="data"+(q||""),z=e.opts.$data&&n&&n.$data;if(z?(f+=" var schema"+m+" = "+e.util.getData(n.$data,q,e.dataPathArr)+"; ",d="schema"+m):d=n,!z&&"number"!=typeof n)throw Error(l+" must be number");f+="if ( ";z&&(f+=" ("+d+" !== undefined && typeof "+d+" != 'number') || ");!1===e.opts.unicode?f+=" "+v+".length ":f+=" ucs2length("+v+") ";var C=C||[];C.push(f+(" "+("maxLength"==l?">":"<")+
" "+d+") { "));f="";!1!==e.createErrors?(f+=" { keyword: '"+(l||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { limit: "+d+" } ",!1!==e.opts.messages&&(f+=" , message: 'should NOT be ",f+="maxLength"==l?"longer":"shorter",f+=" than ",f+=z?"' + "+d+" + '":""+n,f+=" characters' "),e.opts.verbose&&(f+=" , schema:  ",f+=z?"validate.schema"+p:""+n,f+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+v+" "),f+=" } "):
f+=" {} ";l=f;return f=C.pop(),!e.compositeRule&&B?e.async?f+=" throw new ValidationError(["+l+"]); ":f+=" validate.errors = ["+l+"]; return false; ":f+=" var err = "+l+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+="} ",B&&(f+=" else { "),f}},{}],JAEr:[function(t,G,K){G.exports=function(e,l,f){var d;f=" ";var m=e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+"/"+l,B=!e.opts.allErrors,v="data"+(q||""),z=e.opts.$data&&n&&
n.$data;if(z?(f+=" var schema"+m+" = "+e.util.getData(n.$data,q,e.dataPathArr)+"; ",d="schema"+m):d=n,!z&&"number"!=typeof n)throw Error(l+" must be number");f+="if ( ";z&&(f+=" ("+d+" !== undefined && typeof "+d+" != 'number') || ");var C=C||[];C.push(f+(" Object.keys("+v+").length "+("maxProperties"==l?">":"<")+" "+d+") { "));f="";!1!==e.createErrors?(f+=" { keyword: '"+(l||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { limit: "+
d+" } ",!1!==e.opts.messages&&(f+=" , message: 'should NOT have ",f+="maxProperties"==l?"more":"fewer",f+=" than ",f+=z?"' + "+d+" + '":""+n,f+=" properties' "),e.opts.verbose&&(f+=" , schema:  ",f+=z?"validate.schema"+p:""+n,f+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+v+" "),f+=" } "):f+=" {} ";l=f;return f=C.pop(),!e.compositeRule&&B?e.async?f+=" throw new ValidationError(["+l+"]); ":f+=" validate.errors = ["+l+"]; return false; ":f+=" var err = "+l+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",
f+="} ",B&&(f+=" else { "),f}},{}],oNPH:[function(t,G,K){G.exports=function(e,l,f){var d;f=" ";var m=e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+"/"+l,B=!e.opts.allErrors,v="data"+(q||""),z=e.opts.$data&&n&&n.$data;if(z?(f+=" var schema"+m+" = "+e.util.getData(n.$data,q,e.dataPathArr)+"; ",d="schema"+m):d=n,!z&&"number"!=typeof n)throw Error(l+" must be number");f+="var division"+m+";if (";z&&(f+=" "+d+" !== undefined && ( typeof "+d+" != 'number' || ");
f+=" (division"+m+" = "+v+" / "+d+", ";e.opts.multipleOfPrecision?f+=" Math.abs(Math.round(division"+m+") - division"+m+") > 1e-"+e.opts.multipleOfPrecision+" ":f+=" division"+m+" !== parseInt(division"+m+") ";f+=" ) ";z&&(f+="  )  ");var C=C||[];C.push(f+" ) {   ");f="";!1!==e.createErrors?(f+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { multipleOf: "+d+" } ",!1!==e.opts.messages&&(f+=" , message: 'should be multiple of ",
f+=z?"' + "+d:d+"'"),e.opts.verbose&&(f+=" , schema:  ",f+=z?"validate.schema"+p:""+n,f+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+v+" "),f+=" } "):f+=" {} ";l=f;return f=C.pop(),!e.compositeRule&&B?e.async?f+=" throw new ValidationError(["+l+"]); ":f+=" validate.errors = ["+l+"]; return false; ":f+=" var err = "+l+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+="} ",B&&(f+=" else { "),f}},{}],mmjm:[function(t,G,K){G.exports=function(e,l,
f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l),p=e.errSchemaPath+"/"+l;l=!e.opts.allErrors;m="data"+(m||"");d="errs__"+d;var w=e.util.copy(e);w.level++;var B="valid"+w.level;if(e.opts.strictKeywords?"object"==typeof q&&0<Object.keys(q).length||!1===q:e.util.schemaHasRules(q,e.RULES.all)){w.schema=q;w.schemaPath=n;w.errSchemaPath=p;var v;q=e.compositeRule;e.compositeRule=w.compositeRule=!0;w.createErrors=!1;w.opts.allErrors&&(v=w.opts.allErrors,w.opts.allErrors=
!1);f=f+(" var "+d+" = errors;   ")+(e.validate(w)+" ");w.createErrors=!0;v&&(w.opts.allErrors=v);e.compositeRule=w.compositeRule=q;f+=" if ("+B+") {   ";var z=z||[];z.push(f);f="";!1!==e.createErrors?(f+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: {} ",!1!==e.opts.messages&&(f+=" , message: 'should NOT be valid' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+
m+" "),f+=" } "):f+=" {} ";v=f;f=z.pop();!e.compositeRule&&l?e.async?f+=" throw new ValidationError(["+v+"]); ":f+=" validate.errors = ["+v+"]; return false; ":f+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";f+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ";e.opts.allErrors&&(f+=" } ")}else f+="  var err =   ",!1!==e.createErrors?(f+=" { keyword: 'not' , dataPath: (dataPath || '') + "+
e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: {} ",!1!==e.opts.messages&&(f+=" , message: 'should NOT be valid' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ",f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(f+=" if (false) { ");return f}},{}],SSWF:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+
e.util.getProperty(l);l=e.errSchemaPath+"/"+l;var p=!e.opts.allErrors;m="data"+(m||"");var w="valid"+d,B="errs__"+d,v=e.util.copy(e),z="";v.level++;var C="valid"+v.level,A=v.baseId,F="prevValid"+d;d="passingSchemas"+d;f+="var "+B+" = errors , "+F+" = false , "+w+" = false , "+d+" = null; ";var E=e.compositeRule;e.compositeRule=v.compositeRule=!0;if(q)for(var M,J=-1,X=q.length-1;J<X;)M=q[J+=1],(e.opts.strictKeywords?"object"==typeof M&&0<Object.keys(M).length||!1===M:e.util.schemaHasRules(M,e.RULES.all))?
(v.schema=M,v.schemaPath=n+"["+J+"]",v.errSchemaPath=l+"/"+J,f+="  "+e.validate(v)+" ",v.baseId=A):f+=" var "+C+" = true; ",J&&(f+=" if ("+C+" && "+F+") { "+w+" = false; "+d+" = ["+d+", "+J+"]; } else { ",z+="}"),f+=" if ("+C+") { "+w+" = "+F+" = true; "+d+" = "+J+"; }";return e.compositeRule=v.compositeRule=E,f+=z+"if (!"+w+") {   var err =   ",!1!==e.createErrors?(f+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { passingSchemas: "+
d+" } ",!1!==e.opts.messages&&(f+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ",f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&p&&(e.async?f+=" throw new ValidationError(vErrors); ":f+=" validate.errors = vErrors; return false; "),f+="} else {  errors = "+B+"; if (vErrors !== null) { if ("+B+") vErrors.length = "+
B+"; else vErrors = null; }",e.opts.allErrors&&(f+=" } "),f}},{}],mGZS:[function(t,G,K){G.exports=function(e,l,f){var d;f=" ";var m=e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+"/"+l;l=!e.opts.allErrors;var B="data"+(q||""),v=e.opts.$data&&n&&n.$data;v?(f+=" var schema"+m+" = "+e.util.getData(n.$data,q,e.dataPathArr)+"; ",d="schema"+m):d=n;f+="if ( ";v&&(f+=" ("+d+" !== undefined && typeof "+d+" != 'string') || ");f+=" !"+(v?"(new RegExp("+d+"))":e.usePattern(n))+
".test("+B+") ) {   ";var z=z||[];z.push(f);f="";!1!==e.createErrors?(f+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { pattern:  ",f+=v?""+d:""+e.util.toQuotedString(n),f+="  } ",!1!==e.opts.messages&&(f+=" , message: 'should match pattern \"",f+=v?"' + "+d+" + '":""+e.util.escapeQuotes(n),f+="\"' "),e.opts.verbose&&(f+=" , schema:  ",f+=v?"validate.schema"+p:""+e.util.toQuotedString(n),f+="         , parentSchema: validate.schema"+
e.schemaPath+" , data: "+B+" "),f+=" } "):f+=" {} ";d=f;return f=z.pop(),!e.compositeRule&&l?e.async?f+=" throw new ValidationError(["+d+"]); ":f+=" validate.errors = ["+d+"]; return false; ":f+=" var err = "+d+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+="} ",l&&(f+=" else { "),f}},{}],jFnx:[function(t,G,K){G.exports=function(e,l,f){function d(L){return"__proto__"!==L}f=" ";var m=e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+
"/"+l;l=!e.opts.allErrors;q="data"+(q||"");var B="errs__"+m,v=e.util.copy(e),z="";v.level++;var C="valid"+v.level,A="key"+m,F="idx"+m,E=v.dataLevel=e.dataLevel+1,M="data"+E,J="dataProperties"+m,X=Object.keys(n||{}).filter(d),ja=e.schema.patternProperties||{},S=Object.keys(ja).filter(d),W=e.schema.additionalProperties,la=X.length||S.length,qa=!1===W,Pa="object"==typeof W&&Object.keys(W).length,Ba=e.opts.removeAdditional,wa=qa||Pa||Ba,Na=e.opts.ownProperties,Sa=e.baseId,Aa=e.schema.required;if(Aa&&
(!e.opts.$data||!Aa.$data)&&Aa.length<e.opts.loopRequired)var ya=e.util.toHash(Aa);if(f+="var "+B+" = errors;var "+C+" = true;",Na&&(f+=" var "+J+" = undefined;"),wa){if(f+=Na?" "+J+" = "+J+" || Object.keys("+q+"); for (var "+F+"=0; "+F+"<"+J+".length; "+F+"++) { var "+A+" = "+J+"["+F+"]; ":" for (var "+A+" in "+q+") { ",la){if(f+=" var isAdditional"+m+" = !(false ",X.length)if(8<X.length)f+=" || validate.schema"+p+".hasOwnProperty("+A+") ";else if(X){Aa=-1;for(var x=X.length-1;Aa<x;)wa=X[Aa+=1],
f+=" || "+A+" == "+e.util.toQuotedString(wa)+" "}if(S.length&&S)for(Aa=-1,x=S.length-1;Aa<x;)wa=S[Aa+=1],f+=" || "+e.usePattern(wa)+".test("+A+") ";f+=" ); if (isAdditional"+m+") { "}"all"==Ba?f+=" delete "+q+"["+A+"]; ":(m=e.errorPath,wa="' + "+A+" + '",(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,A,e.opts.jsonPointers)),qa)?Ba?f+=" delete "+q+"["+A+"]; ":(qa=w,w=e.errSchemaPath+"/additionalProperties",(D=D||[]).push(f+(" "+C+" = false; ")),f="",!1!==e.createErrors?
(f+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { additionalProperty: '"+wa+"' } ",!1!==e.opts.messages&&(f+=" , message: '",e.opts._errorDataPathProperty?f+="is an invalid additional property":f+="should NOT have additional properties",f+="' "),e.opts.verbose&&(f+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+q+" "),f+=" } "):f+=" {} ",w=f,f=D.pop(),!e.compositeRule&&l?e.async?
f+=" throw new ValidationError(["+w+"]); ":f+=" validate.errors = ["+w+"]; return false; ":f+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",w=qa,l&&(f+=" break; ")):Pa&&("failing"==Ba?(f+=" var "+B+" = errors;  ",wa=e.compositeRule,e.compositeRule=v.compositeRule=!0,v.schema=W,v.schemaPath=e.schemaPath+".additionalProperties",v.errSchemaPath=e.errSchemaPath+"/additionalProperties",v.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,
A,e.opts.jsonPointers),qa=q+"["+A+"]",v.dataPathArr[E]=A,W=e.validate(v),v.baseId=Sa,2>e.util.varOccurences(W,M)?f+=" "+e.util.varReplace(W,M,qa)+" ":f+=" var "+M+" = "+qa+"; "+W+" ",f+=" if (!"+C+") { errors = "+B+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+q+"["+A+"]; }  ",e.compositeRule=v.compositeRule=wa):(v.schema=W,v.schemaPath=e.schemaPath+".additionalProperties",v.errSchemaPath=e.errSchemaPath+"/additionalProperties",
v.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,A,e.opts.jsonPointers),qa=q+"["+A+"]",v.dataPathArr[E]=A,W=e.validate(v),v.baseId=Sa,2>e.util.varOccurences(W,M)?f+=" "+e.util.varReplace(W,M,qa)+" ":f+=" var "+M+" = "+qa+"; "+W+" ",l&&(f+=" if (!"+C+") break; "))),e.errorPath=m);la&&(f+=" } ");f+=" }  ";l&&(f+=" if ("+C+") { ",z+="}")}la=e.opts.useDefaults&&!e.compositeRule;if(X.length&&X)for(Pa=-1,Ba=X.length-1;Pa<Ba;){W=n[wa=X[Pa+=1]];if(e.opts.strictKeywords?
"object"==typeof W&&0<Object.keys(W).length||!1===W:e.util.schemaHasRules(W,e.RULES.all))if(Aa=e.util.getProperty(wa),m=(qa=q+Aa,la&&void 0!==W.default),v.schema=W,v.schemaPath=p+Aa,v.errSchemaPath=w+"/"+e.util.escapeFragment(wa),v.errorPath=e.util.getPath(e.errorPath,wa,e.opts.jsonPointers),v.dataPathArr[E]=e.util.toQuotedString(wa),W=e.validate(v),(v.baseId=Sa,2>e.util.varOccurences(W,M))?(W=e.util.varReplace(W,M,qa),Aa=qa):(Aa=M,f+=" var "+M+" = "+qa+"; "),m)f+=" "+W+" ";else{if(ya&&ya[wa]){f+=
" if ( "+Aa+" === undefined ";Na&&(f+=" || ! Object.prototype.hasOwnProperty.call("+q+", '"+e.util.escapeQuotes(wa)+"') ");f+=") { "+C+" = false; ";m=e.errorPath;qa=w;var D;Aa=e.util.escapeQuotes(wa);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(m,wa,e.opts.jsonPointers));w=e.errSchemaPath+"/required";(D=D||[]).push(f);f="";!1!==e.createErrors?(f+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { missingProperty: '"+
Aa+"' } ",!1!==e.opts.messages&&(f+=" , message: '",e.opts._errorDataPathProperty?f+="is a required property":f+="should have required property \\'"+Aa+"\\'",f+="' "),e.opts.verbose&&(f+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+q+" "),f+=" } "):f+=" {} ";w=f;f=D.pop();!e.compositeRule&&l?e.async?f+=" throw new ValidationError(["+w+"]); ":f+=" validate.errors = ["+w+"]; return false; ":f+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";
w=qa;e.errorPath=m;f+=" } else { "}else l?(f+=" if ( "+Aa+" === undefined ",Na&&(f+=" || ! Object.prototype.hasOwnProperty.call("+q+", '"+e.util.escapeQuotes(wa)+"') "),f+=") { "+C+" = true; } else { "):(f+=" if ("+Aa+" !== undefined ",Na&&(f+=" &&   Object.prototype.hasOwnProperty.call("+q+", '"+e.util.escapeQuotes(wa)+"') "),f+=" ) { ");f+=" "+W+" } "}l&&(f+=" if ("+C+") { ",z+="}")}if(S.length&&S)for(ya=-1,D=S.length-1;ya<D;)if(W=ja[wa=S[ya+=1]],e.opts.strictKeywords?"object"==typeof W&&0<Object.keys(W).length||
!1===W:e.util.schemaHasRules(W,e.RULES.all))v.schema=W,v.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(wa),v.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(wa),f+=Na?" "+J+" = "+J+" || Object.keys("+q+"); for (var "+F+"=0; "+F+"<"+J+".length; "+F+"++) { var "+A+" = "+J+"["+F+"]; ":" for (var "+A+" in "+q+") { ",f+=" if ("+e.usePattern(wa)+".test("+A+")) { ",v.errorPath=e.util.getPathExpr(e.errorPath,A,e.opts.jsonPointers),qa=q+"["+A+"]",v.dataPathArr[E]=
A,W=e.validate(v),v.baseId=Sa,2>e.util.varOccurences(W,M)?f+=" "+e.util.varReplace(W,M,qa)+" ":f+=" var "+M+" = "+qa+"; "+W+" ",l&&(f+=" if (!"+C+") break; "),f+=" } ",l&&(f+=" else "+C+" = true; "),f+=" }  ",l&&(f+=" if ("+C+") { ",z+="}");return l&&(f+=" "+z+" if ("+B+" == errors) {"),f}},{}],XxjR:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l);l=e.errSchemaPath+"/"+l;var p=!e.opts.allErrors;m="data"+(m||"");var w="errs__"+
d,B=e.util.copy(e);B.level++;var v="valid"+B.level;if(f+="var "+w+" = errors;",e.opts.strictKeywords?"object"==typeof q&&0<Object.keys(q).length||!1===q:e.util.schemaHasRules(q,e.RULES.all)){B.schema=q;B.schemaPath=n;B.errSchemaPath=l;q="key"+d;var z="idx"+d,C="i"+d,A="' + "+q+" + '",F="data"+(B.dataLevel=e.dataLevel+1),E="dataProperties"+d,M=e.opts.ownProperties,J=e.baseId;M&&(f+=" var "+E+" = undefined; ");f=f+(M?" "+E+" = "+E+" || Object.keys("+m+"); for (var "+z+"=0; "+z+"<"+E+".length; "+z+"++) { var "+
q+" = "+E+"["+z+"]; ":" for (var "+q+" in "+m+") { ")+(" var startErrs"+d+" = errors; ");z=e.compositeRule;e.compositeRule=B.compositeRule=!0;E=e.validate(B);B.baseId=J;2>e.util.varOccurences(E,F)?f+=" "+e.util.varReplace(E,F,q)+" ":f+=" var "+F+" = "+q+"; "+E+" ";e.compositeRule=B.compositeRule=z;f+=" if (!"+v+") { for (var "+C+"=startErrs"+d+"; "+C+"<errors; "+C+"++) { vErrors["+C+"].propertyName = "+q+"; }   var err =   ";!1!==e.createErrors?(f+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+
e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { propertyName: '"+A+"' } ",!1!==e.opts.messages&&(f+=" , message: 'property name \\'"+A+"\\' is invalid' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";!e.compositeRule&&p&&(e.async?f+=" throw new ValidationError(vErrors); ":f+=" validate.errors = vErrors; return false; ");
p&&(f+=" break; ");f+=" } }"}return p&&(f+="  if ("+w+" == errors) {"),f}},{}],Dht1:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l);l=e.errSchemaPath+"/"+l;var p=!e.opts.allErrors,w="data"+(m||""),B="valid"+d,v=e.opts.$data&&q&&q.$data;v&&(f+=" var schema"+d+" = "+e.util.getData(q.$data,m,e.dataPathArr)+"; ");var z="schema"+d;if(!v)if(q.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var C=
[];if(q)for(var A=-1,F=q.length-1;A<F;){m=q[A+=1];var E=e.schema.properties[m];E&&(e.opts.strictKeywords?"object"==typeof E&&0<Object.keys(E).length||!1===E:e.util.schemaHasRules(E,e.RULES.all))||(C[C.length]=m)}}else C=q;if(v||C.length){q=e.errorPath;A=v||C.length>=e.opts.loopRequired;m=e.opts.ownProperties;if(p){if(f+=" var missing"+d+"; ",A)v||(f+=" var "+z+" = validate.schema"+n+"; "),C="' + "+(F="schema"+d+"["+(A="i"+d)+"]")+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(q,
F,e.opts.jsonPointers)),f+=" var "+B+" = true; ",v&&(f+=" if (schema"+d+" === undefined) "+B+" = true; else if (!Array.isArray(schema"+d+")) "+B+" = false; else {"),f+=" for (var "+A+" = 0; "+A+" < "+z+".length; "+A+"++) { "+B+" = "+w+"["+z+"["+A+"]] !== undefined ",m&&(f+=" &&   Object.prototype.hasOwnProperty.call("+w+", "+z+"["+A+"]) "),f+="; if (!"+B+") break; } ",v&&(f+="  }  "),(M=M||[]).push(f+("  if (!"+B+") {   ")),f="",!1!==e.createErrors?(f+=" { keyword: 'required' , dataPath: (dataPath || '') + "+
e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+C+"' } ",!1!==e.opts.messages&&(f+=" , message: '",e.opts._errorDataPathProperty?f+="is a required property":f+="should have required property \\'"+C+"\\'",f+="' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),f+=" } "):f+=" {} ",n=f;else{f+=" if ( ";if(z=C)for(A=-1,C=z.length-1;A<C;)B=z[A+=1],A&&(f+=" || "),f+=" ( ( "+(w+(v=e.util.getProperty(B)))+
" === undefined ",m&&(f+=" || ! Object.prototype.hasOwnProperty.call("+w+", '"+e.util.escapeQuotes(B)+"') "),f+=") && (missing"+d+" = "+e.util.toQuotedString(e.opts.jsonPointers?B:v)+") ) ";f+=") {  ";var M;C="' + "+(F="missing"+d)+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(q,F,!0):q+" + "+F);(M=M||[]).push(f);f="";!1!==e.createErrors?(f+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+
C+"' } ",!1!==e.opts.messages&&(f+=" , message: '",e.opts._errorDataPathProperty?f+="is a required property":f+="should have required property \\'"+C+"\\'",f+="' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),f+=" } "):f+=" {} ";n=f}f=M.pop();!e.compositeRule&&p?e.async?f+=" throw new ValidationError(["+n+"]); ":f+=" validate.errors = ["+n+"]; return false; ":f+=" var err = "+n+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";
f+=" } else { "}else if(A)v||(f+=" var "+z+" = validate.schema"+n+"; "),C="' + "+(F="schema"+d+"["+(A="i"+d)+"]")+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(q,F,e.opts.jsonPointers)),v&&(f+=" if ("+z+" && !Array.isArray("+z+")) {  var err =   ",!1!==e.createErrors?(f+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+C+"' } ",!1!==e.opts.messages&&(f+=" , message: '",e.opts._errorDataPathProperty?
f+="is a required property":f+="should have required property \\'"+C+"\\'",f+="' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),f+=" } "):f+=" {} ",f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+z+" !== undefined) { "),f+=" for (var "+A+" = 0; "+A+" < "+z+".length; "+A+"++) { if ("+w+"["+z+"["+A+"]] === undefined ",m&&(f+=" || ! Object.prototype.hasOwnProperty.call("+w+", "+z+"["+
A+"]) "),f+=") {  var err =   ",!1!==e.createErrors?(f+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+C+"' } ",!1!==e.opts.messages&&(f+=" , message: '",e.opts._errorDataPathProperty?f+="is a required property":f+="should have required property \\'"+C+"\\'",f+="' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),f+=" } "):f+=" {} ",
f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",v&&(f+="  }  ");else if(M=C)for(d=-1,p=M.length-1;d<p;)B=M[d+=1],v=e.util.getProperty(B),z=(C=e.util.escapeQuotes(B),w+v),e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(q,B,e.opts.jsonPointers)),f+=" if ( "+z+" === undefined ",m&&(f+=" || ! Object.prototype.hasOwnProperty.call("+w+", '"+e.util.escapeQuotes(B)+"') "),f+=") {  var err =   ",!1!==e.createErrors?(f+=" { keyword: 'required' , dataPath: (dataPath || '') + "+
e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+C+"' } ",!1!==e.opts.messages&&(f+=" , message: '",e.opts._errorDataPathProperty?f+="is a required property":f+="should have required property \\'"+C+"\\'",f+="' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),f+=" } "):f+=" {} ",f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } ";e.errorPath=q}else p&&(f+=
" if (true) {");return f}},{}],mmFQ:[function(t,G,K){G.exports=function(e,l,f){var d;f=" ";var m=e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+"/"+l;l=!e.opts.allErrors;var B="data"+(q||""),v="valid"+m,z=e.opts.$data&&n&&n.$data;if(z?(f+=" var schema"+m+" = "+e.util.getData(n.$data,q,e.dataPathArr)+"; ",d="schema"+m):d=n,(n||z)&&!1!==e.opts.uniqueItems){z&&(f+=" var "+v+"; if ("+d+" === false || "+d+" === undefined) "+v+" = true; else if (typeof "+d+" != 'boolean') "+
v+" = false; else { ");f+=" var i = "+B+".length , "+v+" = true , j; if (i > 1) { ";d=e.schema.items&&e.schema.items.type;m=Array.isArray(d);!d||"object"==d||"array"==d||m&&(0<=d.indexOf("object")||0<=d.indexOf("array"))?f+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+B+"[i], "+B+"[j])) { "+v+" = false; break outer; } } } ":(f=f+(" var itemIndices = {}, item; for (;i--;) { var item = "+B+"[i];  if (")+(e.util["checkDataType"+(m?"s":"")](d,"item",e.opts.strictNumbers,!0)+") continue; "),
m&&(f+=" if (typeof item == 'string') item = '\"' + item; "),f+=" if (typeof itemIndices[item] == 'number') { "+v+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } ");f+=" } ";z&&(f+="  }  ");f+=" if (!"+v+") {   ";var C=C||[];C.push(f);f="";!1!==e.createErrors?(f+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(f+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),
e.opts.verbose&&(f+=" , schema:  ",f+=z?"validate.schema"+p:""+n,f+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+B+" "),f+=" } "):f+=" {} ";n=f;f=C.pop();!e.compositeRule&&l?e.async?f+=" throw new ValidationError(["+n+"]); ":f+=" validate.errors = ["+n+"]; return false; ":f+=" var err = "+n+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";f+=" } ";l&&(f+=" else { ")}else l&&(f+=" if (true) { ");return f}},{}],Czyc:[function(t,G,K){G.exports={$ref:t("./ref"),
allOf:t("./allOf"),anyOf:t("./anyOf"),$comment:t("./comment"),const:t("./const"),contains:t("./contains"),dependencies:t("./dependencies"),enum:t("./enum"),format:t("./format"),if:t("./if"),items:t("./items"),maximum:t("./_limit"),minimum:t("./_limit"),maxItems:t("./_limitItems"),minItems:t("./_limitItems"),maxLength:t("./_limitLength"),minLength:t("./_limitLength"),maxProperties:t("./_limitProperties"),minProperties:t("./_limitProperties"),multipleOf:t("./multipleOf"),not:t("./not"),oneOf:t("./oneOf"),
pattern:t("./pattern"),properties:t("./properties"),propertyNames:t("./propertyNames"),required:t("./required"),uniqueItems:t("./uniqueItems"),validate:t("./validate")}},{"./ref":"a2na","./allOf":"hRgn","./anyOf":"lo6J","./comment":"Kkzr","./const":"U4sD","./contains":"EypH","./dependencies":"Cpp7","./enum":"fqDY","./format":"avoW","./if":"JHQ3","./items":"aiPb","./_limit":"UJAl","./_limitItems":"W8ih","./_limitLength":"fZGX","./_limitProperties":"JAEr","./multipleOf":"oNPH","./not":"mmjm","./oneOf":"SSWF",
"./pattern":"mGZS","./properties":"jFnx","./propertyNames":"XxjR","./required":"Dht1","./uniqueItems":"mmFQ","./validate":"yhC1"}],vBP0:[function(t,G,K){var e=t("../dotjs"),l=t("./util").toHash;G.exports=function(){var f=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties",
"minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:"$ref const enum not anyOf oneOf allOf if".split(" ")}],d=["type","$comment"];return f.all=l(d),f.types=l("number integer string array object boolean null".split(" ")),f.forEach(function(m){m.rules=m.rules.map(function(q){if("object"==typeof q){var n=Object.keys(q)[0];var p=q[n];q=n;p.forEach(function(w){d.push(w);f.all[w]=!0})}return d.push(q),f.all[q]={keyword:q,code:e[q],
implements:p}});f.all.$comment={keyword:"$comment",code:e.$comment};m.type&&(f.types[m.type]=m)}),f.keywords=l(d.concat("$schema $id id $data $async title description default definitions examples readOnly writeOnly contentMediaType contentEncoding additionalItems then else".split(" "))),f.custom={},f}},{"../dotjs":"Czyc","./util":"Q1F7"}],BunE:[function(t,G,K){var e="multipleOf maximum exclusiveMaximum minimum exclusiveMinimum maxLength minLength pattern additionalItems maxItems minItems uniqueItems maxProperties minProperties required additionalProperties enum format const".split(" ");
G.exports=function(l,f){for(var d=0;d<f.length;d++){l=JSON.parse(JSON.stringify(l));var m,q=f[d].split("/"),n=l;for(m=1;m<q.length;m++)n=n[q[m]];for(m=0;m<e.length;m++){q=e[m];var p=n[q];p&&(n[q]={anyOf:[p,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return l}},{}],mNRF:[function(t,G,K){function e(f,d,m){function q(w){return(w=w.$schema)&&!n.getSchema(w)?e.call(n,{$ref:w},!0):Promise.resolve()}var n=this;if("function"!=typeof this._opts.loadSchema)throw Error("options.loadSchema should be a function");
"function"==typeof d&&(m=d,d=void 0);var p=q(f).then(function(){var w=n._addSchema(f,void 0,d);return w.validate||function(B){try{return n._compile(B)}catch(v){if(v instanceof l)return function(z){function C(){delete n._loadingSchemas[A]}var A=z.missingSchema;if(n._refs[A]||n._schemas[A])throw Error("Schema "+A+" is loaded but "+z.missingRef+" cannot be resolved");(z=n._loadingSchemas[A])||(z=n._loadingSchemas[A]=n._opts.loadSchema(A)).then(C,C);return z.then(function(F){if(!n._refs[A]&&!n._schemas[A])return q(F).then(function(){n._refs[A]||
n._schemas[A]||n.addSchema(F,A,void 0,d)})}).then(function(){return function M(E){function J(X){function ja(){delete n._loadingSchemas[S]}var S=X.missingSchema;if(n._refs[S]||n._schemas[S])throw Error("Schema "+S+" is loaded but "+X.missingRef+" cannot be resolved");X=n._loadingSchemas[S];return X||(X=n._loadingSchemas[S]=n._opts.loadSchema(S)).then(ja,ja),X.then(function(W){if(!n._refs[S]&&!n._schemas[S])return q(W).then(function(){n._refs[S]||n._schemas[S]||n.addSchema(W,S,void 0,d)})}).then(function(){return M(E)})}
try{return n._compile(E)}catch(X){if(X instanceof l)return J(X);throw X;}}(B)})}(v);throw v;}}(w)});return m&&p.then(function(w){m(null,w)},m),p}var l=t("./error_classes").MissingRef;G.exports=e},{"./error_classes":"OtNE"}],Mzku:[function(t,G,K){G.exports=function(e,l,f){var d;f=" ";var m=e.level,q=e.dataLevel,n=e.schema[l],p=e.schemaPath+e.util.getProperty(l),w=e.errSchemaPath+"/"+l,B=!e.opts.allErrors,v="data"+(q||""),z="valid"+m,C="errs__"+m,A=e.opts.$data&&n&&n.$data;A?(f+=" var schema"+m+" = "+
e.util.getData(n.$data,q,e.dataPathArr)+"; ",d="schema"+m):d=n;var F,E="definition"+m,M=this.definition,J="";if(A&&M.$data){var X="keywordValidate"+m;var ja=M.validateSchema;f+=" var "+E+" = RULES.custom['"+l+"'].definition; var "+X+" = "+E+".validate;"}else{if(!(F=e.useCustomRule(this,n,e.schema,e)))return;d="validate.schema"+p;X=F.code;var S=M.compile;var W=M.inline;var la=M.macro}l=X+".errors";n="i"+m;var qa="ruleErr"+m,Pa=M.async;if(Pa&&!e.async)throw Error("async keyword in sync schema");if(W||
la||(f+=l+" = null;"),f+="var "+C+" = errors;var "+z+";",A&&M.$data&&(J+="}",f+=" if ("+d+" === undefined) { "+z+" = true; } else { ",ja&&(J+="}",f+=" "+z+" = "+E+".validateSchema("+d+"); if ("+z+") { ")),W)M.statements?f+=" "+F.validate+" ":f+=" "+z+" = "+F.validate+"; ";else if(la){m=e.util.copy(e);J="";m.level++;var Ba="valid"+m.level;m.schema=F.validate;m.schemaPath="";F=e.compositeRule;e.compositeRule=m.compositeRule=!0;S=e.validate(m).replace(/validate\.schema/g,X);e.compositeRule=m.compositeRule=
F;f+=" "+S}else{(Sa=Sa||[]).push(f);f="  "+X+".call( ";e.opts.passContext?f+="this":f+="self";S||!1===M.schema?f+=" , "+v+" ":f+=" , "+d+" , "+v+" , validate.schema"+e.schemaPath+" ";f+=" , (dataPath || '')";'""'!=e.errorPath&&(f+=" + "+e.errorPath);var wa=q?"data"+(q-1||""):"parentData",Na=q?e.dataPathArr[q]:"parentDataProperty";F=f+(" , "+wa+" , "+Na+" , rootData )  ");f=Sa.pop();!1===M.errors?(f+=" "+z+" = ",Pa&&(f+="await "),f+=F+"; "):f+=Pa?" var "+(l="customErrors"+m)+" = null; try { "+z+" = await "+
F+"; } catch (e) { "+z+" = false; if (e instanceof ValidationError) "+l+" = e.errors; else throw e; } ":" "+l+" = null; "+z+" = "+F+"; "}if(M.modifying&&(f+=" if ("+wa+") "+v+" = "+wa+"["+Na+"];"),f+=""+J,M.valid)B&&(f+=" if (true) { ");else{var Sa;f+=" if ( ";void 0===M.valid?(f+=" !",f+=la?""+Ba:""+z):f+=" "+!M.valid+" ";Ba=this.keyword;(Sa=Sa||[]).push(f+") { ");(Sa=Sa||[]).push("");f="";!1!==e.createErrors?(f+=" { keyword: '"+(Ba||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+
e.util.toQuotedString(w)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(f+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(f+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+v+" "),f+=" } "):f+=" {} ";wa=f;f=Sa.pop();!e.compositeRule&&B?e.async?f+=" throw new ValidationError(["+wa+"]); ":f+=" validate.errors = ["+wa+"]; return false; ":f+=" var err = "+wa+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";
wa=f;f=Sa.pop();W?M.errors?"full"!=M.errors&&(f+="  for (var "+n+"="+C+"; "+n+"<errors; "+n+"++) { var "+qa+" = vErrors["+n+"]; if ("+qa+".dataPath === undefined) "+qa+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+qa+".schemaPath === undefined) { "+qa+'.schemaPath = "'+w+'"; } ',e.opts.verbose&&(f+=" "+qa+".schema = "+d+"; "+qa+".data = "+v+"; "),f+=" } "):!1===M.errors?f+=" "+wa+" ":(f+=" if ("+C+" == errors) { "+wa+" } else {  for (var "+n+"="+C+"; "+n+"<errors; "+n+"++) { var "+qa+" = vErrors["+
n+"]; if ("+qa+".dataPath === undefined) "+qa+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+qa+".schemaPath === undefined) { "+qa+'.schemaPath = "'+w+'"; } ',e.opts.verbose&&(f+=" "+qa+".schema = "+d+"; "+qa+".data = "+v+"; "),f+=" } } "):la?(f+="   var err =   ",!1!==e.createErrors?(f+=" { keyword: '"+(Ba||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(w)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(f+=" , message: 'should pass \""+
this.keyword+"\" keyword validation' "),e.opts.verbose&&(f+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+v+" "),f+=" } "):f+=" {} ",f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&B&&(e.async?f+=" throw new ValidationError(vErrors); ":f+=" validate.errors = vErrors; return false; ")):!1===M.errors?f+=" "+wa+" ":(f+=" if (Array.isArray("+l+")) { if (vErrors === null) vErrors = "+l+"; else vErrors = vErrors.concat("+
l+"); errors = vErrors.length;  for (var "+n+"="+C+"; "+n+"<errors; "+n+"++) { var "+qa+" = vErrors["+n+"]; if ("+qa+".dataPath === undefined) "+qa+".dataPath = (dataPath || '') + "+e.errorPath+";  "+qa+'.schemaPath = "'+w+'";  ',e.opts.verbose&&(f+=" "+qa+".schema = "+d+"; "+qa+".data = "+v+"; "),f+=" } } else { "+wa+" } ");f+=" } ";B&&(f+=" else { ")}return f}},{}],ve7q:[function(t,G,K){G.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",
definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:"array boolean integer null number object string".split(" ")},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},
$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},
{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",
additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},
contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}},{}],GIYw:[function(t,G,K){t=t("./refs/json-schema-draft-07.json");G.exports={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:t.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],
$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:t.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}},{"./refs/json-schema-draft-07.json":"ve7q"}],UVv5:[function(t,G,K){function e(m,q){e.errors=null;var n=this._validateKeyword=
this._validateKeyword||this.compile(d,!0);if(n(m))return!0;if(e.errors=n.errors,q)throw Error("custom keyword definition is invalid: "+this.errorsText(n.errors));return!1}var l=/^[a-z_$][a-z0-9_$-]*$/i,f=t("./dotjs/custom"),d=t("./definition_schema");G.exports={add:function(m,q){function n(v,z,C){for(var A,F=0;F<p.length;F++){var E=p[F];if(E.type==z){A=E;break}}A||(A={type:z,rules:[]},p.push(A));z={keyword:v,definition:C,custom:!0,code:f,implements:C.implements};A.rules.push(z);p.custom[v]=z}var p=
this.RULES;if(p.keywords[m])throw Error("Keyword "+m+" is already defined");if(!l.test(m))throw Error("Keyword "+m+" is not a valid identifier");if(q){this.validateKeyword(q,!0);var w=q.type;if(Array.isArray(w))for(var B=0;B<w.length;B++)n(m,w[B],q);else n(m,w,q);(w=q.metaSchema)&&(q.$data&&this._opts.$data&&(w={anyOf:[w,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),q.validateSchema=this.compile(w,!0))}return p.keywords[m]=p.all[m]=!0,this},get:function(m){var q=
this.RULES.custom[m];return q?q.definition:this.RULES.keywords[m]||!1},remove:function(m){var q=this.RULES;delete q.keywords[m];delete q.all[m];delete q.custom[m];for(var n=0;n<q.length;n++)for(var p=q[n].rules,w=0;w<p.length;w++)if(p[w].keyword==m){p.splice(w,1);break}return this},validate:e}},{"./dotjs/custom":"Mzku","./definition_schema":"GIYw"}],xbmT:[function(t,G,K){G.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",
description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}},{}],hi5j:[function(t,G,K){function e(S){if(!(this instanceof e))return new e(S);S=this._opts=M.copy(S)||{};var W=this._opts.logger;if(!1===W)this.logger={log:p,warn:p,error:p};else{if(void 0===W&&(W=console),!("object"==typeof W&&W.log&&W.warn&&W.error))throw Error("logger must implement log, warn and error methods");
this.logger=W}this._schemas={};this._refs={};this._fragments={};this._formats=A(S.format);this._cache=S.cache||new v;this._loadingSchemas={};this._compilations=[];this.RULES=F();a:switch(S.schemaId){case "auto":W=q;break a;case "id":W=d;break a;default:W=m}this._getId=W;S.loopRequired=S.loopRequired||1/0;"property"==S.errorDataPath&&(S._errorDataPathProperty=!0);void 0===S.serialize&&(S.serialize=C);W=M.copy(this._opts);for(var la=0;la<X.length;la++)delete W[X[la]];this._metaOpts=W;if(S.formats)for(var qa in this._opts.formats)this.addFormat(qa,
this._opts.formats[qa]);if(S.keywords)for(var Pa in this._opts.keywords)this.addKeyword(Pa,this._opts.keywords[Pa]);var Ba;if(this._opts.$data&&(Ba=t("./refs/data.json"),this.addMetaSchema(Ba,Ba.$id,!0)),!1!==this._opts.meta)qa=t("./refs/json-schema-draft-07.json"),this._opts.$data&&(qa=E(qa,ja)),this.addMetaSchema(qa,J,!0),this._refs["http://json-schema.org/schema"]=J;"object"==typeof S.meta&&this.addMetaSchema(S.meta);S.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}});if(S=this._opts.schemas)if(Array.isArray(S))this.addSchema(S);
else for(var wa in S)this.addSchema(S[wa],wa)}function l(S,W){return W=B.normalizeId(W),S._schemas[W]||S._refs[W]||S._fragments[W]}function f(S,W,la){for(var qa in W){var Pa=W[qa];Pa.meta||la&&!la.test(qa)||(S._cache.del(Pa.cacheKey),delete W[qa])}}function d(S){return S.$id&&this.logger.warn("schema $id ignored",S.$id),S.id}function m(S){return S.id&&this.logger.warn("schema id ignored",S.id),S.$id}function q(S){if(S.$id&&S.id&&S.$id!=S.id)throw Error("schema $id is different from id");return S.$id||
S.id}function n(S,W){if(S._schemas[W]||S._refs[W])throw Error('schema with key or id "'+W+'" already exists');}function p(){}var w=t("./compile"),B=t("./compile/resolve"),v=t("./cache"),z=t("./compile/schema_obj"),C=t("fast-json-stable-stringify"),A=t("./compile/formats"),F=t("./compile/rules"),E=t("./data"),M=t("./compile/util");G.exports=e;e.prototype.validate=function(S,W){var la;if("string"==typeof S){if(!(la=this.getSchema(S)))throw Error('no schema with key or ref "'+S+'"');}else la=this._addSchema(S),
la=la.validate||this._compile(la);W=la(W);return!0!==la.$async&&(this.errors=la.errors),W};e.prototype.compile=function(S,W){S=this._addSchema(S,void 0,W);return S.validate||this._compile(S)};e.prototype.addSchema=function(S,W,la,qa){if(Array.isArray(S)){for(W=0;W<S.length;W++)this.addSchema(S[W],void 0,la,qa);return this}var Pa=this._getId(S);if(void 0!==Pa&&"string"!=typeof Pa)throw Error("schema id must be string");return n(this,W=B.normalizeId(W||Pa)),this._schemas[W]=this._addSchema(S,la,qa,
!0),this};e.prototype.addMetaSchema=function(S,W,la){return this.addSchema(S,W,la,!0),this};e.prototype.validateSchema=function(S,W){var la=S.$schema;if(void 0!==la&&"string"!=typeof la)throw Error("$schema must be a string");(la=la||this._opts.defaultMeta)||(la=this._opts.meta,la=(this._opts.defaultMeta="object"==typeof la?this._getId(la)||la:this.getSchema(J)?J:void 0,this._opts.defaultMeta));if(!la)return this.logger.warn("meta-schema not available"),this.errors=null,!0;S=this.validate(la,S);if(!S&&
W){W="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw Error(W);this.logger.error(W)}return S};e.prototype.getSchema=function(S){var W=l(this,S);switch(typeof W){case "object":return W.validate||this._compile(W);case "string":return this.getSchema(W);case "undefined":var la=B.schema.call(this,{schema:{}},S);if(la){W=la.schema;var qa=la.root;la=la.baseId;var Pa=w.call(this,W,qa,void 0,la);S=(this._fragments[S]=new z({ref:S,fragment:!0,schema:W,root:qa,baseId:la,validate:Pa}),
Pa)}else S=void 0;return S}};e.prototype.removeSchema=function(S){if(S instanceof RegExp)return f(this,this._schemas,S),f(this,this._refs,S),this;switch(typeof S){case "undefined":return f(this,this._schemas),f(this,this._refs),this._cache.clear(),this;case "string":var W=l(this,S);return W&&this._cache.del(W.cacheKey),delete this._schemas[S],delete this._refs[S],this;case "object":W=(W=this._opts.serialize)?W(S):S,this._cache.del(W),(S=this._getId(S))&&(S=B.normalizeId(S),delete this._schemas[S],
delete this._refs[S])}return this};e.prototype.addFormat=function(S,W){return"string"==typeof W&&(W=new RegExp(W)),this._formats[S]=W,this};e.prototype.errorsText=function(S,W){if(!(S=S||this.errors))return"No errors";var la=void 0===(W=W||{}).separator?", ":W.separator;W=void 0===W.dataVar?"data":W.dataVar;for(var qa="",Pa=0;Pa<S.length;Pa++){var Ba=S[Pa];Ba&&(qa+=W+Ba.dataPath+" "+Ba.message+la)}return qa.slice(0,-la.length)};e.prototype._addSchema=function(S,W,la,qa){if("object"!=typeof S&&"boolean"!=
typeof S)throw Error("schema should be object or boolean");var Pa=this._opts.serialize;Pa=Pa?Pa(S):S;var Ba=this._cache.get(Pa);if(Ba)return Ba;qa=qa||!1!==this._opts.addUsedSchema;(Ba=B.normalizeId(this._getId(S)))&&qa&&n(this,Ba);var wa;(W=!1!==this._opts.validateSchema&&!W)&&!(wa=Ba&&Ba==B.normalizeId(S.$schema))&&this.validateSchema(S,!0);var Na=B.ids.call(this,S);la=new z({id:Ba,schema:S,localRefs:Na,cacheKey:Pa,meta:la});return"#"!=Ba[0]&&qa&&(this._refs[Ba]=la),this._cache.put(Pa,la),W&&wa&&
this.validateSchema(S,!0),la};e.prototype._compile=function(S,W){function la(){var Ba=S.validate,wa=Ba.apply(this,arguments);return la.errors=Ba.errors,wa}if(S.compiling)return S.validate=la,la.schema=S.schema,la.errors=null,la.root=W||la,!0===S.schema.$async&&(la.$async=!0),la;var qa;S.compiling=!0;S.meta&&(qa=this._opts,this._opts=this._metaOpts);try{var Pa=w.call(this,S.schema,W,S.localRefs)}catch(Ba){throw delete S.validate,Ba;}finally{S.compiling=!1,S.meta&&(this._opts=qa)}return S.validate=
Pa,S.refs=Pa.refs,S.refVal=Pa.refVal,S.root=Pa.root,Pa};e.prototype.compileAsync=t("./compile/async");G=t("./keyword");e.prototype.addKeyword=G.add;e.prototype.getKeyword=G.get;e.prototype.removeKeyword=G.remove;e.prototype.validateKeyword=G.validate;G=t("./compile/error_classes");e.ValidationError=G.Validation;e.MissingRefError=G.MissingRef;e.$dataMetaSchema=E;var J="http://json-schema.org/draft-07/schema",X=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],ja=["/properties"]},{"./compile":"qdYs",
"./compile/resolve":"w10T","./cache":"fXCy","./compile/schema_obj":"HHLG","fast-json-stable-stringify":"Xb3N","./compile/formats":"dfAH","./compile/rules":"vBP0","./data":"BunE","./compile/util":"Q1F7","./compile/async":"mNRF","./keyword":"UVv5","./compile/error_classes":"OtNE","./refs/data.json":"xbmT","./refs/json-schema-draft-07.json":"ve7q"}],dhP9:[function(t,G,K){t("buffer");var e=t("buffer").Buffer,l={Object,Array,Function,Number,String,Date,RegExp};G.exports=function m(d){function q(n){var p=
l[n];if(p)return p;throw Error('invalid "instanceof" keyword value '+n);}return void 0!==e&&(l.Buffer=e),"undefined"!=typeof Promise&&(l.Promise=Promise),m.definition={compile:function(n){if("string"==typeof n){var p=q(n);return function(B){return B instanceof p}}var w=n.map(q);return function(B){for(var v=0;v<w.length;v++)if(B instanceof w[v])return!0;return!1}},CONSTRUCTORS:l,metaSchema:{anyOf:[{type:"string"},{type:"array",items:{type:"string"}}]}},d.addKeyword("instanceof",m.definition),d}},{buffer:"dskh"}],
uBCt:[function(t,G,K){G.exports=function f(l){return f.definition={type:"number",macro:function(d,m){var q=d[0];d=d[1];m=m.exclusiveRange;if(void 0!==m&&"boolean"!=typeof m)throw Error("Invalid schema for exclusiveRange keyword, should be boolean");if(q>d||m&&q==d)throw Error("There are no numbers in range");return!0===m?{exclusiveMinimum:q,exclusiveMaximum:d}:{minimum:q,maximum:d}},metaSchema:{type:"array",minItems:2,maxItems:2,items:{type:"number"}}},l.addKeyword("range",f.definition),l.addKeyword("exclusiveRange"),
l}},{}],AtCq:[function(t,G,K){G.exports=function f(l){return f.definition={type:"string",inline:function(d,m,q){try{if("object"==typeof q)var n=new RegExp(q.pattern,q.flags);else{var p=q.match(/^\/(.*)\/([gimuy]*)$/);if(p)n=new RegExp(p[1],p[2]);else throw Error("cannot parse string into RegExp");}}catch(w){throw console.error("regular expression",q,"is invalid"),w;}return n+".test(data"+(d.dataLevel||"")+")"},metaSchema:{type:["string","object"],properties:{pattern:{type:"string"},flags:{type:"string"}},
required:["pattern"],additionalProperties:!1}},l.addKeyword("regexp",f.definition),l}},{}],yoml:[function(t,G,K){var e="undefined string number object function boolean symbol".split(" ");G.exports=function d(f){return d.definition={inline:function(m,q,n){var p="data"+(m.dataLevel||"");return"string"==typeof n?"typeof "+p+' == "'+n+'"':"validate.schema"+m.schemaPath+"."+q+".indexOf(typeof "+p+") >= 0"},metaSchema:{anyOf:[{type:"string",enum:e},{type:"array",items:{type:"string",enum:e}}]}},f.addKeyword("typeof",
d.definition),f}},{}],FbE8:[function(t,G,K){var e={},l={timestamp:function(){return Date.now()},datetime:function(){return(new Date).toISOString()},date:function(){return(new Date).toISOString().slice(0,10)},time:function(){return(new Date).toISOString().slice(11)},random:function(){return Math.random()},randomint:function(f){var d=f&&f.max||2;return function(){return Math.floor(Math.random()*d)}},seq:function(f){var d=f&&f.name||"";return e[d]=e[d]||0,function(){return e[d]++}}};G.exports=function m(d){function q(n){var p=
l[n];if(p)return p;throw Error('invalid "dynamicDefaults" keyword property value: '+n);}return m.definition={compile:function(n,p,w){var B={},v;for(v in n){p=n[v];var z=q("string"==typeof p?p:p.func);B[v]=z.length?z(p.args):z}return w.opts.useDefaults&&!w.compositeRule?function(C){for(var A in n)void 0!==C[A]&&("empty"!=w.opts.useDefaults||null!==C[A]&&""!==C[A])||(C[A]=B[A]());return!0}:function(){return!0}},DEFAULTS:l,metaSchema:{type:"object",additionalProperties:{type:["string","object"],additionalProperties:!1,
required:["func","args"],properties:{func:{type:"string"},args:{type:"object"}}}}},d.addKeyword("dynamicDefaults",m.definition),d}},{}],CJDR:[function(t,G,K){G.exports=function f(l){return f.definition={type:"object",macro:function(d,m){if(!d)return!0;d=Object.keys(m.properties);return 0==d.length||{required:d}},metaSchema:{type:"boolean"},dependencies:["properties"]},l.addKeyword("allRequired",f.definition),l}},{}],n1DR:[function(t,G,K){G.exports=function f(l){return f.definition={type:"object",
macro:function(d){return 0==d.length||(1==d.length?{required:d}:{anyOf:d.map(function(m){return{required:[m]}})})},metaSchema:{type:"array",items:{type:"string"}}},l.addKeyword("anyRequired",f.definition),l}},{}],XrCF:[function(t,G,K){G.exports=function f(l){return f.definition={type:"object",macro:function(d){return 0==d.length||(1==d.length?{required:d}:{oneOf:d.map(function(m){return{required:[m]}})})},metaSchema:{type:"array",items:{type:"string"}}},l.addKeyword("oneRequired",f.definition),l}},
{}],MFGI:[function(t,G,K){G.exports=function f(l){return f.definition={type:"object",macro:function(d){return 0==d.length||(1==d.length?{not:{required:d}}:{not:{anyOf:d.map(function(m){return{required:[m]}})}})},metaSchema:{type:"array",items:{type:"string"}}},l.addKeyword("prohibited",f.definition),l}},{}],m7Ap:[function(t,G,K){function e(f,d){return f.map(function(m){var q=d.items&&d.items.properties;m=q&&q[m]&&q[m].type;return Array.isArray(m)?0>m.indexOf("object")&&0>m.indexOf("array"):0<=l.indexOf(m)})}
var l=["number","integer","string","boolean","null"];G.exports=function m(d){return m.definition={type:"array",compile:function(q,n,p){var w=p.util.equal,B=e(q,n);return function(v){if(1<v.length)for(var z=0;z<q.length;z++){var C,A=q[z];if(B[z]){var F={};for(C=v.length;C--;)if(v[C]&&"object"==typeof v[C]){var E=v[C][A];if(!E||"object"!=typeof E){if("string"==typeof E&&(E='"'+E),F[E])return!1;F[E]=!0}}}else for(C=v.length;C--;)if(v[C]&&"object"==typeof v[C])for(F=C;F--;)if(v[F]&&"object"==typeof v[F]&&
w(v[C][A],v[F][A]))return!1}return!0}},metaSchema:{type:"array",items:{type:"string"}}},d.addKeyword("uniqueItemProperties",m.definition),d}},{}],R4Fp:[function(t,G,K){G.exports={metaSchemaRef:function(l){var f=l._opts.defaultMeta;return"string"==typeof f?{$ref:f}:l.getSchema(e)?{$ref:e}:(console.warn("meta schema not defined"),{})}};var e="http://json-schema.org/draft-07/schema"},{}],kIuQ:[function(t,G,K){var e=t("./_util");G.exports=function d(f){return d.definition={type:"object",macro:function(m){var q=
[],n;for(n in m){for(var p=q,w=p.push,B=m[n],v=n.split("/"),z={},C=z,A=1;A<v.length;A++){var F=v[A],E=A==v.length-1;F=F.replace(/~1/g,"/").replace(/~0/g,"~");var M=C.properties={},J=void 0;if(/[0-9]+/.test(F)){var X=+F;for(J=C.items=[];X--;)J.push({})}C=E?B:{};M[F]=C;J&&J.push(C)}w.call(p,z)}return{allOf:q}},metaSchema:{type:"object",propertyNames:{type:"string",format:"json-pointer"},additionalProperties:e.metaSchemaRef(f)}},f.addKeyword("deepProperties",d.definition),f}},{"./_util":"R4Fp"}],KB8y:[function(t,
G,K){G.exports=function q(m){return q.definition={type:"object",inline:function(n,p,w){var B="";for(p=0;p<w.length;p++){p&&(B+=" && ");var v=w[p];var z="data"+(n.dataLevel||"");if(v){var C=z;v=v.split("/");for(var A=1;A<v.length;A++){var F=v[A].replace(/~1/g,"/").replace(/~0/g,"~");F=l.test(F)?"["+F+"]":e.test(F)?"."+F:"['"+F.replace(f,"\\$&")+"']";C+=" && "+(z+=F)}v=C}else v=z;B+="("+v+" !== undefined)"}return B},metaSchema:{type:"array",items:{type:"string",format:"json-pointer"}}},m.addKeyword("deepRequired",
q.definition),m};var e=/^[a-z$_][a-z$_0-9]*$/i,l=/^[0-9]+$/,f=/'|\\/g},{}],KeB4:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l),p=e.errSchemaPath+"/"+l,w=!e.opts.allErrors,B="data"+(m||""),v="valid"+d;if(f+="var "+v+" = undefined;",!1===e.opts.format)return f+(" "+v+" = true; ");var z=e.schema.format,C=e.opts.$data&&z.$data,A="";if(C)f+=" var "+(F="format"+d)+" = formats["+e.util.getData(z.$data,m,e.dataPathArr)+"] , "+
(E="compare"+d)+" = "+F+" && "+F+".compare;";else{var F;if(!(F=e.formats[z])||!F.compare)return f+("  "+v+" = true; ");var E="formats"+e.util.getProperty(z)+".compare"}var M;z="formatMaximum"==l;F="formatExclusive"+(z?"Maximum":"Minimum");var J=e.schema[F],X=e.opts.$data&&J&&J.$data;z=z?"<":">";var ja="result"+d,S=e.opts.$data&&q&&q.$data;if(S?(f+=" var schema"+d+" = "+e.util.getData(q.$data,m,e.dataPathArr)+"; ",M="schema"+d):M=q,X){J=e.util.getData(J.$data,m,e.dataPathArr);X="exclusive"+d;m="' + "+
(la="op"+d)+" + '";f=f+(" var schemaExcl"+d+" = "+J+";  if (typeof ")+((J="schemaExcl"+d)+" != 'boolean' && "+J+" !== undefined) { "+v+" = false; ");var W=F;(qa=qa||[]).push(f);f="";!1!==e.createErrors?(f+=" { keyword: '"+(W||"_formatExclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: {} ",!1!==e.opts.messages&&(f+=" , message: '"+F+" should be boolean' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+
e.schemaPath+" , data: "+B+" "),f+=" } "):f+=" {} ";F=f;f=qa.pop();!e.compositeRule&&w?e.async?f+=" throw new ValidationError(["+F+"]); ":f+=" validate.errors = ["+F+"]; return false; ":f+=" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";f+=" }  ";w&&(A+="}",f+=" else { ");S&&(f+=" if ("+M+" === undefined) "+v+" = true; else if (typeof "+M+" != 'string') "+v+" = false; else { ",A+="}");C&&(f+=" if (!"+E+") "+v+" = true; else { ",A+="}");f+=" var "+ja+
" = "+E+"("+B+",  ";f+=S?""+M:""+e.util.toQuotedString(q);f+=" ); if ("+ja+" === undefined) "+v+" = false; var "+X+" = "+J+" === true; if ("+v+" === undefined) { "+v+" = "+X+" ? "+ja+" "+z+" 0 : "+ja+" "+z+"= 0; } if (!"+v+") var op"+d+" = "+X+" ? '"+z+"' : '"+z+"=';"}else{m=z;(X=!0===J)||(m+="=");var la="'"+m+"'";S&&(f+=" if ("+M+" === undefined) "+v+" = true; else if (typeof "+M+" != 'string') "+v+" = false; else { ",A+="}");C&&(f+=" if (!"+E+") "+v+" = true; else { ",A+="}");f+=" var "+ja+" = "+
E+"("+B+",  ";f+=S?""+M:""+e.util.toQuotedString(q);f+=" ); if ("+ja+" === undefined) "+v+" = false; if ("+v+" === undefined) "+v+" = "+ja+" "+z;X||(f+="=");f+=" 0;"}f+=A+"if (!"+v+") { ";var qa;W=l;(qa=qa||[]).push(f);f="";!1!==e.createErrors?(f+=" { keyword: '"+(W||"_formatLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { comparison: "+la+", limit:  ",f+=S?""+M:""+e.util.toQuotedString(q),f+=" , exclusive: "+X+" } ",!1!==e.opts.messages&&
(f+=" , message: 'should be "+m+' "',f+=S?"' + "+M+" + '":""+e.util.escapeQuotes(q),f+="\"' "),e.opts.verbose&&(f+=" , schema:  ",f+=S?"validate.schema"+n:""+e.util.toQuotedString(q),f+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+B+" "),f+=" } "):f+=" {} ";F=f;return f=qa.pop(),!e.compositeRule&&w?e.async?f+=" throw new ValidationError(["+F+"]); ":f+=" validate.errors = ["+F+"]; return false; ":f+=" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",
f+"}"}},{}],mYD7:[function(t,G,K){function e(n,p){if(n&&p)return n>p?1:n<p?-1:n===p?0:void 0}function l(n,p){if(n&&p&&(n=n.match(f),p=p.match(f),n&&p))return(n=n[1]+n[2]+n[3]+(n[4]||""))>(p=p[1]+p[2]+p[3]+(p[4]||""))?1:n<p?-1:n===p?0:void 0}var f=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,d=/t|\s/i,m={date:e,time:l,"date-time":function(n,p){if(n&&p){n=n.split(d);p=p.split(d);var w=e(n[0],p[0]);if(void 0!==w)return w||l(n[1],p[1])}}},q={type:"object",required:["$data"],properties:{$data:{type:"string",
anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1};G.exports=function(n){var p="format"+n;return function v(B){v.definition={type:"string",inline:t("./dotjs/_formatLimit"),statements:!0,errors:"full",dependencies:["format"],metaSchema:{anyOf:[{type:"string"},q]}};B.addKeyword(p,v.definition);B.addKeyword("formatExclusive"+n,{dependencies:["format"+n],metaSchema:{anyOf:[{type:"boolean"},q]}});var z=B._formats,C;for(C in m){var A=z[C];("object"!=typeof A||A instanceof
RegExp||!A.validate)&&(A=z[C]={validate:A});A.compare||(A.compare=m[C])}return B}}},{"./dotjs/_formatLimit":"KeB4"}],J927:[function(t,G,K){G.exports=t("./_formatLimit")("Minimum")},{"./_formatLimit":"mYD7"}],dgLz:[function(t,G,K){G.exports=t("./_formatLimit")("Maximum")},{"./_formatLimit":"mYD7"}],OTUE:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l);l=e.errSchemaPath+"/"+l;var p=!e.opts.allErrors;m="data"+(m||"");var w=
"valid"+d,B="key"+d,v="idx"+d,z="patternMatched"+d;d="dataProperties"+d;var C="",A=e.opts.ownProperties;f+="var "+w+" = true;";A&&(f+=" var "+d+" = undefined;");if(q)for(var F,E=-1,M=q.length-1;E<M;)F=q[E+=1],f+=" var "+z+" = false;  ",f+=A?" "+d+" = "+d+" || Object.keys("+m+"); for (var "+v+"=0; "+v+"<"+d+".length; "+v+"++) { var "+B+" = "+d+"["+v+"]; ":" for (var "+B+" in "+m+") { ",f+=" "+z+" = "+e.usePattern(F)+".test("+B+"); if ("+z+") break; } ",F=e.util.escapeQuotes(F),f+=" if (!"+z+") { "+
w+" = false;  var err =   ",!1!==e.createErrors?(f+=" { keyword: 'patternRequired' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingPattern: '"+F+"' } ",!1!==e.opts.messages&&(f+=" , message: 'should have property matching pattern \\'"+F+"\\'' "),e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ",f+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; }   ",
p&&(C+="}",f+=" else { ");return f+(""+C)}},{}],u2zM:[function(t,G,K){G.exports=function f(l){return f.definition={type:"object",inline:t("./dotjs/patternRequired"),statements:!0,errors:"full",metaSchema:{type:"array",items:{type:"string",format:"regex"},uniqueItems:!0}},l.addKeyword("patternRequired",f.definition),l}},{"./dotjs/patternRequired":"OTUE"}],mlCb:[function(t,G,K){G.exports=function(e,l,f){f=" ";var d=e.level,m=e.dataLevel,q=e.schema[l],n=e.schemaPath+e.util.getProperty(l);l=e.errSchemaPath+
"/"+l;var p=!e.opts.allErrors;m="data"+(m||"");var w="valid"+d;d="errs__"+d;var B=e.util.copy(e),v="";B.level++;var z="valid"+B.level,C="ifPassed"+e.level,A=B.baseId;f+="var "+C+";";if(q)for(var F,E=-1,M=q.length-1;E<M;){if(F=q[E+=1],E&&!J&&(f+=" if (!"+C+") { ",v+="}"),F.if&&(e.opts.strictKeywords?"object"==typeof F.if&&0<Object.keys(F.if).length:e.util.schemaHasRules(F.if,e.RULES.all))){f+=" var "+d+" = errors;   ";var J=e.compositeRule;(e.compositeRule=B.compositeRule=!0,B.createErrors=!1,B.schema=
F.if,B.schemaPath=n+"["+E+"].if",B.errSchemaPath=l+"/"+E+"/if",f+="  "+e.validate(B)+" ",B.baseId=A,B.createErrors=!0,e.compositeRule=B.compositeRule=J,f+=" "+C+" = "+z+"; if ("+C+") {  ","boolean"==typeof F.then)?(!1===F.then&&((X=X||[]).push(f),f="",!1!==e.createErrors?(f+=" { keyword: 'switch' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { caseIndex: "+E+" } ",!1!==e.opts.messages&&(f+=" , message: 'should pass \"switch\" keyword validation' "),
e.opts.verbose&&(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ",J=f,f=X.pop(),!e.compositeRule&&p?e.async?f+=" throw new ValidationError(["+J+"]); ":f+=" validate.errors = ["+J+"]; return false; ":f+=" var err = "+J+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "),f+=" var "+z+" = "+F.then+"; "):(B.schema=F.then,B.schemaPath=n+"["+E+"].then",B.errSchemaPath=l+"/"+E+"/then",f+="  "+e.validate(B)+
" ",B.baseId=A);f+="  } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } } "}else if(f+=" "+C+" = true;  ","boolean"==typeof F.then){if(!1===F.then){var X;(X=X||[]).push(f);f="";!1!==e.createErrors?(f+=" { keyword: 'switch' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { caseIndex: "+E+" } ",!1!==e.opts.messages&&(f+=" , message: 'should pass \"switch\" keyword validation' "),e.opts.verbose&&
(f+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";J=f;f=X.pop();!e.compositeRule&&p?e.async?f+=" throw new ValidationError(["+J+"]); ":f+=" validate.errors = ["+J+"]; return false; ":f+=" var err = "+J+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}f+=" var "+z+" = "+F.then+"; "}else B.schema=F.then,B.schemaPath=n+"["+E+"].then",B.errSchemaPath=l+"/"+E+"/then",f+="  "+e.validate(B)+" ",B.baseId=
A;J=F.continue}return f+(v+"var "+w+" = "+z+";")}},{}],KC2b:[function(t,G,K){var e=t("./_util");G.exports=function d(f){if(!f.RULES.keywords.switch||!f.RULES.keywords.if){var m=e.metaSchemaRef(f);return d.definition={inline:t("./dotjs/switch"),statements:!0,errors:"full",metaSchema:{type:"array",items:{required:["then"],properties:{if:m,then:{anyOf:[{type:"boolean"},m]},continue:{type:"boolean"}},additionalProperties:!1,dependencies:{continue:["if"]}}}},f.addKeyword("switch",d.definition),f}}},{"./_util":"R4Fp",
"./dotjs/switch":"mlCb"}],mwue:[function(t,G,K){var e=t("./_util");G.exports=function d(f){function m(w,B){var v;return p.some(function(z){if(z.parentSchema===w)return v=z,!0}),v||!1===B||(v={parentSchema:w,cases:{},default:!0},p.push(v)),v}function q(w){return"boolean"==typeof w?w:f.compile(w)}if(!f._opts.$data)return console.warn("keyword select requires $data option"),f;var n=e.metaSchemaRef(f),p=[];return d.definition={validate:function C(B,v,z){if(void 0===z.selectCases)throw Error('keyword "selectCases" is absent');
z=m(z,!1);B=z.cases[B];if(void 0===B&&(B=z.default),"boolean"==typeof B)return B;v=B(v);return v||(C.errors=B.errors),v},$data:!0,metaSchema:{type:["string","number","boolean","null"]}},f.addKeyword("select",d.definition),f.addKeyword("selectCases",{compile:function(B,v){v=m(v);for(var z in B)v.cases[z]=q(B[z]);return function(){return!0}},valid:!0,metaSchema:{type:"object",additionalProperties:n}}),f.addKeyword("selectDefault",{compile:function(B,v){return m(v).default=q(B),function(){return!0}},
valid:!0,metaSchema:n}),f}},{"./_util":"R4Fp"}],selR:[function(t,G,K){G.exports=function f(l){var d={trimLeft:function(m){return m.replace(/^[\s]+/,"")},trimRight:function(m){return m.replace(/[\s]+$/,"")},trim:function(m){return m.trim()},toLowerCase:function(m){return m.toLowerCase()},toUpperCase:function(m){return m.toUpperCase()},toEnumCase:function(m,q){return q.hash[m.toLowerCase()]||m}};return f.definition={type:"string",errors:!1,modifying:!0,valid:!0,compile:function(m,q){var n;if(-1!==m.indexOf("toEnumCase")){if(n=
{hash:{}},!q.enum)throw Error('Missing enum. To use `transform:["toEnumCase"]`, `enum:[...]` is required.');for(var p=q.enum.length;p--;p){var w=q.enum[p];if("string"==typeof w){var B=w.toLowerCase();if(n.hash[B])throw Error('Invalid enum uniqueness. To use `transform:["toEnumCase"]`, all values must be unique when case insensitive.');n.hash[B]=w}}}return function(v,z,C,A){if(C){z=0;for(var F=m.length;z<F;z++)v=d[m[z]](v,n);C[A]=v}}},metaSchema:{type:"array",items:{type:"string",enum:"trimLeft trimRight trim toLowerCase toUpperCase toEnumCase".split(" ")}}},
l.addKeyword("transform",f.definition),l}},{}],KP4Q:[function(t,G,K){G.exports={instanceof:t("./instanceof"),range:t("./range"),regexp:t("./regexp"),typeof:t("./typeof"),dynamicDefaults:t("./dynamicDefaults"),allRequired:t("./allRequired"),anyRequired:t("./anyRequired"),oneRequired:t("./oneRequired"),prohibited:t("./prohibited"),uniqueItemProperties:t("./uniqueItemProperties"),deepProperties:t("./deepProperties"),deepRequired:t("./deepRequired"),formatMinimum:t("./formatMinimum"),formatMaximum:t("./formatMaximum"),
patternRequired:t("./patternRequired"),switch:t("./switch"),select:t("./select"),transform:t("./transform")}},{"./instanceof":"dhP9","./range":"uBCt","./regexp":"AtCq","./typeof":"yoml","./dynamicDefaults":"FbE8","./allRequired":"CJDR","./anyRequired":"n1DR","./oneRequired":"XrCF","./prohibited":"MFGI","./uniqueItemProperties":"m7Ap","./deepProperties":"kIuQ","./deepRequired":"KB8y","./formatMinimum":"J927","./formatMaximum":"dgLz","./patternRequired":"u2zM","./switch":"KC2b","./select":"mwue","./transform":"selR"}],
n1A8:[function(t,G,K){function e(d,m){if(Array.isArray(m)){for(var q=0;q<m.length;q++)l(m[q])(d);return d}if(m)return l(m)(d),d;for(m in f)l(m)(d);return d}function l(d){var m=f[d];if(!m)throw Error("Unknown keyword "+d);return m}var f=t("./keywords");G.exports=e;e.get=l},{"./keywords":"KP4Q"}],STvH:[function(t,G,K){function e(w){if("undefined"==typeof Symbol||null==w[Symbol.iterator]){if(Array.isArray(w)||(w=l(w))){var B=0,v=function(){};return{s:v,n:function(){return B>=w.length?{done:!0}:{done:!1,
value:w[B++]}},e:function(E){throw E;},f:v}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var z,C,A=!0,F=!1;return{s:function(){z=w[Symbol.iterator]()},n:function(){var E=z.next();return A=E.done,E},e:function(E){F=!0;C=E},f:function(){try{A||null==z.return||z.return()}finally{if(F)throw C;}}}}function l(w,B){if(w){if("string"==typeof w)return f(w,B);var v=Object.prototype.toString.call(w).slice(8,
-1);return"Object"===v&&w.constructor&&(v=w.constructor.name),"Map"===v||"Set"===v?Array.from(v):"Arguments"===v||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?f(w,B):void 0}}function f(w,B){(null==B||B>w.length)&&(B=w.length);for(var v=0,z=Array(B);v<B;v++)z[v]=w[v];return z}function d(w){return w&&w.__esModule?w:{default:w}}function m(w,B){w=p.compile(w);return w(B)?[]:w.errors?q(w.errors):[]}function q(w){var B,v=[];w=e(w);try{var z=function(){var C=B.value,A=C.dataPath,F=[];v=v.filter(function(E){return!E.dataPath.includes(A)||
(E.children&&(F=F.concat(E.children.slice(0))),E.children=void 0,F.push(E),!1)});F.length&&(C.children=F);v.push(C)};for(w.s();!(B=w.n()).done;)z()}catch(C){w.e(C)}finally{w.f()}return v}Object.defineProperty(K,"__esModule",{value:!0});K.validate=function(w,B,v){var z=[];if(Array.isArray(B)?((z=Array.from(B,function(C){return m(w,C)})).forEach(function(C,A){C.forEach(function M(E){E.dataPath="[".concat(A,"]").concat(E.dataPath);E.children&&E.children.forEach(M)})}),z=z.reduce(function(C,A){var F=
C.push,E=F.apply;var M=Array.isArray(A)?f(A):void 0;M||(M="undefined"!=typeof Symbol&&Symbol.iterator in Object(A)?Array.from(A):void 0);if(!(A=M||l(A)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return E.call(F,C,A),C},[])):z=m(w,B),0<z.length)throw new n.default(z,w,v);};Object.defineProperty(K,"ValidationError",{enumerable:!0,get:function(){return n.default}});G=d(t("./keywords/absolutePath"));
var n=d(t("./ValidationError"));K=t("ajv");t=t("ajv-keywords");var p=new K({allErrors:!0,verbose:!0,$data:!0});t(p,["instanceof","formatMinimum","formatMaximum","patternRequired"]);(0,G.default)(p)},{"./keywords/absolutePath":"iIhC","./ValidationError":"ySUA",ajv:"hi5j","ajv-keywords":"n1A8"}],pA46:[function(t,G,K){t=t("./validate");G.exports={validate:t.validate,ValidationError:t.ValidationError}},{"./validate":"STvH"}],t7hQ:[function(t,G,K){function e(f,d){(null==d||d>f.length)&&(d=f.length);for(var m=
0,q=Array(d);m<d;m++)q[m]=f[m];return q}var l=t("schema-utils").validate;G.exports={validateOptions:function(f,d){l(d,f)},processOptions:function(f,d){var m={},q=0;for(d=Object.entries(d);q<d.length;q++){var n=d[q];var p=n;p=Array.isArray(p)?p:void 0;if(!p)if(p=void 0,"undefined"!=typeof Symbol&&Symbol.iterator in Object(n)){var w=[],B=!0,v=!1,z=void 0;try{for(var C=n[Symbol.iterator]();!(B=(p=C.next()).done)&&(w.push(p.value),2!==w.length);B=!0);}catch(A){v=!0,z=A}finally{try{B||null==C.return||
C.return()}finally{if(v)throw z;}}p=w}else p=void 0;p||(n?"string"==typeof n?p=e(n,2):(w=Object.prototype.toString.call(n).slice(8,-1),p=("Object"===w&&n.constructor&&(w=n.constructor.name),"Map"===w||"Set"===w?Array.from(w):"Arguments"===w||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?e(n,2):void 0)):p=void 0);if(!(n=p))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");p=n;n=p[0];
p=p[1];m[n]=f[n];void 0===m[n]&&(m[n]=p.default);p.process&&(m[n]=p.process(m[n]))}return m}}},{"schema-utils":"pA46"}],uYXM:[function(t,G,K){G.exports={type:"object",properties:{filerDir:{type:"string"},shimsDir:{type:"string"},shimFs:{type:"boolean"},shimPath:{type:"boolean"},fsProvider:{type:"string"},fsProviderDir:{type:"string"}}}},{}],qUtu:[function(t,G,K){t("process");K=t("process");var e=t("path"),l=K.cwd();G.exports={filerDir:{process:function(f){return f?e.resolve(f.replace("<rootDir>",
l)):e.join(l,"node_modules","filer")}},shimsDir:{process:function(f){return f?e.resolve(f.replace("<rootDir>",l)):e.join(l,"node_modules","filer","shims")}},fsProviderDir:{process:function(f){return f?e.resolve(f.replace("<rootDir>",l)):e.join(l,"node_modules","filer","shims","providers")}},shimFs:{default:!0},shimPath:{default:!0},fsProvider:{default:"default"}}},{path:"UUq2",process:"pBGv"}],Ge14:[function(t,G,K){function e(n,p){for(var w=0;w<p.length;w++){var B=p[w];B.enumerable=B.enumerable||
!1;B.configurable=!0;"value"in B&&(B.writable=!0);Object.defineProperty(n,B.key,B)}}function l(n,p,w){return p&&e(n.prototype,p),w&&e(n,w),n}var f=t("path"),d=t("./utils"),m=t("./schema"),q=t("./processors");G.exports=function(){function n(){var p=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");d.validateOptions(p,m);this.options=d.processOptions(p,q)}return l(n,[{key:"apply",value:function(p){var w=this;p.hooks.normalModuleFactory.tap("filer-webpack-plugin",
function(B){B.hooks.resolve.tap("filer-webpack-plugin",function(v){if("fsProvider"===v.request&&v.context===w.options.shimsDir)return w.resolveFsProvider(v);if(!v.context.startsWith(w.options.filerDir))switch(v.request){case "fs":if(!w.options.shimFs)break;return w.applyFsShim(v);case "path":if(w.options.shimPath)return w.applyPathShim(v)}})})}},{key:"resolveFsProvider",value:function(p){switch(this.options.fsProvider){case "default":p.request=f.join(this.options.fsProviderDir,"default.js");break;
case "indexeddb":p.request=f.join(this.options.fsProviderDir,"indexeddb.js");break;case "memory":p.request=f.join(this.options.fsProviderDir,"memory.js");break;case "custom":p.request=f.join(this.options.fsProviderDir,"custom.js");break;default:throw Error("Invalid option for fsProvider. fsProvider must be one of 'default', 'indexeddb', 'memory' or 'custom'. If using a custom fsProvider, you must also provide the fsProviderDir option.");}}},{key:"applyFsShim",value:function(p){p.request=f.join(this.options.shimsDir,
"fs.js")}},{key:"applyPathShim",value:function(p){p.request=f.join(this.options.shimsDir,"path.js")}}]),n}()},{path:"UUq2","./utils":"t7hQ","./schema":"uYXM","./processors":"qUtu"}],Focm:[function(t,G,K){t("buffer");K=t("buffer").Buffer;var e=null,l=null;G.exports=l={FileSystem:t("./filesystem/interface.js"),Buffer:K,Path:t("./path.js"),path:t("./path.js"),Errors:t("./errors.js"),Shell:t("./shell/shell.js"),FilerWebpackPlugin:t("./webpack-plugin")};Object.defineProperty(l,"fs",{enumerable:!0,get:function(){return e||=
new l.FileSystem,e}})},{"./filesystem/interface.js":"GMi4","./path.js":"UzoP","./errors.js":"p8GN","./shell/shell.js":"D1Ra","./webpack-plugin":"Ge14",buffer:"dskh"}]},{},["Focm"],"Filer");var __awaiter=this&&this.__awaiter||function(t,G,K,e){function l(f){return f instanceof K?f:new K(function(d){d(f)})}return new (K||=Promise)(function(f,d){function m(p){try{n(e.next(p))}catch(w){d(w)}}function q(p){try{n(e["throw"](p))}catch(w){d(w)}}function n(p){p.done?f(p.value):l(p.value).then(m,q)}n((e=e.apply(t,G||[])).next())})};
class ExternalApp{constructor(t,G){this.windows=[];this.manifest=t;this.name=t.name;this.icon=G+"/"+t.icon;this.source=G;this.package=t.package}open(){return __awaiter(this,void 0,void 0,function*(){if("auto"===this.manifest.type){var t=AliceWM.create(this.manifest.wininfo);const G=document.createElement("iframe");G.setAttribute("style","top:0; left:0; bottom:0; right:0; width:100%; height:100%; "+`border: none; margin: 0; padding: 0; background-color: ${this.manifest.background||"#202124"};`);console.log(this.source);
G.setAttribute("src",`${this.source}/${this.manifest.index}`);t.content.appendChild(G);this.windows.push(t);G.contentWindow.anura=anura;G.contentWindow.AliceWM=AliceWM;taskbar.updateTaskbar();return t}t=yield(yield fetch(`${this.source}/${this.manifest.handler}`)).text();top.window.eval(t);loadingScript(this.source,this);taskbar.updateTaskbar()})}};__awaiter=this&&this.__awaiter||function(t,G,K,e){function l(f){return f instanceof K?f:new K(function(d){d(f)})}return new (K||=Promise)(function(f,d){function m(p){try{n(e.next(p))}catch(w){d(w)}}function q(p){try{n(e["throw"](p))}catch(w){d(w)}}function n(p){p.done?f(p.value):l(p.value).then(m,q)}n((e=e.apply(t,G||[])).next())})};
class x86MgrApp{constructor(){this.name="x86 Manager";this.package="anura.x86mgr";this.icon="/assets/xorg.svg";this.screen_container=React.createElement("div",{id:"screen_container"},React.createElement("div",{style:"white-space: pre; font: 14px monospace; line-height: 14px"}),React.createElement("canvas",null));this.windows=[]}open(){return __awaiter(this,void 0,void 0,function*(){const t=AliceWM.create({title:"x86",width:"700px",height:"500px"});this.windows[0]=t;t.content.appendChild(this.screen_container);
taskbar.updateTaskbar();return t})}};__awaiter=this&&this.__awaiter||function(t,G,K,e){function l(f){return f instanceof K?f:new K(function(d){d(f)})}return new (K||=Promise)(function(f,d){function m(p){try{n(e.next(p))}catch(w){d(w)}}function q(p){try{n(e["throw"](p))}catch(w){d(w)}}function n(p){p.done?f(p.value):l(p.value).then(m,q)}n((e=e.apply(t,G||[])).next())})};
class BrowserApp{constructor(){this.name="Anura Browser";this.package="anura.browser";this.icon="/assets/chrome.svg";this.windows=[]}open(){return __awaiter(this,void 0,void 0,function*(){const t=AliceWM.create({title:"",width:"700px",height:"500px"}),G=document.createElement("iframe");G.style="top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0;";G.setAttribute("src","../../browser.html");t.content.appendChild(G);"true"==localStorage["borderless-aboutbrowser"]&&
(t.content.style.position="absolute",t.content.style.height="100%",t.content.style.display="inline-block",t.content.parentElement.querySelector(".title").style["background-color"]="rgba(0, 0, 0, 0)");this.windows.push(t);taskbar.updateTaskbar();return t})}};__awaiter=this&&this.__awaiter||function(t,G,K,e){function l(f){return f instanceof K?f:new K(function(d){d(f)})}return new (K||=Promise)(function(f,d){function m(p){try{n(e.next(p))}catch(w){d(w)}}function q(p){try{n(e["throw"](p))}catch(w){d(w)}}function n(p){p.done?f(p.value):l(p.value).then(m,q)}n((e=e.apply(t,G||[])).next())})};const decoder=new TextDecoder,encoder=new TextEncoder;V86Starter.prototype.serial1_send=function(t){for(let G=0;G<t.length;G++)this.bus.send("serial1-input",t.charCodeAt(G))};
const SLICE_SIZE=32*Math.pow(2,17),BUF_SIZE=256;
function InitV86Backend(t){return __awaiter(this,void 0,void 0,function*(){const G=indexedDB.open("image",2);G.onupgradeneeded=f=>{f.target.result.createObjectStore("parts")};const K=(yield new Promise(f=>G.onsuccess=f)).target.result;window.loadfile=f=>__awaiter(this,void 0,void 0,function*(){K.transaction("parts","readwrite").objectStore("parts").put(f.size,"size");let d=0;for(;d*SLICE_SIZE<f.size;){const m=yield f.slice(d*SLICE_SIZE,(d+1)*SLICE_SIZE).arrayBuffer();yield new Promise(q=>K.transaction("parts",
"readwrite").objectStore("parts").put(m,d).onsuccess=q);d++;console.log(d/(f.size/SLICE_SIZE))}});const e={},l={size:(yield new Promise(f=>K.transaction("parts").objectStore("parts").get("size").onsuccess=f)).target.result,slice:(f,d)=>__awaiter(this,void 0,void 0,function*(){const m=Math.floor(d/SLICE_SIZE);let q=Math.floor(f/SLICE_SIZE),n=null;for(;q<=m;){var p=e[q];p||(p=(yield new Promise(w=>K.transaction("parts").objectStore("parts").get(q).onsuccess=w)).target.result,e[q]=p);p?(p=p.slice(Math.max(0,
f-q*SLICE_SIZE),d-q*SLICE_SIZE),n=null==n?p:catBufs(n,p),q++):q++}return new Blob([n])}),save:()=>__awaiter(this,void 0,void 0,function*(){const f={};for(const [n,p]of anura.x86.emulator.disk_images.hda.block_cache){var d=n*BUF_SIZE;let w=Math.floor(d/SLICE_SIZE);var m=SLICE_SIZE-d%SLICE_SIZE;const B=p.slice(0,Math.min(BUF_SIZE,m));var q=f[w];q||(q=(yield new Promise(v=>K.transaction("parts").objectStore("parts").get(w).onsuccess=v)).target.result,q=new Uint8Array(q),f[w]=q);q.set(B,d%SLICE_SIZE);
256>m&&(w+=1,d=p.slice(m,BUF_SIZE),m=f[w],m||(m=(yield new Promise(v=>K.transaction("parts").objectStore("parts").get(w).onsuccess=v)).target.result,m=new Uint8Array(m),f[w]=m),m.set(d,0))}d=[];for(const n in f)d.push(new Promise(p=>K.transaction("parts","readwrite").objectStore("parts").put(f[n].buffer,parseInt(n)).onsuccess=p));yield Promise.all(d);anura.notifications.add({title:"x86 Subsystem",description:"Saved root filesystem sucessfully",timeout:5E3})}),set_state:()=>{}};l.__proto__=File.prototype;
return new V86Backend(l,t)})}
class V86Backend{constructor(t,G){this.sendQueue=[];this.nextWrite=null;this.openQueue=[];this.onDataCallbacks={};this.ready=!0;this.act=!1;this.cmd_q=null;this.virt_hda=t;const K=anura.fs,e=Filer.Path,l=Filer.Buffer,f=new K.Shell;this.emulator=new V86Starter({wasm_path:"/lib/v86.wasm",memory_size:536870912,vga_memory_size:8388608,screen_container:G.screen_container,initrd:{url:"/fs/initrd.img"},bzimage:{url:"/fs/bzimage",async:!1},hda:{buffer:t,async:!0},cmdline:"rw init=/bin/systemd root=/dev/sda rootfstype=ext4 random.trust_cpu=on 8250.nr_uarts=10 spectre_v2=off pti=off",filesystem:{fs:K,
sh:f,Path:e,Buffer:l},bios:{url:"/bios/seabios.bin"},vga_bios:{url:"/bios/vgabios.bin"},network_relay_url:"ws://localhost:8001/",autostart:!0,uart1:!0,uart2:!0});let d="",m="";setInterval(()=>{this.virt_hda.save()},9E4);window.addEventListener("beforeunload",q=>__awaiter(this,void 0,void 0,function*(){q.preventDefault();yield this.virt_hda.save()}));this.emulator.add_listener("serial0-output-char",q=>{"\r"===q?(anura.logger.debug(d),this._proc_data(d),d=""):d+=q});this.emulator.add_listener("serial1-output-char",
q=>{"\r"===q?(anura.logger.debug(`111: ${m}`),this._proc_data(m),m=""):m+=q})}closepty(t){this.emulator.serial0_send(`c\n${t}`)}openpty(t,G,K,e){this.write_uint(K,this.s_rows_phys_addr);this.write_uint(G,this.s_cols_phys_addr);this.write_uint(1,this.new_intent_phys_addr);this.ready?(this.ready=!1,this.emulator.serial0_send("\u0006\n"),this.emulator.serial0_send(`${t}\n`)):(this.cmd_q=t,this.act=!0);return new Promise(l=>{this.openQueue.push(f=>{this.onDataCallbacks[f]=e;l(f)})})}resizepty(t,G,K){this.write_uint(K,
this.s_rows_phys_addr);this.write_uint(G,this.s_cols_phys_addr);this.write_uint(t+1,this.resize_intent_phys_addr);this.write_uint(1336,this.read_intent_phys_addr);this.ready?(this.ready=!1,this.emulator.serial0_send("\u0006\n")):this.act=!0}writepty(t,G){const K=encoder.encode(G);this.nextWrite?this.sendQueue.push([G,t]):(this.write_uint(t+1,this.write_intent_phys_addr),this.write_uint(K.length,this.write_nbytes_phys_addr),this.nextWrite=K,this.ready?(this.ready=!1,this.emulator.serial0_send("\u0006\n")):
this.act=!0)}_proc_data(t){return __awaiter(this,void 0,void 0,function*(){var G=t.indexOf("\u0005");if(-1!==G)switch(t=t.substring(G+1),G=t.split(" "),G.shift()){case "i":G=G.map(l=>parseInt(l));[this.read_intent_phys_addr,this.write_intent_phys_addr,this.new_intent_phys_addr,this.read_nbytes_phys_addr,this.write_nbytes_phys_addr,this.s_rows_phys_addr,this.s_cols_phys_addr,this.resize_intent_phys_addr]=G;this.emulator.serial0_send("\u0006\n");break;case "r":var K=parseInt(G[0]);const e=this.read_uint(this.read_nbytes_phys_addr);
G=parseInt(G[1]);K=this.emulator.read_memory(K,e);K=decoder.decode(K);(G=this.onDataCallbacks[G])&&G(K);this.emulator.serial1_send("\u0006\n");break;case "w":G=parseInt(G[0]);this.emulator.write_memory(this.nextWrite,G);this.nextWrite=null;this.write_uint(0,this.write_intent_phys_addr);(G=this.sendQueue.shift())&&this.writepty(G[1],G[0]);this.emulator.serial0_send("\u0006\n");break;case "n":(K=this.openQueue.shift())&&K(parseInt(G[0]));this.emulator.serial0_send("\u0006\n");break;case "v":this.ready=
!0,this.act&&(this.act=this.ready=!1,this.emulator.serial0_send("\u0006\n"),this.cmd_q&&(this.cmd_q=null,this.emulator.serial0_send(`${this.cmd_q}\n`)))}})}read_uint(t){t=this.emulator.read_memory(t,4);return t[0]+(t[1]<<8)+(t[2]<<16)+(t[3]<<24)}write_uint(t,G){t=[t,t>>8,t>>16,t>>24].map(K=>K%256);this.emulator.write_memory(t,G)}}
function a(){return __awaiter(this,void 0,void 0,function*(){const t=anura.x86.emulator;window.emulator=t;yield new Promise(K=>setTimeout(K,300));const G=yield navigator.clipboard.readText();for(const K of G.split("\n"))t.serial0_send(`${K}\n`),yield new Promise(e=>setTimeout(e,10));t.serial0_send("\n\u0004\n")})};__awaiter=this&&this.__awaiter||function(t,G,K,e){function l(f){return f instanceof K?f:new K(function(d){d(f)})}return new (K||=Promise)(function(f,d){function m(p){try{n(e.next(p))}catch(w){d(w)}}function q(p){try{n(e["throw"](p))}catch(w){d(w)}}function n(p){p.done?f(p.value):l(p.value).then(m,q)}n((e=e.apply(t,G||[])).next())})};const windowInformation={},windowID=0;class WindowInformation{constructor(){this.allowMultipleInstance=!1}}
class WMWindow{constructor(t){this.mouseover=this.justresized=this.dragging=!1;this.wininfo=t;this.element=React.createElement("div",{class:"aliceWMwin",style:`
                    width: ${t.width};
                    height: ${t.height};
                `,"on:mouseover":()=>{this.mouseover=!0},"on:mouseout":()=>{this.mouseover=!1},"on:mousedown":this.focus.bind(this)},React.createElement("div",{class:"resizers"},React.createElement("div",{class:"resize-edge left"}),React.createElement("div",{class:"resize-edge right"}),React.createElement("div",{class:"resize-edge top"}),React.createElement("div",{class:"resize-edge bottom"}),React.createElement("div",{class:"resize-corner top-left"}),React.createElement("div",{class:"resize-corner top-right"}),
React.createElement("div",{class:"resize-corner bottom-left"}),React.createElement("div",{class:"resize-corner bottom-right"})),React.createElement("div",{class:"title","on:mousedown":m=>{deactivateFrames();this.dragging=!0;this.originalLeft=this.element.offsetLeft;this.originalTop=this.element.offsetTop;this.mouseLeft=m.clientX;this.mouseTop=m.clientY},"on:mouseup":m=>{reactivateFrames();this.dragging&&(this.handleDrag(m),this.dragging=!1)},"on:mousemove":m=>{this.dragging&&this.handleDrag(m)}},
React.createElement("div",{class:"titleContent"},t.title),React.createElement("button",{class:"windowButton","on:click":()=>{this.minimize()}},React.createElement("img",{src:"/assets/window/minimize.svg",height:"12px",class:"windowButtonIcon"})),React.createElement("button",{class:"windowButton","on:click":this.maximize.bind(this)},React.createElement("img",{src:"/assets/window/maximize.svg","bind:maximizeImg":this,height:"12px",class:"windowButtonIcon"})),React.createElement("button",{class:"windowButton",
"on:click":this.close.bind(this)},React.createElement("img",{src:"/assets/window/close.svg",height:"12px",class:"windowButtonIcon"}))),React.createElement("div",{class:"content","bind:content":this,style:"width: 100%; padding:0; margin:0;"}));document.addEventListener("mousemove",m=>{this.dragging&&this.handleDrag(m)});window.addEventListener("blur",()=>{this.mouseover&&this.focus()});document.addEventListener("mouseup",m=>{reactivateFrames();m=m||window.event;this.dragging&&(this.handleDrag(m),this.dragging=
!1)});t=[...this.element.querySelectorAll(".resize-corner"),...this.element.querySelectorAll(".resize-edge")];let G=0,K=0,e=0,l=0,f=0,d=0;for(let m=0;m<t.length;m++){const q=t[m];q.addEventListener("mousedown",p=>{p.preventDefault();G=parseFloat(getComputedStyle(this.element,null).getPropertyValue("width").replace("px",""));K=parseFloat(getComputedStyle(this.element,null).getPropertyValue("height").replace("px",""));deactivateFrames();e=this.element.getBoundingClientRect().left;l=this.element.getBoundingClientRect().top;
f=p.pageX;d=p.pageY;window.addEventListener("mousemove",n);window.addEventListener("mouseup",()=>{reactivateFrames();window.removeEventListener("mousemove",n)})});const n=p=>{this.maximized&&this.unmaximize();if(q.classList.contains("bottom-right")){var w=G+(p.pageX-f);p=K+(p.pageY-d);20<w&&(this.element.style.width=w+"px");20<p&&(this.element.style.height=p+"px")}else if(q.classList.contains("bottom-left")){w=K+(p.pageY-d);var B=G-(p.pageX-f);20<w&&(this.element.style.height=w+"px");20<B&&(this.element.style.width=
B+"px",this.element.style.left=e+(p.pageX-f)+"px")}else q.classList.contains("top-right")?(w=G+(p.pageX-f),B=K-(p.pageY-d),20<w&&(this.element.style.width=w+"px"),20<B&&(this.element.style.height=B+"px",this.element.style.top=l+(p.pageY-d)+"px")):q.classList.contains("top-left")?(w=G-(p.pageX-f),B=K-(p.pageY-d),20<w&&(this.element.style.width=w+"px",this.element.style.left=e+(p.pageX-f)+"px"),20<B&&(this.element.style.height=B+"px",this.element.style.top=l+(p.pageY-d)+"px")):q.classList.contains("left")?
(w=G-(p.pageX-f),20<w&&(this.element.style.width=w+"px",this.element.style.left=e+(p.pageX-f)+"px")):q.classList.contains("right")?(p=G+(p.pageX-f),20<p&&(this.element.style.width=p+"px")):q.classList.contains("top")?(w=K-(p.pageY-d),20<w&&(this.element.style.height=w+"px",this.element.style.top=l+(p.pageY-d)+"px")):q.classList.contains("bottom")&&(p=K+(p.pageY-d),20<p&&(this.element.style.height=p+"px"))}}}handleDrag(t){this.element.style.left=Math.min(window.innerWidth,Math.max(0,this.originalLeft+
t.clientX-this.mouseLeft))+"px";this.element.style.top=Math.min(window.innerHeight,Math.max(0,this.originalTop+t.clientY-this.mouseTop))+"px";this.maximized&&(this.unmaximize(),this.originalLeft=this.element.offsetLeft,this.originalTop=this.element.offsetTop,this.mouseLeft=t.clientX,this.mouseTop=t.clientY)}focus(){this.element.style.setProperty("z-index",(getHighestZindex()+1).toString());normalizeZindex()}close(){this.element.remove();anura.removeStaleApps()}togglemaximize(){this.maximized?this.unmaximize():
this.maximize()}maximize(){if(this.maximized)this.unmaximize();else{this.oldstyle=this.element.getAttribute("style");var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,G=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.element.style.top="0";this.element.style.left="0";this.element.style.width=`${t}px`;this.element.style.height=`${G-61}px`;this.maximizeImg.src="/assets/window/restore.svg";this.maximized=this.justresized=
!0}}unmaximize(){this.element.setAttribute("style",this.oldstyle);this.maximizeImg.src="/assets/window/maximize.svg";this.justresized=!0;this.maximized=!1}minimize(){this.element.style.display="none"}unminimize(){this.element.style.display=""}}const AliceWM={create:function(t){let G={title:"",minheight:40,minwidth:40,width:"1000px",height:"500px",allowMultipleInstance:!1};"object"==typeof t&&(G=t);"string"==typeof t&&(G.title=t);t=new WMWindow(G);document.body.appendChild(t.element);return t}};
function deactivateFrames(){let t;const G=document.getElementsByTagName("iframe");for(t=0;t<G.length;++t)anura.logger.debug(G[t]),G[t].style.pointerEvents="none"}function reactivateFrames(){let t;const G=document.getElementsByTagName("iframe");for(t=0;t<G.length;++t)G[t].style.pointerEvents="auto"}
function getHighestZindex(){const t=Array.from(document.querySelectorAll(".aliceWMwin"));anura.logger.debug(t);let G=0;for(const K of t)Number(K.style.getPropertyValue("z-index"))>=G&&(G=Number(K.style.getPropertyValue("z-index")));return G}
function normalizeZindex(){return __awaiter(this,void 0,void 0,function*(){const t=Array.from(document.querySelectorAll(".aliceWMwin"));anura.logger.debug(t);var G=9999;for(const K of t)Number(K.style.getPropertyValue("z-index"))<=G&&(G=Number(K.style.getPropertyValue("z-index")));--G;for(const K of t)K.style.setProperty("z-index",(Number(K.style.getPropertyValue("z-index"))-G).toString())})}
function center(t){t&&(t.style.left=(window.innerWidth-t.offsetWidth)/2+"px",t.style.top=(window.innerHeight-t.offsetHeight)/2+"px")};let __effects=[];
class React{static get use(){__effects=[];return t=>{t=__effects;__effects=[];t.__alicejs_marker=!0;return t}}static createElement(t,G,...K){const e=document.createElement(t);if(G){if("if"in G){t=G["if"];const f=G.then,d=G["else"];if("object"===typeof t&&"__alicejs_marker"in t)f&&e.appendChild(f),d&&e.appendChild(d),handle(t,m=>{f?m?(f.style.display="",d&&(d.style.display="none")):(f.style.display="none",d&&(d.style.display="")):e.style.display=m?"":"none"});else if(f)t?e.appendChild(f):d&&e.appendChild(d);
else if(!t)return e.style.display="none",document.createTextNode("");delete G["if"];delete G.then;delete G["else"]}if("for"in G){t=G["for"];const f=G["do"];if("object"===typeof t&&"__alicejs_marker"in t){const d=[];let m=[];handle(t,q=>{if(Object.keys(q).length==m.length){var n=0;for(var p in q)if(!deepEqual(q[p],m[p])){var w=f(q[p],p,q);e.replaceChild(w,d[n]);d[n]=w;n+=1}m=Object.keys(JSON.parse(JSON.stringify(q)))}else{for(w of d)w.remove();for(n in q)p=f(q[n],n,q),d.push(p),e.appendChild(p);m=
[]}})}else for(var l in t){const d=f(t[l],l,t);e.appendChild(d)}delete G["for"];delete G["do"]}for(const f in G)l=G[f],"object"===typeof l&&"__alicejs_marker"in l?handle(l,d=>{__assign_prop(e,f,d)}):__assign_prop(e,f,l)}for(const f of K)if("object"===typeof f&&"__alicejs_marker"in f){const d=document.createTextNode("");e.appendChild(d);handle(f,m=>{d.textContent=m})}else f instanceof Node?e.appendChild(f):e.appendChild(document.createTextNode(f));return e}}
function deepEqual(t,G){var K=Object.keys(t),e=Object.keys(G);if(K.length!==e.length)return!1;for(const l of K){K=t[l];e=G[l];const f=isObject(K)&&isObject(e);if(f&&!deepEqual(K,e)||!f&&K!==e)return!1}return!0}function isObject(t){return null!=t&&"object"===typeof t}
function __assign_prop(t,G,K){if("class"===G)t.className=K;else if("function"===typeof K&&G.startsWith("on:"))t.addEventListener(G.substring(3),K);else if("function"===typeof K&&G.startsWith("observe")){const e=window[`${G.substring(8)}Observer`];e?(new e(l=>{for(const f of l)K(f)})).observe(t):console.error(`Observer ${G} does not exist`)}else G.startsWith("bind:")?(G=G.substring(5),K[G]=t):t.setAttribute(G,K)}
function stateful(t){t.__listeners=[];return new Proxy(t,{get(G,K,e){__effects.push([G,K,e]);return Reflect.get(G,K,e)},set(G,K,e){for(const l of G.__listeners)l(G,K,e);return Reflect.set(G,K,e)}})}function handle(t,G){const K=t[t.length-1];t=(e,l,f)=>{l==K[1]&&e==K[0]&&G(f)};K[0].__listeners.push(t);t(K[0],K[1],K[0][K[1]])};class Taskbar{constructor(){this.state=stateful({apps:[]});this.element=React.createElement("footer",null,React.createElement("div",{id:"launcher-button-container"},React.createElement("div",{id:"launcher-button","on:click":()=>{launcher.toggleVisible()}},React.createElement("img",{src:"/assets/icons/launcher.svg",style:"height:100%;width:100%"}))),React.createElement("nav",{id:"taskbar-bar"},React.createElement("ul",{"bind:activeTray":this,for:React.use(this.state.apps),do:t=>React.createElement("li",
null,React.createElement("input",{type:"image",src:t.icon,class:"showDialog","on:click":G=>{if(0<t.windows.length){const K=new anura.ContextMenu;K.addItem("New Window",()=>{t.open()});for(const e of t.windows)K.addItem(e.wininfo.title,()=>{e.unminimize()});K.show(G.x,G.y-100)}else t.open()}}),React.createElement("div",{class:"lightbar",style:"position: relative; bottom: 1px; background-color:#FFF; width:50%; left:50%; transform:translateX(-50%)"+(0==t.windows.length?";visibility:hidden":""),"bind:lightbar":this}))})))}addShortcut(t){}killself(){this.element.remove()}updateTaskbar(){const t=
anura.settings.get("applist").map(K=>anura.apps[K]),G=Object.values(anura.apps).filter(K=>0<K.windows.length);this.state.apps=[...(new Set([...t,...G]))]}};class ContextMenu{constructor(){this.element=React.createElement("div",{class:"custom-menu",style:"display:none;"},React.createElement("div",{class:"custom-menu-item"},React.createElement("span",{class:"material-symbols-outlined"},React.createElement("span",{class:"material-symbols-outlined"},"shelf_auto_hide"))," ","Always Show Shelf"),React.createElement("div",{class:"custom-menu-item"},React.createElement("span",{class:"material-symbols-outlined"},"shelf_position"),"Shelf Position"),React.createElement("div",
{class:"extra-menu-wrapper"},React.createElement("div",{class:"custom-menu extra-menu"},React.createElement("div",{class:"custom-menu-item"},React.createElement("span",{class:"material-symbols-outlined"},"brush")," Set Wallpaper and Style"))),React.createElement("div",{class:"custom-menu-item"},React.createElement("span",{class:"material-symbols-outlined"},"brush")," Set Wallpaper and Style"))}show(){}};var __classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(t,G,K,e){if("a"===K&&!e)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof G?t!==G||!e:!G.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===K?e:"a"===K?e.call(t):e?e.value:G.get(t)},__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(t,G,K,e,l){if("m"===e)throw new TypeError("Private method is not writable");
if("a"===e&&!l)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof G?t!==G||!l:!G.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===e?l.call(t,K):l?l.value=K:G.set(t,K),K},_ContextMenuAPI_element,_ContextMenuAPI_isShown;
class ContextMenuAPI{item(t,G){return React.createElement("div",{class:"custom-menu-item","on:click":G.bind(this)},t)}constructor(){_ContextMenuAPI_element.set(this,React.createElement("div",{class:"custom-menu",style:""}));_ContextMenuAPI_isShown.set(this,!1)}addItem(t,G){__classPrivateFieldGet(this,_ContextMenuAPI_element,"f").appendChild(this.item(t,function(){this.hide();G()}))}show(t,G){__classPrivateFieldGet(this,_ContextMenuAPI_element,"f").style.top=G.toString()+"px";__classPrivateFieldGet(this,
_ContextMenuAPI_element,"f").style.left=t.toString()+"px";document.body.appendChild(__classPrivateFieldGet(this,_ContextMenuAPI_element,"f"));__classPrivateFieldSet(this,_ContextMenuAPI_isShown,!0,"f")}hide(){__classPrivateFieldGet(this,_ContextMenuAPI_isShown,"f")&&(document.body.removeChild(__classPrivateFieldGet(this,_ContextMenuAPI_element,"f")),__classPrivateFieldSet(this,_ContextMenuAPI_isShown,!1,"f"))}}_ContextMenuAPI_element=new WeakMap;_ContextMenuAPI_isShown=new WeakMap;class Launcher{constructor(){this.element=React.createElement("div",{class:"launcher"},React.createElement("div",{class:"topSearchBar"},React.createElement("img",{src:"/assets/icons/googleg.png"}),React.createElement("input",{placeholder:"Search your tabs, files, apps, and more..."})),React.createElement("div",{class:"recentItemsWrapper"},React.createElement("div",{class:"recentItemsText"},"Continue where you left off")),React.createElement("div",{id:"appsView",class:"appsView"}));this.clickoffChecker=
React.createElement("div",{id:"clickoffChecker",class:"clickoffChecker"})}toggleVisible(){this.element.classList.toggle("active");this.clickoffChecker.classList.toggle("active")}hide(){this.element.classList.remove("active");this.clickoffChecker.classList.remove("active")}addShortcut(t){const G=this.shortcutElement(t);G.addEventListener("click",(...K)=>{this.hide();t.open()});this.element.querySelector("#appsView").appendChild(G)}shortcutElement(t){return React.createElement("div",{class:"app"},React.createElement("input",
{class:"app-shortcut-image showDialog",type:"image",src:t.icon}),React.createElement("div",{class:"app-shortcut-name"},t.name))}};class Bootsplash{constructor(){this.element=React.createElement("div",{class:"bootsplash"},React.createElement("img",{src:"/assets/images/bootsplash.png"}))}};class OobeView{constructor(){this.element=React.createElement("div",{class:"oobe"},React.createElement("div",{"bind:content":this,id:"content"}))}};class OobeWelcomeStep{constructor(){this.element=React.createElement("div",{class:"screen",id:"welcome"},React.createElement("h1",null,"Welcome to your Chromebook"),React.createElement("div",{id:"subtitle"},"Fast. Insecure. Effortless."),React.createElement("div",{id:"gridContent"},React.createElement("div",{id:"topButtons"},React.createElement("button",null,"Random button")),React.createElement("img",{id:"animation",src:"assets/oobe/welcome.gif"}),React.createElement("div",{id:"bottomButtons"},React.createElement("button",
{"bind:nextButton":this,class:"preferredButton"},"Next"))))}};class OobeAssetsStep{constructor(){this.element=React.createElement("div",{class:"screen",id:"downloadingFiles"},React.createElement("div",{id:"assetsDiv",style:"display:none;"}),React.createElement("h1",null,"Downloading assets"),React.createElement("div",{id:"subtitle"},"For the best experience, ChromeOS needs to download assets so that there is no unstyled content."),React.createElement("img",{src:"/assets/oobe/spinner.gif"}),React.createElement("button",{"bind:nextButton":this,class:"preferredButton"},
"Skip OOBE for now"))}};const $=document.querySelector.bind(document),sleep=t=>new Promise(G=>setTimeout(G,t)),dg={};function catBufs(t,G){const K=new Uint8Array(t.byteLength+G.byteLength);K.set(new Uint8Array(t),0);K.set(new Uint8Array(G),t.byteLength);return K.buffer}function dbg(t){t=Object.keys(t)[0];dg[t]=t};__awaiter=this&&this.__awaiter||function(t,G,K,e){function l(f){return f instanceof K?f:new K(function(d){d(f)})}return new (K||=Promise)(function(f,d){function m(p){try{n(e.next(p))}catch(w){d(w)}}function q(p){try{n(e["throw"](p))}catch(w){d(w)}}function n(p){p.done?f(p.value):l(p.value).then(m,q)}n((e=e.apply(t,G||[])).next())})};
class Anura{constructor(t,G){this.initComplete=!1;this.apps={};this.Version="0.2.0 alpha";this.logger={log:console.log.bind(console,"anuraOS:"),debug:console.debug.bind(console,"anuraOS:"),warn:console.warn.bind(console,"anuraOS:"),error:console.error.bind(console,"anuraOS:")};this.ContextMenu=ContextMenuAPI;this.fs=t;this.settings=G;this.notifications=new NotificationService;document.body.appendChild(this.notifications.element)}static new(){return __awaiter(this,void 0,void 0,function*(){const t=
new Filer.FileSystem({name:"anura-mainContext",provider:new Filer.FileSystem.providers.IndexedDB});t.readFileSync=K=>__awaiter(this,void 0,void 0,function*(){return yield new Promise((e,l)=>t.readFile(K,function(f,d){e((new TextDecoder("utf8")).decode(d))}))});const G=yield Settings.new(t);return new Anura(t,G)})}registerApp(t){return __awaiter(this,void 0,void 0,function*(){if(t.package in this.apps)throw"Application already installed";launcher.addShortcut(t);taskbar.addShortcut(t);this.apps[t.package]=
t;this.initComplete&&taskbar.updateTaskbar();return t})}registerExternalApp(t){return __awaiter(this,void 0,void 0,function*(){var G=yield(yield fetch(`${t}/manifest.json`)).json();G=new ExternalApp(G,t);yield anura.registerApp(G);return G})}removeStaleApps(){for(const t in anura.apps){const G=anura.apps[t];G.windows.forEach(K=>{K.element.parentElement||G.windows.splice(G.windows.indexOf(K))})}taskbar.updateTaskbar()}python(t){return __awaiter(this,void 0,void 0,function*(){return yield new Promise((G,
K)=>{K=document.createElement("iframe");K.setAttribute("style","display: none");K.setAttribute("src","/apps/python.app/lib.html");K.id=t;K.onload=function(){return __awaiter(this,void 0,void 0,function*(){console.log("Called from python");const e=yield document.getElementById(t).contentWindow.loadPyodide({stdin:()=>{const l=prompt();echo(l);return l}});e.globals.set("AliceWM",AliceWM);e.globals.set("anura",anura);e.window=document.getElementById(t).contentWindow;G(e)})};document.body.appendChild(K)})})}get wsproxyURL(){let t=
"";t="https:"==location.protocol?t+"wss://":t+"ws://";t+=window.location.origin.split("://")[1];t+="/";return this.settings.get("wsproxy-url")||t}};__awaiter=this&&this.__awaiter||function(t,G,K,e){function l(f){return f instanceof K?f:new K(function(d){d(f)})}return new (K||=Promise)(function(f,d){function m(p){try{n(e.next(p))}catch(w){d(w)}}function q(p){try{n(e["throw"](p))}catch(w){d(w)}}function n(p){p.done?f(p.value):l(p.value).then(m,q)}n((e=e.apply(t,G||[])).next())})};
class Settings{constructor(t,G){this.cache={};this.fs=t;this.cache=G;navigator.serviceWorker.ready.then(K=>{K.active.postMessage({anuraMsg:"readyToGetSettings"})});navigator.serviceWorker.addEventListener("message",K=>{var e;console.log("ajskdhshdkas "+K);"anura.settings.set"==K.data.anura_target&&(null===(e=K.source)||void 0===e?void 0:e.postMessage({anura_target:K.data.anura_target,id:K.data.id,anuraMsg:{anuraMsg:"settingsValue",value:this.cache[K.data.prop]}}))})}static defaultSettings(){return{applist:[]}}static new(t){return __awaiter(this,
void 0,void 0,function*(){const G=this.defaultSettings();try{console.log(t);const K=yield t.readFileSync("/anura_settings.json");Object.assign(G,JSON.parse(K))}catch(K){console.error(K),t.writeFile("/anura_settings.json",JSON.stringify(G))}return new Settings(t,G)})}get(t){return this.cache[t]}has(t){return t in this.cache}set(t,G){return __awaiter(this,void 0,void 0,function*(){this.cache[t]=G;return new Promise(K=>this.fs.writeFile("/anura_settings.json",JSON.stringify(this.cache),K))})}};__awaiter=this&&this.__awaiter||function(t,G,K,e){function l(f){return f instanceof K?f:new K(function(d){d(f)})}return new (K||=Promise)(function(f,d){function m(p){try{n(e.next(p))}catch(w){d(w)}}function q(p){try{n(e["throw"](p))}catch(w){d(w)}}function n(p){p.done?f(p.value):l(p.value).then(m,q)}n((e=e.apply(t,G||[])).next())})};
class NotificationService{constructor(){this.element=React.createElement("div",{class:"notif-container"});this.notifications=[]}add(t){const G=new AnuraNotification(t,()=>{this.remove(G)});this.element.appendChild(G.element);this.notifications.push(G)}remove(t){this.notifications=this.notifications.filter(G=>G!=t);t.element.style.opacity="0";setTimeout(()=>{t.element.remove()},360)}}
class AnuraNotification{constructor(t,G){this.title="Anura Notification";this.description="Anura Description";this.timeout=2E3;this.closeIndicator=!1;this.callback=()=>null;Object.assign(this,t);this.close=G;this.element=React.createElement("div",{class:"notif"},React.createElement("div",{class:"notif-close-indicator"},React.createElement("span",{class:"material-symbols-outlined"},"close")),React.createElement("div",{class:"notif-body","on:click":()=>{this.callback();this.close()}},React.createElement("div",
{class:"notif-title"},this.title),React.createElement("div",{class:"notif-description"},this.description)));setTimeout(()=>{G()},this.timeout)}show(){return __awaiter(this,void 0,void 0,function*(){function t(){const q=document.getElementById(G);null!=q&&(q.style.opacity="0",setTimeout(()=>{null===K||void 0===K?void 0:K.removeChild(q)},360))}const G=crypto.randomUUID(),K=document.getElementsByClassName("notif-container")[0],e=document.createElement("div");e.className="notif";const l=document.createElement("div");
l.className="notif-body";const f=document.createElement("div");f.className="notif-title";const d=document.createElement("div");d.className="notif-description";if(this.closeIndicator){const q=document.createElement("div");q.className="notif-close-indicator";q.innerHTML='<span class="material-symbols-outlined">close</span>';e.appendChild(q)}f.innerText=this.title;d.innerText=this.description;e.id=G;const m=this.callback;e.onclick=function(){t();m()};l.appendChild(f);l.appendChild(d);e.appendChild(l);
null===K||void 0===K?void 0:K.appendChild(e);setTimeout(()=>{t()},this.timeout)})}};__awaiter=this&&this.__awaiter||function(t,G,K,e){function l(f){return f instanceof K?f:new K(function(d){d(f)})}return new (K||=Promise)(function(f,d){function m(p){try{n(e.next(p))}catch(w){d(w)}}function q(p){try{n(e["throw"](p))}catch(w){d(w)}}function n(p){p.done?f(p.value):l(p.value).then(m,q)}n((e=e.apply(t,G||[])).next())})};const channel=new BroadcastChannel("tab");channel.postMessage("newtab");let activetab=!0;
channel.addEventListener("message",t=>{"newtab"===t.data&&activetab&&channel.postMessage("blackmanthunderstorm");if("blackmanthunderstorm"===t.data){activetab=!1;for(const G of[...document.children])G.remove();document.open();document.write("you already have an anura tab open");document.close()}});const taskbar=new Taskbar,launcher=new Launcher,contextMenu=new ContextMenu,bootsplash=new Bootsplash,oobeview=new OobeView,oobewelcomestep=new OobeWelcomeStep,oobeassetsstep=new OobeAssetsStep;let anura;
window.addEventListener("load",()=>__awaiter(void 0,void 0,void 0,function*(){document.body.appendChild(bootsplash.element);anura=yield Anura.new();window.anura=anura;bootsplash.element.remove();anura.logger.debug("boot completed");document.dispatchEvent(new Event("anura-boot-completed"))}));document.addEventListener("anura-boot-completed",()=>__awaiter(void 0,void 0,void 0,function*(){document.dispatchEvent(new Event("anura-login-completed"))}));
document.addEventListener("anura-login-completed",()=>__awaiter(void 0,void 0,void 0,function*(){var t,G=new BrowserApp;anura.registerApp(G);anura.registerExternalApp("apps/term.app");anura.registerExternalApp("apps/glxgears.app");anura.registerExternalApp("apps/eruda.app");anura.registerExternalApp("apps/vnc.app");anura.registerExternalApp("apps/sshy.app");anura.registerExternalApp("apps/fsapp.app");anura.registerExternalApp("apps/chideNewNew.app");anura.registerExternalApp("apps/python.app");anura.registerExternalApp("apps/workstore.app");
anura.registerExternalApp("apps/settings.app");try{anura.fs.readdir("/userApps",(K,e)=>{void 0!=e&&e.forEach(l=>{try{anura.registerExternalApp("/fs/userApps/"+l)}catch(f){anura.logger.error("Anura failed to load an app "+f)}})})}catch(K){anura.logger.error(K)}404===(yield yield fetch("/fs/")).status&&anura.notifications.add({title:"Anura Error",description:"Anura has encountered an error with the Filesystem HTTP bridge, click this notification to restart",timeout:5E4,callback:()=>window.location.reload()});
if(!anura.settings.get("x86-disabled")){G=new x86MgrApp;yield anura.registerApp(G);const K=React.createElement("input",{type:"file",id:"input"});document.body.appendChild(K);anura.x86=yield InitV86Backend(G)}document.body.appendChild(contextMenu.element);document.body.appendChild(launcher.element);document.body.appendChild(launcher.clickoffChecker);document.body.appendChild(taskbar.element);window.taskbar=taskbar;document.addEventListener("contextmenu",function(K){if(!K.shiftKey){K.preventDefault();
var e=document.querySelector(".custom-menu");e.style.removeProperty("display");e.style.top=`${K.clientY}px`;e.style.left=`${K.clientX}px`}});document.addEventListener("click",K=>{0==K.button&&document.querySelector(".custom-menu").style.setProperty("display","none")});null===(t=launcher.clickoffChecker)||void 0===t?void 0:t.addEventListener("click",()=>{launcher.toggleVisible()});anura.initComplete=!0;taskbar.updateTaskbar()}));
